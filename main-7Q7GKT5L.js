import{a as P,b as J,c as Mx,d as Vr,e as Ax,f as Rx,g as Ur,h as y,j as i_,k as r_,n as Ox,o as o_}from"./chunk-7F6XFQYV.js";var Hr={};Ax(Hr,{__addDisposableResource:()=>H_,__assign:()=>Fc,__asyncDelegator:()=>L_,__asyncGenerator:()=>Vc,__asyncValues:()=>Uc,__await:()=>pi,__awaiter:()=>G,__classPrivateFieldGet:()=>z_,__classPrivateFieldIn:()=>$_,__classPrivateFieldSet:()=>B_,__createBinding:()=>jc,__decorate:()=>x_,__disposeResources:()=>W_,__esDecorate:()=>I_,__exportStar:()=>P_,__extends:()=>S_,__generator:()=>O_,__importDefault:()=>U_,__importStar:()=>V_,__makeTemplateObject:()=>j_,__metadata:()=>R_,__param:()=>D_,__propKey:()=>M_,__read:()=>eh,__rest:()=>Li,__rewriteRelativeImportExtension:()=>G_,__runInitializers:()=>T_,__setFunctionName:()=>A_,__spread:()=>N_,__spreadArray:()=>F_,__spreadArrays:()=>k_,__values:()=>Lc,default:()=>qx});function S_(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Qp(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Li(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e}function x_(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o}function D_(n,t){return function(e,i){t(e,i,n)}}function I_(n,t,e,i,r,o){function s(A){if(A!==void 0&&typeof A!="function")throw new TypeError("Function expected");return A}for(var a=i.kind,u=a==="getter"?"get":a==="setter"?"set":"value",f=!t&&n?i.static?n:n.prototype:null,h=t||(f?Object.getOwnPropertyDescriptor(f,i.name):{}),m,b=!1,_=e.length-1;_>=0;_--){var w={};for(var M in i)w[M]=M==="access"?{}:i[M];for(var M in i.access)w.access[M]=i.access[M];w.addInitializer=function(A){if(b)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(A||null))};var I=(0,e[_])(a==="accessor"?{get:h.get,set:h.set}:h[u],w);if(a==="accessor"){if(I===void 0)continue;if(I===null||typeof I!="object")throw new TypeError("Object expected");(m=s(I.get))&&(h.get=m),(m=s(I.set))&&(h.set=m),(m=s(I.init))&&r.unshift(m)}else(m=s(I))&&(a==="field"?r.unshift(m):h[u]=m)}f&&Object.defineProperty(f,i.name,h),b=!0}function T_(n,t,e){for(var i=arguments.length>2,r=0;r<t.length;r++)e=i?t[r].call(n,e):t[r].call(n);return i?e:void 0}function M_(n){return typeof n=="symbol"?n:"".concat(n)}function A_(n,t,e){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:e?"".concat(e," ",t):t})}function R_(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function G(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(h){try{f(i.next(h))}catch(m){s(m)}}function u(h){try{f(i.throw(h))}catch(m){s(m)}}function f(h){h.done?o(h.value):r(h.value).then(a,u)}f((i=i.apply(n,t||[])).next())})}function O_(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(h){return u([f,h])}}function u(f){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(e=0)),e;)try{if(i=1,r&&(o=f[0]&2?r.return:f[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,f[1])).done)return o;switch(r=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,r=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){e.label=f[1];break}if(f[0]===6&&e.label<o[1]){e.label=o[1],o=f;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(f);break}o[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(n,e)}catch(h){f=[6,h],r=0}finally{i=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function P_(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&jc(t,n,e)}function Lc(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function eh(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),r,o=[],s;try{for(;(t===void 0||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(s)throw s.error}}return o}function N_(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(eh(arguments[t]));return n}function k_(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var i=Array(n),r=0,t=0;t<e;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}function F_(n,t,e){if(e||arguments.length===2)for(var i=0,r=t.length,o;i<r;i++)(o||!(i in t))&&(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return n.concat(o||Array.prototype.slice.call(t))}function pi(n){return this instanceof pi?(this.v=n,this):new pi(n)}function Vc(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(n,t||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(_){return function(w){return Promise.resolve(w).then(_,m)}}function a(_,w){i[_]&&(r[_]=function(M){return new Promise(function(I,A){o.push([_,M,I,A])>1||u(_,M)})},w&&(r[_]=w(r[_])))}function u(_,w){try{f(i[_](w))}catch(M){b(o[0][3],M)}}function f(_){_.value instanceof pi?Promise.resolve(_.value.v).then(h,m):b(o[0][2],_)}function h(_){u("next",_)}function m(_){u("throw",_)}function b(_,w){_(w),o.shift(),o.length&&u(o[0][0],o[0][1])}}function L_(n){var t,e;return t={},i("next"),i("throw",function(r){throw r}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(r,o){t[r]=n[r]?function(s){return(e=!e)?{value:pi(n[r](s)),done:!1}:o?o(s):s}:o}}function Uc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof Lc=="function"?Lc(n):n[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(o){e[o]=n[o]&&function(s){return new Promise(function(a,u){s=n[o](s),r(a,u,s.done,s.value)})}}function r(o,s,a,u){Promise.resolve(u).then(function(f){o({value:f,done:a})},s)}}function j_(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function V_(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e=Xp(n),i=0;i<e.length;i++)e[i]!=="default"&&jc(t,n,e[i]);return Wx(t,n),t}function U_(n){return n&&n.__esModule?n:{default:n}}function z_(n,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(n):i?i.value:t.get(n)}function B_(n,t,e,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(n,e):r?r.value=e:t.set(n,e),e}function $_(n,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?t===n:n.has(t)}function H_(n,t,e){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var i,r;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],e&&(r=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");r&&(i=function(){try{r.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:i,async:e})}else e&&n.stack.push({async:!0});return t}function W_(n){function t(o){n.error=n.hasError?new Gx(o,n.error,"An error was suppressed during disposal."):o,n.hasError=!0}var e,i=0;function r(){for(;e=n.stack.pop();)try{if(!e.async&&i===1)return i=0,n.stack.push(e),Promise.resolve().then(r);if(e.dispose){var o=e.dispose.call(e.value);if(e.async)return i|=2,Promise.resolve(o).then(r,function(s){return t(s),r()})}else i|=1}catch(s){t(s)}if(i===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return r()}function G_(n,t){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,i,r,o,s){return i?t?".jsx":".js":r&&(!o||!s)?e:r+o+"."+s.toLowerCase()+"js"}):n}var Qp,Fc,jc,Wx,Xp,Gx,qx,Ve=Mx(()=>{"use strict";Qp=function(n,t){return Qp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},Qp(n,t)};Fc=function(){return Fc=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Fc.apply(this,arguments)};jc=Object.create?function(n,t,e,i){i===void 0&&(i=e);var r=Object.getOwnPropertyDescriptor(t,e);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,i,r)}:function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]};Wx=Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t},Xp=function(n){return Xp=Object.getOwnPropertyNames||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[e.length]=i);return e},Xp(n)};Gx=typeof SuppressedError=="function"?SuppressedError:function(n,t,e){var i=new Error(e);return i.name="SuppressedError",i.error=n,i.suppressed=t,i};qx={__extends:S_,__assign:Fc,__rest:Li,__decorate:x_,__param:D_,__esDecorate:I_,__runInitializers:T_,__propKey:M_,__setFunctionName:A_,__metadata:R_,__awaiter:G,__generator:O_,__createBinding:jc,__exportStar:P_,__values:Lc,__read:eh,__spread:N_,__spreadArrays:k_,__spreadArray:F_,__await:pi,__asyncGenerator:Vc,__asyncDelegator:L_,__asyncValues:Uc,__makeTemplateObject:j_,__importStar:V_,__importDefault:U_,__classPrivateFieldGet:z_,__classPrivateFieldSet:B_,__classPrivateFieldIn:$_,__addDisposableResource:H_,__disposeResources:W_,__rewriteRelativeImportExtension:G_}});var _v=Vr(vv=>{"use strict";Object.defineProperty(vv,"__esModule",{value:!0});var gv=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};vv.default=gv});var wv=Vr(bv=>{"use strict";Object.defineProperty(bv,"__esModule",{value:!0});var aS=(Ve(),Ur(Hr)),$P=aS.__importDefault((o_(),Ur(Ox))),HP=aS.__importDefault(_v()),yv=class{constructor(t){var e,i;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(i=t.isMaybeSingle)!==null&&i!==void 0?i:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=$P.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let i=this.fetch,r=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(o=>y(this,null,function*(){var s,a,u,f;let h=null,m=null,b=null,_=o.status,w=o.statusText;if(o.ok){if(this.method!=="HEAD"){let L=yield o.text();L===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((s=this.headers.get("Accept"))===null||s===void 0)&&s.includes("application/vnd.pgrst.plan+text"))?m=L:m=JSON.parse(L))}let I=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),A=(u=o.headers.get("content-range"))===null||u===void 0?void 0:u.split("/");I&&A&&A.length>1&&(b=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(h={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,b=null,_=406,w="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{let I=yield o.text();try{h=JSON.parse(I),Array.isArray(h)&&o.status===404&&(m=[],h=null,_=200,w="OK")}catch{o.status===404&&I===""?(_=204,w="No Content"):h={message:I}}if(h&&this.isMaybeSingle&&(!((f=h?.details)===null||f===void 0)&&f.includes("0 rows"))&&(h=null,_=200,w="OK"),h&&this.shouldThrowOnError)throw new HP.default(h)}return{error:h,data:m,count:b,status:_,statusText:w}}));return this.shouldThrowOnError||(r=r.catch(o=>{var s,a,u;return{error:{message:`${(s=o?.name)!==null&&s!==void 0?s:"FetchError"}: ${o?.message}`,details:`${(a=o?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(u=o?.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}};bv.default=yv});var Sv=Vr(Cv=>{"use strict";Object.defineProperty(Cv,"__esModule",{value:!0});var WP=(Ve(),Ur(Hr)),GP=WP.__importDefault(wv()),Ev=class extends GP.default{select(t){let e=!1,i=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:r,referencedTable:o=r}={}){let s=o?`${o}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${t}.${e?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){let r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:i,referencedTable:r=i}={}){let o=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(s,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:r=!1,wal:o=!1,format:s="text"}={}){var a;let u=[t?"analyze":null,e?"verbose":null,i?"settings":null,r?"buffers":null,o?"wal":null].filter(Boolean).join("|"),f=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${f}"; options=${u};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};Cv.default=Ev});var Pf=Vr(Dv=>{"use strict";Object.defineProperty(Dv,"__esModule",{value:!0});var qP=(Ve(),Ur(Hr)),JP=qP.__importDefault(Sv()),KP=new RegExp("[,()]"),xv=class extends JP.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){let i=Array.from(new Set(e)).map(r=>typeof r=="string"&&KP.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:r}={}){let o="";r==="plain"?o="pl":r==="phrase"?o="ph":r==="websearch"&&(o="w");let s=i===void 0?"":`(${i})`;return this.url.searchParams.append(t,`${o}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach(([e,i])=>{this.url.searchParams.append(e,`eq.${i}`)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){let r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};Dv.default=xv});var Mv=Vr(Tv=>{"use strict";Object.defineProperty(Tv,"__esModule",{value:!0});var YP=(Ve(),Ur(Hr)),Xl=YP.__importDefault(Pf()),Iv=class{constructor(t,{headers:e={},schema:i,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=i,this.fetch=r}select(t,e){let{head:i=!1,count:r}=e??{},o=i?"HEAD":"GET",s=!1,a=(t??"*").split("").map(u=>/\s/.test(u)&&!s?"":(u==='"'&&(s=!s),u)).join("");return this.url.searchParams.set("select",a),r&&this.headers.append("Prefer",`count=${r}`),new Xl.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:i=!0}={}){var r;let o="POST";if(e&&this.headers.append("Prefer",`count=${e}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){let s=t.reduce((a,u)=>a.concat(Object.keys(u)),[]);if(s.length>0){let a=[...new Set(s)].map(u=>`"${u}"`);this.url.searchParams.set("columns",a.join(","))}}return new Xl.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:r,defaultToNull:o=!0}={}){var s;let a="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){let u=t.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(u.length>0){let f=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new Xl.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}update(t,{count:e}={}){var i;let r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Xl.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:t}={}){var e;let i="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Xl.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}};Tv.default=Iv});var cS=Vr(Rv=>{"use strict";Object.defineProperty(Rv,"__esModule",{value:!0});var lS=(Ve(),Ur(Hr)),ZP=lS.__importDefault(Mv()),QP=lS.__importDefault(Pf()),Av=class n{constructor(t,{headers:e={},schema:i,fetch:r}={}){this.url=t,this.headers=new Headers(e),this.schemaName=i,this.fetch=r}from(t){let e=new URL(`${this.url}/${t}`);return new ZP.default(e,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new n(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:r=!1,count:o}={}){var s;let a,u=new URL(`${this.url}/rpc/${t}`),f;i||r?(a=i?"HEAD":"GET",Object.entries(e).filter(([m,b])=>b!==void 0).map(([m,b])=>[m,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([m,b])=>{u.searchParams.append(m,b)})):(a="POST",f=e);let h=new Headers(this.headers);return o&&h.set("Prefer",`count=${o}`),new QP.default({method:a,url:u,headers:h,schema:this.schemaName,body:f,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};Rv.default=Av});var gS=Vr(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.PostgrestError=sn.PostgrestBuilder=sn.PostgrestTransformBuilder=sn.PostgrestFilterBuilder=sn.PostgrestQueryBuilder=sn.PostgrestClient=void 0;var Ks=(Ve(),Ur(Hr)),uS=Ks.__importDefault(cS());sn.PostgrestClient=uS.default;var dS=Ks.__importDefault(Mv());sn.PostgrestQueryBuilder=dS.default;var fS=Ks.__importDefault(Pf());sn.PostgrestFilterBuilder=fS.default;var pS=Ks.__importDefault(Sv());sn.PostgrestTransformBuilder=pS.default;var hS=Ks.__importDefault(wv());sn.PostgrestBuilder=hS.default;var mS=Ks.__importDefault(_v());sn.PostgrestError=mS.default;sn.default={PostgrestClient:uS.default,PostgrestQueryBuilder:dS.default,PostgrestFilterBuilder:fS.default,PostgrestTransformBuilder:pS.default,PostgrestBuilder:hS.default,PostgrestError:mS.default}});var Np;function gc(){return Np}function fi(n){let t=Np;return Np=n,t}var s_=Symbol("NotFound");function Ho(n){return n===s_||n?.name==="\u0275NotFound"}var zt=null,vc=!1,kp=1,Px=null,Bt=Symbol("SIGNAL");function ce(n){let t=zt;return zt=n,t}function wc(){return zt}var Wo={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Go(n){if(vc)throw new Error("");if(zt===null)return;zt.consumerOnSignalRead(n);let t=zt.producersTail;if(t!==void 0&&t.producer===n)return;let e,i=zt.recomputing;if(i&&(e=t!==void 0?t.nextProducer:zt.producers,e!==void 0&&e.producer===n)){zt.producersTail=e,e.lastReadVersion=n.version;return}let r=n.consumersTail;if(r!==void 0&&r.consumer===zt&&(!i||kx(r,zt)))return;let o=Jo(zt),s={producer:n,consumer:zt,nextProducer:e,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};zt.producersTail=s,t!==void 0?t.nextProducer=s:zt.producers=s,o&&u_(n,s)}function a_(){kp++}function Ec(n){if(!(Jo(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===kp)){if(!n.producerMustRecompute(n)&&!pa(n)){bc(n);return}n.producerRecomputeValue(n),bc(n)}}function Fp(n){if(n.consumers===void 0)return;let t=vc;vc=!0;try{for(let e=n.consumers;e!==void 0;e=e.nextConsumer){let i=e.consumer;i.dirty||Nx(i)}}finally{vc=t}}function Lp(){return zt?.consumerAllowSignalWrites!==!1}function Nx(n){n.dirty=!0,Fp(n),n.consumerMarkedDirty?.(n)}function bc(n){n.dirty=!1,n.lastCleanEpoch=kp}function qo(n){return n&&l_(n),ce(n)}function l_(n){n.producersTail=void 0,n.recomputing=!0}function fa(n,t){ce(t),n&&c_(n)}function c_(n){n.recomputing=!1;let t=n.producersTail,e=t!==void 0?t.nextProducer:n.producers;if(e!==void 0){if(Jo(n))do e=jp(e);while(e!==void 0);t!==void 0?t.nextProducer=void 0:n.producers=void 0}}function pa(n){for(let t=n.producers;t!==void 0;t=t.nextProducer){let e=t.producer,i=t.lastReadVersion;if(i!==e.version||(Ec(e),i!==e.version))return!0}return!1}function ha(n){if(Jo(n)){let t=n.producers;for(;t!==void 0;)t=jp(t)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function u_(n,t){let e=n.consumersTail,i=Jo(n);if(e!==void 0?(t.nextConsumer=e.nextConsumer,e.nextConsumer=t):(t.nextConsumer=void 0,n.consumers=t),t.prevConsumer=e,n.consumersTail=t,!i)for(let r=n.producers;r!==void 0;r=r.nextProducer)u_(r.producer,r)}function jp(n){let t=n.producer,e=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,i!==void 0?i.prevConsumer=r:t.consumersTail=r,r!==void 0)r.nextConsumer=i;else if(t.consumers=i,!Jo(t)){let o=t.producers;for(;o!==void 0;)o=jp(o)}return e}function Jo(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function Cc(n){Px?.(n)}function kx(n,t){let e=t.producersTail;if(e!==void 0){let i=t.producers;do{if(i===n)return!0;if(i===e)break;i=i.nextProducer}while(i!==void 0)}return!1}function Sc(n,t){return Object.is(n,t)}function xc(n,t){let e=Object.create(Fx);e.computation=n,t!==void 0&&(e.equal=t);let i=()=>{if(Ec(e),Go(e),e.value===da)throw e.error;return e.value};return i[Bt]=e,Cc(e),i}var _c=Symbol("UNSET"),yc=Symbol("COMPUTING"),da=Symbol("ERRORED"),Fx=J(P({},Wo),{value:_c,dirty:!0,error:null,equal:Sc,kind:"computed",producerMustRecompute(n){return n.value===_c||n.value===yc},producerRecomputeValue(n){if(n.value===yc)throw new Error("");let t=n.value;n.value=yc;let e=qo(n),i,r=!1;try{i=n.computation(),ce(null),r=t!==_c&&t!==da&&i!==da&&n.equal(t,i)}catch(o){i=da,n.error=o}finally{fa(n,e)}if(r){n.value=t;return}n.value=i,n.version++}});function Lx(){throw new Error}var d_=Lx;function f_(n){d_(n)}function Vp(n){d_=n}var jx=null;function Up(n,t){let e=Object.create(Dc);e.value=n,t!==void 0&&(e.equal=t);let i=()=>p_(e);return i[Bt]=e,Cc(e),[i,s=>Ko(e,s),s=>zp(e,s)]}function p_(n){return Go(n),n.value}function Ko(n,t){Lp()||f_(n),n.equal(n.value,t)||(n.value=t,Vx(n))}function zp(n,t){Lp()||f_(n),Ko(n,t(n.value))}var Dc=J(P({},Wo),{equal:Sc,value:void 0,kind:"signal"});function Vx(n){n.version++,a_(),Fp(n),jx?.(n)}function de(n){return typeof n=="function"}function Yo(n){let e=n(i=>{Error.call(i),i.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Ic=Yo(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function zr(n,t){if(n){let e=n.indexOf(t);0<=e&&n.splice(e,1)}}var Xe=class n{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let o of e)o.remove(this);else e.remove(this);let{initialTeardown:i}=this;if(de(i))try{i()}catch(o){t=o instanceof Ic?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{h_(o)}catch(s){t=t??[],s instanceof Ic?t=[...t,...s.errors]:t.push(s)}}if(t)throw new Ic(t)}}add(t){var e;if(t&&t!==this)if(this.closed)h_(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}}_hasParent(t){let{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){let{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&zr(e,t)}remove(t){let{_finalizers:e}=this;e&&zr(e,t),t instanceof n&&t._removeParent(this)}};Xe.EMPTY=(()=>{let n=new Xe;return n.closed=!0,n})();var Bp=Xe.EMPTY;function Tc(n){return n instanceof Xe||n&&"closed"in n&&de(n.remove)&&de(n.add)&&de(n.unsubscribe)}function h_(n){de(n)?n():n.unsubscribe()}var Jn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Zo={setTimeout(n,t,...e){let{delegate:i}=Zo;return i?.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){let{delegate:t}=Zo;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Mc(n){Zo.setTimeout(()=>{let{onUnhandledError:t}=Jn;if(t)t(n);else throw n})}function ma(){}var m_=$p("C",void 0,void 0);function g_(n){return $p("E",void 0,n)}function v_(n){return $p("N",n,void 0)}function $p(n,t,e){return{kind:n,value:t,error:e}}var Br=null;function Qo(n){if(Jn.useDeprecatedSynchronousErrorHandling){let t=!Br;if(t&&(Br={errorThrown:!1,error:null}),n(),t){let{errorThrown:e,error:i}=Br;if(Br=null,e)throw i}}else n()}function __(n){Jn.useDeprecatedSynchronousErrorHandling&&Br&&(Br.errorThrown=!0,Br.error=n)}var $r=class extends Xe{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Tc(t)&&t.add(this)):this.destination=Bx}static create(t,e,i){return new lr(t,e,i)}next(t){this.isStopped?Wp(v_(t),this):this._next(t)}error(t){this.isStopped?Wp(g_(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Wp(m_,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Ux=Function.prototype.bind;function Hp(n,t){return Ux.call(n,t)}var Gp=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Ac(i)}}error(t){let{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Ac(i)}else Ac(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Ac(e)}}},lr=class extends $r{constructor(t,e,i){super();let r;if(de(t)||!t)r={next:t??void 0,error:e??void 0,complete:i??void 0};else{let o;this&&Jn.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Hp(t.next,o),error:t.error&&Hp(t.error,o),complete:t.complete&&Hp(t.complete,o)}):r=t}this.destination=new Gp(r)}};function Ac(n){Jn.useDeprecatedSynchronousErrorHandling?__(n):Mc(n)}function zx(n){throw n}function Wp(n,t){let{onStoppedNotification:e}=Jn;e&&Zo.setTimeout(()=>e(n,t))}var Bx={closed:!0,next:ma,error:zx,complete:ma};var Xo=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Kt(n){return n}function qp(...n){return Jp(n)}function Jp(n){return n.length===0?Kt:n.length===1?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}var we=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){let i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){let o=Hx(e)?e:new lr(e,i,r);return Qo(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return i=y_(i),new i((r,o)=>{let s=new lr({next:a=>{try{e(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(e){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(e)}[Xo](){return this}pipe(...e){return Jp(e)(this)}toPromise(e){return e=y_(e),new e((i,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>i(o))})}}return n.create=t=>new n(t),n})();function y_(n){var t;return(t=n??Jn.Promise)!==null&&t!==void 0?t:Promise}function $x(n){return n&&de(n.next)&&de(n.error)&&de(n.complete)}function Hx(n){return n&&n instanceof $r||$x(n)&&Tc(n)}function Kp(n){return de(n?.lift)}function ye(n){return t=>{if(Kp(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function he(n,t,e,i,r){return new Yp(n,t,e,i,r)}var Yp=class extends $r{constructor(t,e,i,r,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(u){t.error(u)}}:super._next,this._error=r?function(a){try{r(a)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function es(){return ye((n,t)=>{let e=null;n._refCount++;let i=he(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){e=null;return}let r=n._connection,o=e;e=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}var ts=class extends we{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Kp(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Xe;let e=this.getSubject();t.add(this.source.subscribe(he(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Xe.EMPTY)}return t}refCount(){return es()(this)}};var b_=Yo(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var We=(()=>{class n extends we{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let i=new Rc(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new b_}next(e){Qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(e)}})}error(e){Qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:i,isStopped:r,observers:o}=this;return i||r?Bp:(this.currentObservers=null,o.push(e),new Xe(()=>{this.currentObservers=null,zr(o,e)}))}_checkFinalizedStatuses(e){let{hasError:i,thrownError:r,isStopped:o}=this;i?e.error(r):o&&e.complete()}asObservable(){let e=new we;return e.source=this,e}}return n.create=(t,e)=>new Rc(t,e),n})(),Rc=class extends We{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.next)===null||i===void 0||i.call(e,t)}error(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.error)===null||i===void 0||i.call(e,t)}complete(){var t,e;(e=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||e===void 0||e.call(t)}_subscribe(t){var e,i;return(i=(e=this.source)===null||e===void 0?void 0:e.subscribe(t))!==null&&i!==void 0?i:Bp}};var Ge=class extends We{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){let{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}};var Zp={now(){return(Zp.delegate||Date).now()},delegate:void 0};var Oc=class extends Xe{constructor(t,e){super()}schedule(t,e=0){return this}};var ga={setInterval(n,t,...e){let{delegate:i}=ga;return i?.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){let{delegate:t}=ga;return(t?.clearInterval||clearInterval)(n)},delegate:void 0};var Pc=class extends Oc{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;let r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,e)),this.pending=!0,this.delay=e,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,e),this}requestAsyncId(t,e,i=0){return ga.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(i!=null&&this.delay===i&&this.pending===!1)return e;e!=null&&ga.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let i=this._execute(t,e);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i=!1,r;try{this.work(t)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,zr(i,this),t!=null&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}};var ns=class n{constructor(t,e=n.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}};ns.now=Zp.now;var Nc=class extends ns{constructor(t,e=ns.now){super(t,e),this.actions=[],this._active=!1}flush(t){let{actions:e}=this;if(this._active){e.push(t);return}let i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}};var w_=new Nc(Pc);var jt=new we(n=>n.complete());function E_(n){return n&&de(n.schedule)}function C_(n){return n[n.length-1]}function kc(n){return de(C_(n))?n.pop():void 0}function cr(n){return E_(C_(n))?n.pop():void 0}Ve();var zc=n=>n&&typeof n.length=="number"&&typeof n!="function";function Bc(n){return de(n?.then)}function $c(n){return de(n[Xo])}function Hc(n){return Symbol.asyncIterator&&de(n?.[Symbol.asyncIterator])}function Wc(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Jx(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Gc=Jx();function qc(n){return de(n?.[Gc])}Ve();function Jc(n){return Vc(this,arguments,function*(){let e=n.getReader();try{for(;;){let{value:i,done:r}=yield pi(e.read());if(r)return yield pi(void 0);yield yield pi(i)}}finally{e.releaseLock()}})}function Kc(n){return de(n?.getReader)}function ft(n){if(n instanceof we)return n;if(n!=null){if($c(n))return Kx(n);if(zc(n))return Yx(n);if(Bc(n))return Zx(n);if(Hc(n))return q_(n);if(qc(n))return Qx(n);if(Kc(n))return Xx(n)}throw Wc(n)}function Kx(n){return new we(t=>{let e=n[Xo]();if(de(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Yx(n){return new we(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}function Zx(n){return new we(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Mc)})}function Qx(n){return new we(t=>{for(let e of n)if(t.next(e),t.closed)return;t.complete()})}function q_(n){return new we(t=>{eD(n,t).catch(e=>t.error(e))})}function Xx(n){return q_(Jc(n))}function eD(n,t){var e,i,r,o;return G(this,void 0,void 0,function*(){try{for(e=Uc(n);i=yield e.next(),!i.done;){let s=i.value;if(t.next(s),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=e.return)&&(yield o.call(e))}finally{if(r)throw r.error}}t.complete()})}function cn(n,t,e,i=0,r=!1){let o=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function Yc(n,t=0){return ye((e,i)=>{e.subscribe(he(i,r=>cn(i,n,()=>i.next(r),t),()=>cn(i,n,()=>i.complete(),t),r=>cn(i,n,()=>i.error(r),t)))})}function Zc(n,t=0){return ye((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function J_(n,t){return ft(n).pipe(Zc(t),Yc(t))}function K_(n,t){return ft(n).pipe(Zc(t),Yc(t))}function Y_(n,t){return new we(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}function Z_(n,t){return new we(e=>{let i;return cn(e,t,()=>{i=n[Gc](),cn(e,t,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(s){e.error(s);return}o?e.complete():e.next(r)},0,!0)}),()=>de(i?.return)&&i.return()})}function Qc(n,t){if(!n)throw new Error("Iterable cannot be null");return new we(e=>{cn(e,t,()=>{let i=n[Symbol.asyncIterator]();cn(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function Q_(n,t){return Qc(Jc(n),t)}function X_(n,t){if(n!=null){if($c(n))return J_(n,t);if(zc(n))return Y_(n,t);if(Bc(n))return K_(n,t);if(Hc(n))return Qc(n,t);if(qc(n))return Z_(n,t);if(Kc(n))return Q_(n,t)}throw Wc(n)}function B(n,t){return t?X_(n,t):ft(n)}function K(...n){let t=cr(n);return B(n,t)}function is(n,t){let e=de(n)?n:()=>n,i=r=>r.error(e());return new we(t?r=>t.schedule(i,0,r):i)}function th(n){return!!n&&(n instanceof we||de(n.lift)&&de(n.subscribe))}var yn=Yo(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function bn(n,t){let e=typeof t=="object";return new Promise((i,r)=>{let o=!1,s;n.subscribe({next:a=>{s=a,o=!0},error:r,complete:()=>{o?i(s):e?i(t.defaultValue):r(new yn)}})})}function ze(n,t){let e=typeof t=="object";return new Promise((i,r)=>{let o=new lr({next:s=>{i(s),o.unsubscribe()},error:r,complete:()=>{e?i(t.defaultValue):r(new yn)}});n.subscribe(o)})}function fe(n,t){return ye((e,i)=>{let r=0;e.subscribe(he(i,o=>{i.next(n.call(t,o,r++))}))})}var{isArray:tD}=Array;function nD(n,t){return tD(t)?n(...t):n(t)}function Xc(n){return fe(t=>nD(n,t))}var{isArray:iD}=Array,{getPrototypeOf:rD,prototype:oD,keys:sD}=Object;function eu(n){if(n.length===1){let t=n[0];if(iD(t))return{args:t,keys:null};if(aD(t)){let e=sD(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}function aD(n){return n&&typeof n=="object"&&rD(n)===oD}function tu(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function va(...n){let t=cr(n),e=kc(n),{args:i,keys:r}=eu(n);if(i.length===0)return B([],t);let o=new we(lD(i,t,r?s=>tu(r,s):Kt));return e?o.pipe(Xc(e)):o}function lD(n,t,e=Kt){return i=>{ey(t,()=>{let{length:r}=n,o=new Array(r),s=r,a=r;for(let u=0;u<r;u++)ey(t,()=>{let f=B(n[u],t),h=!1;f.subscribe(he(i,m=>{o[u]=m,h||(h=!0,a--),a||i.next(e(o.slice()))},()=>{--s||i.complete()}))},i)},i)}}function ey(n,t,e){n?cn(e,n,t):t()}function ty(n,t,e,i,r,o,s,a){let u=[],f=0,h=0,m=!1,b=()=>{m&&!u.length&&!f&&t.complete()},_=M=>f<i?w(M):u.push(M),w=M=>{o&&t.next(M),f++;let I=!1;ft(e(M,h++)).subscribe(he(t,A=>{r?.(A),o?_(A):t.next(A)},()=>{I=!0},void 0,()=>{if(I)try{for(f--;u.length&&f<i;){let A=u.shift();s?cn(t,s,()=>w(A)):w(A)}b()}catch(A){t.error(A)}}))};return n.subscribe(he(t,_,()=>{m=!0,b()})),()=>{a?.()}}function st(n,t,e=1/0){return de(t)?st((i,r)=>fe((o,s)=>t(i,o,r,s))(ft(n(i,r))),e):(typeof t=="number"&&(e=t),ye((i,r)=>ty(i,r,n,e)))}function ur(n=1/0){return st(Kt,n)}function ny(){return ur(1)}function rs(...n){return ny()(B(n,cr(n)))}function _a(n){return new we(t=>{ft(n()).subscribe(t)})}function nh(...n){let t=kc(n),{args:e,keys:i}=eu(n),r=new we(o=>{let{length:s}=e;if(!s){o.complete();return}let a=new Array(s),u=s,f=s;for(let h=0;h<s;h++){let m=!1;ft(e[h]).subscribe(he(o,b=>{m||(m=!0,f--),a[h]=b},()=>u--,void 0,()=>{(!u||!m)&&(f||o.next(i?tu(i,a):a),o.complete())}))}});return t?r.pipe(Xc(t)):r}function at(n,t){return ye((e,i)=>{let r=0;e.subscribe(he(i,o=>n.call(t,o,r++)&&i.next(o)))})}function ji(n){return ye((t,e)=>{let i=null,r=!1,o;i=t.subscribe(he(e,void 0,void 0,s=>{o=ft(n(s,ji(n)(t))),i?(i.unsubscribe(),i=null,o.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(e))})}function iy(n,t,e,i,r){return(o,s)=>{let a=e,u=t,f=0;o.subscribe(he(s,h=>{let m=f++;u=a?n(u,h,m):(a=!0,h),i&&s.next(u)},r&&(()=>{a&&s.next(u),s.complete()})))}}function hi(n,t){return de(t)?st(n,t,1):st(n,1)}function ih(n,t=w_){return ye((e,i)=>{let r=null,o=null,s=null,a=()=>{if(r){r.unsubscribe(),r=null;let f=o;o=null,i.next(f)}};function u(){let f=s+n,h=t.now();if(h<f){r=this.schedule(void 0,f-h),i.add(r);return}a()}e.subscribe(he(i,f=>{o=f,s=t.now(),r||(r=t.schedule(u,n),i.add(r))},()=>{a(),i.complete()},void 0,()=>{o=r=null}))})}function dr(n){return ye((t,e)=>{let i=!1;t.subscribe(he(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function St(n){return n<=0?()=>jt:ye((t,e)=>{let i=0;t.subscribe(he(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function rh(n,t=Kt){return n=n??cD,ye((e,i)=>{let r,o=!0;e.subscribe(he(i,s=>{let a=t(s);(o||!n(r,a))&&(o=!1,r=a,i.next(s))}))})}function cD(n,t){return n===t}function nu(n=uD){return ye((t,e)=>{let i=!1;t.subscribe(he(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function uD(){return new yn}function Wr(n){return ye((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function Vi(n,t){let e=arguments.length>=2;return i=>i.pipe(n?at((r,o)=>n(r,o,i)):Kt,St(1),e?dr(t):nu(()=>new yn))}function os(n){return n<=0?()=>jt:ye((t,e)=>{let i=[];t.subscribe(he(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function oh(n,t){let e=arguments.length>=2;return i=>i.pipe(n?at((r,o)=>n(r,o,i)):Kt,os(1),e?dr(t):nu(()=>new yn))}function sh(n,t){return ye(iy(n,t,arguments.length>=2,!0))}function ah(...n){let t=cr(n);return ye((e,i)=>{(t?rs(n,e,t):rs(n,e)).subscribe(i)})}function qe(n,t){return ye((e,i)=>{let r=null,o=0,s=!1,a=()=>s&&!r&&i.complete();e.subscribe(he(i,u=>{r?.unsubscribe();let f=0,h=o++;ft(n(u,h)).subscribe(r=he(i,m=>i.next(t?t(u,m,h,f++):m),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function Kn(n){return ye((t,e)=>{ft(n).subscribe(he(e,()=>e.complete(),ma)),!e.closed&&t.subscribe(e)})}function xt(n,t,e){let i=de(n)||t||e?{next:n,error:t,complete:e}:n;return i?ye((r,o)=>{var s;(s=i.subscribe)===null||s===void 0||s.call(i);let a=!0;r.subscribe(he(o,u=>{var f;(f=i.next)===null||f===void 0||f.call(i,u),o.next(u)},()=>{var u;a=!1,(u=i.complete)===null||u===void 0||u.call(i),o.complete()},u=>{var f;a=!1,(f=i.error)===null||f===void 0||f.call(i,u),o.error(u)},()=>{var u,f;a&&((u=i.unsubscribe)===null||u===void 0||u.call(i)),(f=i.finalize)===null||f===void 0||f.call(i)}))}):Kt}function ry(n){let t=ce(null);try{return n()}finally{ce(t)}}var su="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",z=class extends Error{code;constructor(t,e){super($i(t,e)),this.code=t}};function dD(n){return`NG0${Math.abs(n)}`}function $i(n,t){return`${dD(n)}${t?": "+t:""}`}var Hi=globalThis;function Te(n){for(let t in n)if(n[t]===Te)return t;throw Error("")}function ay(n,t){for(let e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function zi(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(zi).join(", ")}]`;if(n==null)return""+n;let t=n.overriddenName||n.name;if(t)return`${t}`;let e=n.toString();if(e==null)return""+e;let i=e.indexOf(`
`);return i>=0?e.slice(0,i):e}function au(n,t){return n?t?`${n} ${t}`:n:t||""}var fD=Te({__forward_ref__:Te});function yt(n){return n.__forward_ref__=yt,n.toString=function(){return zi(this())},n}function Vt(n){return yh(n)?n():n}function yh(n){return typeof n=="function"&&n.hasOwnProperty(fD)&&n.__forward_ref__===yt}function V(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function wn(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ea(n){return pD(n,lu)}function bh(n){return Ea(n)!==null}function pD(n,t){return n.hasOwnProperty(t)&&n[t]||null}function hD(n){let t=n?.[lu]??null;return t||null}function ch(n){return n&&n.hasOwnProperty(ru)?n[ru]:null}var lu=Te({\u0275prov:Te}),ru=Te({\u0275inj:Te}),Y=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=V({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function wh(n){return n&&!!n.\u0275providers}var Eh=Te({\u0275cmp:Te}),Ch=Te({\u0275dir:Te}),Sh=Te({\u0275pipe:Te}),xh=Te({\u0275mod:Te}),ba=Te({\u0275fac:Te}),Yr=Te({__NG_ELEMENT_ID__:Te}),oy=Te({__NG_ENV_ID__:Te});function Zn(n){return typeof n=="string"?n:n==null?"":String(n)}function ly(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Zn(n)}var cy=Te({ngErrorCode:Te}),mD=Te({ngErrorMessage:Te}),gD=Te({ngTokenPath:Te});function Dh(n,t){return uy("",-200,t)}function cu(n,t){throw new z(-201,!1)}function uy(n,t,e){let i=new z(t,n);return i[cy]=t,i[mD]=n,e&&(i[gD]=e),i}function vD(n){return n[cy]}var uh;function dy(){return uh}function Yt(n){let t=uh;return uh=n,t}function Ih(n,t,e){let i=Ea(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(e&8)return null;if(t!==void 0)return t;cu(n,"Injector")}var _D={},Gr=_D,yD="__NG_DI_FLAG__",dh=class{injector;constructor(t){this.injector=t}retrieve(t,e){let i=qr(e)||0;try{return this.injector.get(t,i&8?null:Gr,i)}catch(r){if(Ho(r))return r;throw r}}};function bD(n,t=0){let e=gc();if(e===void 0)throw new z(-203,!1);if(e===null)return Ih(n,void 0,t);{let i=wD(t),r=e.retrieve(n,i);if(Ho(r)){if(i.optional)return null;throw r}return r}}function U(n,t=0){return(dy()||bD)(Vt(n),t)}function N(n,t){return U(n,qr(t))}function qr(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function wD(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function fh(n){let t=[];for(let e=0;e<n.length;e++){let i=Vt(n[e]);if(Array.isArray(i)){if(i.length===0)throw new z(900,!1);let r,o=0;for(let s=0;s<i.length;s++){let a=i[s],u=ED(a);typeof u=="number"?u===-1?r=a.token:o|=u:r=a}t.push(U(r,o))}else t.push(U(i))}return t}function ED(n){return n[yD]}function fr(n,t){let e=n.hasOwnProperty(ba);return e?n[ba]:null}function fy(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=t[i];if(e&&(r=e(r),o=e(o)),o!==r)return!1}return!0}function py(n){return n.flat(Number.POSITIVE_INFINITY)}function uu(n,t){n.forEach(e=>Array.isArray(e)?uu(e,t):t(e))}function Th(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Ca(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function hy(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(r===1)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;){let o=r-2;n[r]=n[o],r--}n[t]=e,n[t+1]=i}}function du(n,t,e){let i=as(n,t);return i>=0?n[i|1]=e:(i=~i,hy(n,i,t,e)),i}function fu(n,t){let e=as(n,t);if(e>=0)return n[e|1]}function as(n,t){return CD(n,t,1)}function CD(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){let o=i+(r-i>>1),s=n[o<<e];if(t===s)return o<<e;s>t?r=o:i=o+1}return~(r<<e)}var hr={},Zt=[],Wi=new Y(""),Mh=new Y("",-1),Ah=new Y(""),wa=class{get(t,e=Gr){if(e===Gr){let r=uy("",-201);throw r.name="\u0275NotFound",r}return e}};function Rh(n){return n[xh]||null}function Gi(n){return n[Eh]||null}function Oh(n){return n[Ch]||null}function my(n){return n[Sh]||null}function mi(n){return{\u0275providers:n}}function gy(n){return mi([{provide:Wi,multi:!0,useValue:n}])}function vy(...n){return{\u0275providers:Ph(!0,n),\u0275fromNgModule:!0}}function Ph(n,...t){let e=[],i=new Set,r,o=s=>{e.push(s)};return uu(t,s=>{let a=s;ou(a,o,[],i)&&(r||=[],r.push(a))}),r!==void 0&&_y(r,o),e}function _y(n,t){for(let e=0;e<n.length;e++){let{ngModule:i,providers:r}=n[e];Nh(r,o=>{t(o,i)})}}function ou(n,t,e,i){if(n=Vt(n),!n)return!1;let r=null,o=ch(n),s=!o&&Gi(n);if(!o&&!s){let u=n.ngModule;if(o=ch(u),o)r=u;else return!1}else{if(s&&!s.standalone)return!1;r=n}let a=i.has(r);if(s){if(a)return!1;if(i.add(r),s.dependencies){let u=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let f of u)ou(f,t,e,i)}}else if(o){if(o.imports!=null&&!a){i.add(r);let f;try{uu(o.imports,h=>{ou(h,t,e,i)&&(f||=[],f.push(h))})}finally{}f!==void 0&&_y(f,t)}if(!a){let f=fr(r)||(()=>new r);t({provide:r,useFactory:f,deps:Zt},r),t({provide:Ah,useValue:r,multi:!0},r),t({provide:Wi,useValue:()=>U(r),multi:!0},r)}let u=o.providers;if(u!=null&&!a){let f=n;Nh(u,h=>{t(h,f)})}}else return!1;return r!==n&&n.providers!==void 0}function Nh(n,t){for(let e of n)wh(e)&&(e=e.\u0275providers),Array.isArray(e)?Nh(e,t):t(e)}var SD=Te({provide:String,useValue:Te});function yy(n){return n!==null&&typeof n=="object"&&SD in n}function xD(n){return!!(n&&n.useExisting)}function DD(n){return!!(n&&n.useFactory)}function Jr(n){return typeof n=="function"}function by(n){return!!n.useClass}var Sa=new Y(""),iu={},sy={},lh;function xa(){return lh===void 0&&(lh=new wa),lh}var lt=class{},Kr=class extends lt{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,hh(t,s=>this.processProvider(s)),this.records.set(Mh,ss(void 0,this)),r.has("environment")&&this.records.set(lt,ss(void 0,this));let o=this.records.get(Sa);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(Ah,Zt,{self:!0}))}retrieve(t,e){let i=qr(e)||0;try{return this.get(t,Gr,i)}catch(r){if(Ho(r))return r;throw r}}destroy(){ya(this),this._destroyed=!0;let t=ce(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of e)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ce(t)}}onDestroy(t){return ya(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){ya(this);let e=fi(this),i=Yt(void 0),r;try{return t()}finally{fi(e),Yt(i)}}get(t,e=Gr,i){if(ya(this),t.hasOwnProperty(oy))return t[oy](this);let r=qr(i),o,s=fi(this),a=Yt(void 0);try{if(!(r&4)){let f=this.records.get(t);if(f===void 0){let h=RD(t)&&Ea(t);h&&this.injectableDefInScope(h)?f=ss(ph(t),iu):f=null,this.records.set(t,f)}if(f!=null)return this.hydrate(t,f,r)}let u=r&2?xa():this.parent;return e=r&8&&e===Gr?null:e,u.get(t,e)}catch(u){let f=vD(u);throw f===-200||f===-201?new z(f,null):u}finally{Yt(a),fi(s)}}resolveInjectorInitializers(){let t=ce(null),e=fi(this),i=Yt(void 0),r;try{let o=this.get(Wi,Zt,{self:!0});for(let s of o)s()}finally{fi(e),Yt(i),ce(t)}}toString(){let t=[],e=this.records;for(let i of e.keys())t.push(zi(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=Vt(t);let e=Jr(t)?t:Vt(t&&t.provide),i=TD(t);if(!Jr(t)&&t.multi===!0){let r=this.records.get(e);r||(r=ss(void 0,iu,!0),r.factory=()=>fh(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e,i){let r=ce(null);try{if(e.value===sy)throw Dh(zi(t));return e.value===iu&&(e.value=sy,e.value=e.factory(void 0,i)),typeof e.value=="object"&&e.value&&AD(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{ce(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let e=Vt(t.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){let e=this._onDestroyHooks.indexOf(t);e!==-1&&this._onDestroyHooks.splice(e,1)}};function ph(n){let t=Ea(n),e=t!==null?t.factory:fr(n);if(e!==null)return e;if(n instanceof Y)throw new z(204,!1);if(n instanceof Function)return ID(n);throw new z(204,!1)}function ID(n){if(n.length>0)throw new z(204,!1);let e=hD(n);return e!==null?()=>e.factory(n):()=>new n}function TD(n){if(yy(n))return ss(void 0,n.useValue);{let t=kh(n);return ss(t,iu)}}function kh(n,t,e){let i;if(Jr(n)){let r=Vt(n);return fr(r)||ph(r)}else if(yy(n))i=()=>Vt(n.useValue);else if(DD(n))i=()=>n.useFactory(...fh(n.deps||[]));else if(xD(n))i=(r,o)=>U(Vt(n.useExisting),o!==void 0&&o&8?8:void 0);else{let r=Vt(n&&(n.useClass||n.provide));if(MD(n))i=()=>new r(...fh(n.deps));else return fr(r)||ph(r)}return i}function ya(n){if(n.destroyed)throw new z(205,!1)}function ss(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function MD(n){return!!n.deps}function AD(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function RD(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function hh(n,t){for(let e of n)Array.isArray(e)?hh(e,t):e&&wh(e)?hh(e.\u0275providers,t):t(e)}function Dt(n,t){let e;n instanceof Kr?(ya(n),e=n):e=new dh(n);let i,r=fi(e),o=Yt(void 0);try{return t()}finally{fi(r),Yt(o)}}function wy(){return dy()!==void 0||gc()!=null}var Qn=0,re=1,ue=2,_t=3,An=4,Rn=5,ls=6,cs=7,ct=8,mr=9,gi=10,Ne=11,us=12,Fh=13,Zr=14,En=15,gr=16,Qr=17,vi=18,Da=19,Lh=20,Ui=21,pu=22,Ia=23,Cn=24,Xr=25,eo=26,Je=27,Ey=1,jh=6,vr=7,Ta=8,to=9,pt=10;function _i(n){return Array.isArray(n)&&typeof n[Ey]=="object"}function Xn(n){return Array.isArray(n)&&n[Ey]===!0}function Vh(n){return(n.flags&4)!==0}function qi(n){return n.componentOffset>-1}function ds(n){return(n.flags&1)===1}function yi(n){return!!n.template}function fs(n){return(n[ue]&512)!==0}function no(n){return(n[ue]&256)===256}var Cy="svg",Sy="math";function On(n){for(;Array.isArray(n);)n=n[Qn];return n}function Uh(n,t){return On(t[n])}function Pn(n,t){return On(t[n.index])}function Ma(n,t){return n.data[t]}function Aa(n,t){return n[t]}function zh(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}function Nn(n,t){let e=t[n];return _i(e)?e:e[Qn]}function xy(n){return(n[ue]&4)===4}function hu(n){return(n[ue]&128)===128}function Dy(n){return Xn(n[_t])}function bi(n,t){return t==null?null:n[t]}function Bh(n){n[Qr]=0}function $h(n){n[ue]&1024||(n[ue]|=1024,hu(n)&&ps(n))}function Iy(n,t){for(;n>0;)t=t[Zr],n--;return t}function Ra(n){return!!(n[ue]&9216||n[Cn]?.dirty)}function mu(n){n[gi].changeDetectionScheduler?.notify(8),n[ue]&64&&(n[ue]|=1024),Ra(n)&&ps(n)}function ps(n){n[gi].changeDetectionScheduler?.notify(0);let t=pr(n);for(;t!==null&&!(t[ue]&8192||(t[ue]|=8192,!hu(t)));)t=pr(t)}function Hh(n,t){if(no(n))throw new z(911,!1);n[Ui]===null&&(n[Ui]=[]),n[Ui].push(t)}function Ty(n,t){if(n[Ui]===null)return;let e=n[Ui].indexOf(t);e!==-1&&n[Ui].splice(e,1)}function pr(n){let t=n[_t];return Xn(t)?t[_t]:t}function Wh(n){return n[cs]??=[]}function Gh(n){return n.cleanup??=[]}function My(n,t,e,i){let r=Wh(t);r.push(e),n.firstCreatePass&&Gh(n).push(i,r.length-1)}var me={lFrame:Wy(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var mh=!1;function Ay(){return me.lFrame.elementDepthCount}function Ry(){me.lFrame.elementDepthCount++}function Oy(){me.lFrame.elementDepthCount--}function gu(){return me.bindingsEnabled}function Py(){return me.skipHydrationRootTNode!==null}function Ny(n){return me.skipHydrationRootTNode===n}function ky(){me.skipHydrationRootTNode=null}function oe(){return me.lFrame.lView}function Ke(){return me.lFrame.tView}function C(n){return me.lFrame.contextLView=n,n[ct]}function S(n){return me.lFrame.contextLView=null,n}function It(){let n=qh();for(;n!==null&&n.type===64;)n=n.parent;return n}function qh(){return me.lFrame.currentTNode}function Fy(){let n=me.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}function hs(n,t){let e=me.lFrame;e.currentTNode=n,e.isParent=t}function Jh(){return me.lFrame.isParent}function Ly(){me.lFrame.isParent=!1}function jy(){return me.lFrame.contextLView}function Kh(){return mh}function Yh(n){let t=mh;return mh=n,t}function ms(){let n=me.lFrame,t=n.bindingRootIndex;return t===-1&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Zh(){return me.lFrame.bindingIndex}function Vy(n){return me.lFrame.bindingIndex=n}function Ji(){return me.lFrame.bindingIndex++}function Oa(n){let t=me.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function Uy(){return me.lFrame.inI18n}function zy(n,t){let e=me.lFrame;e.bindingIndex=e.bindingRootIndex=n,vu(t)}function By(){return me.lFrame.currentDirectiveIndex}function vu(n){me.lFrame.currentDirectiveIndex=n}function $y(n){let t=me.lFrame.currentDirectiveIndex;return t===-1?null:n[t]}function Qh(){return me.lFrame.currentQueryIndex}function _u(n){me.lFrame.currentQueryIndex=n}function OD(n){let t=n[re];return t.type===2?t.declTNode:t.type===1?n[Rn]:null}function Xh(n,t,e){if(e&4){let r=t,o=n;for(;r=r.parent,r===null&&!(e&1);)if(r=OD(o),r===null||(o=o[Zr],r.type&10))break;if(r===null)return!1;t=r,n=o}let i=me.lFrame=Hy();return i.currentTNode=t,i.lView=n,!0}function yu(n){let t=Hy(),e=n[re];me.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Hy(){let n=me.lFrame,t=n===null?null:n.child;return t===null?Wy(n):t}function Wy(n){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=t),t}function Gy(){let n=me.lFrame;return me.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var em=Gy;function bu(){let n=Gy();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function qy(n){return(me.lFrame.contextLView=Iy(n,me.lFrame.contextLView))[ct]}function ei(){return me.lFrame.selectedIndex}function _r(n){me.lFrame.selectedIndex=n}function Pa(){let n=me.lFrame;return Ma(n.tView,n.selectedIndex)}function Jy(){return me.lFrame.currentNamespace}var Ky=!0;function wu(){return Ky}function Na(n){Ky=n}function gh(n,t=null,e=null,i){let r=tm(n,t,e,i);return r.resolveInjectorInitializers(),r}function tm(n,t=null,e=null,i,r=new Set){let o=[e||Zt,vy(n)];return i=i||(typeof n=="object"?void 0:zi(n)),new Kr(o,t||xa(),i||null,r)}var Qt=class n{static THROW_IF_NOT_FOUND=Gr;static NULL=new wa;static create(t,e){if(Array.isArray(t))return gh({name:""},e,t,"");{let i=t.name??"";return gh({name:i},t.parent,t.providers,i)}}static \u0275prov=V({token:n,providedIn:"any",factory:()=>U(Mh)});static __NG_ELEMENT_ID__=-1},Ye=new Y(""),ti=(()=>{class n{static __NG_ELEMENT_ID__=PD;static __NG_ENV_ID__=e=>e}return n})(),vh=class extends ti{_lView;constructor(t){super(),this._lView=t}get destroyed(){return no(this._lView)}onDestroy(t){let e=this._lView;return Hh(e,t),()=>Ty(e,t)}};function PD(){return new vh(oe())}var Yn=class{_console=console;handleError(t){this._console.error("ERROR",t)}},Xt=new Y("",{providedIn:"root",factory:()=>{let n=N(lt),t;return e=>{n.destroyed&&!t?setTimeout(()=>{throw e}):(t??=n.get(Yn),t.handleError(e))}}}),Yy={provide:Wi,useValue:()=>void N(Yn),multi:!0},ND=new Y("",{providedIn:"root",factory:()=>{let n=N(Ye).defaultView;if(!n)return;let t=N(Xt),e=o=>{t(o.reason),o.preventDefault()},i=o=>{o.error?t(o.error):t(new Error(o.message,{cause:o})),o.preventDefault()},r=()=>{n.addEventListener("unhandledrejection",e),n.addEventListener("error",i)};typeof Zone<"u"?Zone.root.run(r):r(),N(ti).onDestroy(()=>{n.removeEventListener("error",i),n.removeEventListener("unhandledrejection",e)})}});function nm(){return mi([gy(()=>void N(ND))])}function im(n){return typeof n=="function"&&n[Bt]!==void 0}function Ze(n,t){let[e,i,r]=Up(n,t?.equal),o=e,s=o[Bt];return o.set=i,o.update=r,o.asReadonly=Zy.bind(o),o}function Zy(){let n=this[Bt];if(n.readonlyFn===void 0){let t=()=>this();t[Bt]=n,n.readonlyFn=t}return n.readonlyFn}function rm(n){return im(n)&&typeof n.set=="function"}var Eu=(()=>{class n{view;node;constructor(e,i){this.view=e,this.node=i}static __NG_ELEMENT_ID__=kD}return n})();function kD(){return new Eu(oe(),It())}var Bi=class{},ka=new Y("",{providedIn:"root",factory:()=>!1});var om=new Y(""),sm=new Y(""),wi=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Ge(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new we(e=>{e.next(!1),e.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=V({token:n,providedIn:"root",factory:()=>new n})}return n})(),Cu=(()=>{class n{internalPendingTasks=N(wi);scheduler=N(Bi);errorHandler=N(Xt);add(){let e=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(e)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(e))}}run(e){let i=this.add();e().catch(this.errorHandler).finally(i)}static \u0275prov=V({token:n,providedIn:"root",factory:()=>new n})}return n})();function Fa(...n){}var am=(()=>{class n{static \u0275prov=V({token:n,providedIn:"root",factory:()=>new _h})}return n})(),_h=class{dirtyEffectCount=0;queues=new Map;add(t){this.enqueue(t),this.schedule(t)}schedule(t){t.dirty&&this.dirtyEffectCount++}remove(t){let e=t.zone,i=this.queues.get(e);i.has(t)&&(i.delete(t),t.dirty&&this.dirtyEffectCount--)}enqueue(t){let e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);let i=this.queues.get(e);i.has(t)||i.add(t)}flush(){for(;this.dirtyEffectCount>0;){let t=!1;for(let[e,i]of this.queues)e===null?t||=this.flushQueue(i):t||=e.run(()=>this.flushQueue(i));t||(this.dirtyEffectCount=0)}}flushQueue(t){let e=!1;for(let i of t)i.dirty&&(this.dirtyEffectCount--,e=!0,i.run());return e}};function Ga(n){return{toString:n}.toString()}function $D(n){return typeof n=="function"}var Ru=class{previousValue;currentValue;firstChange;constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}};function Mb(n,t,e,i){t!==null?t.applyValueToInputSignal(t,i):n[e]=i}var Sn=(()=>{let n=()=>Ab;return n.ngInherit=!0,n})();function Ab(n){return n.type.prototype.ngOnChanges&&(n.setInput=WD),HD}function HD(){let n=Ob(this),t=n?.current;if(t){let e=n.previous;if(e===hr)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function WD(n,t,e,i,r){let o=this.declaredInputs[i],s=Ob(n)||GD(n,{previous:hr,current:null}),a=s.current||(s.current={}),u=s.previous,f=u[o];a[o]=new Ru(f&&f.currentValue,e,u===hr),Mb(n,t,r,e)}var Rb="__ngSimpleChanges__";function Ob(n){return n[Rb]||null}function GD(n,t){return n[Rb]=t}var Qy=[];var Ae=function(n,t=null,e){for(let i=0;i<Qy.length;i++){let r=Qy[i];r(n,t,e)}};function qD(n,t,e){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(i){let s=Ab(t);(e.preOrderHooks??=[]).push(n,s),(e.preOrderCheckHooks??=[]).push(n,s)}r&&(e.preOrderHooks??=[]).push(0-n,r),o&&((e.preOrderHooks??=[]).push(n,o),(e.preOrderCheckHooks??=[]).push(n,o))}function Pb(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){let o=n.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:f,ngOnDestroy:h}=o;s&&(n.contentHooks??=[]).push(-e,s),a&&((n.contentHooks??=[]).push(e,a),(n.contentCheckHooks??=[]).push(e,a)),u&&(n.viewHooks??=[]).push(-e,u),f&&((n.viewHooks??=[]).push(e,f),(n.viewCheckHooks??=[]).push(e,f)),h!=null&&(n.destroyHooks??=[]).push(e,h)}}function Iu(n,t,e){Nb(n,t,3,e)}function Tu(n,t,e,i){(n[ue]&3)===e&&Nb(n,t,e,i)}function lm(n,t){let e=n[ue];(e&3)===t&&(e&=16383,e+=1,n[ue]=e)}function Nb(n,t,e,i){let r=i!==void 0?n[Qr]&65535:0,o=i??-1,s=t.length-1,a=0;for(let u=r;u<s;u++)if(typeof t[u+1]=="number"){if(a=t[u],i!=null&&a>=i)break}else t[u]<0&&(n[Qr]+=65536),(a<o||o==-1)&&(JD(n,e,t,u),n[Qr]=(n[Qr]&4294901760)+u+2),u++}function Xy(n,t){Ae(4,n,t);let e=ce(null);try{t.call(n)}finally{ce(e),Ae(5,n,t)}}function JD(n,t,e,i){let r=e[i]<0,o=e[i+1],s=r?-e[i]:e[i],a=n[s];r?n[ue]>>14<n[Qr]>>16&&(n[ue]&3)===t&&(n[ue]+=16384,Xy(a,o)):Xy(a,o)}var vs=-1,ro=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,i,r){this.factory=t,this.name=r,this.canSeeViewProviders=e,this.injectImpl=i}};function KD(n){return(n.flags&8)!==0}function YD(n){return(n.flags&16)!==0}function ZD(n,t,e){let i=0;for(;i<e.length;){let r=e[i];if(typeof r=="number"){if(r!==0)break;i++;let o=e[i++],s=e[i++],a=e[i++];n.setAttribute(t,s,a,o)}else{let o=r,s=e[++i];QD(o)?n.setProperty(t,o,s):n.setAttribute(t,o,s),i++}}return i}function kb(n){return n===3||n===4||n===6}function QD(n){return n.charCodeAt(0)===64}function Va(n,t){if(!(t===null||t.length===0))if(n===null||n.length===0)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){let r=t[i];typeof r=="number"?e=r:e===0||(e===-1||e===2?eb(n,e,r,null,t[++i]):eb(n,e,r,null,null))}}return n}function eb(n,t,e,i,r){let o=0,s=n.length;if(t===-1)s=-1;else for(;o<n.length;){let a=n[o++];if(typeof a=="number"){if(a===t){s=-1;break}else if(a>t){s=o-1;break}}}for(;o<n.length;){let a=n[o];if(typeof a=="number")break;if(a===e){r!==null&&(n[o+1]=r);return}o++,r!==null&&o++}s!==-1&&(n.splice(s,0,t),o=s+1),n.splice(o++,0,e),r!==null&&n.splice(o++,0,r)}function Fb(n){return n!==vs}function Ou(n){return n&32767}function XD(n){return n>>16}function Pu(n,t){let e=XD(n),i=t;for(;e>0;)i=i[Zr],e--;return i}var bm=!0;function Nu(n){let t=bm;return bm=n,t}var eI=256,Lb=eI-1,jb=5,tI=0,Ei={};function nI(n,t,e){let i;typeof e=="string"?i=e.charCodeAt(0)||0:e.hasOwnProperty(Yr)&&(i=e[Yr]),i==null&&(i=e[Yr]=tI++);let r=i&Lb,o=1<<r;t.data[n+(r>>jb)]|=o}function ku(n,t){let e=Vb(n,t);if(e!==-1)return e;let i=t[re];i.firstCreatePass&&(n.injectorIndex=t.length,cm(i.data,n),cm(t,null),cm(i.blueprint,null));let r=Zm(n,t),o=n.injectorIndex;if(Fb(r)){let s=Ou(r),a=Pu(r,t),u=a[re].data;for(let f=0;f<8;f++)t[o+f]=a[s+f]|u[s+f]}return t[o+8]=r,o}function cm(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Vb(n,t){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||t[n.injectorIndex+8]===null?-1:n.injectorIndex}function Zm(n,t){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;r!==null;){if(i=Hb(r),i===null)return vs;if(e++,r=r[Zr],i.injectorIndex!==-1)return i.injectorIndex|e<<16}return vs}function wm(n,t,e){nI(n,t,e)}function iI(n,t){if(t==="class")return n.classes;if(t==="style")return n.styles;let e=n.attrs;if(e){let i=e.length,r=0;for(;r<i;){let o=e[r];if(kb(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<i&&typeof e[r]=="string";)r++;else{if(o===t)return e[r+1];r=r+2}}}return null}function Ub(n,t,e){if(e&8||n!==void 0)return n;cu(t,"NodeInjector")}function zb(n,t,e,i){if(e&8&&i===void 0&&(i=null),(e&3)===0){let r=n[mr],o=Yt(void 0);try{return r?r.get(t,i,e&8):Ih(t,i,e&8)}finally{Yt(o)}}return Ub(i,t,e)}function Bb(n,t,e,i=0,r){if(n!==null){if(t[ue]&2048&&!(i&2)){let s=aI(n,t,e,i,Ei);if(s!==Ei)return s}let o=$b(n,t,e,i,Ei);if(o!==Ei)return o}return zb(t,e,i,r)}function $b(n,t,e,i,r){let o=oI(e);if(typeof o=="function"){if(!Xh(t,n,i))return i&1?Ub(r,e,i):zb(t,e,i,r);try{let s;if(s=o(i),s==null&&!(i&8))cu(e);else return s}finally{em()}}else if(typeof o=="number"){let s=null,a=Vb(n,t),u=vs,f=i&1?t[En][Rn]:null;for((a===-1||i&4)&&(u=a===-1?Zm(n,t):t[a+8],u===vs||!nb(i,!1)?a=-1:(s=t[re],a=Ou(u),t=Pu(u,t)));a!==-1;){let h=t[re];if(tb(o,a,h.data)){let m=rI(a,t,e,s,i,f);if(m!==Ei)return m}u=t[a+8],u!==vs&&nb(i,t[re].data[a+8]===f)&&tb(o,a,t)?(s=h,a=Ou(u),t=Pu(u,t)):a=-1}}return r}function rI(n,t,e,i,r,o){let s=t[re],a=s.data[n+8],u=i==null?qi(a)&&bm:i!=s&&(a.type&3)!==0,f=r&1&&o===a,h=Mu(a,s,e,u,f);return h!==null?Ua(t,s,h,a,r):Ei}function Mu(n,t,e,i,r){let o=n.providerIndexes,s=t.data,a=o&1048575,u=n.directiveStart,f=n.directiveEnd,h=o>>20,m=i?a:a+h,b=r?a+h:f;for(let _=m;_<b;_++){let w=s[_];if(_<u&&e===w||_>=u&&w.type===e)return _}if(r){let _=s[u];if(_&&yi(_)&&_.type===e)return u}return null}function Ua(n,t,e,i,r){let o=n[e],s=t.data;if(o instanceof ro){let a=o;if(a.resolving){let _=ly(s[e]);throw Dh(_)}let u=Nu(a.canSeeViewProviders);a.resolving=!0;let f=s[e].type||s[e],h,m=a.injectImpl?Yt(a.injectImpl):null,b=Xh(n,i,0);try{o=n[e]=a.factory(void 0,r,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&qD(e,s[e],t)}finally{m!==null&&Yt(m),Nu(u),a.resolving=!1,em()}}return o}function oI(n){if(typeof n=="string")return n.charCodeAt(0)||0;let t=n.hasOwnProperty(Yr)?n[Yr]:void 0;return typeof t=="number"?t>=0?t&Lb:sI:t}function tb(n,t,e){let i=1<<n;return!!(e[t+(n>>jb)]&i)}function nb(n,t){return!(n&2)&&!(n&1&&t)}var io=class{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Bb(this._tNode,this._lView,t,qr(i),e)}};function sI(){return new io(It(),oe())}function kn(n){return Ga(()=>{let t=n.prototype.constructor,e=t[ba]||Em(t),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let o=r[ba]||Em(r);if(o&&o!==e)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function Em(n){return yh(n)?()=>{let t=Em(Vt(n));return t&&t()}:fr(n)}function aI(n,t,e,i,r){let o=n,s=t;for(;o!==null&&s!==null&&s[ue]&2048&&!fs(s);){let a=$b(o,s,e,i|2,Ei);if(a!==Ei)return a;let u=o.parent;if(!u){let f=s[Lh];if(f){let h=f.get(e,Ei,i);if(h!==Ei)return h}u=Hb(s),s=s[Zr]}o=u}return r}function Hb(n){let t=n[re],e=t.type;return e===2?t.declTNode:e===1?n[Rn]:null}function qa(n){return iI(It(),n)}function lI(){return ws(It(),oe())}function ws(n,t){return new Tt(Pn(n,t))}var Tt=(()=>{class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=lI}return n})();function cI(n){return n instanceof Tt?n.nativeElement:n}function uI(){return this._results[Symbol.iterator]()}var Fu=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new We}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;let i=py(t);(this._changesDetected=!fy(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=uI};function Wb(n){return(n.flags&128)===128}var Qm=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(Qm||{}),Gb=new Map,dI=0;function fI(){return dI++}function pI(n){Gb.set(n[Da],n)}function Cm(n){Gb.delete(n[Da])}var ib="__ngContext__";function _s(n,t){_i(t)?(n[ib]=t[Da],pI(t)):n[ib]=t}function qb(n){return Kb(n[us])}function Jb(n){return Kb(n[An])}function Kb(n){for(;n!==null&&!Xn(n);)n=n[An];return n}var Sm;function Xm(n){Sm=n}function Yb(){if(Sm!==void 0)return Sm;if(typeof document<"u")return document;throw new z(210,!1)}var Qu=new Y("",{providedIn:"root",factory:()=>hI}),hI="ng",Xu=new Y(""),Es=new Y("",{providedIn:"platform",factory:()=>"unknown"});var ed=new Y("",{providedIn:"root",factory:()=>Yb().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var mI="h",gI="b";var Zb="r";var Qb="di";var Xb=!1,ew=new Y("",{providedIn:"root",factory:()=>Xb});var eg=new Y("");var vI=(n,t,e,i)=>{};function _I(n,t,e,i){vI(n,t,e,i)}function tg(n){return(n.flags&32)===32}var yI=()=>null;function tw(n,t,e=!1){return yI(n,t,e)}function nw(n,t){let e=n.contentQueries;if(e!==null){let i=ce(null);try{for(let r=0;r<e.length;r+=2){let o=e[r],s=e[r+1];if(s!==-1){let a=n.data[s];_u(o),a.contentQueries(2,t[s],s)}}}finally{ce(i)}}}function xm(n,t,e){_u(0);let i=ce(null);try{t(n,e)}finally{ce(i)}}function ng(n,t,e){if(Vh(t)){let i=ce(null);try{let r=t.directiveStart,o=t.directiveEnd;for(let s=r;s<o;s++){let a=n.data[s];if(a.contentQueries){let u=e[s];a.contentQueries(1,u,s)}}}finally{ce(i)}}}var Ki=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n})(Ki||{});var Su;function bI(){if(Su===void 0&&(Su=null,Hi.trustedTypes))try{Su=Hi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Su}function rb(n){return bI()?.createScriptURL(n)||n}var Lu=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${su})`}};function Cs(n){return n instanceof Lu?n.changingThisBreaksApplicationSecurity:n}function ig(n,t){let e=iw(n);if(e!=null&&e!==t){if(e==="ResourceURL"&&t==="URL")return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${su})`)}return e===t}function iw(n){return n instanceof Lu&&n.getTypeName()||null}var wI=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function rw(n){return n=String(n),n.match(wI)?n:"unsafe:"+n}var td=(function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n})(td||{});function Ja(n){let t=sw();return t?t.sanitize(td.URL,n)||"":ig(n,"URL")?Cs(n):rw(Zn(n))}function ow(n){let t=sw();if(t)return rb(t.sanitize(td.RESOURCE_URL,n)||"");if(ig(n,"ResourceURL"))return rb(Cs(n));throw new z(904,!1)}function EI(n,t){return t==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||t==="href"&&(n==="base"||n==="link")?ow:Ja}function rg(n,t,e){return EI(t,e)(n)}function sw(){let n=oe();return n&&n[gi].sanitizer}var CI=/^>|^->|<!--|-->|--!>|<!-$/g,SI=/(<|>)/g,xI="\u200B$1\u200B";function DI(n){return n.replace(CI,t=>t.replace(SI,xI))}function og(n){return n.ownerDocument.defaultView}function sg(n){return n.ownerDocument}function aw(n){return n instanceof Function?n():n}function II(n,t,e){let i=n.length;for(;;){let r=n.indexOf(t,e);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let o=t.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}e=r+1}}var lw="ng-template";function TI(n,t,e,i){let r=0;if(i){for(;r<t.length&&typeof t[r]=="string";r+=2)if(t[r]==="class"&&II(t[r+1].toLowerCase(),e,0)!==-1)return!0}else if(ag(n))return!1;if(r=t.indexOf(1,r),r>-1){let o;for(;++r<t.length&&typeof(o=t[r])=="string";)if(o.toLowerCase()===e)return!0}return!1}function ag(n){return n.type===4&&n.value!==lw}function MI(n,t,e){let i=n.type===4&&!e?lw:n.value;return t===i}function AI(n,t,e){let i=4,r=n.attrs,o=r!==null?PI(r):0,s=!1;for(let a=0;a<t.length;a++){let u=t[a];if(typeof u=="number"){if(!s&&!ni(i)&&!ni(u))return!1;if(s&&ni(u))continue;s=!1,i=u|i&1;continue}if(!s)if(i&4){if(i=2|i&1,u!==""&&!MI(n,u,e)||u===""&&t.length===1){if(ni(i))return!1;s=!0}}else if(i&8){if(r===null||!TI(n,r,u,e)){if(ni(i))return!1;s=!0}}else{let f=t[++a],h=RI(u,r,ag(n),e);if(h===-1){if(ni(i))return!1;s=!0;continue}if(f!==""){let m;if(h>o?m="":m=r[h+1].toLowerCase(),i&2&&f!==m){if(ni(i))return!1;s=!0}}}}return ni(i)||s}function ni(n){return(n&1)===0}function RI(n,t,e,i){if(t===null)return-1;let r=0;if(i||!e){let o=!1;for(;r<t.length;){let s=t[r];if(s===n)return r;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=t[++r];for(;typeof a=="string";)a=t[++r];continue}else{if(s===4)break;if(s===0){r+=4;continue}}r+=o?1:2}return-1}else return NI(t,n)}function OI(n,t,e=!1){for(let i=0;i<t.length;i++)if(AI(n,t[i],e))return!0;return!1}function PI(n){for(let t=0;t<n.length;t++){let e=n[t];if(kb(e))return t}return n.length}function NI(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){let i=n[e];if(typeof i=="number")return-1;if(i===t)return e;e++}return-1}function ob(n,t){return n?":not("+t.trim()+")":t}function kI(n){let t=n[0],e=1,i=2,r="",o=!1;for(;e<n.length;){let s=n[e];if(typeof s=="string")if(i&2){let a=n[++e];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else i&8?r+="."+s:i&4&&(r+=" "+s);else r!==""&&!ni(s)&&(t+=ob(o,r),r=""),i=s,o=o||!ni(i);e++}return r!==""&&(t+=ob(o,r)),t}function FI(n){return n.map(kI).join(",")}function LI(n){let t=[],e=[],i=1,r=2;for(;i<n.length;){let o=n[i];if(typeof o=="string")r===2?o!==""&&t.push(o,n[++i]):r===8&&e.push(o);else{if(!ni(r))break;r=o}i++}return e.length&&t.push(1,...e),t}var Mt={};function jI(n,t){return n.createText(t)}function VI(n,t,e){n.setValue(t,e)}function UI(n,t){return n.createComment(DI(t))}function cw(n,t,e){return n.createElement(t,e)}function ju(n,t,e,i,r){n.insertBefore(t,e,i,r)}function uw(n,t,e){n.appendChild(t,e)}function sb(n,t,e,i,r){i!==null?ju(n,t,e,i,r):uw(n,t,e)}function dw(n,t,e,i){n.removeChild(null,t,e,i)}function zI(n,t,e){n.setAttribute(t,"style",e)}function BI(n,t,e){e===""?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function fw(n,t,e){let{mergedAttrs:i,classes:r,styles:o}=e;i!==null&&ZD(n,t,i),r!==null&&BI(n,t,r),o!==null&&zI(n,t,o)}function lg(n,t,e,i,r,o,s,a,u,f,h){let m=Je+i,b=m+r,_=$I(m,b),w=typeof f=="function"?f():f;return _[re]={type:n,blueprint:_,template:e,queries:null,viewQuery:a,declTNode:t,data:_.slice().fill(null,m),bindingStartIndex:m,expandoStartIndex:b,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:u,consts:w,incompleteFirstPass:!1,ssrId:h}}function $I(n,t){let e=[];for(let i=0;i<t;i++)e.push(i<n?null:Mt);return e}function HI(n){let t=n.tView;return t===null||t.incompleteFirstPass?n.tView=lg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function cg(n,t,e,i,r,o,s,a,u,f,h){let m=t.blueprint.slice();return m[Qn]=r,m[ue]=i|4|128|8|64|1024,(f!==null||n&&n[ue]&2048)&&(m[ue]|=2048),Bh(m),m[_t]=m[Zr]=n,m[ct]=e,m[gi]=s||n&&n[gi],m[Ne]=a||n&&n[Ne],m[mr]=u||n&&n[mr]||null,m[Rn]=o,m[Da]=fI(),m[ls]=h,m[Lh]=f,m[En]=t.type==2?n[En]:m,m}function WI(n,t,e){let i=Pn(t,n),r=HI(e),o=n[gi].rendererFactory,s=ug(n,cg(n,r,null,pw(e),i,t,null,o.createRenderer(i,e),null,null,null));return n[t.index]=s}function pw(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function hw(n,t,e,i){if(e===0)return-1;let r=t.length;for(let o=0;o<e;o++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function ug(n,t){return n[us]?n[Fh][An]=t:n[us]=t,n[Fh]=t,t}function p(n=1){mw(Ke(),oe(),ei()+n,!1)}function mw(n,t,e,i){if(!i)if((t[ue]&3)===3){let o=n.preOrderCheckHooks;o!==null&&Iu(t,o,e)}else{let o=n.preOrderHooks;o!==null&&Tu(t,o,0,e)}_r(e)}var nd=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(nd||{});function Dm(n,t,e,i){let r=ce(null);try{let[o,s,a]=n.inputs[e],u=null;(s&nd.SignalBased)!==0&&(u=t[o][Bt]),u!==null&&u.transformFn!==void 0?i=u.transformFn(i):a!==null&&(i=a.call(t,i)),n.setInput!==null?n.setInput(t,u,i,e,o):Mb(t,u,o,i)}finally{ce(r)}}var ri=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(ri||{}),GI;function dg(n,t){return GI(n,t)}var ys=new Set,id=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(id||{}),co=new Y(""),ab=new Set;function oi(n){ab.has(n)||(ab.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var gw=!1,Im=class extends We{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,wy()&&(this.destroyRef=N(ti,{optional:!0})??void 0,this.pendingTasks=N(wi,{optional:!0})??void 0)}emit(t){let e=ce(null);try{super.next(t)}finally{ce(e)}}subscribe(t,e,i){let r=t,o=e||(()=>null),s=i;if(t&&typeof t=="object"){let u=t;r=u.next?.bind(u),o=u.error?.bind(u),s=u.complete?.bind(u)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:r,error:o,complete:s});return t instanceof Xe&&t.add(a),a}wrapInTimeout(t){return e=>{let i=this.pendingTasks?.add();setTimeout(()=>{try{t(e)}finally{i!==void 0&&this.pendingTasks?.remove(i)}})}}},ke=Im;function vw(n){let t,e;function i(){n=Fa;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{n(),i()})),()=>i()}function lb(n){return queueMicrotask(()=>n()),()=>{n=Fa}}var fg="isAngularZone",Vu=fg+"_ID",qI=0,Be=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new ke(!1);onMicrotaskEmpty=new ke(!1);onStable=new ke(!1);onError=new ke(!1);constructor(t){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=gw}=t;if(typeof Zone>"u")throw new z(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&i,s.shouldCoalesceRunChangeDetection=r,s.callbackScheduled=!1,s.scheduleInRootZone=o,YI(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(fg)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new z(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new z(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,t,JI,Fa,Fa);try{return o.runTask(s,e,i)}finally{o.cancelTask(s)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}},JI={};function pg(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function KI(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function t(){vw(()=>{n.callbackScheduled=!1,Tm(n),n.isCheckStableRunning=!0,pg(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),Tm(n)}function YI(n){let t=()=>{KI(n)},e=qI++;n._inner=n._inner.fork({name:"angular",properties:{[fg]:!0,[Vu]:e,[Vu+e]:!0},onInvokeTask:(i,r,o,s,a,u)=>{if(ZI(u))return i.invokeTask(o,s,a,u);try{return cb(n),i.invokeTask(o,s,a,u)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&t(),ub(n)}},onInvoke:(i,r,o,s,a,u,f)=>{try{return cb(n),i.invoke(o,s,a,u,f)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!QI(u)&&t(),ub(n)}},onHasTask:(i,r,o,s)=>{i.hasTask(o,s),r===o&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,Tm(n),pg(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,r,o,s)=>(i.handleError(o,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function Tm(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function cb(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function ub(n){n._nesting--,pg(n)}var Uu=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new ke;onMicrotaskEmpty=new ke;onStable=new ke;onError=new ke;run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}};function ZI(n){return _w(n,"__ignore_ng_zone__")}function QI(n){return _w(n,"__scheduler_tick__")}function _w(n,t){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[t]===!0}var hg=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=V({token:n,providedIn:"root",factory:()=>new n})}return n})(),yw=[0,1,2,3],bw=(()=>{class n{ngZone=N(Be);scheduler=N(Bi);errorHandler=N(Yn,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){N(co,{optional:!0})}execute(){let e=this.sequences.size>0;e&&Ae(16),this.executing=!0;for(let i of yw)for(let r of this.sequences)if(!(r.erroredOrDestroyed||!r.hooks[i]))try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let o=r.hooks[i];return o(r.pipelinedValue)},r.snapshot))}catch(o){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(let i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&Ae(17)}register(e){let{view:i}=e;i!==void 0?((i[Xr]??=[]).push(e),ps(i),i[ue]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,i){return i?i.run(id.AFTER_NEXT_RENDER,e):e()}static \u0275prov=V({token:n,providedIn:"root",factory:()=>new n})}return n})(),zu=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,i,r,o,s=null){this.impl=t,this.hooks=e,this.view=i,this.once=r,this.snapshot=s,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let t=this.view?.[Xr];t&&(this.view[Xr]=t.filter(e=>e!==this))}};function Ka(n,t){let e=t?.injector??N(Qt);return oi("NgAfterNextRender"),eT(n,e,t,!0)}function XI(n){return n instanceof Function?[void 0,void 0,n,void 0]:[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function eT(n,t,e,i){let r=t.get(hg);r.impl??=t.get(bw);let o=t.get(co,null,{optional:!0}),s=e?.manualCleanup!==!0?t.get(ti):null,a=t.get(Eu,null,{optional:!0}),u=new zu(r.impl,XI(n),a?.view,i,s,o?.snapshot(null));return r.impl.register(u),u}var tT=new Y("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function ww(n,t){let e=n.get(tT);if(Array.isArray(t))for(let i of t)e.queue.add(i);else e.queue.add(t);e.scheduler&&e.scheduler(n)}function nT(n,t){for(let[e,i]of t)ww(n,i.animateFns)}function db(n,t,e,i){let r=n?.[eo]?.enter;t!==null&&r&&r.has(e.index)&&nT(i,r)}function gs(n,t,e,i,r,o,s,a){if(r!=null){let u,f=!1;Xn(r)?u=r:_i(r)&&(f=!0,r=r[Qn]);let h=On(r);n===0&&i!==null?(db(a,i,o,e),s==null?uw(t,i,h):ju(t,i,h,s||null,!0)):n===1&&i!==null?(db(a,i,o,e),ju(t,i,h,s||null,!0)):n===2?fb(a,o,e,m=>{dw(t,h,f,m)}):n===3&&fb(a,o,e,()=>{t.destroyNode(h)}),u!=null&&mT(t,n,e,u,o,i,s)}}function iT(n,t){Ew(n,t),t[Qn]=null,t[Rn]=null}function rT(n,t,e,i,r,o){i[Qn]=r,i[Rn]=t,od(n,i,e,1,r,o)}function Ew(n,t){t[gi].changeDetectionScheduler?.notify(9),od(n,t,t[Ne],2,null,null)}function oT(n){let t=n[us];if(!t)return um(n[re],n);for(;t;){let e=null;if(_i(t))e=t[us];else{let i=t[pt];i&&(e=i)}if(!e){for(;t&&!t[An]&&t!==n;)_i(t)&&um(t[re],t),t=t[_t];t===null&&(t=n),_i(t)&&um(t[re],t),e=t&&t[An]}t=e}}function mg(n,t){let e=n[to],i=e.indexOf(t);e.splice(i,1)}function rd(n,t){if(no(t))return;let e=t[Ne];e.destroyNode&&od(n,t,e,3,null,null),oT(t)}function um(n,t){if(no(t))return;let e=ce(null);try{t[ue]&=-129,t[ue]|=256,t[Cn]&&ha(t[Cn]),lT(n,t),aT(n,t),t[re].type===1&&t[Ne].destroy();let i=t[gr];if(i!==null&&Xn(t[_t])){i!==t[_t]&&mg(i,t);let r=t[vi];r!==null&&r.detachView(n)}Cm(t)}finally{ce(e)}}function fb(n,t,e,i){let r=n?.[eo];if(r==null||r.leave==null||!r.leave.has(t.index))return i(!1);if(r.skipLeaveAnimations)return r.skipLeaveAnimations=!1,i(!1);n&&ys.add(n),ww(e,()=>{if(r.leave&&r.leave.has(t.index)){let s=r.leave.get(t.index),a=[];if(s)for(let u=0;u<s.animateFns.length;u++){let f=s.animateFns[u],{promise:h}=f();a.push(h)}r.running=Promise.allSettled(a),sT(n,i)}else n&&ys.delete(n),i(!1)})}function sT(n,t){let e=n[eo]?.running;if(e){e.then(()=>{n[eo].running=void 0,ys.delete(n),t(!0)});return}t(!1)}function aT(n,t){let e=n.cleanup,i=t[cs];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?i[a]():i[-a].unsubscribe(),s+=2}else{let a=i[e[s+1]];e[s].call(a)}i!==null&&(t[cs]=null);let r=t[Ui];if(r!==null){t[Ui]=null;for(let s=0;s<r.length;s++){let a=r[s];a()}}let o=t[Ia];if(o!==null){t[Ia]=null;for(let s of o)s.destroy()}}function lT(n,t){let e;if(n!=null&&(e=n.destroyHooks)!=null)for(let i=0;i<e.length;i+=2){let r=t[e[i]];if(!(r instanceof ro)){let o=e[i+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=r[o[s]],u=o[s+1];Ae(4,a,u);try{u.call(a)}finally{Ae(5,a,u)}}else{Ae(4,r,o);try{o.call(r)}finally{Ae(5,r,o)}}}}}function cT(n,t,e){return uT(n,t.parent,e)}function uT(n,t,e){let i=t;for(;i!==null&&i.type&168;)t=i,i=t.parent;if(i===null)return e[Qn];if(qi(i)){let{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===Ki.None||r===Ki.Emulated)return null}return Pn(i,e)}function dT(n,t,e){return pT(n,t,e)}function fT(n,t,e){return n.type&40?Pn(n,e):null}var pT=fT,pb;function gg(n,t,e,i){let r=cT(n,i,t),o=t[Ne],s=i.parent||t[Rn],a=dT(s,i,t);if(r!=null)if(Array.isArray(e))for(let u=0;u<e.length;u++)sb(o,r,e[u],a,!1);else sb(o,r,e,a,!1);pb!==void 0&&pb(o,i,t,e,r)}function La(n,t){if(t!==null){let e=t.type;if(e&3)return Pn(t,n);if(e&4)return Mm(-1,n[t.index]);if(e&8){let i=t.child;if(i!==null)return La(n,i);{let r=n[t.index];return Xn(r)?Mm(-1,r):On(r)}}else{if(e&128)return La(n,t.next);if(e&32)return dg(t,n)()||On(n[t.index]);{let i=Cw(n,t);if(i!==null){if(Array.isArray(i))return i[0];let r=pr(n[En]);return La(r,i)}else return La(n,t.next)}}}return null}function Cw(n,t){if(t!==null){let i=n[En][Rn],r=t.projection;return i.projection[r]}return null}function Mm(n,t){let e=pt+n+1;if(e<t.length){let i=t[e],r=i[re].firstChild;if(r!==null)return La(i,r)}return t[vr]}function vg(n,t,e,i,r,o,s){for(;e!=null;){let a=i[mr];if(e.type===128){e=e.next;continue}let u=i[e.index],f=e.type;if(s&&t===0&&(u&&_s(On(u),i),e.flags|=2),!tg(e))if(f&8)vg(n,t,e.child,i,r,o,!1),gs(t,n,a,r,u,e,o,i);else if(f&32){let h=dg(e,i),m;for(;m=h();)gs(t,n,a,r,m,e,o,i);gs(t,n,a,r,u,e,o,i)}else f&16?hT(n,t,i,e,r,o):gs(t,n,a,r,u,e,o,i);e=s?e.projectionNext:e.next}}function od(n,t,e,i,r,o){vg(e,i,n.firstChild,t,r,o,!1)}function hT(n,t,e,i,r,o){let s=e[En],u=s[Rn].projection[i.projection];if(Array.isArray(u))for(let f=0;f<u.length;f++){let h=u[f];gs(t,n,e[mr],r,h,i,o,e)}else{let f=u,h=s[_t];Wb(i)&&(f.flags|=128),vg(n,t,f,h,r,o,!0)}}function mT(n,t,e,i,r,o,s){let a=i[vr],u=On(i);a!==u&&gs(t,n,e,o,a,r,s);for(let f=pt;f<i.length;f++){let h=i[f];od(h[re],h,n,t,o,a)}}function gT(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let o=i.indexOf("-")===-1?void 0:ri.DashCase;r==null?n.removeStyle(e,i,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=ri.Important),n.setStyle(e,i,r,o))}}function Sw(n,t,e,i,r){let o=ei(),s=i&2;try{_r(-1),s&&t.length>Je&&mw(n,t,Je,!1),Ae(s?2:0,r,e),e(i,r)}finally{_r(o),Ae(s?3:1,r,e)}}function sd(n,t,e){ET(n,t,e),(e.flags&64)===64&&CT(n,t,e)}function ad(n,t,e=Pn){let i=t.localNames;if(i!==null){let r=t.index+1;for(let o=0;o<i.length;o+=2){let s=i[o+1],a=s===-1?e(t,n):n[s];n[r++]=a}}}function vT(n,t,e,i){let o=i.get(ew,Xb)||e===Ki.ShadowDom,s=n.selectRootElement(t,o);return _T(s),s}function _T(n){yT(n)}var yT=()=>null;function bT(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function xw(n,t,e,i,r,o){let s=t[re];if(ld(n,s,t,e,i)){qi(n)&&Dw(t,n.index);return}n.type&3&&(e=bT(e)),wT(n,t,e,i,r,o)}function wT(n,t,e,i,r,o){if(n.type&3){let s=Pn(n,t);i=o!=null?o(i,n.value||"",e):i,r.setProperty(s,e,i)}else n.type&12}function Dw(n,t){let e=Nn(t,n);e[ue]&16||(e[ue]|=64)}function ET(n,t,e){let i=e.directiveStart,r=e.directiveEnd;qi(e)&&WI(t,e,n.data[i+e.componentOffset]),n.firstCreatePass||ku(e,t);let o=e.initialInputs;for(let s=i;s<r;s++){let a=n.data[s],u=Ua(t,n,s,e);if(_s(u,t),o!==null&&DT(t,s-i,u,a,e,o),yi(a)){let f=Nn(e.index,t);f[ct]=Ua(t,n,s,e)}}}function CT(n,t,e){let i=e.directiveStart,r=e.directiveEnd,o=e.index,s=By();try{_r(o);for(let a=i;a<r;a++){let u=n.data[a],f=t[a];vu(a),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&ST(u,f)}}finally{_r(-1),vu(s)}}function ST(n,t){n.hostBindings!==null&&n.hostBindings(1,t)}function _g(n,t){let e=n.directiveRegistry,i=null;if(e)for(let r=0;r<e.length;r++){let o=e[r];OI(t,o.selectors,!1)&&(i??=[],yi(o)?i.unshift(o):i.push(o))}return i}function xT(n,t,e,i,r,o){let s=Pn(n,t);Iw(t[Ne],s,o,n.value,e,i,r)}function Iw(n,t,e,i,r,o,s){if(o==null)n.removeAttribute(t,r,e);else{let a=s==null?Zn(o):s(o,i||"",r);n.setAttribute(t,r,a,e)}}function DT(n,t,e,i,r,o){let s=o[t];if(s!==null)for(let a=0;a<s.length;a+=2){let u=s[a],f=s[a+1];Dm(i,e,u,f)}}function Tw(n,t,e,i,r){let o=Je+e,s=t[re],a=r(s,t,n,i,e);t[o]=a,hs(n,!0);let u=n.type===2;return u?(fw(t[Ne],a,n),(Ay()===0||ds(n))&&_s(a,t),Ry()):_s(a,t),wu()&&(!u||!tg(n))&&gg(s,t,a,n),n}function Mw(n){let t=n;return Jh()?Ly():(t=t.parent,hs(t,!1)),t}function IT(n,t){let e=n[mr];if(!e)return;let i;try{i=e.get(Xt,null)}catch{i=null}i?.(t)}function ld(n,t,e,i,r){let o=n.inputs?.[i],s=n.hostDirectiveInputs?.[i],a=!1;if(s)for(let u=0;u<s.length;u+=2){let f=s[u],h=s[u+1],m=t.data[f];Dm(m,e[f],h,r),a=!0}if(o)for(let u of o){let f=e[u],h=t.data[u];Dm(h,f,i,r),a=!0}return a}function TT(n,t){let e=Nn(t,n),i=e[re];MT(i,e);let r=e[Qn];r!==null&&e[ls]===null&&(e[ls]=tw(r,e[mr])),Ae(18),yg(i,e,e[ct]),Ae(19,e[ct])}function MT(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}function yg(n,t,e){yu(t);try{let i=n.viewQuery;i!==null&&xm(1,i,e);let r=n.template;r!==null&&Sw(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[vi]?.finishViewCreation(n),n.staticContentQueries&&nw(n,t),n.staticViewQueries&&xm(2,n.viewQuery,e);let o=n.components;o!==null&&AT(t,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[ue]&=-5,bu()}}function AT(n,t){for(let e=0;e<t.length;e++)TT(n,t[e])}function cd(n,t,e,i){let r=ce(null);try{let o=t.tView,a=n[ue]&4096?4096:16,u=cg(n,o,e,a,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),f=n[t.index];u[gr]=f;let h=n[vi];return h!==null&&(u[vi]=h.createEmbeddedView(o)),yg(o,u,e),u}finally{ce(r)}}function za(n,t){return!t||t.firstChild===null||Wb(n)}function Ba(n,t,e,i,r=!1){for(;e!==null;){if(e.type===128){e=r?e.projectionNext:e.next;continue}let o=t[e.index];o!==null&&i.push(On(o)),Xn(o)&&Aw(o,i);let s=e.type;if(s&8)Ba(n,t,e.child,i);else if(s&32){let a=dg(e,t),u;for(;u=a();)i.push(u)}else if(s&16){let a=Cw(t,e);if(Array.isArray(a))i.push(...a);else{let u=pr(t[En]);Ba(u[re],u,a,i,!0)}}e=r?e.projectionNext:e.next}return i}function Aw(n,t){for(let e=pt;e<n.length;e++){let i=n[e],r=i[re].firstChild;r!==null&&Ba(i[re],i,r,t)}n[vr]!==n[Qn]&&t.push(n[vr])}function Rw(n){if(n[Xr]!==null){for(let t of n[Xr])t.impl.addSequence(t);n[Xr].length=0}}var Ow=[];function RT(n){return n[Cn]??OT(n)}function OT(n){let t=Ow.pop()??Object.create(NT);return t.lView=n,t}function PT(n){n.lView[Cn]!==n&&(n.lView=null,Ow.push(n))}var NT=J(P({},Wo),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{ps(n.lView)},consumerOnSignalRead(){this.lView[Cn]=this}});function kT(n){let t=n[Cn]??Object.create(FT);return t.lView=n,t}var FT=J(P({},Wo),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=pr(n.lView);for(;t&&!Pw(t[re]);)t=pr(t);t&&$h(t)},consumerOnSignalRead(){this.lView[Cn]=this}});function Pw(n){return n.type!==2}function Nw(n){if(n[Ia]===null)return;let t=!0;for(;t;){let e=!1;for(let i of n[Ia])i.dirty&&(e=!0,i.zone===null||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=e&&!!(n[ue]&8192)}}var LT=100;function kw(n,t=0){let i=n[gi].rendererFactory,r=!1;r||i.begin?.();try{jT(n,t)}finally{r||i.end?.()}}function jT(n,t){let e=Kh();try{Yh(!0),Am(n,t);let i=0;for(;Ra(n);){if(i===LT)throw new z(103,!1);i++,Am(n,1)}}finally{Yh(e)}}function VT(n,t,e,i){if(no(t))return;let r=t[ue],o=!1,s=!1;yu(t);let a=!0,u=null,f=null;o||(Pw(n)?(f=RT(t),u=qo(f)):wc()===null?(a=!1,f=kT(t),u=qo(f)):t[Cn]&&(ha(t[Cn]),t[Cn]=null));try{Bh(t),Vy(n.bindingStartIndex),e!==null&&Sw(n,t,e,2,i);let h=(r&3)===3;if(!o)if(h){let _=n.preOrderCheckHooks;_!==null&&Iu(t,_,null)}else{let _=n.preOrderHooks;_!==null&&Tu(t,_,0,null),lm(t,0)}if(s||UT(t),Nw(t),Fw(t,0),n.contentQueries!==null&&nw(n,t),!o)if(h){let _=n.contentCheckHooks;_!==null&&Iu(t,_)}else{let _=n.contentHooks;_!==null&&Tu(t,_,1),lm(t,1)}BT(n,t);let m=n.components;m!==null&&jw(t,m,0);let b=n.viewQuery;if(b!==null&&xm(2,b,i),!o)if(h){let _=n.viewCheckHooks;_!==null&&Iu(t,_)}else{let _=n.viewHooks;_!==null&&Tu(t,_,2),lm(t,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),t[pu]){for(let _ of t[pu])_();t[pu]=null}o||(Rw(t),t[ue]&=-73)}catch(h){throw o||ps(t),h}finally{f!==null&&(fa(f,u),a&&PT(f)),bu()}}function Fw(n,t){for(let e=qb(n);e!==null;e=Jb(e))for(let i=pt;i<e.length;i++){let r=e[i];Lw(r,t)}}function UT(n){for(let t=qb(n);t!==null;t=Jb(t)){if(!(t[ue]&2))continue;let e=t[to];for(let i=0;i<e.length;i++){let r=e[i];$h(r)}}}function zT(n,t,e){Ae(18);let i=Nn(t,n);Lw(i,e),Ae(19,i[ct])}function Lw(n,t){hu(n)&&Am(n,t)}function Am(n,t){let i=n[re],r=n[ue],o=n[Cn],s=!!(t===0&&r&16);if(s||=!!(r&64&&t===0),s||=!!(r&1024),s||=!!(o?.dirty&&pa(o)),s||=!1,o&&(o.dirty=!1),n[ue]&=-9217,s)VT(i,n,i.template,n[ct]);else if(r&8192){let a=ce(null);try{Nw(n),Fw(n,1);let u=i.components;u!==null&&jw(n,u,1),Rw(n)}finally{ce(a)}}}function jw(n,t,e){for(let i=0;i<t.length;i++)zT(n,t[i],e)}function BT(n,t){let e=n.hostBindingOpCodes;if(e!==null)try{for(let i=0;i<e.length;i++){let r=e[i];if(r<0)_r(~r);else{let o=r,s=e[++i],a=e[++i];zy(s,o);let u=t[o];Ae(24,u),a(2,u),Ae(25,u)}}}finally{_r(-1)}}function bg(n,t){let e=Kh()?64:1088;for(n[gi].changeDetectionScheduler?.notify(t);n;){n[ue]|=e;let i=pr(n);if(fs(n)&&!i)return n;n=i}return null}function Vw(n,t,e,i){return[n,!0,0,t,null,i,null,e,null,null]}function Uw(n,t){let e=pt+t;if(e<n.length)return n[e]}function ud(n,t,e,i=!0){let r=t[re];if($T(r,t,n,e),i){let s=Mm(e,n),a=t[Ne],u=a.parentNode(n[vr]);u!==null&&rT(r,n[Rn],a,t,u,s)}let o=t[ls];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function zw(n,t){let e=$a(n,t);return e!==void 0&&rd(e[re],e),e}function $a(n,t){if(n.length<=pt)return;let e=pt+t,i=n[e];if(i){let r=i[gr];r!==null&&r!==n&&mg(r,i),t>0&&(n[e-1][An]=i[An]);let o=Ca(n,pt+t);iT(i[re],i);let s=o[vi];s!==null&&s.detachView(o[re]),i[_t]=null,i[An]=null,i[ue]&=-129}return i}function $T(n,t,e,i){let r=pt+i,o=e.length;i>0&&(e[r-1][An]=t),i<o-pt?(t[An]=e[r],Th(e,pt+i,t)):(e.push(t),t[An]=null),t[_t]=e;let s=t[gr];s!==null&&e!==s&&Bw(s,t);let a=t[vi];a!==null&&a.insertView(n),mu(t),t[ue]|=128}function Bw(n,t){let e=n[to],i=t[_t];if(_i(i))n[ue]|=2;else{let r=i[_t][En];t[En]!==r&&(n[ue]|=2)}e===null?n[to]=[t]:e.push(t)}var yr=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let t=this._lView,e=t[re];return Ba(e,t,e.firstChild,[])}constructor(t,e){this._lView=t,this._cdRefInjectingView=e}get context(){return this._lView[ct]}set context(t){this._lView[ct]=t}get destroyed(){return no(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[_t];if(Xn(t)){let e=t[Ta],i=e?e.indexOf(this):-1;i>-1&&($a(t,i),Ca(e,i))}this._attachedToViewContainer=!1}rd(this._lView[re],this._lView)}onDestroy(t){Hh(this._lView,t)}markForCheck(){bg(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ue]&=-129}reattach(){mu(this._lView),this._lView[ue]|=128}detectChanges(){this._lView[ue]|=1024,kw(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new z(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=fs(this._lView),e=this._lView[gr];e!==null&&!t&&mg(e,this._lView),Ew(this._lView[re],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new z(902,!1);this._appRef=t;let e=fs(this._lView),i=this._lView[gr];i!==null&&!e&&Bw(i,this._lView),mu(this._lView)}};var br=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=HT;constructor(e,i,r){this._declarationLView=e,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,i){return this.createEmbeddedViewImpl(e,i)}createEmbeddedViewImpl(e,i,r){let o=cd(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:i,dehydratedView:r});return new yr(o)}}return n})();function HT(){return dd(It(),oe())}function dd(n,t){return n.type&4?new br(t,n,ws(n,t)):null}function fd(n,t,e,i,r){let o=n.data[t];if(o===null)o=WT(n,t,e,i,r),Uy()&&(o.flags|=32);else if(o.type&64){o.type=e,o.value=i,o.attrs=r;let s=Fy();o.injectorIndex=s===null?-1:s.injectorIndex}return hs(o,!0),o}function WT(n,t,e,i,r){let o=qh(),s=Jh(),a=s?o:o&&o.parent,u=n.data[t]=qT(n,a,e,t,i,r);return GT(n,u,o,s),u}function GT(n,t,e,i){n.firstChild===null&&(n.firstChild=t),e!==null&&(i?e.child==null&&t.parent!==null&&(e.child=t):e.next===null&&(e.next=t,t.prev=e))}function qT(n,t,e,i,r,o){let s=t?t.injectorIndex:-1,a=0;return Py()&&(a|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var aH=new RegExp(`^(\\d+)*(${gI}|${mI})*(.*)`);function JT(n){let t=n[jh]??[],i=n[_t][Ne],r=[];for(let o of t)o.data[Qb]!==void 0?r.push(o):KT(o,i);n[jh]=r}function KT(n,t){let e=0,i=n.firstChild;if(i){let r=n.data[Zb];for(;e<r;){let o=i.nextSibling;dw(t,i,!1),i=o,e++}}}var YT=()=>null,ZT=()=>null;function Rm(n,t){return YT(n,t)}function $w(n,t,e){return ZT(n,t,e)}var Hw=class{},pd=class{},Om=class{resolveComponentFactory(t){throw new z(917,!1)}},Ya=class{static NULL=new Om},oo=class{},dn=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>QT()}return n})();function QT(){let n=oe(),t=It(),e=Nn(t.index,n);return(_i(e)?e:n)[Ne]}var Ww=(()=>{class n{static \u0275prov=V({token:n,providedIn:"root",factory:()=>null})}return n})();var Au={},Pm=class{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){let r=this.injector.get(t,Au,i);return r!==Au||e===Au?r:this.parentInjector.get(t,e,i)}};function hb(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,o=0;if(t!==null)for(let s=0;s<t.length;s++){let a=t[s];if(typeof a=="number")o=a;else if(o==1)r=au(r,a);else if(o==2){let u=a,f=t[++s];i=au(i,u+": "+f+";")}}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function D(n,t=0){let e=oe();if(e===null)return U(n,t);let i=It();return Bb(i,e,Vt(n),t)}function wg(){let n="invalid";throw new Error(n)}function Gw(n,t,e,i,r){let o=i===null?null:{"":-1},s=r(n,e);if(s!==null){let a=s,u=null,f=null;for(let h of s)if(h.resolveHostDirectives!==null){[a,u,f]=h.resolveHostDirectives(s);break}tM(n,t,e,a,o,u,f)}o!==null&&i!==null&&XT(e,i,o)}function XT(n,t,e){let i=n.localNames=[];for(let r=0;r<t.length;r+=2){let o=e[t[r+1]];if(o==null)throw new z(-301,!1);i.push(t[r],o)}}function eM(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function tM(n,t,e,i,r,o,s){let a=i.length,u=!1;for(let b=0;b<a;b++){let _=i[b];!u&&yi(_)&&(u=!0,eM(n,e,b)),wm(ku(e,t),n,_.type)}aM(e,n.data.length,a);for(let b=0;b<a;b++){let _=i[b];_.providersResolver&&_.providersResolver(_)}let f=!1,h=!1,m=hw(n,t,a,null);a>0&&(e.directiveToIndex=new Map);for(let b=0;b<a;b++){let _=i[b];if(e.mergedAttrs=Va(e.mergedAttrs,_.hostAttrs),iM(n,e,t,m,_),sM(m,_,r),s!==null&&s.has(_)){let[M,I]=s.get(_);e.directiveToIndex.set(_.type,[m,M+e.directiveStart,I+e.directiveStart])}else(o===null||!o.has(_))&&e.directiveToIndex.set(_.type,m);_.contentQueries!==null&&(e.flags|=4),(_.hostBindings!==null||_.hostAttrs!==null||_.hostVars!==0)&&(e.flags|=64);let w=_.type.prototype;!f&&(w.ngOnChanges||w.ngOnInit||w.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),f=!0),!h&&(w.ngOnChanges||w.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),h=!0),m++}nM(n,e,o)}function nM(n,t,e){for(let i=t.directiveStart;i<t.directiveEnd;i++){let r=n.data[i];if(e===null||!e.has(r))mb(0,t,r,i),mb(1,t,r,i),vb(t,i,!1);else{let o=e.get(r);gb(0,t,o,i),gb(1,t,o,i),vb(t,i,!0)}}}function mb(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s;n===0?s=t.inputs??={}:s=t.outputs??={},s[o]??=[],s[o].push(i),qw(t,o)}}function gb(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s=r[o],a;n===0?a=t.hostDirectiveInputs??={}:a=t.hostDirectiveOutputs??={},a[s]??=[],a[s].push(i,o),qw(t,s)}}function qw(n,t){t==="class"?n.flags|=8:t==="style"&&(n.flags|=16)}function vb(n,t,e){let{attrs:i,inputs:r,hostDirectiveInputs:o}=n;if(i===null||!e&&r===null||e&&o===null||ag(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let s=null,a=0;for(;a<i.length;){let u=i[a];if(u===0){a+=4;continue}else if(u===5){a+=2;continue}else if(typeof u=="number")break;if(!e&&r.hasOwnProperty(u)){let f=r[u];for(let h of f)if(h===t){s??=[],s.push(u,i[a+1]);break}}else if(e&&o.hasOwnProperty(u)){let f=o[u];for(let h=0;h<f.length;h+=2)if(f[h]===t){s??=[],s.push(f[h+1],i[a+1]);break}}a+=2}n.initialInputs??=[],n.initialInputs.push(s)}function iM(n,t,e,i,r){n.data[i]=r;let o=r.factory||(r.factory=fr(r.type,!0)),s=new ro(o,yi(r),D,null);n.blueprint[i]=s,e[i]=s,rM(n,t,i,hw(n,e,r.hostVars,Mt),r)}function rM(n,t,e,i,r){let o=r.hostBindings;if(o){let s=n.hostBindingOpCodes;s===null&&(s=n.hostBindingOpCodes=[]);let a=~t.index;oM(s)!=a&&s.push(a),s.push(e,i,o)}}function oM(n){let t=n.length;for(;t>0;){let e=n[--t];if(typeof e=="number"&&e<0)return e}return 0}function sM(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;yi(t)&&(e[""]=n)}}function aM(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Eg(n,t,e,i,r,o,s,a){let u=t[re],f=u.consts,h=bi(f,s),m=fd(u,n,e,i,h);return o&&Gw(u,t,m,bi(f,a),r),m.mergedAttrs=Va(m.mergedAttrs,m.attrs),m.attrs!==null&&hb(m,m.attrs,!1),m.mergedAttrs!==null&&hb(m,m.mergedAttrs,!0),u.queries!==null&&u.queries.elementStart(u,m),m}function Cg(n,t){Pb(n,t),Vh(t)&&n.queries.elementEnd(t)}function Sg(n){return hd(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function Jw(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{let e=n[Symbol.iterator](),i;for(;!(i=e.next()).done;)t(i.value)}}function hd(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function md(n,t,e){return n[t]=e}function lM(n,t){return n[t]}function un(n,t,e){if(e===Mt)return!1;let i=n[t];return Object.is(i,e)?!1:(n[t]=e,!0)}function xg(n,t,e,i){let r=un(n,t,e);return un(n,t+1,i)||r}function Kw(n,t,e,i,r){let o=xg(n,t,e,i);return un(n,t+2,r)||o}function dm(n,t,e){return function i(r){let o=qi(n)?Nn(n.index,t):t;bg(o,5);let s=t[ct],a=_b(t,s,e,r),u=i.__ngNextListenerFn__;for(;u;)a=_b(t,s,u,r)&&a,u=u.__ngNextListenerFn__;return a}}function _b(n,t,e,i){let r=ce(null);try{return Ae(6,t,e),e(i)!==!1}catch(o){return IT(n,o),!1}finally{Ae(7,t,e),ce(r)}}function cM(n,t,e,i,r,o,s,a){let u=ds(n),f=!1,h=null;if(!i&&u&&(h=dM(t,e,o,n.index)),h!==null){let m=h.__ngLastListenerFn__||h;m.__ngNextListenerFn__=s,h.__ngLastListenerFn__=s,f=!0}else{let m=Pn(n,e),b=i?i(m):m;_I(e,b,o,a);let _=r.listen(b,o,a);if(!uM(o)){let w=i?M=>i(On(M[n.index])):n.index;Yw(w,t,e,o,a,_,!1)}}return f}function uM(n){return n.startsWith("animation")||n.startsWith("transition")}function dM(n,t,e,i){let r=n.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let s=r[o];if(s===e&&r[o+1]===i){let a=t[cs],u=r[o+2];return a&&a.length>u?a[u]:null}typeof s=="string"&&(o+=2)}return null}function Yw(n,t,e,i,r,o,s){let a=t.firstCreatePass?Gh(t):null,u=Wh(e),f=u.length;u.push(r,o),a&&a.push(i,n,f,(f+1)*(s?-1:1))}function yb(n,t,e,i,r,o){let s=t[e],a=t[re],f=a.data[e].outputs[i],m=s[f].subscribe(o);Yw(n.index,a,t,r,o,m,!0)}var Nm=Symbol("BINDING");var Bu=class extends Ya{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let e=Gi(t);return new so(e,this.ngModule)}};function fM(n){return Object.keys(n).map(t=>{let[e,i,r]=n[t],o={propName:e,templateName:t,isSignal:(i&nd.SignalBased)!==0};return r&&(o.transform=r),o})}function pM(n){return Object.keys(n).map(t=>({propName:n[t],templateName:t}))}function hM(n,t,e){let i=t instanceof lt?t:t?.injector;return i&&n.getStandaloneInjector!==null&&(i=n.getStandaloneInjector(i)||i),i?new Pm(e,i):e}function mM(n){let t=n.get(oo,null);if(t===null)throw new z(407,!1);let e=n.get(Ww,null),i=n.get(Bi,null);return{rendererFactory:t,sanitizer:e,changeDetectionScheduler:i,ngReflect:!1}}function gM(n,t){let e=Zw(n);return cw(t,e,e==="svg"?Cy:e==="math"?Sy:null)}function Zw(n){return(n.selectors[0][0]||"div").toLowerCase()}var so=class extends pd{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=fM(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=pM(this.componentDef.outputs),this.cachedOutputs}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=FI(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,i,r,o,s){Ae(22);let a=ce(null);try{let u=this.componentDef,f=vM(i,u,s,o),h=hM(u,r||this.ngModule,t),m=mM(h),b=m.rendererFactory.createRenderer(null,u),_=i?vT(b,i,u.encapsulation,h):gM(u,b),w=s?.some(bb)||o?.some(A=>typeof A!="function"&&A.bindings.some(bb)),M=cg(null,f,null,512|pw(u),null,null,m,b,h,null,tw(_,h,!0));M[Je]=_,yu(M);let I=null;try{let A=Eg(Je,M,2,"#host",()=>f.directiveRegistry,!0,0);fw(b,_,A),_s(_,M),sd(f,M,A),ng(f,A,M),Cg(f,A),e!==void 0&&yM(A,this.ngContentSelectors,e),I=Nn(A.index,M),M[ct]=I[ct],yg(f,M,null)}catch(A){throw I!==null&&Cm(I),Cm(M),A}finally{Ae(23),bu()}return new $u(this.componentType,M,!!w)}finally{ce(a)}}};function vM(n,t,e,i){let r=n?["ng-version","20.3.7"]:LI(t.selectors[0]),o=null,s=null,a=0;if(e)for(let h of e)a+=h[Nm].requiredVars,h.create&&(h.targetIdx=0,(o??=[]).push(h)),h.update&&(h.targetIdx=0,(s??=[]).push(h));if(i)for(let h=0;h<i.length;h++){let m=i[h];if(typeof m!="function")for(let b of m.bindings){a+=b[Nm].requiredVars;let _=h+1;b.create&&(b.targetIdx=_,(o??=[]).push(b)),b.update&&(b.targetIdx=_,(s??=[]).push(b))}}let u=[t];if(i)for(let h of i){let m=typeof h=="function"?h:h.type,b=Oh(m);u.push(b)}return lg(0,null,_M(o,s),1,a,u,null,null,null,[r],null)}function _M(n,t){return!n&&!t?null:e=>{if(e&1&&n)for(let i of n)i.create();if(e&2&&t)for(let i of t)i.update()}}function bb(n){let t=n[Nm].kind;return t==="input"||t==="twoWay"}var $u=class extends Hw{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e,i){super(),this._rootLView=e,this._hasInputBindings=i,this._tNode=Ma(e[re],Je),this.location=ws(this._tNode,e),this.instance=Nn(this._tNode.index,e)[ct],this.hostView=this.changeDetectorRef=new yr(e,void 0),this.componentType=t}setInput(t,e){this._hasInputBindings;let i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;let r=this._rootLView,o=ld(i,r[re],r,t,e);this.previousInputValues.set(t,e);let s=Nn(i.index,r);bg(s,1)}get injector(){return new io(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function yM(n,t,e){let i=n.projection=[];for(let r=0;r<t.length;r++){let o=e[r];i.push(o!=null&&o.length?Array.from(o):null)}}var Yi=(()=>{class n{static __NG_ELEMENT_ID__=bM}return n})();function bM(){let n=It();return Xw(n,oe())}var wM=Yi,Qw=class extends wM{_lContainer;_hostTNode;_hostLView;constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return ws(this._hostTNode,this._hostLView)}get injector(){return new io(this._hostTNode,this._hostLView)}get parentInjector(){let t=Zm(this._hostTNode,this._hostLView);if(Fb(t)){let e=Pu(t,this._hostLView),i=Ou(t),r=e[re].data[i+8];return new io(r,e)}else return new io(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let e=wb(this._lContainer);return e!==null&&e[t]||null}get length(){return this._lContainer.length-pt}createEmbeddedView(t,e,i){let r,o;typeof i=="number"?r=i:i!=null&&(r=i.index,o=i.injector);let s=Rm(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(e||{},o,s);return this.insertImpl(a,r,za(this._hostTNode,s)),a}createComponent(t,e,i,r,o,s,a){let u=t&&!$D(t),f;if(u)f=e;else{let I=e||{};f=I.index,i=I.injector,r=I.projectableNodes,o=I.environmentInjector||I.ngModuleRef,s=I.directives,a=I.bindings}let h=u?t:new so(Gi(t)),m=i||this.parentInjector;if(!o&&h.ngModule==null){let A=(u?m:this.parentInjector).get(lt,null);A&&(o=A)}let b=Gi(h.componentType??{}),_=Rm(this._lContainer,b?.id??null),w=_?.firstChild??null,M=h.create(m,r,w,o,s,a);return this.insertImpl(M.hostView,f,za(this._hostTNode,_)),M}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,i){let r=t._lView;if(Dy(r)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let u=r[_t],f=new Qw(u,u[Rn],u[_t]);f.detach(f.indexOf(t))}}let o=this._adjustIndex(e),s=this._lContainer;return ud(s,r,o,i),t.attachToViewContainerRef(),Th(fm(s),o,t),t}move(t,e){return this.insert(t,e)}indexOf(t){let e=wb(this._lContainer);return e!==null?e.indexOf(t):-1}remove(t){let e=this._adjustIndex(t,-1),i=$a(this._lContainer,e);i&&(Ca(fm(this._lContainer),e),rd(i[re],i))}detach(t){let e=this._adjustIndex(t,-1),i=$a(this._lContainer,e);return i&&Ca(fm(this._lContainer),e)!=null?new yr(i):null}_adjustIndex(t,e=0){return t??this.length+e}};function wb(n){return n[Ta]}function fm(n){return n[Ta]||(n[Ta]=[])}function Xw(n,t){let e,i=t[n.index];return Xn(i)?e=i:(e=Vw(i,t,null,n),t[n.index]=e,ug(t,e)),CM(e,t,n,i),new Qw(e,n,t)}function EM(n,t){let e=n[Ne],i=e.createComment(""),r=Pn(t,n),o=e.parentNode(r);return ju(e,o,i,e.nextSibling(r),!1),i}var CM=DM,SM=()=>!1;function xM(n,t,e){return SM(n,t,e)}function DM(n,t,e,i){if(n[vr])return;let r;e.type&8?r=On(i):r=EM(t,e),n[vr]=r}var km=class n{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},Fm=class n{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let e=t.queries;if(e!==null){let i=t.contentQueries!==null?t.contentQueries[0]:e.length,r=[];for(let o=0;o<i;o++){let s=e.getByIndex(o),a=this.queries[s.indexInDeclarationView];r.push(a.clone())}return new n(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)Dg(t,e).matches!==null&&this.queries[e].setDirty()}},Hu=class{flags;read;predicate;constructor(t,e,i=null){this.flags=e,this.read=i,typeof t=="string"?this.predicate=NM(t):this.predicate=t}},Lm=class n{queries;constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){let r=e!==null?e.length:0,o=this.getByIndex(i).embeddedTView(t,r);o&&(o.indexInDeclarationView=i,e!==null?e.push(o):e=[o])}return e!==null?new n(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},jm=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,e=-1){this.metadata=t,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new n(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,i=t.parent;for(;i!==null&&i.type&8&&i.index!==e;)i=i.parent;return e===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];this.matchTNodeWithReadOption(t,e,IM(e,o)),this.matchTNodeWithReadOption(t,e,Mu(e,t,o,!1,!1))}else i===br?e.type&4&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Mu(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Tt||r===Yi||r===br&&e.type&4)this.addMatch(e.index,-2);else{let o=Mu(e,t,r,!1,!1);o!==null&&this.addMatch(e.index,o)}else this.addMatch(e.index,i)}}addMatch(t,e){this.matches===null?this.matches=[t,e]:this.matches.push(t,e)}};function IM(n,t){let e=n.localNames;if(e!==null){for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1]}return null}function TM(n,t){return n.type&11?ws(n,t):n.type&4?dd(n,t):null}function MM(n,t,e,i){return e===-1?TM(t,n):e===-2?AM(n,t,i):Ua(n,n[re],e,t)}function AM(n,t,e){if(e===Tt)return ws(t,n);if(e===br)return dd(t,n);if(e===Yi)return Xw(t,n)}function eE(n,t,e,i){let r=t[vi].queries[i];if(r.matches===null){let o=n.data,s=e.matches,a=[];for(let u=0;s!==null&&u<s.length;u+=2){let f=s[u];if(f<0)a.push(null);else{let h=o[f];a.push(MM(t,h,s[u+1],e.metadata.read))}}r.matches=a}return r.matches}function Vm(n,t,e,i){let r=n.queries.getByIndex(e),o=r.matches;if(o!==null){let s=eE(n,t,r,e);for(let a=0;a<o.length;a+=2){let u=o[a];if(u>0)i.push(s[a/2]);else{let f=o[a+1],h=t[-u];for(let m=pt;m<h.length;m++){let b=h[m];b[gr]===b[_t]&&Vm(b[re],b,f,i)}if(h[to]!==null){let m=h[to];for(let b=0;b<m.length;b++){let _=m[b];Vm(_[re],_,f,i)}}}}}return i}function RM(n,t){return n[vi].queries[t].queryList}function tE(n,t,e){let i=new Fu((e&4)===4);return My(n,t,i,i.destroy),(t[vi]??=new Fm).queries.push(new km(i))-1}function OM(n,t,e){let i=Ke();return i.firstCreatePass&&(nE(i,new Hu(n,t,e),-1),(t&2)===2&&(i.staticViewQueries=!0)),tE(i,oe(),t)}function PM(n,t,e,i){let r=Ke();if(r.firstCreatePass){let o=It();nE(r,new Hu(t,e,i),o.index),kM(r,n),(e&2)===2&&(r.staticContentQueries=!0)}return tE(r,oe(),e)}function NM(n){return n.split(",").map(t=>t.trim())}function nE(n,t,e){n.queries===null&&(n.queries=new Lm),n.queries.track(new jm(t,e))}function kM(n,t){let e=n.contentQueries||(n.contentQueries=[]),i=e.length?e[e.length-1]:-1;t!==i&&e.push(n.queries.length-1,t)}function Dg(n,t){return n.queries.getByIndex(t)}function FM(n,t){let e=n[re],i=Dg(e,t);return i.crossesNgTemplate?Vm(e,n,t,[]):eE(e,n,i,t)}var ao=class{},gd=class{};var Wu=class extends ao{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Bu(this);constructor(t,e,i,r=!0){super(),this.ngModuleType=t,this._parent=e;let o=Rh(t);this._bootstrapComponents=aw(o.bootstrap),this._r3Injector=tm(t,e,[{provide:ao,useValue:this},{provide:Ya,useValue:this.componentFactoryResolver},...i],zi(t),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},Gu=class extends gd{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new Wu(this.moduleType,t,[])}};var Ha=class extends ao{injector;componentFactoryResolver=new Bu(this);instance=null;constructor(t){super();let e=new Kr([...t.providers,{provide:ao,useValue:this},{provide:Ya,useValue:this.componentFactoryResolver}],t.parent||xa(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function Ss(n,t,e=null){return new Ha({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}var LM=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let i=Ph(!1,e.type),r=i.length>0?Ss([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=V({token:n,providedIn:"environment",factory:()=>new n(U(lt))})}return n})();function ve(n){return Ga(()=>{let t=iE(n),e=J(P({},t),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Qm.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?r=>r.get(LM).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ki.Emulated,styles:n.styles||Zt,_:null,schemas:n.schemas||null,tView:null,id:""});t.standalone&&oi("NgStandalone"),rE(e);let i=n.dependencies;return e.directiveDefs=Eb(i,jM),e.pipeDefs=Eb(i,my),e.id=zM(e),e})}function jM(n){return Gi(n)||Oh(n)}function Fn(n){return Ga(()=>({type:n.type,bootstrap:n.bootstrap||Zt,declarations:n.declarations||Zt,imports:n.imports||Zt,exports:n.exports||Zt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function VM(n,t){if(n==null)return hr;let e={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],o,s,a,u;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o,u=r[3]||null):(o=r,s=r,a=nd.None,u=null),e[o]=[i,a,u],t[o]=s}return e}function UM(n){if(n==null)return hr;let t={};for(let e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);return t}function Ee(n){return Ga(()=>{let t=iE(n);return rE(t),t})}function xs(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function iE(n){let t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputConfig:n.inputs||hr,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||Zt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:VM(n.inputs,t),outputs:UM(n.outputs),debugInfo:null}}function rE(n){n.features?.forEach(t=>t(n))}function Eb(n,t){return n?()=>{let e=typeof n=="function"?n():n,i=[];for(let r of e){let o=t(r);o!==null&&i.push(o)}return i}:null}function zM(n){let t=0,e=typeof n.consts=="function"?"":n.consts,i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,e,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of i.join("|"))t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function BM(n){return Object.getPrototypeOf(n.prototype).constructor}function ut(n){let t=BM(n.type),e=!0,i=[n];for(;t;){let r;if(yi(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new z(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);let s=n;s.inputs=pm(n.inputs),s.declaredInputs=pm(n.declaredInputs),s.outputs=pm(n.outputs);let a=r.hostBindings;a&&qM(n,a);let u=r.viewQuery,f=r.contentQueries;if(u&&WM(n,u),f&&GM(n,f),$M(n,r),ay(n.outputs,r.outputs),yi(r)&&r.data.animation){let h=n.data;h.animation=(h.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let s=0;s<o.length;s++){let a=o[s];a&&a.ngInherit&&a(n),a===ut&&(e=!1)}}t=Object.getPrototypeOf(t)}HM(i)}function $M(n,t){for(let e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;let i=t.inputs[e];i!==void 0&&(n.inputs[e]=i,n.declaredInputs[e]=t.declaredInputs[e])}}function HM(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Va(r.hostAttrs,e=Va(e,r.hostAttrs))}}function pm(n){return n===hr?{}:n===Zt?[]:n}function WM(n,t){let e=n.viewQuery;e?n.viewQuery=(i,r)=>{t(i,r),e(i,r)}:n.viewQuery=t}function GM(n,t){let e=n.contentQueries;e?n.contentQueries=(i,r,o)=>{t(i,r,o),e(i,r,o)}:n.contentQueries=t}function qM(n,t){let e=n.hostBindings;e?n.hostBindings=(i,r)=>{t(i,r),e(i,r)}:n.hostBindings=t}function oE(n,t,e,i,r,o,s,a){if(e.firstCreatePass){n.mergedAttrs=Va(n.mergedAttrs,n.attrs);let h=n.tView=lg(2,n,r,o,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,e.consts,null);e.queries!==null&&(e.queries.template(e,n),h.queries=e.queries.embeddedTView(n))}a&&(n.flags|=a),hs(n,!1);let u=KM(e,t,n,i);wu()&&gg(e,t,u,n),_s(u,t);let f=Vw(u,t,u,n);t[i+Je]=f,ug(t,f),xM(f,n,t)}function JM(n,t,e,i,r,o,s,a,u,f,h){let m=e+Je,b;return t.firstCreatePass?(b=fd(t,m,4,s||null,a||null),gu()&&Gw(t,n,b,bi(t.consts,f),_g),Pb(t,b)):b=t.data[m],oE(b,n,t,e,i,r,o,u),ds(b)&&sd(t,n,b),f!=null&&ad(n,b,h),b}function qu(n,t,e,i,r,o,s,a,u,f,h){let m=e+Je,b;if(t.firstCreatePass){if(b=fd(t,m,4,s||null,a||null),f!=null){let _=bi(t.consts,f);b.localNames=[];for(let w=0;w<_.length;w+=2)b.localNames.push(_[w],-1)}}else b=t.data[m];return oE(b,n,t,e,i,r,o,u),f!=null&&ad(n,b,h),b}function E(n,t,e,i,r,o,s,a){let u=oe(),f=Ke(),h=bi(f.consts,o);return JM(u,f,n,t,e,i,r,h,void 0,s,a),E}var KM=YM;function YM(n,t,e,i){return Na(!0),t[Ne].createComment("")}var Ig=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var Tg=new Y("");function wr(n){return!!n&&typeof n.then=="function"}function Mg(n){return!!n&&typeof n.subscribe=="function"}var Ag=new Y("");function vd(n){return mi([{provide:Ag,multi:!0,useValue:n}])}var Rg=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i});appInits=N(Ag,{optional:!0})??[];injector=N(Qt);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let r of this.appInits){let o=Dt(this.injector,r);if(wr(o))e.push(o);else if(Mg(o)){let s=new Promise((a,u)=>{o.subscribe({complete:a,error:u})});e.push(s)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),e.length===0&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Za=new Y("");function sE(){Vp(()=>{let n="";throw new z(600,n)})}function aE(n){return n.isBoundToModule}var ZM=10;var Zi=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=N(Xt);afterRenderManager=N(hg);zonelessEnabled=N(ka);rootEffectScheduler=N(am);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new We;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=N(wi);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(fe(e=>!e))}constructor(){N(co,{optional:!0})}whenStable(){let e;return new Promise(i=>{e=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{e.unsubscribe()})}_injector=N(lt);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,i){return this.bootstrapImpl(e,i)}bootstrapImpl(e,i,r=Qt.NULL){return this._injector.get(Be).run(()=>{Ae(10);let s=e instanceof pd;if(!this._injector.get(Rg).done){let w="";throw new z(405,w)}let u;s?u=e:u=this._injector.get(Ya).resolveComponentFactory(e),this.componentTypes.push(u.componentType);let f=aE(u)?void 0:this._injector.get(ao),h=i||u.selector,m=u.create(r,[],h,f),b=m.location.nativeElement,_=m.injector.get(Tg,null);return _?.registerApplication(b),m.onDestroy(()=>{this.detachView(m.hostView),ja(this.components,m),_?.unregisterApplication(b)}),this._loadComponent(m),Ae(11,m),m})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Ae(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(id.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new z(101,!1);let e=ce(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,ce(e),this.afterTick.next(),Ae(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(oo,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<ZM;)Ae(14),this.synchronizeOnce(),Ae(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let e=!1;if(this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!i&&!Ra(r))continue;let o=i&&!this.zonelessEnabled?0:1;kw(r,o),e=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}e||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Ra(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){let i=e;ja(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(e),this._injector.get(Za,[]).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ja(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new z(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ja(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function si(n,t){let e=oe(),i=Ji();if(un(e,i,t)){let r=Ke(),o=Pa();if(ld(o,r,e,n,t))qi(o)&&Dw(e,o.index);else{let a=Pn(o,e);Iw(e[Ne],a,null,o.value,n,t,null)}}return si}function Ci(n,t,e,i){let r=oe(),o=Ji();if(un(r,o,t)){let s=Ke(),a=Pa();xT(a,r,n,t,e,i)}return Ci}var hH=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var Um=class{destroy(t){}updateValue(t,e){}swap(t,e){let i=Math.min(t,e),r=Math.max(t,e),o=this.detach(r);if(r-i>1){let s=this.detach(i);this.attach(i,o),this.attach(r,s)}else this.attach(i,o)}move(t,e){this.attach(e,this.detach(t,!0))}};function hm(n,t,e,i,r){return n===e&&Object.is(t,i)?1:Object.is(r(n,t),r(e,i))?-1:0}function QM(n,t,e){let i,r,o=0,s=n.length-1,a=void 0;if(Array.isArray(t)){let u=t.length-1;for(;o<=s&&o<=u;){let f=n.at(o),h=t[o],m=hm(o,f,o,h,e);if(m!==0){m<0&&n.updateValue(o,h),o++;continue}let b=n.at(s),_=t[u],w=hm(s,b,u,_,e);if(w!==0){w<0&&n.updateValue(s,_),s--,u--;continue}let M=e(o,f),I=e(s,b),A=e(o,h);if(Object.is(A,I)){let L=e(u,_);Object.is(L,M)?(n.swap(o,s),n.updateValue(s,_),u--,s--):n.move(s,o),n.updateValue(o,h),o++;continue}if(i??=new Ju,r??=Sb(n,o,s,e),zm(n,i,o,A))n.updateValue(o,h),o++,s++;else if(r.has(A))i.set(M,n.detach(o)),s--;else{let L=n.create(o,t[o]);n.attach(o,L),o++,s++}}for(;o<=u;)Cb(n,i,e,o,t[o]),o++}else if(t!=null){let u=t[Symbol.iterator](),f=u.next();for(;!f.done&&o<=s;){let h=n.at(o),m=f.value,b=hm(o,h,o,m,e);if(b!==0)b<0&&n.updateValue(o,m),o++,f=u.next();else{i??=new Ju,r??=Sb(n,o,s,e);let _=e(o,m);if(zm(n,i,o,_))n.updateValue(o,m),o++,s++,f=u.next();else if(!r.has(_))n.attach(o,n.create(o,m)),o++,s++,f=u.next();else{let w=e(o,h);i.set(w,n.detach(o)),s--}}}for(;!f.done;)Cb(n,i,e,n.length,f.value),f=u.next()}for(;o<=s;)n.destroy(n.detach(s--));i?.forEach(u=>{n.destroy(u)})}function zm(n,t,e,i){return t!==void 0&&t.has(i)?(n.attach(e,t.get(i)),t.delete(i),!0):!1}function Cb(n,t,e,i,r){if(zm(n,t,i,e(i,r)))n.updateValue(i,r);else{let o=n.create(i,r);n.attach(i,o)}}function Sb(n,t,e,i){let r=new Set;for(let o=t;o<=e;o++)r.add(i(o,n.at(o)));return r}var Ju=class{kvMap=new Map;_vMap=void 0;has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;let e=this.kvMap.get(t);return this._vMap!==void 0&&this._vMap.has(e)?(this.kvMap.set(t,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,e){if(this.kvMap.has(t)){let i=this.kvMap.get(t);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,e)}else this.kvMap.set(t,e)}forEach(t){for(let[e,i]of this.kvMap)if(t(i,e),this._vMap!==void 0){let r=this._vMap;for(;r.has(i);)i=r.get(i),t(i,e)}}};function te(n,t,e,i,r,o,s,a){oi("NgControlFlow");let u=oe(),f=Ke(),h=bi(f.consts,o);return qu(u,f,n,t,e,i,r,h,256,s,a),Og}function Og(n,t,e,i,r,o,s,a){oi("NgControlFlow");let u=oe(),f=Ke(),h=bi(f.consts,o);return qu(u,f,n,t,e,i,r,h,512,s,a),Og}function ne(n,t){oi("NgControlFlow");let e=oe(),i=Ji(),r=e[i]!==Mt?e[i]:-1,o=r!==-1?Ku(e,Je+r):void 0,s=0;if(un(e,i,n)){let a=ce(null);try{if(o!==void 0&&zw(o,s),n!==-1){let u=Je+n,f=Ku(e,u),h=Wm(e[re],u),m=$w(f,h,e),b=cd(e,h,t,{dehydratedView:m});ud(f,b,s,za(h,m))}}finally{ce(a)}}else if(o!==void 0){let a=Uw(o,s);a!==void 0&&(a[ct]=t)}}var Bm=class{lContainer;$implicit;$index;constructor(t,e,i){this.lContainer=t,this.$implicit=e,this.$index=i}get $count(){return this.lContainer.length-pt}};function Pg(n){return n}function Er(n,t){return t}var $m=class{hasEmptyBlock;trackByFn;liveCollection;constructor(t,e,i){this.hasEmptyBlock=t,this.trackByFn=e,this.liveCollection=i}};function At(n,t,e,i,r,o,s,a,u,f,h,m,b){oi("NgControlFlow");let _=oe(),w=Ke(),M=u!==void 0,I=oe(),A=a?s.bind(I[En][ct]):s,L=new $m(M,A);I[Je+n]=L,qu(_,w,n+1,t,e,i,r,bi(w.consts,o),256),M&&qu(_,w,n+2,u,f,h,m,bi(w.consts,b),512)}var Hm=class extends Um{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(t,e,i){super(),this.lContainer=t,this.hostLView=e,this.templateTNode=i}get length(){return this.lContainer.length-pt}at(t){return this.getLView(t)[ct].$implicit}attach(t,e){let i=e[ls];this.needsIndexUpdate||=t!==this.length,ud(this.lContainer,e,t,za(this.templateTNode,i))}detach(t,e){return this.needsIndexUpdate||=t!==this.length-1,e&&XM(this.lContainer,t),eA(this.lContainer,t)}create(t,e){let i=Rm(this.lContainer,this.templateTNode.tView.ssrId),r=cd(this.hostLView,this.templateTNode,new Bm(this.lContainer,e,t),{dehydratedView:i});return this.operationsCounter?.recordCreate(),r}destroy(t){rd(t[re],t),this.operationsCounter?.recordDestroy()}updateValue(t,e){this.getLView(t)[ct].$implicit=e}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[ct].$index=t}getLView(t){return tA(this.lContainer,t)}};function Rt(n){let t=ce(null),e=ei();try{let i=oe(),r=i[re],o=i[e],s=e+1,a=Ku(i,s);if(o.liveCollection===void 0){let f=Wm(r,s);o.liveCollection=new Hm(a,i,f)}else o.liveCollection.reset();let u=o.liveCollection;if(QM(u,n,o.trackByFn),u.updateIndexes(),o.hasEmptyBlock){let f=Ji(),h=u.length===0;if(un(i,f,h)){let m=e+2,b=Ku(i,m);if(h){let _=Wm(r,m),w=$w(b,_,i),M=cd(i,_,void 0,{dehydratedView:w});ud(b,M,0,za(_,w))}else r.firstUpdatePass&&JT(b),zw(b,0)}}}finally{ce(t)}}function Ku(n,t){return n[t]}function XM(n,t){if(n.length<=pt)return;let e=pt+t,i=n[e];i&&i[eo]&&(i[eo].skipLeaveAnimations=!0)}function eA(n,t){return $a(n,t)}function tA(n,t){return Uw(n,t)}function Wm(n,t){return Ma(n,t)}function v(n,t,e){let i=oe(),r=Ji();if(un(i,r,t)){let o=Ke(),s=Pa();xw(s,i,n,t,i[Ne],e)}return v}function Gm(n,t,e,i,r){ld(t,n,e,r?"class":"style",i)}function c(n,t,e,i){let r=oe(),o=r[re],s=n+Je,a=o.firstCreatePass?Eg(s,r,2,t,_g,gu(),e,i):o.data[s];if(Tw(a,r,n,t,nA),ds(a)){let u=r[re];sd(u,r,a),ng(u,a,r)}return i!=null&&ad(r,a),c}function l(){let n=Ke(),t=It(),e=Mw(t);return n.firstCreatePass&&Cg(n,e),Ny(e)&&ky(),Oy(),e.classesWithoutHost!=null&&KD(e)&&Gm(n,e,oe(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&YD(e)&&Gm(n,e,oe(),e.stylesWithoutHost,!1),l}function O(n,t,e,i){return c(n,t,e,i),l(),O}var nA=(n,t,e,i,r)=>(Na(!0),cw(t[Ne],i,Jy()));function et(n,t,e){let i=oe(),r=i[re],o=n+Je,s=r.firstCreatePass?Eg(o,i,8,"ng-container",_g,gu(),t,e):r.data[o];if(Tw(s,i,n,"ng-container",iA),ds(s)){let a=i[re];sd(a,i,s),ng(a,s,i)}return e!=null&&ad(i,s),et}function tt(){let n=Ke(),t=It(),e=Mw(t);return n.firstCreatePass&&Cg(n,e),tt}var iA=(n,t,e,i,r)=>(Na(!0),UI(t[Ne],""));function k(){return oe()}var xu=void 0;function rA(n){let t=Math.floor(Math.abs(n)),e=n.toString().replace(/^[^.]*\.?/,"").length;return t===1&&e===0?1:5}var oA=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],xu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],xu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",xu,"{1} 'at' {0}",xu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",rA],mm={};function fn(n){let t=sA(n),e=xb(t);if(e)return e;let i=t.split("-")[0];if(e=xb(i),e)return e;if(i==="en")return oA;throw new z(701,!1)}function xb(n){return n in mm||(mm[n]=Hi.ng&&Hi.ng.common&&Hi.ng.common.locales&&Hi.ng.common.locales[n]),mm[n]}var nt=(function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n})(nt||{});function sA(n){return n.toLowerCase().replace(/_/g,"-")}var Qa="en-US";var aA=Qa;function lE(n){typeof n=="string"&&(aA=n.toLowerCase().replace(/_/g,"-"))}function x(n,t,e){let i=oe(),r=Ke(),o=It();return cE(r,i,i[Ne],o,n,t,e),x}function cE(n,t,e,i,r,o,s){let a=!0,u=null;if((i.type&3||s)&&(u??=dm(i,t,o),cM(i,n,t,s,e,r,o,u)&&(a=!1)),a){let f=i.outputs?.[r],h=i.hostDirectiveOutputs?.[r];if(h&&h.length)for(let m=0;m<h.length;m+=2){let b=h[m],_=h[m+1];u??=dm(i,t,o),yb(i,t,b,_,r,u)}if(f&&f.length)for(let m of f)u??=dm(i,t,o),yb(i,t,m,r,r,u)}}function g(n=1){return qy(n)}function Ng(n,t,e,i){PM(n,t,e,i)}function Xa(n,t,e){OM(n,t,e)}function uo(n){let t=oe(),e=Ke(),i=Qh();_u(i+1);let r=Dg(e,i);if(n.dirty&&xy(t)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let o=FM(t,i);n.reset(o,cI),n.notifyOnChanges()}return!0}return!1}function fo(){return RM(oe(),Qh())}function en(n){let t=jy();return Aa(t,Je+n)}function Du(n,t){return n<<17|t<<2}function lo(n){return n>>17&32767}function lA(n){return(n&2)==2}function cA(n,t){return n&131071|t<<17}function qm(n){return n|2}function bs(n){return(n&131068)>>2}function gm(n,t){return n&-131069|t<<2}function uA(n){return(n&1)===1}function Jm(n){return n|1}function dA(n,t,e,i,r,o){let s=o?t.classBindings:t.styleBindings,a=lo(s),u=bs(s);n[i]=e;let f=!1,h;if(Array.isArray(e)){let m=e;h=m[1],(h===null||as(m,h)>0)&&(f=!0)}else h=e;if(r)if(u!==0){let b=lo(n[a+1]);n[i+1]=Du(b,a),b!==0&&(n[b+1]=gm(n[b+1],i)),n[a+1]=cA(n[a+1],i)}else n[i+1]=Du(a,0),a!==0&&(n[a+1]=gm(n[a+1],i)),a=i;else n[i+1]=Du(u,0),a===0?a=i:n[u+1]=gm(n[u+1],i),u=i;f&&(n[i+1]=qm(n[i+1])),Db(n,h,i,!0),Db(n,h,i,!1),fA(t,h,n,i,o),s=Du(a,u),o?t.classBindings=s:t.styleBindings=s}function fA(n,t,e,i,r){let o=r?n.residualClasses:n.residualStyles;o!=null&&typeof t=="string"&&as(o,t)>=0&&(e[i+1]=Jm(e[i+1]))}function Db(n,t,e,i){let r=n[e+1],o=t===null,s=i?lo(r):bs(r),a=!1;for(;s!==0&&(a===!1||o);){let u=n[s],f=n[s+1];pA(u,t)&&(a=!0,n[s+1]=i?Jm(f):qm(f)),s=i?lo(f):bs(f)}a&&(n[e+1]=i?qm(r):Jm(r))}function pA(n,t){return n===null||t==null||(Array.isArray(n)?n[1]:n)===t?!0:Array.isArray(n)&&typeof t=="string"?as(n,t)>=0:!1}var ii={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function hA(n){return n.substring(ii.key,ii.keyEnd)}function mA(n){return gA(n),uE(n,dE(n,0,ii.textEnd))}function uE(n,t){let e=ii.textEnd;return e===t?-1:(t=ii.keyEnd=vA(n,ii.key=t,e),dE(n,t,e))}function gA(n){ii.key=0,ii.keyEnd=0,ii.value=0,ii.valueEnd=0,ii.textEnd=n.length}function dE(n,t,e){for(;t<e&&n.charCodeAt(t)<=32;)t++;return t}function vA(n,t,e){for(;t<e&&n.charCodeAt(t)>32;)t++;return t}function Si(n,t,e){return fE(n,t,e,!1),Si}function Ce(n,t){return fE(n,t,null,!0),Ce}function Cr(n){yA(xA,_A,n,!0)}function _A(n,t){for(let e=mA(t);e>=0;e=uE(t,e))du(n,hA(t),!0)}function fE(n,t,e,i){let r=oe(),o=Ke(),s=Oa(2);if(o.firstUpdatePass&&hE(o,n,s,i),t!==Mt&&un(r,s,t)){let a=o.data[ei()];mE(o,a,r,r[Ne],n,r[s+1]=IA(t,e),i,s)}}function yA(n,t,e,i){let r=Ke(),o=Oa(2);r.firstUpdatePass&&hE(r,null,o,i);let s=oe();if(e!==Mt&&un(s,o,e)){let a=r.data[ei()];if(gE(a,i)&&!pE(r,o)){let u=i?a.classesWithoutHost:a.stylesWithoutHost;u!==null&&(e=au(u,e||"")),Gm(r,a,s,e,i)}else DA(r,a,s,s[Ne],s[o+1],s[o+1]=SA(n,t,e),i,o)}}function pE(n,t){return t>=n.expandoStartIndex}function hE(n,t,e,i){let r=n.data;if(r[e+1]===null){let o=r[ei()],s=pE(n,e);gE(o,i)&&t===null&&!s&&(t=!1),t=bA(r,o,t,i),dA(r,o,t,e,s,i)}}function bA(n,t,e,i){let r=$y(n),o=i?t.residualClasses:t.residualStyles;if(r===null)(i?t.classBindings:t.styleBindings)===0&&(e=vm(null,n,t,e,i),e=Wa(e,t.attrs,i),o=null);else{let s=t.directiveStylingLast;if(s===-1||n[s]!==r)if(e=vm(r,n,t,e,i),o===null){let u=wA(n,t,i);u!==void 0&&Array.isArray(u)&&(u=vm(null,n,t,u[1],i),u=Wa(u,t.attrs,i),EA(n,t,i,u))}else o=CA(n,t,i)}return o!==void 0&&(i?t.residualClasses=o:t.residualStyles=o),e}function wA(n,t,e){let i=e?t.classBindings:t.styleBindings;if(bs(i)!==0)return n[lo(i)]}function EA(n,t,e,i){let r=e?t.classBindings:t.styleBindings;n[lo(r)]=i}function CA(n,t,e){let i,r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++){let s=n[o].hostAttrs;i=Wa(i,s,e)}return Wa(i,t.attrs,e)}function vm(n,t,e,i,r){let o=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(o=t[a],i=Wa(i,o.hostAttrs,r),o!==n);)a++;return n!==null&&(e.directiveStylingLast=a),i}function Wa(n,t,e){let i=e?1:2,r=-1;if(t!==null)for(let o=0;o<t.length;o++){let s=t[o];typeof s=="number"?r=s:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),du(n,s,e?!0:t[++o]))}return n===void 0?null:n}function SA(n,t,e){if(e==null||e==="")return Zt;let i=[],r=Cs(e);if(Array.isArray(r))for(let o=0;o<r.length;o++)n(i,r[o],!0);else if(typeof r=="object")for(let o in r)r.hasOwnProperty(o)&&n(i,o,r[o]);else typeof r=="string"&&t(i,r);return i}function xA(n,t,e){let i=String(t);i!==""&&!i.includes(" ")&&du(n,i,e)}function DA(n,t,e,i,r,o,s,a){r===Mt&&(r=Zt);let u=0,f=0,h=0<r.length?r[0]:null,m=0<o.length?o[0]:null;for(;h!==null||m!==null;){let b=u<r.length?r[u+1]:void 0,_=f<o.length?o[f+1]:void 0,w=null,M;h===m?(u+=2,f+=2,b!==_&&(w=m,M=_)):m===null||h!==null&&h<m?(u+=2,w=h):(f+=2,w=m,M=_),w!==null&&mE(n,t,e,i,w,M,s,a),h=u<r.length?r[u]:null,m=f<o.length?o[f]:null}}function mE(n,t,e,i,r,o,s,a){if(!(t.type&3))return;let u=n.data,f=u[a+1],h=uA(f)?Ib(u,t,e,r,bs(f),s):void 0;if(!Yu(h)){Yu(o)||lA(f)&&(o=Ib(u,null,e,r,a,s));let m=Uh(ei(),e);gT(i,s,m,r,o)}}function Ib(n,t,e,i,r,o){let s=t===null,a;for(;r>0;){let u=n[r],f=Array.isArray(u),h=f?u[1]:u,m=h===null,b=e[r+1];b===Mt&&(b=m?Zt:void 0);let _=m?fu(b,i):h===i?b:void 0;if(f&&!Yu(_)&&(_=fu(u,i)),Yu(_)&&(a=_,s))return a;let w=n[r+1];r=s?lo(w):bs(w)}if(t!==null){let u=o?t.residualClasses:t.residualStyles;u!=null&&(a=fu(u,i))}return a}function Yu(n){return n!==void 0}function IA(n,t){return n==null||n===""||(typeof t=="string"?n=n+t:typeof n=="object"&&(n=zi(Cs(n)))),n}function gE(n,t){return(n.flags&(t?8:16))!==0}function d(n,t=""){let e=oe(),i=Ke(),r=n+Je,o=i.firstCreatePass?fd(i,r,1,t,null):i.data[r],s=TA(i,e,o,t,n);e[r]=s,wu()&&gg(i,e,s,o),hs(o,!1)}var TA=(n,t,e,i,r)=>(Na(!0),jI(t[Ne],i));function vE(n,t,e,i=""){return un(n,Ji(),e)?t+Zn(e)+i:Mt}function MA(n,t,e,i,r,o=""){let s=Zh(),a=xg(n,s,e,r);return Oa(2),a?t+Zn(e)+i+Zn(r)+o:Mt}function AA(n,t,e,i,r,o,s,a=""){let u=Zh(),f=Kw(n,u,e,r,s);return Oa(3),f?t+Zn(e)+i+Zn(r)+o+Zn(s)+a:Mt}function T(n){return R("",n),T}function R(n,t,e){let i=oe(),r=vE(i,n,t,e);return r!==Mt&&kg(i,ei(),r),R}function _e(n,t,e,i,r){let o=oe(),s=MA(o,n,t,e,i,r);return s!==Mt&&kg(o,ei(),s),_e}function _d(n,t,e,i,r,o,s){let a=oe(),u=AA(a,n,t,e,i,r,o,s);return u!==Mt&&kg(a,ei(),u),_d}function kg(n,t,e){let i=Uh(t,n);VI(n[Ne],i,e)}function H(n,t,e){rm(t)&&(t=t());let i=oe(),r=Ji();if(un(i,r,t)){let o=Ke(),s=Pa();xw(s,i,n,t,i[Ne],e)}return H}function q(n,t){let e=rm(n);return e&&n.set(t),e}function W(n,t){let e=oe(),i=Ke(),r=It();return cE(i,e,e[Ne],r,n,t),W}function po(n){return un(oe(),Ji(),n)?Zn(n):Mt}function el(n,t,e=""){return vE(oe(),n,t,e)}function RA(n,t,e){let i=Ke();if(i.firstCreatePass){let r=yi(n);Km(e,i.data,i.blueprint,r,!0),Km(t,i.data,i.blueprint,r,!1)}}function Km(n,t,e,i,r){if(n=Vt(n),Array.isArray(n))for(let o=0;o<n.length;o++)Km(n[o],t,e,i,r);else{let o=Ke(),s=oe(),a=It(),u=Jr(n)?n:Vt(n.provide),f=kh(n),h=a.providerIndexes&1048575,m=a.directiveStart,b=a.providerIndexes>>20;if(Jr(n)||!n.multi){let _=new ro(f,r,D,null),w=ym(u,t,r?h:h+b,m);w===-1?(wm(ku(a,s),o,u),_m(o,n,t.length),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(_),s.push(_)):(e[w]=_,s[w]=_)}else{let _=ym(u,t,h+b,m),w=ym(u,t,h,h+b),M=_>=0&&e[_],I=w>=0&&e[w];if(r&&!I||!r&&!M){wm(ku(a,s),o,u);let A=NA(r?PA:OA,e.length,r,i,f,n);!r&&I&&(e[w].providerFactory=A),_m(o,n,t.length,0),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(A),s.push(A)}else{let A=_E(e[r?w:_],f,!r&&i);_m(o,n,_>-1?_:w,A)}!r&&i&&I&&e[w].componentProviders++}}}function _m(n,t,e,i){let r=Jr(t),o=by(t);if(r||o){let u=(o?Vt(t.useClass):t).prototype.ngOnDestroy;if(u){let f=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){let h=f.indexOf(e);h===-1?f.push(e,[i,u]):f[h+1].push(i,u)}else f.push(e,u)}}}function _E(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function ym(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function OA(n,t,e,i,r){return Ym(this.multi,[])}function PA(n,t,e,i,r){let o=this.multi,s;if(this.providerFactory){let a=this.providerFactory.componentProviders,u=Ua(i,i[re],this.providerFactory.index,r);s=u.slice(0,a),Ym(o,s);for(let f=a;f<u.length;f++)s.push(u[f])}else s=[],Ym(o,s);return s}function Ym(n,t){for(let e=0;e<n.length;e++){let i=n[e];t.push(i())}return t}function NA(n,t,e,i,r,o){let s=new ro(n,e,D,null);return s.multi=[],s.index=t,s.componentProviders=0,_E(s,r,i&&!e),s}function $t(n,t=[]){return e=>{e.providersResolver=(i,r)=>RA(i,r?r(n):n,t)}}function $e(n,t,e){let i=ms()+n,r=oe();return r[i]===Mt?md(r,i,e?t.call(e):t()):lM(r,i)}function Fg(n,t,e,i){return yE(oe(),ms(),n,t,e,i)}function Lg(n,t){let e=n[t];return e===Mt?void 0:e}function yE(n,t,e,i,r,o){let s=t+e;return un(n,s,r)?md(n,s+1,o?i.call(o,r):i(r)):Lg(n,s+1)}function kA(n,t,e,i,r,o,s){let a=t+e;return xg(n,a,r,o)?md(n,a+2,s?i.call(s,r,o):i(r,o)):Lg(n,a+2)}function FA(n,t,e,i,r,o,s,a){let u=t+e;return Kw(n,u,r,o,s)?md(n,u+3,a?i.call(a,r,o,s):i(r,o,s)):Lg(n,u+3)}function Z(n,t){let e=Ke(),i,r=n+Je;e.firstCreatePass?(i=LA(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];let o=i.factory||(i.factory=fr(i.type,!0)),s,a=Yt(D);try{let u=Nu(!1),f=o();return Nu(u),zh(e,oe(),r,f),f}finally{Yt(a)}}function LA(n,t){if(t)for(let e=t.length-1;e>=0;e--){let i=t[e];if(n===i.name)return i}}function Qi(n,t,e){let i=n+Je,r=oe(),o=Aa(r,i);return jg(r,i)?yE(r,ms(),t,o.transform,e,o):o.transform(e)}function X(n,t,e,i){let r=n+Je,o=oe(),s=Aa(o,r);return jg(o,r)?kA(o,ms(),t,s.transform,e,i,s):s.transform(e,i)}function tl(n,t,e,i,r){let o=n+Je,s=oe(),a=Aa(s,o);return jg(s,o)?FA(s,ms(),t,a.transform,e,i,r,a):a.transform(e,i,r)}function jg(n,t){return n[re].data[t].pure}function xn(n,t){return dd(n,t)}var Zu=class{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}},Vg=(()=>{class n{compileModuleSync(e){return new Gu(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let i=this.compileModuleSync(e),r=Rh(e),o=aw(r.declarations).reduce((s,a)=>{let u=Gi(a);return u&&s.push(new so(u)),s},[]);return new Zu(i,o)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var jA=(()=>{class n{zone=N(Be);changeDetectionScheduler=N(Bi);applicationRef=N(Zi);applicationErrorHandler=N(Xt);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(e){this.applicationErrorHandler(e)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),bE=new Y("",{factory:()=>!1});function Ug({ngZoneFactory:n,ignoreChangesOutsideZone:t,scheduleInRootZone:e}){return n??=()=>new Be(J(P({},Bg()),{scheduleInRootZone:e})),[{provide:Be,useFactory:n},{provide:Wi,multi:!0,useFactory:()=>{let i=N(jA,{optional:!0});return()=>i.initialize()}},{provide:Wi,multi:!0,useFactory:()=>{let i=N(VA);return()=>{i.initialize()}}},t===!0?{provide:om,useValue:!0}:[],{provide:sm,useValue:e??gw},{provide:Xt,useFactory:()=>{let i=N(Be),r=N(lt),o;return s=>{i.runOutsideAngular(()=>{r.destroyed&&!o?setTimeout(()=>{throw s}):(o??=r.get(Yn),o.handleError(s))})}}}]}function zg(n){let t=n?.ignoreChangesOutsideZone,e=n?.scheduleInRootZone,i=Ug({ngZoneFactory:()=>{let r=Bg(n);return r.scheduleInRootZone=e,r.shouldCoalesceEventChangeDetection&&oi("NgZone_CoalesceEvent"),new Be(r)},ignoreChangesOutsideZone:t,scheduleInRootZone:e});return mi([{provide:bE,useValue:!0},{provide:ka,useValue:!1},i])}function Bg(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var VA=(()=>{class n{subscription=new Xe;initialized=!1;zone=N(Be);pendingTasks=N(wi);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Be.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Be.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var wE=(()=>{class n{applicationErrorHandler=N(Xt);appRef=N(Zi);taskService=N(wi);ngZone=N(Be);zonelessEnabled=N(ka);tracing=N(co,{optional:!0});disableScheduling=N(om,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Xe;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Vu):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(N(sm,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Uu||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let i=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,i=!0;break}case 12:{this.appRef.dirtyFlags|=16,i=!0;break}case 13:{this.appRef.dirtyFlags|=2,i=!0;break}case 11:{i=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;let r=this.useMicrotaskScheduler?lb:vw;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Vu+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(e),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,lb(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function UA(){return typeof $localize<"u"&&$localize.locale||Qa}var ho=new Y("",{providedIn:"root",factory:()=>N(ho,{optional:!0,skipSelf:!0})||UA()});function bt(n){return ry(n)}function mo(n,t){return xc(n,t?.equal)}var EE=class{[Bt];constructor(t){this[Bt]=t}destroy(){this[Bt].destroy()}};var ME=Symbol("InputSignalNode#UNSET"),QA=J(P({},Dc),{transformFn:void 0,applyValueToInputSignal(n,t){Ko(n,t)}});function AE(n,t){let e=Object.create(QA);e.value=n,e.transformFn=t?.transform;function i(){if(Go(e),e.value===ME){let r=null;throw new z(-950,r)}return e.value}return i[Bt]=e,i}var bd=class{attributeName;constructor(t){this.attributeName=t}__NG_ELEMENT_ID__=()=>qa(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},XA=new Y("");XA.__NG_ELEMENT_ID__=n=>{let t=It();if(t===null)throw new z(204,!1);if(t.type&2)return t.value;if(n&8)return null;throw new z(204,!1)};function CE(n,t){return AE(n,t)}function eR(n){return AE(ME,n)}var RE=(CE.required=eR,CE);var $g=new Y(""),tR=new Y("");function nl(n){return!n.moduleRef}function nR(n){let t=nl(n)?n.r3Injector:n.moduleRef.injector,e=t.get(Be);return e.run(()=>{nl(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=t.get(Xt),r;if(e.runOutsideAngular(()=>{r=e.onError.subscribe({next:i})}),nl(n)){let o=()=>t.destroy(),s=n.platformInjector.get($g);s.add(o),t.onDestroy(()=>{r.unsubscribe(),s.delete(o)})}else{let o=()=>n.moduleRef.destroy(),s=n.platformInjector.get($g);s.add(o),n.moduleRef.onDestroy(()=>{ja(n.allPlatformModules,n.moduleRef),r.unsubscribe(),s.delete(o)})}return rR(i,e,()=>{let o=t.get(wi),s=o.add(),a=t.get(Rg);return a.runInitializers(),a.donePromise.then(()=>{let u=t.get(ho,Qa);if(lE(u||Qa),!t.get(tR,!0))return nl(n)?t.get(Zi):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(nl(n)){let h=t.get(Zi);return n.rootComponent!==void 0&&h.bootstrap(n.rootComponent),h}else return iR?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>void o.remove(s))})})}var iR;function rR(n,t,e){try{let i=e();return wr(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n(i)),i}}var yd=null;function oR(n=[],t){return Qt.create({name:t,providers:[{provide:Sa,useValue:"platform"},{provide:$g,useValue:new Set([()=>yd=null])},...n]})}function sR(n=[]){if(yd)return yd;let t=oR(n);return yd=t,sE(),aR(t),t}function aR(n){let t=n.get(Xu,null);Dt(n,()=>{t?.forEach(e=>e())})}var Xi=(()=>{class n{static __NG_ELEMENT_ID__=lR}return n})();function lR(n){return cR(It(),oe(),(n&16)===16)}function cR(n,t,e){if(qi(n)&&!e){let i=Nn(n.index,t);return new yr(i,i)}else if(n.type&175){let i=t[En];return new yr(i,t)}return null}var Hg=class{constructor(){}supports(t){return Sg(t)}create(t){return new Wg(t)}},uR=(n,t)=>t,Wg=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||uR}forEachItem(t){let e;for(e=this._itHead;e!==null;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,o=null;for(;e||i;){let s=!i||e&&e.currentIndex<SE(i,r,o)?e:i,a=SE(s,r,o),u=s.currentIndex;if(s===i)r--,i=i._nextRemoved;else if(e=e._next,s.previousIndex==null)r++;else{o||(o=[]);let f=a-r,h=u-r;if(f!=h){for(let b=0;b<f;b++){let _=b<o.length?o[b]:o[b]=0,w=_+b;h<=w&&w<f&&(o[b]=_+1)}let m=s.previousIndex;o[m]=h-f}}a!==u&&t(s,a,u)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)t(e)}diff(t){if(t==null&&(t=[]),!Sg(t))throw new z(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._itHead,i=!1,r,o,s;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,o,s,a),i=!0):(i&&(e=this._verifyReinsertion(e,o,s,a)),Object.is(e.item,o)||this._addIdentityChange(e,o)),e=e._next}else r=0,Jw(t,a=>{s=this._trackByFn(r,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,r),i=!0):(i&&(e=this._verifyReinsertion(e,a,s,r)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let o;return t===null?o=this._itTail:(o=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,r)):(t=this._linkedRecords===null?null:this._linkedRecords.get(i,r),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,r)):t=this._addAfter(new Gg(e,i),o,r)),t}_verifyReinsertion(t,e,i,r){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null);return o!==null?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;t!==null;){let e=t._next;this._addToRemovals(this._unlink(t)),t=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let r=t._prevRemoved,o=t._nextRemoved;return r===null?this._removalsHead=o:r._nextRemoved=o,o===null?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){let r=e===null?this._itHead:e._next;return t._next=r,t._prev=e,r===null?this._itTail=t:r._prev=t,e===null?this._itHead=t:e._next=t,this._linkedRecords===null&&(this._linkedRecords=new wd),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let e=t._prev,i=t._next;return e===null?this._itHead=i:e._next=i,i===null?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new wd),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},Gg=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,e){this.item=t,this.trackById=e}},qg=class{_head=null;_tail=null;add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;i!==null;i=i._nextDup)if((e===null||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){let e=t._prevDup,i=t._nextDup;return e===null?this._head=i:e._nextDup=i,i===null?this._tail=e:i._prevDup=e,this._head===null}},wd=class{map=new Map;put(t){let e=t.trackById,i=this.map.get(e);i||(i=new qg,this.map.set(e,i)),i.add(t)}get(t,e){let i=t,r=this.map.get(i);return r?r.get(t,e):null}remove(t){let e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function SE(n,t,e){let i=n.previousIndex;if(i===null)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}var Jg=class{constructor(){}supports(t){return t instanceof Map||hd(t)}create(){return new Kg}},Kg=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(t){let e;for(e=this._mapHead;e!==null;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;e!==null;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;e!==null;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)t(e)}diff(t){if(!t)t=new Map;else if(!(t instanceof Map||hd(t)))throw new z(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{let o=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,o)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;i!==null;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){let i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){let r=this._records.get(t);this._maybeAddToChanges(r,e);let o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}let i=new Yg(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;t!==null;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;t!=null;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){this._additionsHead===null?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){this._changesHead===null?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}},Yg=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(t){this.key=t}};function xE(){return new Zg([new Hg])}var Zg=(()=>{class n{factories;static \u0275prov=V({token:n,providedIn:"root",factory:xE});constructor(e){this.factories=e}static create(e,i){if(i!=null){let r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:()=>{let i=N(n,{optional:!0,skipSelf:!0});return n.create(e,i||xE())}}}find(e){let i=this.factories.find(r=>r.supports(e));if(i!=null)return i;throw new z(901,!1)}}return n})();function DE(){return new Qg([new Jg])}var Qg=(()=>{class n{static \u0275prov=V({token:n,providedIn:"root",factory:DE});factories;constructor(e){this.factories=e}static create(e,i){if(i){let r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:()=>{let i=N(n,{optional:!0,skipSelf:!0});return n.create(e,i||DE())}}}find(e){let i=this.factories.find(r=>r.supports(e));if(i)return i;throw new z(901,!1)}}return n})();function OE(n){let{rootComponent:t,appProviders:e,platformProviders:i,platformRef:r}=n;Ae(8);try{let o=r?.injector??sR(i),s=[Ug({}),{provide:Bi,useExisting:wE},Yy,...e||[]],a=new Ha({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return nR({r3Injector:a.injector,platformInjector:o,rootComponent:t})}catch(o){return Promise.reject(o)}finally{Ae(9)}}function go(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function PE(n){let t=Gi(n);if(!t)return null;let e=new so(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var FE=null;function Ln(){return FE}function Xg(n){FE??=n}var il=class{},rl=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N(LE),providedIn:"platform"})}return n})(),e0=new Y(""),LE=(()=>{class n extends rl{_location;_history;_doc=N(Ye);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ln().getBaseHref(this._doc)}onPopState(e){let i=Ln().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){let i=Ln().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function Ed(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function NE(n){let t=n.search(/#|\?|$/);return n[t-1]==="/"?n.slice(0,t-1)+n.slice(t):n}function ai(n){return n&&n[0]!=="?"?`?${n}`:n}var Dn=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N(Sd),providedIn:"root"})}return n})(),Cd=new Y(""),Sd=(()=>{class n extends Dn{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??N(Ye).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Ed(this._baseHref,e)}path(e=!1){let i=this._platformLocation.pathname+ai(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,o){let s=this.prepareExternalUrl(r+ai(o));this._platformLocation.pushState(e,i,s)}replaceState(e,i,r,o){let s=this.prepareExternalUrl(r+ai(o));this._platformLocation.replaceState(e,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(U(rl),U(Cd,8))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Sr=(()=>{class n{_subject=new We;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let i=this._locationStrategy.getBaseHref();this._basePath=pR(NE(kE(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+ai(i))}normalize(e){return n.stripTrailingSlash(fR(this._basePath,kE(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ai(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ai(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=ai;static joinWithSlash=Ed;static stripTrailingSlash=NE;static \u0275fac=function(i){return new(i||n)(U(Dn))};static \u0275prov=V({token:n,factory:()=>dR(),providedIn:"root"})}return n})();function dR(){return new Sr(U(Dn))}function fR(n,t){if(!n||!t.startsWith(n))return t;let e=t.substring(n.length);return e===""||["/",";","?","#"].includes(e[0])?e:t}function kE(n){return n.replace(/\/index.html$/,"")}function pR(n){if(new RegExp("^(https?:)?//").test(n)){let[,e]=n.split(/\/\/[^\/]+/);return e}return n}var cl=(()=>{class n extends Dn{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(e){let i=Ed(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,o){let s=this.prepareExternalUrl(r+ai(o))||this._platformLocation.pathname;this._platformLocation.pushState(e,i,s)}replaceState(e,i,r,o){let s=this.prepareExternalUrl(r+ai(o))||this._platformLocation.pathname;this._platformLocation.replaceState(e,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(U(rl),U(Cd,8))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();var Nd=(function(n){return n[n.Decimal=0]="Decimal",n[n.Percent=1]="Percent",n[n.Currency=2]="Currency",n[n.Scientific=3]="Scientific",n})(Nd||{});var Ht=(function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n})(Ht||{}),Re=(function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n})(Re||{}),pn=(function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n})(pn||{}),Pt={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function $E(n){return fn(n)[nt.LocaleId]}function HE(n,t,e){let i=fn(n),r=[i[nt.DayPeriodsFormat],i[nt.DayPeriodsStandalone]],o=Vn(r,t);return Vn(o,e)}function WE(n,t,e){let i=fn(n),r=[i[nt.DaysFormat],i[nt.DaysStandalone]],o=Vn(r,t);return Vn(o,e)}function GE(n,t,e){let i=fn(n),r=[i[nt.MonthsFormat],i[nt.MonthsStandalone]],o=Vn(r,t);return Vn(o,e)}function qE(n,t){let i=fn(n)[nt.Eras];return Vn(i,t)}function ol(n,t){let e=fn(n);return Vn(e[nt.DateFormat],t)}function sl(n,t){let e=fn(n);return Vn(e[nt.TimeFormat],t)}function al(n,t){let i=fn(n)[nt.DateTimeFormat];return Vn(i,t)}function jn(n,t){let e=fn(n),i=e[nt.NumberSymbols][t];if(typeof i>"u"){if(t===Pt.CurrencyDecimal)return e[nt.NumberSymbols][Pt.Decimal];if(t===Pt.CurrencyGroup)return e[nt.NumberSymbols][Pt.Group]}return i}function a0(n,t){return fn(n)[nt.NumberFormats][t]}function JE(n){if(!n[nt.ExtraData])throw new z(2303,!1)}function KE(n){let t=fn(n);return JE(t),(t[nt.ExtraData][2]||[]).map(i=>typeof i=="string"?t0(i):[t0(i[0]),t0(i[1])])}function YE(n,t,e){let i=fn(n);JE(i);let r=[i[nt.ExtraData][0],i[nt.ExtraData][1]],o=Vn(r,t)||[];return Vn(o,e)||[]}function Vn(n,t){for(let e=t;e>-1;e--)if(typeof n[e]<"u")return n[e];throw new z(2304,!1)}function t0(n){let[t,e]=n.split(":");return{hours:+t,minutes:+e}}var hR=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,xd={},mR=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function ZE(n,t,e,i){let r=SR(n);t=er(e,t)||t;let s=[],a;for(;t;)if(a=mR.exec(t),a){s=s.concat(a.slice(1));let h=s.pop();if(!h)break;t=h}else{s.push(t);break}let u=r.getTimezoneOffset();i&&(u=XE(i,u),r=CR(r,i));let f="";return s.forEach(h=>{let m=wR(h);f+=m?m(r,e,u):h==="''"?"'":h.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),f}function Ad(n,t,e){let i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function er(n,t){let e=$E(n);if(xd[e]??={},xd[e][t])return xd[e][t];let i="";switch(t){case"shortDate":i=ol(n,pn.Short);break;case"mediumDate":i=ol(n,pn.Medium);break;case"longDate":i=ol(n,pn.Long);break;case"fullDate":i=ol(n,pn.Full);break;case"shortTime":i=sl(n,pn.Short);break;case"mediumTime":i=sl(n,pn.Medium);break;case"longTime":i=sl(n,pn.Long);break;case"fullTime":i=sl(n,pn.Full);break;case"short":let r=er(n,"shortTime"),o=er(n,"shortDate");i=Dd(al(n,pn.Short),[r,o]);break;case"medium":let s=er(n,"mediumTime"),a=er(n,"mediumDate");i=Dd(al(n,pn.Medium),[s,a]);break;case"long":let u=er(n,"longTime"),f=er(n,"longDate");i=Dd(al(n,pn.Long),[u,f]);break;case"full":let h=er(n,"fullTime"),m=er(n,"fullDate");i=Dd(al(n,pn.Full),[h,m]);break}return i&&(xd[e][t]=i),i}function Dd(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return t!=null&&i in t?t[i]:e})),n}function li(n,t,e="-",i,r){let o="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,o=e));let s=String(n);for(;s.length<t;)s="0"+s;return i&&(s=s.slice(s.length-t)),o+s}function gR(n,t){return li(n,3).substring(0,t)}function ht(n,t,e=0,i=!1,r=!1){return function(o,s){let a=vR(n,o);if((e>0||a>-e)&&(a+=e),n===3)a===0&&e===-12&&(a=12);else if(n===6)return gR(a,t);let u=jn(s,Pt.MinusSign);return li(a,t,u,i,r)}}function vR(n,t){switch(n){case 0:return t.getFullYear();case 1:return t.getMonth();case 2:return t.getDate();case 3:return t.getHours();case 4:return t.getMinutes();case 5:return t.getSeconds();case 6:return t.getMilliseconds();case 7:return t.getDay();default:throw new z(2301,!1)}}function Fe(n,t,e=Ht.Format,i=!1){return function(r,o){return _R(r,o,n,t,e,i)}}function _R(n,t,e,i,r,o){switch(e){case 2:return GE(t,r,i)[n.getMonth()];case 1:return WE(t,r,i)[n.getDay()];case 0:let s=n.getHours(),a=n.getMinutes();if(o){let f=KE(t),h=YE(t,r,i),m=f.findIndex(b=>{if(Array.isArray(b)){let[_,w]=b,M=s>=_.hours&&a>=_.minutes,I=s<w.hours||s===w.hours&&a<w.minutes;if(_.hours<w.hours){if(M&&I)return!0}else if(M||I)return!0}else if(b.hours===s&&b.minutes===a)return!0;return!1});if(m!==-1)return h[m]}return HE(t,r,i)[s<12?0:1];case 3:return qE(t,i)[n.getFullYear()<=0?0:1];default:let u=e;throw new z(2302,!1)}}function Id(n){return function(t,e,i){let r=-1*i,o=jn(e,Pt.MinusSign),s=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case 0:return(r>=0?"+":"")+li(s,2,o)+li(Math.abs(r%60),2,o);case 1:return"GMT"+(r>=0?"+":"")+li(s,1,o);case 2:return"GMT"+(r>=0?"+":"")+li(s,2,o)+":"+li(Math.abs(r%60),2,o);case 3:return i===0?"Z":(r>=0?"+":"")+li(s,2,o)+":"+li(Math.abs(r%60),2,o);default:throw new z(2310,!1)}}}var yR=0,Md=4;function bR(n){let t=Ad(n,yR,1).getDay();return Ad(n,0,1+(t<=Md?Md:Md+7)-t)}function QE(n){let t=n.getDay(),e=t===0?-3:Md-t;return Ad(n.getFullYear(),n.getMonth(),n.getDate()+e)}function n0(n,t=!1){return function(e,i){let r;if(t){let o=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();r=1+Math.floor((s+o)/7)}else{let o=QE(e),s=bR(o.getFullYear()),a=o.getTime()-s.getTime();r=1+Math.round(a/6048e5)}return li(r,n,jn(i,Pt.MinusSign))}}function Td(n,t=!1){return function(e,i){let o=QE(e).getFullYear();return li(o,n,jn(i,Pt.MinusSign),t)}}var i0={};function wR(n){if(i0[n])return i0[n];let t;switch(n){case"G":case"GG":case"GGG":t=Fe(3,Re.Abbreviated);break;case"GGGG":t=Fe(3,Re.Wide);break;case"GGGGG":t=Fe(3,Re.Narrow);break;case"y":t=ht(0,1,0,!1,!0);break;case"yy":t=ht(0,2,0,!0,!0);break;case"yyy":t=ht(0,3,0,!1,!0);break;case"yyyy":t=ht(0,4,0,!1,!0);break;case"Y":t=Td(1);break;case"YY":t=Td(2,!0);break;case"YYY":t=Td(3);break;case"YYYY":t=Td(4);break;case"M":case"L":t=ht(1,1,1);break;case"MM":case"LL":t=ht(1,2,1);break;case"MMM":t=Fe(2,Re.Abbreviated);break;case"MMMM":t=Fe(2,Re.Wide);break;case"MMMMM":t=Fe(2,Re.Narrow);break;case"LLL":t=Fe(2,Re.Abbreviated,Ht.Standalone);break;case"LLLL":t=Fe(2,Re.Wide,Ht.Standalone);break;case"LLLLL":t=Fe(2,Re.Narrow,Ht.Standalone);break;case"w":t=n0(1);break;case"ww":t=n0(2);break;case"W":t=n0(1,!0);break;case"d":t=ht(2,1);break;case"dd":t=ht(2,2);break;case"c":case"cc":t=ht(7,1);break;case"ccc":t=Fe(1,Re.Abbreviated,Ht.Standalone);break;case"cccc":t=Fe(1,Re.Wide,Ht.Standalone);break;case"ccccc":t=Fe(1,Re.Narrow,Ht.Standalone);break;case"cccccc":t=Fe(1,Re.Short,Ht.Standalone);break;case"E":case"EE":case"EEE":t=Fe(1,Re.Abbreviated);break;case"EEEE":t=Fe(1,Re.Wide);break;case"EEEEE":t=Fe(1,Re.Narrow);break;case"EEEEEE":t=Fe(1,Re.Short);break;case"a":case"aa":case"aaa":t=Fe(0,Re.Abbreviated);break;case"aaaa":t=Fe(0,Re.Wide);break;case"aaaaa":t=Fe(0,Re.Narrow);break;case"b":case"bb":case"bbb":t=Fe(0,Re.Abbreviated,Ht.Standalone,!0);break;case"bbbb":t=Fe(0,Re.Wide,Ht.Standalone,!0);break;case"bbbbb":t=Fe(0,Re.Narrow,Ht.Standalone,!0);break;case"B":case"BB":case"BBB":t=Fe(0,Re.Abbreviated,Ht.Format,!0);break;case"BBBB":t=Fe(0,Re.Wide,Ht.Format,!0);break;case"BBBBB":t=Fe(0,Re.Narrow,Ht.Format,!0);break;case"h":t=ht(3,1,-12);break;case"hh":t=ht(3,2,-12);break;case"H":t=ht(3,1);break;case"HH":t=ht(3,2);break;case"m":t=ht(4,1);break;case"mm":t=ht(4,2);break;case"s":t=ht(5,1);break;case"ss":t=ht(5,2);break;case"S":t=ht(6,1);break;case"SS":t=ht(6,2);break;case"SSS":t=ht(6,3);break;case"Z":case"ZZ":case"ZZZ":t=Id(0);break;case"ZZZZZ":t=Id(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Id(1);break;case"OOOO":case"ZZZZ":case"zzzz":t=Id(2);break;default:return null}return i0[n]=t,t}function XE(n,t){n=n.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function ER(n,t){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+t),n}function CR(n,t,e){let r=n.getTimezoneOffset(),o=XE(t,r);return ER(n,-1*(o-r))}function SR(n){if(jE(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,o=1,s=1]=n.split("-").map(a=>+a);return Ad(r,o-1,s)}let e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(hR))return xR(i)}let t=new Date(n);if(!jE(t))throw new z(2311,!1);return t}function xR(n){let t=new Date(0),e=0,i=0,r=n[8]?t.setUTCFullYear:t.setFullYear,o=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));let s=Number(n[4]||0)-e,a=Number(n[5]||0)-i,u=Number(n[6]||0),f=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return o.call(t,s,a,u,f),t}function jE(n){return n instanceof Date&&!isNaN(n.valueOf())}var DR=/^(\d+)?\.((\d+)(-(\d+))?)?$/,VE=22,Rd=".",ll="0",IR=";",TR=",",r0="#";var MR="%";function e1(n,t,e,i,r,o,s=!1){let a="",u=!1;if(!isFinite(n))a=jn(e,Pt.Infinity);else{let f=RR(n);s&&(f=AR(f));let h=t.minInt,m=t.minFrac,b=t.maxFrac;if(o){let L=o.match(DR);if(L===null)throw new z(2306,!1);let $=L[1],j=L[3],se=L[5];$!=null&&(h=o0($)),j!=null&&(m=o0(j)),se!=null?b=o0(se):j!=null&&m>b&&(b=m)}OR(f,m,b);let _=f.digits,w=f.integerLen,M=f.exponent,I=[];for(u=_.every(L=>!L);w<h;w++)_.unshift(0);for(;w<0;w++)_.unshift(0);w>0?I=_.splice(w,_.length):(I=_,_=[0]);let A=[];for(_.length>=t.lgSize&&A.unshift(_.splice(-t.lgSize,_.length).join(""));_.length>t.gSize;)A.unshift(_.splice(-t.gSize,_.length).join(""));_.length&&A.unshift(_.join("")),a=A.join(jn(e,i)),I.length&&(a+=jn(e,r)+I.join("")),M&&(a+=jn(e,Pt.Exponential)+"+"+M)}return n<0&&!u?a=t.negPre+a+t.negSuf:a=t.posPre+a+t.posSuf,a}function t1(n,t,e){let i=a0(t,Nd.Percent),r=i1(i,jn(t,Pt.MinusSign));return e1(n,r,t,Pt.Group,Pt.Decimal,e,!0).replace(new RegExp(MR,"g"),jn(t,Pt.PercentSign))}function n1(n,t,e){let i=a0(t,Nd.Decimal),r=i1(i,jn(t,Pt.MinusSign));return e1(n,r,t,Pt.Group,Pt.Decimal,e)}function i1(n,t="-"){let e={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(IR),r=i[0],o=i[1],s=r.indexOf(Rd)!==-1?r.split(Rd):[r.substring(0,r.lastIndexOf(ll)+1),r.substring(r.lastIndexOf(ll)+1)],a=s[0],u=s[1]||"";e.posPre=a.substring(0,a.indexOf(r0));for(let h=0;h<u.length;h++){let m=u.charAt(h);m===ll?e.minFrac=e.maxFrac=h+1:m===r0?e.maxFrac=h+1:e.posSuf+=m}let f=a.split(TR);if(e.gSize=f[1]?f[1].length:0,e.lgSize=f[2]||f[1]?(f[2]||f[1]).length:0,o){let h=r.length-e.posPre.length-e.posSuf.length,m=o.indexOf(r0);e.negPre=o.substring(0,m).replace(/'/g,""),e.negSuf=o.slice(m+h).replace(/'/g,"")}else e.negPre=t+e.posPre,e.negSuf=e.posSuf;return e}function AR(n){if(n.digits[0]===0)return n;let t=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(t===0?n.digits.push(0,0):t===1&&n.digits.push(0),n.integerLen+=2),n}function RR(n){let t=Math.abs(n)+"",e=0,i,r,o,s,a;for((r=t.indexOf(Rd))>-1&&(t=t.replace(Rd,"")),(o=t.search(/e/i))>0?(r<0&&(r=o),r+=+t.slice(o+1),t=t.substring(0,o)):r<0&&(r=t.length),o=0;t.charAt(o)===ll;o++);if(o===(a=t.length))i=[0],r=1;else{for(a--;t.charAt(a)===ll;)a--;for(r-=o,i=[],s=0;o<=a;o++,s++)i[s]=Number(t.charAt(o))}return r>VE&&(i=i.splice(0,VE-1),e=r-1,r=1),{digits:i,exponent:e,integerLen:r}}function OR(n,t,e){if(t>e)throw new z(2307,!1);let i=n.digits,r=i.length-n.integerLen,o=Math.min(Math.max(t,r),e),s=o+n.integerLen,a=i[s];if(s>0){i.splice(Math.max(n.integerLen,s));for(let m=s;m<i.length;m++)i[m]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,s=o+1),i[0]=0;for(let m=1;m<s;m++)i[m]=0}if(a>=5)if(s-1<0){for(let m=0;m>s;m--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[s-1]++;for(;r<Math.max(0,o);r++)i.push(0);let u=o!==0,f=t+n.integerLen,h=i.reduceRight(function(m,b,_,w){return b=b+m,w[_]=b<10?b:b-10,u&&(w[_]===0&&_>=f?w.pop():u=!1),b>=10?1:0},0);h&&(i.unshift(h),n.integerLen++)}function o0(n){let t=parseInt(n);if(isNaN(t))throw new z(2305,!1);return t}var s0=/\s+/,UE=[],l0=(()=>{class n{_ngEl;_renderer;initialClasses=UE;rawClass;stateMap=new Map;constructor(e,i){this._ngEl=e,this._renderer=i}set klass(e){this.initialClasses=e!=null?e.trim().split(s0):UE}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(s0):e}ngDoCheck(){for(let i of this.initialClasses)this._updateState(i,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let i of e)this._updateState(i,!0);else if(e!=null)for(let i of Object.keys(e))this._updateState(i,!!e[i]);this._applyStateDiff()}_updateState(e,i){let r=this.stateMap.get(e);r!==void 0?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(e,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let i=e[0],r=e[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(e,i){e=e.trim(),e.length>0&&e.split(s0).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(i){return new(i||n)(D(Tt),D(dn))};static \u0275dir=Ee({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var Od=class{$implicit;ngForOf;index;count;constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Le=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let i=this._viewContainer;e.forEachOperation((r,o,s)=>{if(r.previousIndex==null)i.createEmbeddedView(this._template,new Od(r.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)i.remove(o===null?void 0:o);else if(o!==null){let a=i.get(o);i.move(a,s),zE(a,r)}});for(let r=0,o=i.length;r<o;r++){let a=i.get(r).context;a.index=r,a.count=o,a.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{let o=i.get(r.currentIndex);zE(o,r)})}static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(D(Yi),D(br),D(Zg))};static \u0275dir=Ee({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function zE(n,t){n.context.$implicit=t.item}var Se=(()=>{class n{_viewContainer;_context=new Pd;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,i){this._viewContainer=e,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){BE(e,!1),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){BE(e,!1),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(D(Yi),D(br))};static \u0275dir=Ee({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),Pd=class{$implicit=null;ngIf=null};function BE(n,t){if(n&&!n.createEmbeddedView)throw new z(2020,!1)}var ul=(()=>{class n{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){let e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){let[r,o]=e.split("."),s=r.indexOf("-")===-1?void 0:ri.DashCase;i!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,o?`${i}${o}`:i,s):this._renderer.removeStyle(this._ngEl.nativeElement,r,s)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}static \u0275fac=function(i){return new(i||n)(D(Tt),D(Qg),D(dn))};static \u0275dir=Ee({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return n})();function kd(n,t){return new z(2100,!1)}var PR="mediumDate",r1=new Y(""),o1=new Y(""),dt=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,o){if(e==null||e===""||e!==e)return null;try{let s=i??this.defaultOptions?.dateFormat??PR,a=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return ZE(e,s,o||this.locale,a)}catch(s){throw kd(n,s.message)}}static \u0275fac=function(i){return new(i||n)(D(ho,16),D(r1,24),D(o1,24))};static \u0275pipe=xs({name:"date",type:n,pure:!0})}return n})();var tn=(()=>{class n{_locale;constructor(e){this._locale=e}transform(e,i,r){if(!s1(e))return null;r||=this._locale;try{let o=a1(e);return n1(o,r,i)}catch(o){throw kd(n,o.message)}}static \u0275fac=function(i){return new(i||n)(D(ho,16))};static \u0275pipe=xs({name:"number",type:n,pure:!0})}return n})(),dl=(()=>{class n{_locale;constructor(e){this._locale=e}transform(e,i,r){if(!s1(e))return null;r||=this._locale;try{let o=a1(e);return t1(o,r,i)}catch(o){throw kd(n,o.message)}}static \u0275fac=function(i){return new(i||n)(D(ho,16))};static \u0275pipe=xs({name:"percent",type:n,pure:!0})}return n})();function s1(n){return!(n==null||n===""||n!==n)}function a1(n){if(typeof n=="string"&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if(typeof n!="number")throw new z(2309,!1);return n}var fl=(()=>{class n{transform(e,i,r){if(e==null)return null;if(!(typeof e=="string"||Array.isArray(e)))throw kd(n,e);return e.slice(i,r)}static \u0275fac=function(i){return new(i||n)};static \u0275pipe=xs({name:"slice",type:n,pure:!1})}return n})();var be=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Fn({type:n});static \u0275inj=wn({})}return n})();function pl(n,t){t=encodeURIComponent(t);for(let e of n.split(";")){let i=e.indexOf("="),[r,o]=i==-1?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}var vo=class{};var l1="browser";var c1=(()=>{class n{static \u0275prov=V({token:n,providedIn:"root",factory:()=>new c0(N(Ye),window)})}return n})(),c0=class{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t,e){this.window.scrollTo(J(P({},e),{left:t[0],top:t[1]}))}scrollToAnchor(t,e){let i=NR(this.document,t);i&&(this.scrollToElement(i,e),i.focus())}setHistoryScrollRestoration(t){try{this.window.history.scrollRestoration=t}catch{console.warn($i(2400,!1))}}scrollToElement(t,e){let i=t.getBoundingClientRect(),r=i.left+this.window.pageXOffset,o=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(J(P({},e),{left:r-s[0],top:o-s[1]}))}};function NR(n,t){let e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),r=i.currentNode;for(;r;){let o=r.shadowRoot;if(o){let s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}r=i.nextNode()}}return null}var hl=class{_doc;constructor(t){this._doc=t}manager},Fd=(()=>{class n extends hl{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r,o){return e.addEventListener(i,r,o),()=>this.removeEventListener(e,i,r,o)}removeEventListener(e,i,r,o){return e.removeEventListener(i,r,o)}static \u0275fac=function(i){return new(i||n)(U(Ye))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),jd=new Y(""),h0=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,i){this._zone=i,e.forEach(s=>{s.manager=this});let r=e.filter(s=>!(s instanceof Fd));this._plugins=r.slice().reverse();let o=e.find(s=>s instanceof Fd);o&&this._plugins.push(o)}addEventListener(e,i,r,o){return this._findPluginFor(i).addEventListener(e,i,r,o)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(o=>o.supports(e)),!i)throw new z(5101,!1);return this._eventNameToPlugin.set(e,i),i}static \u0275fac=function(i){return new(i||n)(U(jd),U(Be))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),u0="ng-app-id";function u1(n){for(let t of n)t.remove()}function d1(n,t){let e=t.createElement("style");return e.textContent=n,e}function kR(n,t,e,i){let r=n.head?.querySelectorAll(`style[${u0}="${t}"],link[${u0}="${t}"]`);if(r)for(let o of r)o.removeAttribute(u0),o instanceof HTMLLinkElement?i.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&e.set(o.textContent,{usage:0,elements:[o]})}function f0(n,t){let e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}var m0=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(e,i,r,o={}){this.doc=e,this.appId=i,this.nonce=r,kR(e,i,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,i){for(let r of e)this.addUsage(r,this.inline,d1);i?.forEach(r=>this.addUsage(r,this.external,f0))}removeStyles(e,i){for(let r of e)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(e,i,r){let o=i.get(e);o?o.usage++:i.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,r(e,this.doc)))})}removeUsage(e,i){let r=i.get(e);r&&(r.usage--,r.usage<=0&&(u1(r.elements),i.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])u1(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[i,{elements:r}]of this.inline)r.push(this.addElement(e,d1(i,this.doc)));for(let[i,{elements:r}]of this.external)r.push(this.addElement(e,f0(i,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,i){return this.nonce&&i.setAttribute("nonce",this.nonce),e.appendChild(i)}static \u0275fac=function(i){return new(i||n)(U(Ye),U(Qu),U(ed,8),U(Es))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),d0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},g0=/%COMP%/g;var p1="%COMP%",FR=`_nghost-${p1}`,LR=`_ngcontent-${p1}`,jR=!0,VR=new Y("",{providedIn:"root",factory:()=>jR});function UR(n){return LR.replace(g0,n)}function zR(n){return FR.replace(g0,n)}function h1(n,t){return t.map(e=>e.replace(g0,n))}var v0=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,i,r,o,s,a,u,f=null,h=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=u,this.nonce=f,this.tracingService=h,this.platformIsServer=!1,this.defaultRenderer=new ml(e,s,u,this.platformIsServer,this.tracingService)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;let r=this.getOrCreateRenderer(e,i);return r instanceof Ld?r.applyToHost(e):r instanceof gl&&r.applyStyles(),r}getOrCreateRenderer(e,i){let r=this.rendererByCompId,o=r.get(i.id);if(!o){let s=this.doc,a=this.ngZone,u=this.eventManager,f=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,m=this.platformIsServer,b=this.tracingService;switch(i.encapsulation){case Ki.Emulated:o=new Ld(u,f,i,this.appId,h,s,a,m,b);break;case Ki.ShadowDom:return new p0(u,f,e,i,s,a,this.nonce,m,b);default:o=new gl(u,f,i,h,s,a,m,b);break}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(i){return new(i||n)(U(h0),U(m0),U(Qu),U(VR),U(Ye),U(Es),U(Be),U(ed),U(co,8))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),ml=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,i,r,o){this.eventManager=t,this.doc=e,this.ngZone=i,this.platformIsServer=r,this.tracingService=o}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(d0[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(f1(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(f1(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){e.remove()}selectRootElement(t,e){let i=typeof t=="string"?this.doc.querySelector(t):t;if(!i)throw new z(-5104,!1);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;let o=d0[r];o?t.setAttributeNS(o,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){let r=d0[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(ri.DashCase|ri.Important)?t.style.setProperty(e,i,r&ri.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&ri.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t!=null&&(t[e]=i)}setValue(t,e){t.nodeValue=e}listen(t,e,i,r){if(typeof t=="string"&&(t=Ln().getGlobalEventTarget(this.doc,t),!t))throw new z(5102,!1);let o=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(t,e,o)),this.eventManager.addEventListener(t,e,o,r)}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;t(e)===!1&&e.preventDefault()}}};function f1(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var p0=class extends ml{sharedStylesHost;hostEl;shadowRoot;constructor(t,e,i,r,o,s,a,u,f){super(t,o,s,u,f),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=r.styles;h=h1(r.id,h);for(let b of h){let _=document.createElement("style");a&&_.setAttribute("nonce",a),_.textContent=b,this.shadowRoot.appendChild(_)}let m=r.getExternalStyles?.();if(m)for(let b of m){let _=f0(b,o);a&&_.setAttribute("nonce",a),this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},gl=class extends ml{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,i,r,o,s,a,u,f){super(t,o,s,a,u),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r;let h=i.styles;this.styles=f?h1(f,h):h,this.styleUrls=i.getExternalStyles?.(f)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&ys.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Ld=class extends gl{contentAttr;hostAttr;constructor(t,e,i,r,o,s,a,u,f){let h=r+"-"+i.id;super(t,e,i,o,s,a,u,f,h),this.contentAttr=UR(h),this.hostAttr=zR(h)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}};var Vd=class n extends il{supportsDOMEvents=!0;static makeCurrent(){Xg(new n)}onAndCancel(t,e,i,r){return t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=BR();return e==null?null:$R(e)}resetBaseElement(){vl=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return pl(document.cookie,t)}},vl=null;function BR(){return vl=vl||document.head.querySelector("base"),vl?vl.getAttribute("href"):null}function $R(n){return new URL(n,document.baseURI).pathname}var HR=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),m1=["alt","control","meta","shift"],WR={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},GR={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},g1=(()=>{class n extends hl{constructor(e){super(e)}supports(e){return n.parseEventName(e)!=null}addEventListener(e,i,r,o){let s=n.parseEventName(i),a=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ln().onAndCancel(e,s.domEventName,a,o))}static parseEventName(e){let i=e.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let o=n._normalizeKey(i.pop()),s="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),s="code."),m1.forEach(f=>{let h=i.indexOf(f);h>-1&&(i.splice(h,1),s+=f+".")}),s+=o,i.length!=0||o.length===0)return null;let u={};return u.domEventName=r,u.fullKey=s,u}static matchEventFullKeyCode(e,i){let r=WR[e.key]||e.key,o="";return i.indexOf("code.")>-1&&(r=e.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),m1.forEach(s=>{if(s!==r){let a=GR[s];a(e)&&(o+=s+".")}}),o+=r,o===i)}static eventCallback(e,i,r){return o=>{n.matchEventFullKeyCode(o,e)&&r.runGuarded(()=>i(o))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(i){return new(i||n)(U(Ye))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();function _0(n,t,e){let i=P({rootComponent:n,platformRef:e?.platformRef},qR(t));return OE(i)}function qR(n){return{appProviders:[...QR,...n?.providers??[]],platformProviders:ZR}}function JR(){Vd.makeCurrent()}function KR(){return new Yn}function YR(){return Xm(document),document}var ZR=[{provide:Es,useValue:l1},{provide:Xu,useValue:JR,multi:!0},{provide:Ye,useFactory:YR}];var QR=[{provide:Sa,useValue:"root"},{provide:Yn,useFactory:KR},{provide:jd,useClass:Fd,multi:!0,deps:[Ye]},{provide:jd,useClass:g1,multi:!0,deps:[Ye]},v0,m0,h0,{provide:oo,useExisting:v0},{provide:vo,useClass:HR},[]];var Ts=class{},_l=class{},xi=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(e=>{let i=e.indexOf(":");if(i>0){let r=e.slice(0,i),o=e.slice(i+1).trim();this.addHeaderEntry(r,o)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,i)=>{this.addHeaderEntry(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){let e=new n;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){let e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(t.name,e);let r=(t.op==="a"?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":let o=t.value;if(!o)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>o.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(t,e){let i=t.toLowerCase();this.maybeSetNormalizedName(t,i),this.headers.has(i)?this.headers.get(i).push(e):this.headers.set(i,[e])}setHeaderEntries(t,e){let i=(Array.isArray(e)?e:[e]).map(o=>o.toString()),r=t.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}};var zd=class{encodeKey(t){return v1(t)}encodeValue(t){return v1(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function XR(n,t){let e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[s,a]=o==-1?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,o)),t.decodeValue(r.slice(o+1))],u=e.get(s)||[];u.push(a),e.set(s,u)}),e}var eO=/%(\d[a-f0-9])/gi,tO={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function v1(n){return encodeURIComponent(n).replace(eO,(t,e)=>tO[e]??t)}function Ud(n){return`${n}`}var tr=class n{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new zd,t.fromString){if(t.fromObject)throw new z(2805,!1);this.map=XR(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{let i=t.fromObject[e],r=Array.isArray(i)?i.map(Ud):[Ud(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){let e=[];return Object.keys(t).forEach(i=>{let r=t[i];Array.isArray(r)?r.forEach(o=>{e.push({param:i,value:o,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let e=new n({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let e=(t.op==="a"?this.map.get(t.param):void 0)||[];e.push(Ud(t.value)),this.map.set(t.param,e);break;case"d":if(t.value!==void 0){let i=this.map.get(t.param)||[],r=i.indexOf(Ud(t.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var Bd=class{map=new Map;set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function nO(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function _1(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function y1(n){return typeof Blob<"u"&&n instanceof Blob}function b1(n){return typeof FormData<"u"&&n instanceof FormData}function iO(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var w1="Content-Type",E1="Accept",C1="X-Request-URL",S1="text/plain",x1="application/json",rO=`${x1}, ${S1}, */*`,Ds=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(t,e,i,r){this.url=e,this.method=t.toUpperCase();let o;if(nO(this.method)||r?(this.body=i!==void 0?i:null,o=r):o=i,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new z(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),this.transferCache=o.transferCache}if(this.headers??=new xi,this.context??=new Bd,!this.params)this.params=new tr,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),u=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+u+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||_1(this.body)||y1(this.body)||b1(this.body)||iO(this.body)?this.body:this.body instanceof tr?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||b1(this.body)?null:y1(this.body)?this.body.type||null:_1(this.body)?null:typeof this.body=="string"?S1:this.body instanceof tr?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?x1:null}clone(t={}){let e=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,o=t.keepalive??this.keepalive,s=t.priority||this.priority,a=t.cache||this.cache,u=t.mode||this.mode,f=t.redirect||this.redirect,h=t.credentials||this.credentials,m=t.referrer||this.referrer,b=t.integrity||this.integrity,_=t.transferCache??this.transferCache,w=t.timeout??this.timeout,M=t.body!==void 0?t.body:this.body,I=t.withCredentials??this.withCredentials,A=t.reportProgress??this.reportProgress,L=t.headers||this.headers,$=t.params||this.params,j=t.context??this.context;return t.setHeaders!==void 0&&(L=Object.keys(t.setHeaders).reduce((se,je)=>se.set(je,t.setHeaders[je]),L)),t.setParams&&($=Object.keys(t.setParams).reduce((se,je)=>se.set(je,t.setParams[je]),$)),new n(e,i,M,{params:$,headers:L,context:j,reportProgress:A,responseType:r,withCredentials:I,transferCache:_,keepalive:o,cache:a,priority:s,timeout:w,mode:u,redirect:f,credentials:h,referrer:m,integrity:b})}},_o=(function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n})(_o||{}),Ms=class{headers;status;statusText;url;ok;type;redirected;constructor(t,e=200,i="OK"){this.headers=t.headers||new xi,this.status=t.status!==void 0?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.redirected=t.redirected,this.ok=this.status>=200&&this.status<300}},$d=class n extends Ms{constructor(t={}){super(t)}type=_o.ResponseHeader;clone(t={}){return new n({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},yl=class n extends Ms{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=_o.Response;clone(t={}){return new n({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0,redirected:t.redirected??this.redirected})}},Is=class extends Ms{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},oO=200,sO=204;function y0(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}var Di=(()=>{class n{handler;constructor(e){this.handler=e}request(e,i,r={}){let o;if(e instanceof Ds)o=e;else{let u;r.headers instanceof xi?u=r.headers:u=new xi(r.headers);let f;r.params&&(r.params instanceof tr?f=r.params:f=new tr({fromObject:r.params})),o=new Ds(e,i,r.body!==void 0?r.body:null,{headers:u,context:r.context,params:f,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,integrity:r.integrity,timeout:r.timeout})}let s=K(o).pipe(hi(u=>this.handler.handle(u)));if(e instanceof Ds||r.observe==="events")return s;let a=s.pipe(at(u=>u instanceof yl));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return a.pipe(fe(u=>{if(u.body!==null&&!(u.body instanceof ArrayBuffer))throw new z(2806,!1);return u.body}));case"blob":return a.pipe(fe(u=>{if(u.body!==null&&!(u.body instanceof Blob))throw new z(2807,!1);return u.body}));case"text":return a.pipe(fe(u=>{if(u.body!==null&&typeof u.body!="string")throw new z(2808,!1);return u.body}));case"json":default:return a.pipe(fe(u=>u.body))}case"response":return a;default:throw new z(2809,!1)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:new tr().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,y0(r,i))}post(e,i,r={}){return this.request("POST",e,y0(r,i))}put(e,i,r={}){return this.request("PUT",e,y0(r,i))}static \u0275fac=function(i){return new(i||n)(U(Ts))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();var aO=new Y("");function lO(n,t){return t(n)}function cO(n,t,e){return(i,r)=>Dt(e,()=>t(i,o=>n(o,r)))}var D1=new Y(""),I1=new Y(""),T1=new Y("",{providedIn:"root",factory:()=>!0});var Hd=(()=>{class n extends Ts{backend;injector;chain=null;pendingTasks=N(Cu);contributeToStability=N(T1);constructor(e,i){super(),this.backend=e,this.injector=i}handle(e){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(D1),...this.injector.get(I1,[])]));this.chain=i.reduceRight((r,o)=>cO(r,o,this.injector),lO)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(Wr(i))}else return this.chain(e,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(U(_l),U(lt))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();var uO=/^\)\]\}',?\n/,dO=RegExp(`^${C1}:`,"m");function fO(n){return"responseURL"in n&&n.responseURL?n.responseURL:dO.test(n.getAllResponseHeaders())?n.getResponseHeader(C1):null}var b0=(()=>{class n{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new z(-2800,!1);let i=this.xhrFactory;return K(null).pipe(qe(()=>new we(o=>{let s=i.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((I,A)=>s.setRequestHeader(I,A.join(","))),e.headers.has(E1)||s.setRequestHeader(E1,rO),!e.headers.has(w1)){let I=e.detectContentTypeHeader();I!==null&&s.setRequestHeader(w1,I)}if(e.timeout&&(s.timeout=e.timeout),e.responseType){let I=e.responseType.toLowerCase();s.responseType=I!=="json"?I:"text"}let a=e.serializeBody(),u=null,f=()=>{if(u!==null)return u;let I=s.statusText||"OK",A=new xi(s.getAllResponseHeaders()),L=fO(s)||e.url;return u=new $d({headers:A,status:s.status,statusText:I,url:L}),u},h=()=>{let{headers:I,status:A,statusText:L,url:$}=f(),j=null;A!==sO&&(j=typeof s.response>"u"?s.responseText:s.response),A===0&&(A=j?oO:0);let se=A>=200&&A<300;if(e.responseType==="json"&&typeof j=="string"){let je=j;j=j.replace(uO,"");try{j=j!==""?JSON.parse(j):null}catch(F){j=je,se&&(se=!1,j={error:F,text:j})}}se?(o.next(new yl({body:j,headers:I,status:A,statusText:L,url:$||void 0})),o.complete()):o.error(new Is({error:j,headers:I,status:A,statusText:L,url:$||void 0}))},m=I=>{let{url:A}=f(),L=new Is({error:I,status:s.status||0,statusText:s.statusText||"Unknown Error",url:A||void 0});o.error(L)},b=m;e.timeout&&(b=I=>{let{url:A}=f(),L=new Is({error:new DOMException("Request timed out","TimeoutError"),status:s.status||0,statusText:s.statusText||"Request timeout",url:A||void 0});o.error(L)});let _=!1,w=I=>{_||(o.next(f()),_=!0);let A={type:_o.DownloadProgress,loaded:I.loaded};I.lengthComputable&&(A.total=I.total),e.responseType==="text"&&s.responseText&&(A.partialText=s.responseText),o.next(A)},M=I=>{let A={type:_o.UploadProgress,loaded:I.loaded};I.lengthComputable&&(A.total=I.total),o.next(A)};return s.addEventListener("load",h),s.addEventListener("error",m),s.addEventListener("timeout",b),s.addEventListener("abort",m),e.reportProgress&&(s.addEventListener("progress",w),a!==null&&s.upload&&s.upload.addEventListener("progress",M)),s.send(a),o.next({type:_o.Sent}),()=>{s.removeEventListener("error",m),s.removeEventListener("abort",m),s.removeEventListener("load",h),s.removeEventListener("timeout",b),e.reportProgress&&(s.removeEventListener("progress",w),a!==null&&s.upload&&s.upload.removeEventListener("progress",M)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(i){return new(i||n)(U(vo))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),M1=new Y(""),pO="XSRF-TOKEN",hO=new Y("",{providedIn:"root",factory:()=>pO}),mO="X-XSRF-TOKEN",gO=new Y("",{providedIn:"root",factory:()=>mO}),bl=class{},vO=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,i){this.doc=e,this.cookieName=i}getToken(){let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=pl(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(i){return new(i||n)(U(Ye),U(hO))};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();function _O(n,t){let e=n.url.toLowerCase();if(!N(M1)||n.method==="GET"||n.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return t(n);let i=N(bl).getToken(),r=N(gO);return i!=null&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),t(n)}function w0(...n){let t=[Di,b0,Hd,{provide:Ts,useExisting:Hd},{provide:_l,useFactory:()=>N(aO,{optional:!0})??N(b0)},{provide:D1,useValue:_O,multi:!0},{provide:M1,useValue:!0},{provide:bl,useClass:vO}];for(let e of n)t.push(...e.\u0275providers);return mi(t)}var A1=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(i){return new(i||n)(U(Ye))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var pe="primary",Pl=Symbol("RouteTitle"),D0=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function wo(n){return new D0(n)}function j1(n,t,e){let i=e.path.split("/");if(i.length>n.length||e.pathMatch==="full"&&(t.hasChildren()||i.length<n.length))return null;let r={};for(let o=0;o<i.length;o++){let s=i[o],a=n[o];if(s[0]===":")r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function bO(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Ii(n[e],t[e]))return!1;return!0}function Ii(n,t){let e=n?I0(n):void 0,i=t?I0(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let o=0;o<e.length;o++)if(r=e[o],!V1(n[r],t[r]))return!1;return!0}function I0(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function V1(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;let e=[...n].sort(),i=[...t].sort();return e.every((r,o)=>i[o]===r)}else return n===t}function U1(n){return n.length>0?n[n.length-1]:null}function nr(n){return th(n)?n:wr(n)?B(Promise.resolve(n)):K(n)}var wO={exact:B1,subset:$1},z1={exact:EO,subset:CO,ignored:()=>!0};function R1(n,t,e){return wO[e.paths](n.root,t.root,e.matrixParams)&&z1[e.queryParams](n.queryParams,t.queryParams)&&!(e.fragment==="exact"&&n.fragment!==t.fragment)}function EO(n,t){return Ii(n,t)}function B1(n,t,e){if(!yo(n.segments,t.segments)||!Jd(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(let i in t.children)if(!n.children[i]||!B1(n.children[i],t.children[i],e))return!1;return!0}function CO(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>V1(n[e],t[e]))}function $1(n,t,e){return H1(n,t,t.segments,e)}function H1(n,t,e,i){if(n.segments.length>e.length){let r=n.segments.slice(0,e.length);return!(!yo(r,e)||t.hasChildren()||!Jd(r,e,i))}else if(n.segments.length===e.length){if(!yo(n.segments,e)||!Jd(n.segments,e,i))return!1;for(let r in t.children)if(!n.children[r]||!$1(n.children[r],t.children[r],i))return!1;return!0}else{let r=e.slice(0,n.segments.length),o=e.slice(n.segments.length);return!yo(n.segments,r)||!Jd(n.segments,r,i)||!n.children[pe]?!1:H1(n.children[pe],t,o,i)}}function Jd(n,t,e){return t.every((i,r)=>z1[e](n[r].parameters,i.parameters))}var Mi=class{root;queryParams;fragment;_queryParamMap;constructor(t=new xe([],{}),e={},i=null){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=wo(this.queryParams),this._queryParamMap}toString(){return DO.serialize(this)}},xe=class{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Kd(this)}},xr=class{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=wo(this.parameters),this._parameterMap}toString(){return G1(this)}};function SO(n,t){return yo(n,t)&&n.every((e,i)=>Ii(e.parameters,t[i].parameters))}function yo(n,t){return n.length!==t.length?!1:n.every((e,i)=>e.path===t[i].path)}function xO(n,t){let e=[];return Object.entries(n.children).forEach(([i,r])=>{i===pe&&(e=e.concat(t(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==pe&&(e=e.concat(t(r,i)))}),e}var Eo=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>new Dr,providedIn:"root"})}return n})(),Dr=class{parse(t){let e=new M0(t);return new Mi(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${wl(t.root,!0)}`,i=MO(t.queryParams),r=typeof t.fragment=="string"?`#${IO(t.fragment)}`:"";return`${e}${i}${r}`}},DO=new Dr;function Kd(n){return n.segments.map(t=>G1(t)).join("/")}function wl(n,t){if(!n.hasChildren())return Kd(n);if(t){let e=n.children[pe]?wl(n.children[pe],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==pe&&i.push(`${r}:${wl(o,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}else{let e=xO(n,(i,r)=>r===pe?[wl(n.children[pe],!1)]:[`${r}:${wl(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[pe]!=null?`${Kd(n)}/${e[0]}`:`${Kd(n)}/(${e.join("//")})`}}function W1(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Gd(n){return W1(n).replace(/%3B/gi,";")}function IO(n){return encodeURI(n)}function T0(n){return W1(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Yd(n){return decodeURIComponent(n)}function O1(n){return Yd(n.replace(/\+/g,"%20"))}function G1(n){return`${T0(n.path)}${TO(n.parameters)}`}function TO(n){return Object.entries(n).map(([t,e])=>`;${T0(t)}=${T0(e)}`).join("")}function MO(n){let t=Object.entries(n).map(([e,i])=>Array.isArray(i)?i.map(r=>`${Gd(e)}=${Gd(r)}`).join("&"):`${Gd(e)}=${Gd(i)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var AO=/^[^\/()?;#]+/;function E0(n){let t=n.match(AO);return t?t[0]:""}var RO=/^[^\/()?;=#]+/;function OO(n){let t=n.match(RO);return t?t[0]:""}var PO=/^[^=?&#]+/;function NO(n){let t=n.match(PO);return t?t[0]:""}var kO=/^[^&#]+/;function FO(n){let t=n.match(kO);return t?t[0]:""}var M0=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new xe([],{}):new xe([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[pe]=new xe(t,e)),i}parseSegment(){let t=E0(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new z(4009,!1);return this.capture(t),new xr(Yd(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=OO(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let r=E0(this.remaining);r&&(i=r,this.capture(i))}t[Yd(e)]=Yd(i)}parseQueryParam(t){let e=NO(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let s=FO(this.remaining);s&&(i=s,this.capture(i))}let r=O1(e),o=O1(i);if(t.hasOwnProperty(r)){let s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=E0(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new z(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=pe);let s=this.parseChildren();e[o]=Object.keys(s).length===1&&s[pe]?s[pe]:new xe([],s),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new z(4011,!1)}};function q1(n){return n.segments.length>0?new xe([],{[pe]:n}):n}function J1(n){let t={};for(let[i,r]of Object.entries(n.children)){let o=J1(r);if(i===pe&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))t[s]=a;else(o.segments.length>0||o.hasChildren())&&(t[i]=o)}let e=new xe(n.segments,t);return LO(e)}function LO(n){if(n.numberOfChildren===1&&n.children[pe]){let t=n.children[pe];return new xe(n.segments.concat(t.segments),t.children)}return n}function Ir(n){return n instanceof Mi}function K1(n,t,e=null,i=null){let r=Y1(n);return Z1(r,t,e,i)}function Y1(n){let t;function e(o){let s={};for(let u of o.children){let f=e(u);s[u.outlet]=f}let a=new xe(o.url,s);return o===n&&(t=a),a}let i=e(n.root),r=q1(i);return t??r}function Z1(n,t,e,i){let r=n;for(;r.parent;)r=r.parent;if(t.length===0)return C0(r,r,r,e,i);let o=jO(t);if(o.toRoot())return C0(r,r,new xe([],{}),e,i);let s=VO(o,r,n),a=s.processChildren?Cl(s.segmentGroup,s.index,o.commands):X1(s.segmentGroup,s.index,o.commands);return C0(r,s.segmentGroup,a,e,i)}function Zd(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function xl(n){return typeof n=="object"&&n!=null&&n.outlets}function C0(n,t,e,i,r){let o={};i&&Object.entries(i).forEach(([u,f])=>{o[u]=Array.isArray(f)?f.map(h=>`${h}`):`${f}`});let s;n===t?s=e:s=Q1(n,t,e);let a=q1(J1(s));return new Mi(a,o,r)}function Q1(n,t,e){let i={};return Object.entries(n.children).forEach(([r,o])=>{o===t?i[r]=e:i[r]=Q1(o,t,e)}),new xe(n.segments,i)}var Qd=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&Zd(i[0]))throw new z(4003,!1);let r=i.find(xl);if(r&&r!==U1(i))throw new z(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function jO(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Qd(!0,0,n);let t=0,e=!1,i=n.reduce((r,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([u,f])=>{a[u]=typeof f=="string"?f.split("/"):f}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:s===0?(o.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?e=!0:a===".."?t++:a!=""&&r.push(a))}),r):[...r,o]},[]);return new Qd(e,t,i)}var Os=class{segmentGroup;processChildren;index;constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}};function VO(n,t,e){if(n.isAbsolute)return new Os(t,!0,0);if(!e)return new Os(t,!1,NaN);if(e.parent===null)return new Os(e,!0,0);let i=Zd(n.commands[0])?0:1,r=e.segments.length-1+i;return UO(e,r,n.numberOfDoubleDots)}function UO(n,t,e){let i=n,r=t,o=e;for(;o>r;){if(o-=r,i=i.parent,!i)throw new z(4005,!1);r=i.segments.length}return new Os(i,!1,r-o)}function zO(n){return xl(n[0])?n[0].outlets:{[pe]:n}}function X1(n,t,e){if(n??=new xe([],{}),n.segments.length===0&&n.hasChildren())return Cl(n,t,e);let i=BO(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let o=new xe(n.segments.slice(0,i.pathIndex),{});return o.children[pe]=new xe(n.segments.slice(i.pathIndex),n.children),Cl(o,0,r)}else return i.match&&r.length===0?new xe(n.segments,{}):i.match&&!n.hasChildren()?A0(n,t,e):i.match?Cl(n,0,r):A0(n,t,e)}function Cl(n,t,e){if(e.length===0)return new xe(n.segments,{});{let i=zO(e),r={};if(Object.keys(i).some(o=>o!==pe)&&n.children[pe]&&n.numberOfChildren===1&&n.children[pe].segments.length===0){let o=Cl(n.children[pe],t,e);return new xe(n.segments,o.children)}return Object.entries(i).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(r[o]=X1(n.children[o],t,s))}),Object.entries(n.children).forEach(([o,s])=>{i[o]===void 0&&(r[o]=s)}),new xe(n.segments,r)}}function BO(n,t,e){let i=0,r=t,o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return o;let s=n.segments[r],a=e[i];if(xl(a))break;let u=`${a}`,f=i<e.length-1?e[i+1]:null;if(r>0&&u===void 0)break;if(u&&f&&typeof f=="object"&&f.outlets===void 0){if(!N1(u,f,s))return o;i+=2}else{if(!N1(u,{},s))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function A0(n,t,e){let i=n.segments.slice(0,t),r=0;for(;r<e.length;){let o=e[r];if(xl(o)){let u=$O(o.outlets);return new xe(i,u)}if(r===0&&Zd(e[0])){let u=n.segments[t];i.push(new xr(u.path,P1(e[0]))),r++;continue}let s=xl(o)?o.outlets[pe]:`${o}`,a=r<e.length-1?e[r+1]:null;s&&a&&Zd(a)?(i.push(new xr(s,P1(a))),r+=2):(i.push(new xr(s,{})),r++)}return new xe(i,{})}function $O(n){let t={};return Object.entries(n).forEach(([e,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(t[e]=A0(new xe([],{}),0,i))}),t}function P1(n){let t={};return Object.entries(n).forEach(([e,i])=>t[e]=`${i}`),t}function N1(n,t,e){return n==e.path&&Ii(t,e.parameters)}var Ps="imperative",wt=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})(wt||{}),Tn=class{id;url;constructor(t,e){this.id=t,this.url=e}},Tr=class extends Tn{type=wt.NavigationStart;navigationTrigger;restoredState;constructor(t,e,i="imperative",r=null){super(t,e),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},rn=class extends Tn{urlAfterRedirects;type=wt.NavigationEnd;constructor(t,e,i){super(t,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},nn=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(nn||{}),ks=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(ks||{}),Ti=class extends Tn{reason;code;type=wt.NavigationCancel;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ai=class extends Tn{reason;code;type=wt.NavigationSkipped;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}},Fs=class extends Tn{error;target;type=wt.NavigationError;constructor(t,e,i,r){super(t,e),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Dl=class extends Tn{urlAfterRedirects;state;type=wt.RoutesRecognized;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Xd=class extends Tn{urlAfterRedirects;state;type=wt.GuardsCheckStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ef=class extends Tn{urlAfterRedirects;state;shouldActivate;type=wt.GuardsCheckEnd;constructor(t,e,i,r,o){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},tf=class extends Tn{urlAfterRedirects;state;type=wt.ResolveStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nf=class extends Tn{urlAfterRedirects;state;type=wt.ResolveEnd;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rf=class{route;type=wt.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},of=class{route;type=wt.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},sf=class{snapshot;type=wt.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},af=class{snapshot;type=wt.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lf=class{snapshot;type=wt.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cf=class{snapshot;type=wt.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ls=class{routerEvent;position;anchor;type=wt.Scroll;constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},Il=class{},js=class{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}};function HO(n){return!(n instanceof Il)&&!(n instanceof js)}function WO(n,t){return n.providers&&!n._injector&&(n._injector=Ss(n.providers,t,`Route: ${n.path}`)),n._injector??t}function ci(n){return n.outlet||pe}function GO(n,t){let e=n.filter(i=>ci(i)===t);return e.push(...n.filter(i=>ci(i)!==t)),e}function zs(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){let e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var uf=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return zs(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new Co(this.rootInjector)}},Co=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,i){let r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){let i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new uf(this.rootInjector),this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(i){return new(i||n)(U(lt))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),df=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=R0(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){let e=R0(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=O0(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return O0(t,this._root).map(e=>e.value)}};function R0(n,t){if(n===t.value)return t;for(let e of t.children){let i=R0(n,e);if(i)return i}return null}function O0(n,t){if(n===t.value)return[t];for(let e of t.children){let i=O0(n,e);if(i.length)return i.unshift(t),i}return[]}var In=class{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function Rs(n){let t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}var Tl=class extends df{snapshot;constructor(t,e){super(t),this.snapshot=e,U0(this,t)}toString(){return this.snapshot.toString()}};function eC(n){let t=qO(n),e=new Ge([new xr("",{})]),i=new Ge({}),r=new Ge({}),o=new Ge({}),s=new Ge(""),a=new Wt(e,i,o,s,r,pe,n,t.root);return a.snapshot=t.root,new Tl(new In(a,[]),t)}function qO(n){let t={},e={},i={},o=new bo([],t,i,"",e,pe,n,null,{});return new Ml("",new In(o,[]))}var Wt=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,i,r,o,s,a,u){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(fe(f=>f[Pl]))??K(void 0),this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(fe(t=>wo(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(fe(t=>wo(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ff(n,t,e="emptyOnly"){let i,{routeConfig:r}=n;return t!==null&&(e==="always"||r?.path===""||!t.component&&!t.routeConfig?.loadComponent)?i={params:P(P({},t.params),n.params),data:P(P({},t.data),n.data),resolve:P(P(P(P({},n.data),t.data),r?.data),n._resolvedData)}:i={params:P({},n.params),data:P({},n.data),resolve:P(P({},n.data),n._resolvedData??{})},r&&nC(r)&&(i.resolve[Pl]=r.title),i}var bo=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Pl]}constructor(t,e,i,r,o,s,a,u,f){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._resolve=f}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=wo(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=wo(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(i=>i.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},Ml=class extends df{url;constructor(t,e){super(e),this.url=t,U0(this,e)}toString(){return tC(this._root)}};function U0(n,t){t.value._routerState=n,t.children.forEach(e=>U0(n,e))}function tC(n){let t=n.children.length>0?` { ${n.children.map(tC).join(", ")} } `:"";return`${n.value}${t}`}function S0(n){if(n.snapshot){let t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Ii(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),Ii(t.params,e.params)||n.paramsSubject.next(e.params),bO(t.url,e.url)||n.urlSubject.next(e.url),Ii(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function P0(n,t){let e=Ii(n.params,t.params)&&SO(n.url,t.url),i=!n.parent!=!t.parent;return e&&!i&&(!n.parent||P0(n.parent,t.parent))}function nC(n){return typeof n.title=="string"||n.title===null}var iC=new Y(""),Nl=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=pe;activateEvents=new ke;deactivateEvents=new ke;attachEvents=new ke;detachEvents=new ke;routerOutletData=RE(void 0);parentContexts=N(Co);location=N(Yi);changeDetector=N(Xi);inputBinder=N(kl,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new z(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new z(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new z(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new z(4013,!1);this._activatedRoute=e;let r=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,u=new N0(e,a,r.injector,this.routerOutletData);this.activated=r.createComponent(s,{index:r.length,injector:u,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ee({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Sn]})}return n})(),N0=class{route;childContexts;parent;outletData;constructor(t,e,i,r){this.route=t,this.childContexts=e,this.parent=i,this.outletData=r}get(t,e){return t===Wt?this.route:t===Co?this.childContexts:t===iC?this.outletData:this.parent.get(t,e)}},kl=new Y(""),z0=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:i}=e,r=va([i.queryParams,i.params,i.data]).pipe(qe(([o,s,a],u)=>(a=P(P(P({},o),s),a),u===0?K(a):Promise.resolve(a)))).subscribe(o=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(e);return}let s=PE(i.component);if(!s){this.unsubscribeFromRouteData(e);return}for(let{templateName:a}of s.inputs)e.activatedComponentRef.setInput(a,o[a])});this.outletDataSubscriptions.set(e,r)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})(),B0=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=ve({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){i&1&&O(0,"router-outlet")},dependencies:[Nl],encapsulation:2})}return n})();function $0(n){let t=n.children&&n.children.map($0),e=t?J(P({},n),{children:t}):P({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==pe&&(e.component=B0),e}function JO(n,t,e){let i=Al(n,t._root,e?e._root:void 0);return new Tl(i,t)}function Al(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){let i=e.value;i._futureSnapshot=t.value;let r=KO(n,t,e);return new In(i,r)}else{if(n.shouldAttach(t.value)){let o=n.retrieve(t.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>Al(n,a)),s}}let i=YO(t.value),r=t.children.map(o=>Al(n,o));return new In(i,r)}}function KO(n,t,e){return t.children.map(i=>{for(let r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Al(n,i,r);return Al(n,i)})}function YO(n){return new Wt(new Ge(n.url),new Ge(n.params),new Ge(n.queryParams),new Ge(n.fragment),new Ge(n.data),n.outlet,n.component,n)}var Vs=class{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}},rC="ngNavigationCancelingError";function pf(n,t){let{redirectTo:e,navigationBehaviorOptions:i}=Ir(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=oC(!1,nn.Redirect);return r.url=e,r.navigationBehaviorOptions=i,r}function oC(n,t){let e=new Error(`NavigationCancelingError: ${n||""}`);return e[rC]=!0,e.cancellationCode=t,e}function ZO(n){return sC(n)&&Ir(n.url)}function sC(n){return!!n&&n[rC]}var QO=(n,t,e,i)=>fe(r=>(new k0(t,r.targetRouterState,r.currentRouterState,e,i).activate(n),r)),k0=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,i,r,o){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(t){let e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),S0(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){let r=Rs(e);t.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,r[s],i),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(r===o)if(r.component){let s=i.getContext(r.outlet);s&&this.deactivateChildRoutes(t,e,s.children)}else this.deactivateChildRoutes(t,e,i);else o&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Rs(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(i&&i.outlet){let s=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Rs(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,e,i){let r=Rs(e);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new cf(o.value.snapshot))}),t.children.length&&this.forwardEvent(new af(t.value.snapshot))}activateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(S0(r),r===o)if(r.component){let s=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,s.children)}else this.activateChildRoutes(t,e,i);else if(r.component){let s=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),S0(a.route.value),this.activateChildRoutes(t,null,s.children)}else s.attachRef=null,s.route=r,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(t,null,s.children)}else this.activateChildRoutes(t,null,i)}},hf=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Ns=class{component;route;constructor(t,e){this.component=t,this.route=e}};function XO(n,t,e){let i=n._root,r=t?t._root:null;return El(i,r,e,[i.value])}function e2(n){let t=n.routeConfig?n.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:n,guards:t}}function Bs(n,t){let e=Symbol(),i=t.get(n,e);return i===e?typeof n=="function"&&!bh(n)?n:t.get(n):i}function El(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=Rs(t);return n.children.forEach(s=>{t2(s,o[s.value.outlet],e,i.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>Sl(a,e.getContext(s),r)),r}function t2(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,s=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let u=n2(s,o,o.routeConfig.runGuardsAndResolvers);u?r.canActivateChecks.push(new hf(i)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?El(n,t,a?a.children:null,i,r):El(n,t,e,i,r),u&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new Ns(a.outlet.component,s))}else s&&Sl(t,a,r),r.canActivateChecks.push(new hf(i)),o.component?El(n,null,a?a.children:null,i,r):El(n,null,e,i,r);return r}function n2(n,t,e){if(typeof e=="function")return e(n,t);switch(e){case"pathParamsChange":return!yo(n.url,t.url);case"pathParamsOrQueryParamsChange":return!yo(n.url,t.url)||!Ii(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!P0(n,t)||!Ii(n.queryParams,t.queryParams);case"paramsChange":default:return!P0(n,t)}}function Sl(n,t,e){let i=Rs(n),r=n.value;Object.entries(i).forEach(([o,s])=>{r.component?t?Sl(s,t.children.getContext(o),e):Sl(s,null,e):Sl(s,t,e)}),r.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new Ns(t.outlet.component,r)):e.canDeactivateChecks.push(new Ns(null,r)):e.canDeactivateChecks.push(new Ns(null,r))}function Fl(n){return typeof n=="function"}function i2(n){return typeof n=="boolean"}function r2(n){return n&&Fl(n.canLoad)}function o2(n){return n&&Fl(n.canActivate)}function s2(n){return n&&Fl(n.canActivateChild)}function a2(n){return n&&Fl(n.canDeactivate)}function l2(n){return n&&Fl(n.canMatch)}function aC(n){return n instanceof yn||n?.name==="EmptyError"}var qd=Symbol("INITIAL_VALUE");function Us(){return qe(n=>va(n.map(t=>t.pipe(St(1),ah(qd)))).pipe(fe(t=>{for(let e of t)if(e!==!0){if(e===qd)return qd;if(e===!1||c2(e))return e}return!0}),at(t=>t!==qd),St(1)))}function c2(n){return Ir(n)||n instanceof Vs}function u2(n,t){return st(e=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=e;return s.length===0&&o.length===0?K(J(P({},e),{guardsResult:!0})):d2(s,i,r,n).pipe(st(a=>a&&i2(a)?f2(i,o,n,t):K(a)),fe(a=>J(P({},e),{guardsResult:a})))})}function d2(n,t,e,i){return B(n).pipe(st(r=>v2(r.component,r.route,e,t,i)),Vi(r=>r!==!0,!0))}function f2(n,t,e,i){return B(t).pipe(hi(r=>rs(h2(r.route.parent,i),p2(r.route,i),g2(n,r.path,e),m2(n,r.route,e))),Vi(r=>r!==!0,!0))}function p2(n,t){return n!==null&&t&&t(new lf(n)),K(!0)}function h2(n,t){return n!==null&&t&&t(new sf(n)),K(!0)}function m2(n,t,e){let i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||i.length===0)return K(!0);let r=i.map(o=>_a(()=>{let s=zs(t)??e,a=Bs(o,s),u=o2(a)?a.canActivate(t,n):Dt(s,()=>a(t,n));return nr(u).pipe(Vi())}));return K(r).pipe(Us())}function g2(n,t,e){let i=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>e2(s)).filter(s=>s!==null).map(s=>_a(()=>{let a=s.guards.map(u=>{let f=zs(s.node)??e,h=Bs(u,f),m=s2(h)?h.canActivateChild(i,n):Dt(f,()=>h(i,n));return nr(m).pipe(Vi())});return K(a).pipe(Us())}));return K(o).pipe(Us())}function v2(n,t,e,i,r){let o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!o||o.length===0)return K(!0);let s=o.map(a=>{let u=zs(t)??r,f=Bs(a,u),h=a2(f)?f.canDeactivate(n,t,e,i):Dt(u,()=>f(n,t,e,i));return nr(h).pipe(Vi())});return K(s).pipe(Us())}function _2(n,t,e,i){let r=t.canLoad;if(r===void 0||r.length===0)return K(!0);let o=r.map(s=>{let a=Bs(s,n),u=r2(a)?a.canLoad(t,e):Dt(n,()=>a(t,e));return nr(u)});return K(o).pipe(Us(),lC(i))}function lC(n){return qp(xt(t=>{if(typeof t!="boolean")throw pf(n,t)}),fe(t=>t===!0))}function y2(n,t,e,i){let r=t.canMatch;if(!r||r.length===0)return K(!0);let o=r.map(s=>{let a=Bs(s,n),u=l2(a)?a.canMatch(t,e):Dt(n,()=>a(t,e));return nr(u)});return K(o).pipe(Us(),lC(i))}var Rl=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},Ol=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function As(n){return is(new Rl(n))}function b2(n){return is(new z(4e3,!1))}function w2(n){return is(oC(!1,nn.GuardRejected))}var F0=class{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return K(i);if(r.numberOfChildren>1||!r.children[pe])return b2(`${t.redirectTo}`);r=r.children[pe]}}applyRedirectCommands(t,e,i,r,o){return E2(e,r,o).pipe(fe(s=>{if(s instanceof Mi)throw new Ol(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),t,i);if(s[0]==="/")throw new Ol(a);return a}))}applyRedirectCreateUrlTree(t,e,i,r){let o=this.createSegmentGroup(t,e.root,i,r);return new Mi(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let i={};return Object.entries(t).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);i[r]=e[a]}else i[r]=o}),i}createSegmentGroup(t,e,i,r){let o=this.createSegments(t,e.segments,i,r),s={};return Object.entries(e.children).forEach(([a,u])=>{s[a]=this.createSegmentGroup(t,u,i,r)}),new xe(o,s)}createSegments(t,e,i,r){return e.map(o=>o.path[0]===":"?this.findPosParam(t,o,r):this.findOrReturn(o,i))}findPosParam(t,e,i){let r=i[e.path.substring(1)];if(!r)throw new z(4001,!1);return r}findOrReturn(t,e){let i=0;for(let r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}};function E2(n,t,e){if(typeof n=="string")return K(n);let i=n,{queryParams:r,fragment:o,routeConfig:s,url:a,outlet:u,params:f,data:h,title:m}=t;return nr(Dt(e,()=>i({params:f,data:h,queryParams:r,fragment:o,routeConfig:s,url:a,outlet:u,title:m})))}var L0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function C2(n,t,e,i,r){let o=cC(n,t,e);return o.matched?(i=WO(t,i),y2(i,t,e,r).pipe(fe(s=>s===!0?o:P({},L0)))):K(o)}function cC(n,t,e){if(t.path==="**")return S2(e);if(t.path==="")return t.pathMatch==="full"&&(n.hasChildren()||e.length>0)?P({},L0):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let r=(t.matcher||j1)(e,n,t);if(!r)return P({},L0);let o={};Object.entries(r.posParams??{}).forEach(([a,u])=>{o[a]=u.path});let s=r.consumed.length>0?P(P({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function S2(n){return{matched:!0,parameters:n.length>0?U1(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function k1(n,t,e,i){return e.length>0&&I2(n,e,i)?{segmentGroup:new xe(t,D2(i,new xe(e,n.children))),slicedSegments:[]}:e.length===0&&T2(n,e,i)?{segmentGroup:new xe(n.segments,x2(n,e,i,n.children)),slicedSegments:e}:{segmentGroup:new xe(n.segments,n.children),slicedSegments:e}}function x2(n,t,e,i){let r={};for(let o of e)if(gf(n,t,o)&&!i[ci(o)]){let s=new xe([],{});r[ci(o)]=s}return P(P({},i),r)}function D2(n,t){let e={};e[pe]=t;for(let i of n)if(i.path===""&&ci(i)!==pe){let r=new xe([],{});e[ci(i)]=r}return e}function I2(n,t,e){return e.some(i=>gf(n,t,i)&&ci(i)!==pe)}function T2(n,t,e){return e.some(i=>gf(n,t,i))}function gf(n,t,e){return(n.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function M2(n,t,e){return t.length===0&&!n.children[e]}var j0=class{};function A2(n,t,e,i,r,o,s="emptyOnly"){return new V0(n,t,e,i,r,s,o).recognize()}var R2=31,V0=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,i,r,o,s,a){this.injector=t,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new F0(this.urlSerializer,this.urlTree)}noMatchError(t){return new z(4002,`'${t.segmentGroup}'`)}recognize(){let t=k1(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(fe(({children:e,rootSnapshot:i})=>{let r=new In(i,e),o=new Ml("",r),s=K1(i,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(t){let e=new bo([],Object.freeze({}),Object.freeze(P({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),pe,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,pe,e).pipe(fe(i=>({children:i,rootSnapshot:e})),ji(i=>{if(i instanceof Ol)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof Rl?this.noMatchError(i):i}))}processSegmentGroup(t,e,i,r,o){return i.segments.length===0&&i.hasChildren()?this.processChildren(t,e,i,o):this.processSegment(t,e,i,i.segments,r,!0,o).pipe(fe(s=>s instanceof In?[s]:[]))}processChildren(t,e,i,r){let o=[];for(let s of Object.keys(i.children))s==="primary"?o.unshift(s):o.push(s);return B(o).pipe(hi(s=>{let a=i.children[s],u=GO(e,s);return this.processSegmentGroup(t,u,a,s,r)}),sh((s,a)=>(s.push(...a),s)),dr(null),oh(),st(s=>{if(s===null)return As(i);let a=uC(s);return O2(a),K(a)}))}processSegment(t,e,i,r,o,s,a){return B(e).pipe(hi(u=>this.processSegmentAgainstRoute(u._injector??t,e,u,i,r,o,s,a).pipe(ji(f=>{if(f instanceof Rl)return K(null);throw f}))),Vi(u=>!!u),ji(u=>{if(aC(u))return M2(i,r,o)?K(new j0):As(i);throw u}))}processSegmentAgainstRoute(t,e,i,r,o,s,a,u){return ci(i)!==s&&(s===pe||!gf(r,o,i))?As(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(t,r,i,o,s,u):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,r,e,i,o,s,u):As(r)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,o,s,a){let{matched:u,parameters:f,consumedSegments:h,positionalParamSegments:m,remainingSegments:b}=cC(e,r,o);if(!u)return As(e);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>R2&&(this.allowRedirects=!1));let _=new bo(o,f,Object.freeze(P({},this.urlTree.queryParams)),this.urlTree.fragment,F1(r),ci(r),r.component??r._loadedComponent??null,r,L1(r)),w=ff(_,a,this.paramsInheritanceStrategy);return _.params=Object.freeze(w.params),_.data=Object.freeze(w.data),this.applyRedirects.applyRedirectCommands(h,r.redirectTo,m,_,t).pipe(qe(I=>this.applyRedirects.lineralizeSegments(r,I)),st(I=>this.processSegment(t,i,e,I.concat(b),s,!1,a)))}matchSegmentAgainstRoute(t,e,i,r,o,s){let a=C2(e,i,r,t,this.urlSerializer);return i.path==="**"&&(e.children={}),a.pipe(qe(u=>u.matched?(t=i._injector??t,this.getChildConfig(t,i,r).pipe(qe(({routes:f})=>{let h=i._loadedInjector??t,{parameters:m,consumedSegments:b,remainingSegments:_}=u,w=new bo(b,m,Object.freeze(P({},this.urlTree.queryParams)),this.urlTree.fragment,F1(i),ci(i),i.component??i._loadedComponent??null,i,L1(i)),M=ff(w,s,this.paramsInheritanceStrategy);w.params=Object.freeze(M.params),w.data=Object.freeze(M.data);let{segmentGroup:I,slicedSegments:A}=k1(e,b,_,f);if(A.length===0&&I.hasChildren())return this.processChildren(h,f,I,w).pipe(fe($=>new In(w,$)));if(f.length===0&&A.length===0)return K(new In(w,[]));let L=ci(i)===o;return this.processSegment(h,f,I,A,L?pe:o,!0,w).pipe(fe($=>new In(w,$ instanceof In?[$]:[])))}))):As(e)))}getChildConfig(t,e,i){return e.children?K({routes:e.children,injector:t}):e.loadChildren?e._loadedRoutes!==void 0?K({routes:e._loadedRoutes,injector:e._loadedInjector}):_2(t,e,i,this.urlSerializer).pipe(st(r=>r?this.configLoader.loadChildren(t,e).pipe(xt(o=>{e._loadedRoutes=o.routes,e._loadedInjector=o.injector})):w2(e))):K({routes:[],injector:t})}};function O2(n){n.sort((t,e)=>t.value.outlet===pe?-1:e.value.outlet===pe?1:t.value.outlet.localeCompare(e.value.outlet))}function P2(n){let t=n.value.routeConfig;return t&&t.path===""}function uC(n){let t=[],e=new Set;for(let i of n){if(!P2(i)){t.push(i);continue}let r=t.find(o=>i.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...i.children),e.add(r)):t.push(i)}for(let i of e){let r=uC(i.children);t.push(new In(i.value,r))}return t.filter(i=>!e.has(i))}function F1(n){return n.data||{}}function L1(n){return n.resolve||{}}function N2(n,t,e,i,r,o){return st(s=>A2(n,t,e,i,s.extractedUrl,r,o).pipe(fe(({state:a,tree:u})=>J(P({},s),{targetSnapshot:a,urlAfterRedirects:u}))))}function k2(n,t){return st(e=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return K(e);let o=new Set(r.map(u=>u.route)),s=new Set;for(let u of o)if(!s.has(u))for(let f of dC(u))s.add(f);let a=0;return B(s).pipe(hi(u=>o.has(u)?F2(u,i,n,t):(u.data=ff(u,u.parent,n).resolve,K(void 0))),xt(()=>a++),os(1),st(u=>a===s.size?K(e):jt))})}function dC(n){let t=n.children.map(e=>dC(e)).flat();return[n,...t]}function F2(n,t,e,i){let r=n.routeConfig,o=n._resolve;return r?.title!==void 0&&!nC(r)&&(o[Pl]=r.title),_a(()=>(n.data=ff(n,n.parent,e).resolve,L2(o,n,t,i).pipe(fe(s=>(n._resolvedData=s,n.data=P(P({},n.data),s),null)))))}function L2(n,t,e,i){let r=I0(n);if(r.length===0)return K({});let o={};return B(r).pipe(st(s=>j2(n[s],t,e,i).pipe(Vi(),xt(a=>{if(a instanceof Vs)throw pf(new Dr,a);o[s]=a}))),os(1),fe(()=>o),ji(s=>aC(s)?jt:is(s)))}function j2(n,t,e,i){let r=zs(t)??i,o=Bs(n,r),s=o.resolve?o.resolve(t,e):Dt(r,()=>o(t,e));return nr(s)}function x0(n){return qe(t=>{let e=n(t);return e?B(e).pipe(fe(()=>t)):K(t)})}var H0=(()=>{class n{buildTitle(e){let i,r=e.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===pe);return i}getResolvedTitleForRoute(e){return e.data[Pl]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N(fC),providedIn:"root"})}return n})(),fC=(()=>{class n extends H0{title;constructor(e){super(),this.title=e}updateTitle(e){let i=this.buildTitle(e);i!==void 0&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(U(A1))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Mr=new Y("",{providedIn:"root",factory:()=>({})}),So=new Y(""),vf=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=N(Vg);loadComponent(e,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return K(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=nr(Dt(e,()=>i.loadComponent())).pipe(fe(hC),qe(mC),xt(s=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=s}),Wr(()=>{this.componentLoaders.delete(i)})),o=new ts(r,()=>new We).pipe(es());return this.componentLoaders.set(i,o),o}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return K({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=pC(i,this.compiler,e,this.onLoadEndListener).pipe(Wr(()=>{this.childrenLoaders.delete(i)})),s=new ts(o,()=>new We).pipe(es());return this.childrenLoaders.set(i,s),s}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function pC(n,t,e,i){return nr(Dt(e,()=>n.loadChildren())).pipe(fe(hC),qe(mC),st(r=>r instanceof gd||Array.isArray(r)?K(r):B(t.compileModuleAsync(r))),fe(r=>{i&&i(n);let o,s,a=!1;return Array.isArray(r)?(s=r,a=!0):(o=r.create(e).injector,s=o.get(So,[],{optional:!0,self:!0}).flat()),{routes:s.map($0),injector:o}}))}function V2(n){return n&&typeof n=="object"&&"default"in n}function hC(n){return V2(n)?n.default:n}function mC(n){return K(n)}var _f=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N(U2),providedIn:"root"})}return n})(),U2=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),W0=new Y(""),G0=new Y("");function gC(n,t,e){let i=n.get(G0),r=n.get(Ye);if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(f=>setTimeout(f));let o,s=new Promise(f=>{o=f}),a=r.startViewTransition(()=>(o(),z2(n)));a.ready.catch(f=>{});let{onViewTransitionCreated:u}=i;return u&&Dt(n,()=>u({transition:a,from:t,to:e})),s}function z2(n){return new Promise(t=>{Ka({read:()=>setTimeout(t)},{injector:n})})}var q0=new Y(""),yf=(()=>{class n{currentNavigation=Ze(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new We;transitionAbortWithErrorSubject=new We;configLoader=N(vf);environmentInjector=N(lt);destroyRef=N(ti);urlSerializer=N(Eo);rootContexts=N(Co);location=N(Sr);inputBindingEnabled=N(kl,{optional:!0})!==null;titleStrategy=N(H0);options=N(Mr,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=N(_f);createViewTransition=N(W0,{optional:!0});navigationErrorHandler=N(q0,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>K(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=r=>this.events.next(new rf(r)),i=r=>this.events.next(new of(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let i=++this.navigationId;bt(()=>{this.transitions?.next(J(P({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i}))})}setupNavigations(e){return this.transitions=new Ge(null),this.transitions.pipe(at(i=>i!==null),qe(i=>{let r=!1;return K(i).pipe(qe(o=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",nn.SupersededByNewNavigation),jt;this.currentTransition=i,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?J(P({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let s=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=o.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!s&&a!=="reload")return this.events.next(new Ai(o.id,this.urlSerializer.serialize(o.rawUrl),"",ks.IgnoredSameUrlNavigation)),o.resolve(!1),jt;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return K(o).pipe(qe(u=>(this.events.next(new Tr(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),u.id!==this.navigationId?jt:Promise.resolve(u))),N2(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),xt(u=>{i.targetSnapshot=u.targetSnapshot,i.urlAfterRedirects=u.urlAfterRedirects,this.currentNavigation.update(h=>(h.finalUrl=u.urlAfterRedirects,h));let f=new Dl(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(f)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:u,extractedUrl:f,source:h,restoredState:m,extras:b}=o,_=new Tr(u,this.urlSerializer.serialize(f),h,m);this.events.next(_);let w=eC(this.rootComponentType).snapshot;return this.currentTransition=i=J(P({},o),{targetSnapshot:w,urlAfterRedirects:f,extras:J(P({},b),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(M=>(M.finalUrl=f,M)),K(i)}else return this.events.next(new Ai(o.id,this.urlSerializer.serialize(o.extractedUrl),"",ks.IgnoredByUrlHandlingStrategy)),o.resolve(!1),jt}),xt(o=>{let s=new Xd(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(s)}),fe(o=>(this.currentTransition=i=J(P({},o),{guards:XO(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),i)),u2(this.environmentInjector,o=>this.events.next(o)),xt(o=>{if(i.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw pf(this.urlSerializer,o.guardsResult);let s=new ef(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(s)}),at(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",nn.GuardRejected),!1)),x0(o=>{if(o.guards.canActivateChecks.length!==0)return K(o).pipe(xt(s=>{let a=new tf(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),qe(s=>{let a=!1;return K(s).pipe(k2(this.paramsInheritanceStrategy,this.environmentInjector),xt({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",nn.NoDataFromResolver)}}))}),xt(s=>{let a=new nf(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),x0(o=>{let s=a=>{let u=[];if(a.routeConfig?.loadComponent){let f=zs(a)??this.environmentInjector;u.push(this.configLoader.loadComponent(f,a.routeConfig).pipe(xt(h=>{a.component=h}),fe(()=>{})))}for(let f of a.children)u.push(...s(f));return u};return va(s(o.targetSnapshot.root)).pipe(dr(null),St(1))}),x0(()=>this.afterPreactivation()),qe(()=>{let{currentSnapshot:o,targetSnapshot:s}=i,a=this.createViewTransition?.(this.environmentInjector,o.root,s.root);return a?B(a).pipe(fe(()=>i)):K(i)}),fe(o=>{let s=JO(e.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=i=J(P({},o),{targetRouterState:s}),this.currentNavigation.update(a=>(a.targetRouterState=s,a)),i}),xt(()=>{this.events.next(new Il)}),QO(this.rootContexts,e.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),St(1),Kn(new we(o=>{let s=i.abortController.signal,a=()=>o.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(at(()=>!r&&!i.targetRouterState),xt(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",nn.Aborted)}))),xt({next:o=>{r=!0,this.lastSuccessfulNavigation=bt(this.currentNavigation),this.events.next(new rn(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),Kn(this.transitionAbortWithErrorSubject.pipe(xt(o=>{throw o}))),Wr(()=>{r||this.cancelNavigationTransition(i,"",nn.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),ji(o=>{if(this.destroyed)return i.resolve(!1),jt;if(r=!0,sC(o))this.events.next(new Ti(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode)),ZO(o)?this.events.next(new js(o.url,o.navigationBehaviorOptions)):i.resolve(!1);else{let s=new Fs(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);try{let a=Dt(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof Vs){let{message:u,cancellationCode:f}=pf(this.urlSerializer,a);this.events.next(new Ti(i.id,this.urlSerializer.serialize(i.extractedUrl),u,f)),this.events.next(new js(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),o}catch(a){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(a)}}return jt}))}))}cancelNavigationTransition(e,i,r){let o=new Ti(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(o),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=bt(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return e.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function B2(n){return n!==Ps}var vC=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N($2),providedIn:"root"})}return n})(),mf=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}},$2=(()=>{class n extends mf{static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),_C=(()=>{class n{urlSerializer=N(Eo);options=N(Mr,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=N(Sr);urlHandlingStrategy=N(_f);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Mi;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:i,targetBrowserUrl:r}){let o=e!==void 0?this.urlHandlingStrategy.merge(e,i):i,s=r??o;return s instanceof Mi?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:e,finalUrl:i,initialUrl:r}){i&&e?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=e):this.rawUrlTree=r}routerState=eC(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:()=>N(H2),providedIn:"root"})}return n})(),H2=(()=>{class n extends _C{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{i.type==="popstate"&&setTimeout(()=>{e(i.url,i.state,"popstate")})})}handleRouterEvent(e,i){e instanceof Tr?this.updateStateMemento():e instanceof Ai?this.commitTransition(i):e instanceof Dl?this.urlUpdateStrategy==="eager"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof Il?(this.commitTransition(i),this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof Ti&&e.code!==nn.SupersededByNewNavigation&&e.code!==nn.Redirect?this.restoreHistory(i):e instanceof Fs?this.restoreHistory(i,!0):e instanceof rn&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:i,id:r}){let{replaceUrl:o,state:s}=i;if(this.location.isCurrentPathEqualTo(e)||o){let a=this.browserPageId,u=P(P({},s),this.generateNgRouterState(r,a));this.location.replaceState(e,"",u)}else{let a=P(P({},s),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(e,"",a)}}restoreHistory(e,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===e.finalUrl&&o===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bf(n,t){n.events.pipe(at(e=>e instanceof rn||e instanceof Ti||e instanceof Fs||e instanceof Ai),fe(e=>e instanceof rn||e instanceof Ai?0:(e instanceof Ti?e.code===nn.Redirect||e.code===nn.SupersededByNewNavigation:!1)?2:1),at(e=>e!==2),St(1)).subscribe(()=>{t()})}var W2={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},G2={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},De=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=N(Ig);stateManager=N(_C);options=N(Mr,{optional:!0})||{};pendingTasks=N(wi);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=N(yf);urlSerializer=N(Eo);location=N(Sr);urlHandlingStrategy=N(_f);injector=N(lt);_events=new We;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=N(vC);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=N(So,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!N(kl,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Xe;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,o=bt(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Ti&&i.code!==nn.Redirect&&i.code!==nn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof rn)this.navigated=!0;else if(i instanceof js){let s=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),u=P({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||B2(r.source)},s);this.scheduleNavigation(a,Ps,null,u,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}HO(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ps,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i,r)=>{this.navigateToSyncWithBrowser(e,r,i)})}navigateToSyncWithBrowser(e,i,r){let o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){let u=P({},r);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(o.state=u)}let a=this.parseUrl(e);this.scheduleNavigation(a,i,s,o).catch(u=>{this.disposed||this.injector.get(Xt)(u)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return bt(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map($0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){let{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:u}=i,f=u?this.currentUrlTree.fragment:s,h=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":h=P(P({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let m;try{let b=r?r.snapshot:this.routerState.snapshot.root;m=Y1(b)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),m=this.currentUrlTree.root}return Z1(m,e,h,f??null)}navigateByUrl(e,i={skipLocationChange:!1}){let r=Ir(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Ps,null,i)}navigate(e,i={skipLocationChange:!1}){return q2(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.console.warn($i(4018,!1)),this.urlSerializer.parse("/")}}isActive(e,i){let r;if(i===!0?r=P({},W2):i===!1?r=P({},G2):r=i,Ir(e))return R1(this.currentUrlTree,e,r);let o=this.parseUrl(e);return R1(this.currentUrlTree,o,r)}removeEmptyProps(e){return Object.entries(e).reduce((i,[r,o])=>(o!=null&&(i[r]=o),i),{})}scheduleNavigation(e,i,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,u,f;s?(a=s.resolve,u=s.reject,f=s.promise):f=new Promise((m,b)=>{a=m,u=b});let h=this.pendingTasks.add();return bf(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:o,resolve:a,reject:u,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(m=>Promise.reject(m))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function q2(n){for(let t=0;t<n.length;t++)if(n[t]==null)throw new z(4008,!1)}var Gt=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Ze(null);get href(){return bt(this.reactiveHref)}set href(e){this.reactiveHref.set(e)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new We;applicationErrorHandler=N(Xt);options=N(Mr,{optional:!0});constructor(e,i,r,o,s,a){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=s,this.locationStrategy=a,this.reactiveHref.set(N(new bd("href"),{optional:!0}));let u=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=u==="a"||u==="area"||!!(typeof customElements=="object"&&customElements.get(u)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let e=this.preserveFragment,i=r=>r==="merge"||r==="preserve";e||=i(this.queryParamsHandling),e||=!this.queryParamsHandling&&!i(this.options?.defaultQueryParamsHandling),e&&(this.subscription=this.router.events.subscribe(r=>{r instanceof rn&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Ir(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,i,r,o,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||i||r||o||s||typeof this.target=="string"&&this.target!="_self"))return!0;let u={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,u)?.catch(f=>{this.applicationErrorHandler(f)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.reactiveHref.set(e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e))??"":null)}applyAttributeValue(e,i){let r=this.renderer,o=this.el.nativeElement;i!==null?r.setAttribute(o,e,i):r.removeAttribute(o,e)}get urlTree(){return this.routerLinkInput===null?null:Ir(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(D(De),D(Wt),qa("tabindex"),D(dn),D(Tt),D(Dn))};static \u0275dir=Ee({type:n,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(i,r){i&1&&x("click",function(s){return r.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),i&2&&Ci("href",r.reactiveHref(),rg)("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",go],skipLocationChange:[2,"skipLocationChange","skipLocationChange",go],replaceUrl:[2,"replaceUrl","replaceUrl",go],routerLink:"routerLink"},features:[Sn]})}return n})(),K0=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new ke;constructor(e,i,r,o,s){this.router=e,this.element=i,this.renderer=r,this.cdr=o,this.link=s,this.routerEventsSubscription=e.events.subscribe(a=>{a instanceof rn&&this.update()})}ngAfterContentInit(){K(this.links.changes,K(null)).pipe(ur()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let e=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=B(e).pipe(ur()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(e){let i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let e=this.hasActiveLinks();this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.isActiveChange.emit(e))})}isLinkActive(e){let i=J2(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{let o=r.urlTree;return o?e.isActive(o,i):!1}}hasActiveLinks(){let e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static \u0275fac=function(i){return new(i||n)(D(De),D(Tt),D(dn),D(Xi),D(Gt,8))};static \u0275dir=Ee({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(i&1&&Ng(o,Gt,5),i&2){let s;uo(s=fo())&&(r.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Sn]})}return n})();function J2(n){return!!n.paths}var Ll=class{};var yC=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,i,r,o){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(at(e=>e instanceof rn),hi(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){let r=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Ss(o.providers,e,`Route: ${o.path}`));let s=o._injector??e,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(a,o.children??o._loadedRoutes))}return B(r).pipe(ur())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;i.loadChildren&&i.canLoad===void 0?r=this.loader.loadChildren(e,i):r=K(null);let o=r.pipe(st(s=>s===null?K(void 0):(i._loadedRoutes=s.routes,i._loadedInjector=s.injector,this.processRoutes(s.injector??e,s.routes))));if(i.loadComponent&&!i._loadedComponent){let s=this.loader.loadComponent(e,i);return B([o,s]).pipe(ur())}else return o})}static \u0275fac=function(i){return new(i||n)(U(De),U(lt),U(Ll),U(vf))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),bC=new Y(""),K2=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=Ps;restoredId=0;store={};constructor(e,i,r,o,s={}){this.urlSerializer=e,this.transitions=i,this.viewportScroller=r,this.zone=o,this.options=s,s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Tr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof rn?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Ai&&e.code===ks.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{if(!(e instanceof Ls))return;let i={behavior:"instant"};e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],i):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position,i):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(e,i){this.zone.runOutsideAngular(()=>y(this,null,function*(){yield new Promise(r=>{setTimeout(r),typeof requestAnimationFrame<"u"&&requestAnimationFrame(r)}),this.zone.run(()=>{this.transitions.events.next(new Ls(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(i){wg()};static \u0275prov=V({token:n,factory:n.\u0275fac})}return n})();function Y0(n,...t){return mi([{provide:So,multi:!0,useValue:n},[],{provide:Wt,useFactory:wC,deps:[De]},{provide:Za,multi:!0,useFactory:EC},t.map(e=>e.\u0275providers)])}function wC(n){return n.routerState.root}function jl(n,t){return{\u0275kind:n,\u0275providers:t}}function EC(){let n=N(Qt);return t=>{let e=n.get(Zi);if(t!==e.components[0])return;let i=n.get(De),r=n.get(CC);n.get(Z0)===1&&i.initialNavigation(),n.get(DC,null,{optional:!0})?.setUpPreloading(),n.get(bC,null,{optional:!0})?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var CC=new Y("",{factory:()=>new We}),Z0=new Y("",{providedIn:"root",factory:()=>1});function SC(){let n=[{provide:eg,useValue:!0},{provide:Z0,useValue:0},vd(()=>{let t=N(Qt);return t.get(e0,Promise.resolve()).then(()=>new Promise(i=>{let r=t.get(De),o=t.get(CC);bf(r,()=>{i(!0)}),t.get(yf).afterPreactivation=()=>(i(!0),o.closed?K(void 0):o),r.initialNavigation()}))})];return jl(2,n)}function xC(){let n=[vd(()=>{N(De).setUpLocationChangeListener()}),{provide:Z0,useValue:2}];return jl(3,n)}var DC=new Y("");function IC(n){return jl(0,[{provide:DC,useExisting:yC},{provide:Ll,useExisting:n}])}function TC(){return jl(8,[z0,{provide:kl,useExisting:z0}])}function MC(n){oi("NgRouterViewTransitions");let t=[{provide:W0,useValue:gC},{provide:G0,useValue:P({skipNextTransition:!!n?.skipInitialTransition},n)}];return jl(9,t)}var AC=[Sr,{provide:Eo,useClass:Dr},De,Co,{provide:Wt,useFactory:wC,deps:[De]},vf,[]],Ut=(()=>{class n{constructor(){}static forRoot(e,i){return{ngModule:n,providers:[AC,[],{provide:So,multi:!0,useValue:e},[],i?.errorHandler?{provide:q0,useValue:i.errorHandler}:[],{provide:Mr,useValue:i||{}},i?.useHash?Z2():Q2(),Y2(),i?.preloadingStrategy?IC(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?X2(i):[],i?.bindToComponentInputs?TC().\u0275providers:[],i?.enableViewTransitions?MC().\u0275providers:[],eP()]}}static forChild(e){return{ngModule:n,providers:[{provide:So,multi:!0,useValue:e}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Fn({type:n});static \u0275inj=wn({})}return n})();function Y2(){return{provide:bC,useFactory:()=>{let n=N(c1),t=N(Be),e=N(Mr),i=N(yf),r=N(Eo);return e.scrollOffset&&n.setOffset(e.scrollOffset),new K2(r,i,n,t,e)}}}function Z2(){return{provide:Dn,useClass:cl}}function Q2(){return{provide:Dn,useClass:Sd}}function X2(n){return[n.initialNavigation==="disabled"?xC().\u0275providers:[],n.initialNavigation==="enabledBlocking"?SC().\u0275providers:[]]}var J0=new Y("");function eP(){return[{provide:J0,useFactory:EC},{provide:Za,multi:!0,useExisting:J0}]}var VC=(()=>{class n{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||n)(D(dn),D(Tt))};static \u0275dir=Ee({type:n})}return n})(),qs=(()=>{class n extends VC{static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,features:[ut]})}return n})(),ir=new Y(""),tP={provide:ir,useExisting:yt(()=>xo),multi:!0},xo=(()=>{class n extends qs{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target.checked)})("blur",function(){return r.onTouched()})},standalone:!1,features:[$t([tP]),ut]})}return n})(),nP={provide:ir,useExisting:yt(()=>Me),multi:!0};function iP(){let n=Ln()?Ln().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var rP=new Y(""),Me=(()=>{class n extends VC{_compositionMode;_composing=!1;constructor(e,i,r){super(e,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!iP())}writeValue(e){let i=e??"";this.setProperty("value",i)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||n)(D(dn),D(Tt),D(rP,8))};static \u0275dir=Ee({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&x("input",function(s){return r._handleInput(s.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(s){return r._compositionEnd(s.target.value)})},standalone:!1,features:[$t([nP]),ut]})}return n})();function tv(n){return n==null||nv(n)===0}function nv(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var Rr=new Y(""),Do=new Y(""),oP=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ee=class{static min(t){return UC(t)}static max(t){return sP(t)}static required(t){return aP(t)}static requiredTrue(t){return lP(t)}static email(t){return cP(t)}static minLength(t){return uP(t)}static maxLength(t){return dP(t)}static pattern(t){return fP(t)}static nullValidator(t){return Ef()}static compose(t){return GC(t)}static composeAsync(t){return qC(t)}};function UC(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}function sP(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}function aP(n){return tv(n.value)?{required:!0}:null}function lP(n){return n.value===!0?null:{required:!0}}function cP(n){return tv(n.value)||oP.test(n.value)?null:{email:!0}}function uP(n){return t=>{let e=t.value?.length??nv(t.value);return e===null||e===0?null:e<n?{minlength:{requiredLength:n,actualLength:e}}:null}}function dP(n){return t=>{let e=t.value?.length??nv(t.value);return e!==null&&e>n?{maxlength:{requiredLength:n,actualLength:e}}:null}}function fP(n){if(!n)return Ef;let t,e;return typeof n=="string"?(e="",n.charAt(0)!=="^"&&(e+="^"),e+=n,n.charAt(n.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(tv(i.value))return null;let r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}function Ef(n){return null}function zC(n){return n!=null}function BC(n){return wr(n)?B(n):n}function $C(n){let t={};return n.forEach(e=>{t=e!=null?P(P({},t),e):t}),Object.keys(t).length===0?null:t}function HC(n,t){return t.map(e=>e(n))}function pP(n){return!n.validate}function WC(n){return n.map(t=>pP(t)?t:e=>t.validate(e))}function GC(n){if(!n)return null;let t=n.filter(zC);return t.length==0?null:function(e){return $C(HC(e,t))}}function iv(n){return n!=null?GC(WC(n)):null}function qC(n){if(!n)return null;let t=n.filter(zC);return t.length==0?null:function(e){let i=HC(e,t).map(BC);return nh(i).pipe(fe($C))}}function rv(n){return n!=null?qC(WC(n)):null}function RC(n,t){return n===null?[t]:Array.isArray(n)?[...n,t]:[n,t]}function JC(n){return n._rawValidators}function KC(n){return n._rawAsyncValidators}function Q0(n){return n?Array.isArray(n)?n:[n]:[]}function Cf(n,t){return Array.isArray(n)?n.includes(t):n===t}function OC(n,t){let e=Q0(t);return Q0(n).forEach(r=>{Cf(e,r)||e.push(r)}),e}function PC(n,t){return Q0(t).filter(e=>!Cf(n,e))}var Sf=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=iv(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=rv(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},on=class extends Sf{name;get formDirective(){return null}get path(){return null}},Oi=class extends Sf{_parent=null;name=null;valueAccessor=null},xf=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},hP={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},kZ=J(P({},hP),{"[class.ng-submitted]":"isSubmitted"}),Oe=(()=>{class n extends xf{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(D(Oi,2))};static \u0275dir=Ee({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&Ce("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[ut]})}return n})(),hn=(()=>{class n extends xf{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(D(on,10))};static \u0275dir=Ee({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){i&2&&Ce("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[ut]})}return n})();var Vl="VALID",wf="INVALID",$s="PENDING",Ul="DISABLED",Ar=class{},Df=class extends Ar{value;source;constructor(t,e){super(),this.value=t,this.source=e}},Bl=class extends Ar{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},$l=class extends Ar{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},Hs=class extends Ar{status;source;constructor(t,e){super(),this.status=t,this.source=e}},If=class extends Ar{source;constructor(t){super(),this.source=t}},Wl=class extends Ar{source;constructor(t){super(),this.source=t}};function ov(n){return(Rf(n)?n.validators:n)||null}function mP(n){return Array.isArray(n)?iv(n):n||null}function sv(n,t){return(Rf(t)?t.asyncValidators:n)||null}function gP(n){return Array.isArray(n)?rv(n):n||null}function Rf(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function YC(n,t,e){let i=n.controls;if(!(t?Object.keys(i):i).length)throw new z(1e3,"");if(!i[e])throw new z(1001,"")}function ZC(n,t,e){n._forEachChild((i,r)=>{if(e[r]===void 0)throw new z(1002,"")})}var Ws=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return bt(this.statusReactive)}set status(t){bt(()=>this.statusReactive.set(t))}_status=mo(()=>this.statusReactive());statusReactive=Ze(void 0);get valid(){return this.status===Vl}get invalid(){return this.status===wf}get pending(){return this.status==$s}get disabled(){return this.status===Ul}get enabled(){return this.status!==Ul}errors;get pristine(){return bt(this.pristineReactive)}set pristine(t){bt(()=>this.pristineReactive.set(t))}_pristine=mo(()=>this.pristineReactive());pristineReactive=Ze(!0);get dirty(){return!this.pristine}get touched(){return bt(this.touchedReactive)}set touched(t){bt(()=>this.touchedReactive.set(t))}_touched=mo(()=>this.touchedReactive());touchedReactive=Ze(!1);get untouched(){return!this.touched}_events=new We;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(OC(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(OC(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(PC(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(PC(t,this._rawAsyncValidators))}hasValidator(t){return Cf(this._rawValidators,t)}hasAsyncValidator(t){return Cf(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(J(P({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new $l(!0,i))}markAllAsDirty(t={}){this.markAsDirty({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(t))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),e&&t.emitEvent!==!1&&this._events.next(new $l(!1,i))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(J(P({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new Bl(!1,i))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),e&&t.emitEvent!==!1&&this._events.next(new Bl(!0,i))}markAsPending(t={}){this.status=$s;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Hs(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(J(P({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ul,this.errors=null,this._forEachChild(r=>{r.disable(J(P({},t),{onlySelf:!0}))}),this._updateValue();let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Df(this.value,i)),this._events.next(new Hs(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(J(P({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Vl,this._forEachChild(i=>{i.enable(J(P({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(J(P({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Vl||this.status===$s)&&this._runAsyncValidator(i,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Df(this.value,e)),this._events.next(new Hs(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(J(P({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ul:Vl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=$s,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:t!==!1};let i=BC(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){let i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new Hs(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,i)}_initObservables(){this.valueChanges=new ke,this.statusChanges=new ke}_calculateStatus(){return this._allControlsDisabled()?Ul:this.errors?wf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus($s)?$s:this._anyControlsHaveStatus(wf)?wf:Vl}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),r&&this._events.next(new Bl(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new $l(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Rf(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=mP(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=gP(this._rawAsyncValidators)}},Gs=class extends Ws{constructor(t,e,i){super(ov(e),sv(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){ZC(this,!0,t),Object.keys(t).forEach(i=>{YC(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(i=>{let r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t?t[r]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Wl(this))}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>i._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,o)=>{i=e(i,r,o)}),i}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var X0=class extends Gs{};var Io=new Y("",{providedIn:"root",factory:()=>ql}),ql="always";function Of(n,t){return[...t.path,n]}function Gl(n,t,e=ql){av(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(n.disabled),_P(n,t),bP(n,t),yP(n,t),vP(n,t)}function Tf(n,t,e=!0){let i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Af(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Mf(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function vP(n,t){if(t.valueAccessor.setDisabledState){let e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}function av(n,t){let e=JC(n);t.validator!==null?n.setValidators(RC(e,t.validator)):typeof e=="function"&&n.setValidators([e]);let i=KC(n);t.asyncValidator!==null?n.setAsyncValidators(RC(i,t.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();Mf(t._rawValidators,r),Mf(t._rawAsyncValidators,r)}function Af(n,t){let e=!1;if(n!==null){if(t.validator!==null){let r=JC(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.validator);o.length!==r.length&&(e=!0,n.setValidators(o))}}if(t.asyncValidator!==null){let r=KC(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.asyncValidator);o.length!==r.length&&(e=!0,n.setAsyncValidators(o))}}}let i=()=>{};return Mf(t._rawValidators,i),Mf(t._rawAsyncValidators,i),e}function _P(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&QC(n,t)})}function yP(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&QC(n,t),n.updateOn!=="submit"&&n.markAsTouched()})}function QC(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function bP(n,t){let e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}function XC(n,t){n==null,av(n,t)}function wP(n,t){return Af(n,t)}function lv(n,t){if(!n.hasOwnProperty("model"))return!1;let e=n.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function EP(n){return Object.getPrototypeOf(n.constructor)===qs}function eS(n,t){n._syncPendingControls(),t.forEach(e=>{let i=e.control;i.updateOn==="submit"&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function cv(n,t){if(!t)return null;Array.isArray(t);let e,i,r;return t.forEach(o=>{o.constructor===Me?e=o:EP(o)?i=o:r=o}),r||i||e||null}function CP(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}var SP={provide:on,useExisting:yt(()=>uv)},zl=Promise.resolve(),uv=(()=>{class n extends on{callSetDisabledState;get submitted(){return bt(this.submittedReactive)}_submitted=mo(()=>this.submittedReactive());submittedReactive=Ze(!1);_directives=new Set;form;ngSubmit=new ke;options;constructor(e,i,r){super(),this.callSetDisabledState=r,this.form=new Gs({},iv(e),rv(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){zl.then(()=>{let i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),Gl(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){zl.then(()=>{let i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){zl.then(()=>{let i=this._findContainer(e.path),r=new Gs({});XC(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){zl.then(()=>{let i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){zl.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),eS(this.form,this._directives),this.ngSubmit.emit(e),this.form._events.next(new If(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(i){return new(i||n)(D(Rr,10),D(Do,10),D(Io,8))};static \u0275dir=Ee({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){i&1&&x("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[$t([SP]),ut]})}return n})();function NC(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function kC(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Hl=class extends Ws{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,i){super(ov(e),sv(i,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Rf(e)&&(e.nonNullable||e.initialValueIsDefault)&&(kC(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new Wl(this))}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){NC(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){NC(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){kC(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var xP=n=>n instanceof Hl,DP=(()=>{class n extends on{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Of(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,standalone:!1,features:[ut]})}return n})();var IP={provide:Oi,useExisting:yt(()=>Et)},FC=Promise.resolve(),Et=(()=>{class n extends Oi{_changeDetectorRef;callSetDisabledState;control=new Hl;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new ke;constructor(e,i,r,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=cv(this,o)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),lv(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Gl(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){FC.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let i=e.isDisabled.currentValue,r=i!==0&&go(i);FC.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?Of(e,this._parent):[e]}static \u0275fac=function(i){return new(i||n)(D(on,9),D(Rr,10),D(Do,10),D(ir,10),D(Xi,8),D(Io,8))};static \u0275dir=Ee({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[$t([IP]),ut,Sn]})}return n})();var mn=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ee({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),TP={provide:ir,useExisting:yt(()=>To),multi:!0},To=(()=>{class n extends qs{writeValue(e){let i=e??"";this.setProperty("value",i)}registerOnChange(e){this.onChange=i=>{e(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&x("input",function(s){return r.onChange(s.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[$t([TP]),ut]})}return n})(),MP={provide:ir,useExisting:yt(()=>dv),multi:!0};var AP=(()=>{class n{_accessors=[];add(e,i){this._accessors.push([e,i])}remove(e){for(let i=this._accessors.length-1;i>=0;--i)if(this._accessors[i][1]===e){this._accessors.splice(i,1);return}}select(e){this._accessors.forEach(i=>{this._isSameGroup(i,e)&&i[1]!==e&&i[1].fireUncheck(e.value)})}_isSameGroup(e,i){return e[0].control?e[0]._parent===i._control._parent&&e[1].name===i.name:!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dv=(()=>{class n extends qs{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=N(Io,{optional:!0})??ql;constructor(e,i,r,o){super(e,i),this._registry=r,this._injector=o}ngOnInit(){this._control=this._injector.get(Oi),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(i){return new(i||n)(D(dn),D(Tt),D(AP),D(Qt))};static \u0275dir=Ee({type:n,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(){return r.onChange()})("blur",function(){return r.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[$t([MP]),ut]})}return n})();var fv=new Y(""),RP={provide:Oi,useExisting:yt(()=>pv)},pv=(()=>{class n extends Oi{_ngModelWarningConfig;callSetDisabledState;viewModel;form;set isDisabled(e){}model;update=new ke;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,o,s){super(),this._ngModelWarningConfig=o,this.callSetDisabledState=s,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=cv(this,r)}ngOnChanges(e){if(this._isControlChanged(e)){let i=e.form.previousValue;i&&Tf(i,this,!1),Gl(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}lv(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Tf(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}static \u0275fac=function(i){return new(i||n)(D(Rr,10),D(Do,10),D(ir,10),D(fv,8),D(Io,8))};static \u0275dir=Ee({type:n,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],standalone:!1,features:[$t([RP]),ut,Sn]})}return n})(),OP={provide:on,useExisting:yt(()=>gn)},gn=(()=>{class n extends on{callSetDisabledState;get submitted(){return bt(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=mo(()=>this._submittedReactive());_submittedReactive=Ze(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new ke;constructor(e,i,r){super(),this.callSetDisabledState=r,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Af(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let i=this.form.get(e.path);return Gl(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Tf(e.control||null,e,!1),CP(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this._submittedReactive.set(!0),eS(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new If(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0,i={}){this.form.reset(e,i),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(e=>{let i=e.control,r=this.form.get(e.path);i!==r&&(Tf(i||null,e),xP(r)&&(Gl(r,e,this.callSetDisabledState),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let i=this.form.get(e.path);XC(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let i=this.form.get(e.path);i&&wP(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){av(this.form,this),this._oldForm&&Af(this._oldForm,this)}static \u0275fac=function(i){return new(i||n)(D(Rr,10),D(Do,10),D(Io,8))};static \u0275dir=Ee({type:n,selectors:[["","formGroup",""]],hostBindings:function(i,r){i&1&&x("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[$t([OP]),ut,Sn]})}return n})(),PP={provide:on,useExisting:yt(()=>Js)},Js=(()=>{class n extends DP{name=null;constructor(e,i,r){super(),this._parent=e,this._setValidators(i),this._setAsyncValidators(r)}_checkParentType(){nS(this._parent)}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Rr,10),D(Do,10))};static \u0275dir=Ee({type:n,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[$t([PP]),ut]})}return n})(),NP={provide:on,useExisting:yt(()=>tS)},tS=(()=>{class n extends on{_parent;name=null;constructor(e,i,r){super(),this._parent=e,this._setValidators(i),this._setAsyncValidators(r)}ngOnInit(){nS(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Of(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Rr,10),D(Do,10))};static \u0275dir=Ee({type:n,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[$t([NP]),ut]})}return n})();function nS(n){return!(n instanceof Js)&&!(n instanceof gn)&&!(n instanceof tS)}var kP={provide:Oi,useExisting:yt(()=>Mn)},Mn=(()=>{class n extends Oi{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new ke;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,o,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=cv(this,o)}ngOnChanges(e){this._added||this._setUpControl(),lv(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Of(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Rr,10),D(Do,10),D(ir,10),D(fv,8))};static \u0275dir=Ee({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[$t([kP]),ut,Sn]})}return n})();var FP={provide:ir,useExisting:yt(()=>mt),multi:!0};function iS(n,t){return n==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function LP(n){return n.split(":")[0]}var mt=(()=>{class n extends qs{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;appRefInjector=N(Zi).injector;destroyRef=N(ti);cdr=N(Xi);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,Ka({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(e){this.cdr.markForCheck(),this.value=e;let i=this._getOptionId(e),r=iS(i,e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){let i=LP(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[$t([FP]),ut]})}return n})(),kt=(()=>{class n{_element;_renderer;_select;id;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(iS(this.id,e)),this._select._writeValueAfterRender())}set value(e){this._setElementValue(e),this._select&&this._select._writeValueAfterRender()}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(i){return new(i||n)(D(Tt),D(dn),D(mt,9))};static \u0275dir=Ee({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),jP={provide:ir,useExisting:yt(()=>rS),multi:!0};function LC(n,t){return n==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function VP(n){return n.split(":")[0]}var rS=(()=>{class n extends qs{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let i;if(Array.isArray(e)){let r=e.map(o=>this._getOptionId(o));i=(o,s)=>{o._setSelected(r.indexOf(s.toString())>-1)}}else i=(r,o)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{let r=[],o=i.selectedOptions;if(o!==void 0){let s=o;for(let a=0;a<s.length;a++){let u=s[a],f=this._getOptionValue(u.value);r.push(f)}}else{let s=i.options;for(let a=0;a<s.length;a++){let u=s[a];if(u.selected){let f=this._getOptionValue(u.value);r.push(f)}}}this.value=r,e(r)}}_registerOption(e){let i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){let i=VP(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[$t([jP]),ut]})}return n})(),Ft=(()=>{class n{_element;_renderer;_select;id;_value;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(LC(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(LC(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(D(Tt),D(dn),D(rS,9))};static \u0275dir=Ee({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function UP(n){return typeof n=="number"?n:parseFloat(n)}var zP=(()=>{class n{_validator=Ef;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Ef,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ee({type:n,features:[Sn]})}return n})();var BP={provide:Rr,useExisting:yt(()=>hv),multi:!0},hv=(()=>{class n extends zP{min;inputName="min";normalizeInput=e=>UP(e);createValidator=e=>UC(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=kn(n)))(r||n)}})();static \u0275dir=Ee({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&Ci("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[$t([BP]),ut]})}return n})();var oS=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=Fn({type:n});static \u0275inj=wn({})}return n})(),ev=class extends Ws{constructor(t,e,i){super(ov(e),sv(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){Array.isArray(t)?t.forEach(i=>{this.controls.push(i),this._registerControl(i)}):(this.controls.push(t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,i={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,e={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,i={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){ZC(this,!1,t),t.forEach((i,r)=>{YC(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Wl(this))}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,i)=>i._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};function jC(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var Un=(()=>{class n{useNonNullable=!1;get nonNullable(){let e=new n;return e.useNonNullable=!0,e}group(e,i=null){let r=this._reduceControls(e),o={};return jC(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Gs(r,o)}record(e,i=null){let r=this._reduceControls(e);return new X0(r,i)}control(e,i,r){let o={};return this.useNonNullable?(jC(i)?o=i:(o.validators=i,o.asyncValidators=r),new Hl(e,J(P({},o),{nonNullable:!0}))):new Hl(e,i,r)}array(e,i,r){let o=e.map(s=>this._createControl(s));return new ev(o,i,r)}_reduceControls(e){let i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){if(e instanceof Hl)return e;if(e instanceof Ws)return e;if(Array.isArray(e)){let i=e[0],r=e.length>1?e[1]:null,o=e.length>2?e[2]:null;return this.control(i,r,o)}else return this.control(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Lt=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:Io,useValue:e.callSetDisabledState??ql}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Fn({type:n});static \u0275inj=wn({imports:[oS]})}return n})(),zn=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:fv,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Io,useValue:e.callSetDisabledState??ql}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=Fn({type:n});static \u0275inj=wn({imports:[oS]})}return n})();Ve();var sS=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)};var Jl=class extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}},Kl=class extends Jl{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}},Yl=class extends Jl{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}},Zl=class extends Jl{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}},mv=(function(n){return n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2",n})(mv||{});var Ql=class{constructor(t,{headers:e={},customFetch:i,region:r=mv.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=sS(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return G(this,arguments,void 0,function*(e,i={}){var r;try{let{headers:o,method:s,body:a,signal:u}=i,f={},{region:h}=i;h||(h=this.region);let m=new URL(`${this.url}/${e}`);h&&h!=="any"&&(f["x-region"]=h,m.searchParams.set("forceFunctionRegion",h));let b;a&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",b=a):typeof a=="string"?(f["Content-Type"]="text/plain",b=a):typeof FormData<"u"&&a instanceof FormData?b=a:(f["Content-Type"]="application/json",b=JSON.stringify(a)):b=a;let _=yield this.fetch(m.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),o),body:b,signal:u}).catch(A=>{throw A.name==="AbortError"?A:new Kl(A)}),w=_.headers.get("x-relay-error");if(w&&w==="true")throw new Yl(_);if(!_.ok)throw new Zl(_);let M=((r=_.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),I;return M==="application/json"?I=yield _.json():M==="application/octet-stream"||M==="application/pdf"?I=yield _.blob():M==="text/event-stream"?I=_:M==="multipart/form-data"?I=yield _.formData():I=yield _.text(),{data:I,error:null,response:_}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new Kl(o)}:{data:null,error:o,response:o instanceof Zl||o instanceof Yl?o.context:void 0}}})}};var Ov=Rx(gS(),1),{PostgrestClient:vS,PostgrestQueryBuilder:eQ,PostgrestFilterBuilder:tQ,PostgrestTransformBuilder:nQ,PostgrestBuilder:iQ,PostgrestError:XP}=Ov.default||Ov;var Pv=class{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let e=process.versions;if(e&&e.node){let i=e.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){let i=this.getWebSocketConstructor();return new i(t,e)}static isWebSocketSupported(){try{let t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}},Nv=Pv;var _S="2.77.0";var yS=`realtime-js/${_S}`,bS="1.0.0";var ec=1e4,wS=1e3,ES=100,tc=(function(n){return n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed",n})(tc||{}),Ct=(function(n){return n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving",n})(Ct||{}),Bn=(function(n){return n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token",n})(Bn||{}),kv=(function(n){return n.websocket="websocket",n})(kv||{}),Mo=(function(n){return n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed",n})(Mo||{});var Nf=class{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){let e=new DataView(t),i=new TextDecoder;return this._decodeBroadcast(t,e,i)}_decodeBroadcast(t,e,i){let r=e.getUint8(1),o=e.getUint8(2),s=this.HEADER_LENGTH+2,a=i.decode(t.slice(s,s+r));s=s+r;let u=i.decode(t.slice(s,s+o));s=s+o;let f=JSON.parse(i.decode(t.slice(s,t.byteLength)));return{ref:null,topic:a,event:u,payload:f}}};var Ys=class{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Ue=(function(n){return n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange",n})(Ue||{}),Lv=(n,t,e={})=>{var i;let r=(i=e.skipTypes)!==null&&i!==void 0?i:[];return t?Object.keys(t).reduce((o,s)=>(o[s]=eN(s,n,t,r),o),{}):{}},eN=(n,t,e,i)=>{let r=t.find(a=>a.name===n),o=r?.type,s=e[n];return o&&!i.includes(o)?CS(o,s):Fv(s)},CS=(n,t)=>{if(n.charAt(0)==="_"){let e=n.slice(1,n.length);return rN(t,e)}switch(n){case Ue.bool:return tN(t);case Ue.float4:case Ue.float8:case Ue.int2:case Ue.int4:case Ue.int8:case Ue.numeric:case Ue.oid:return nN(t);case Ue.json:case Ue.jsonb:return iN(t);case Ue.timestamp:return oN(t);case Ue.abstime:case Ue.date:case Ue.daterange:case Ue.int4range:case Ue.int8range:case Ue.money:case Ue.reltime:case Ue.text:case Ue.time:case Ue.timestamptz:case Ue.timetz:case Ue.tsrange:case Ue.tstzrange:return Fv(t);default:return Fv(t)}},Fv=n=>n,tN=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},nN=n=>{if(typeof n=="string"){let t=parseFloat(n);if(!Number.isNaN(t))return t}return n},iN=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(t){return console.log(`JSON parse error: ${t}`),n}return n},rN=(n,t)=>{if(typeof n!="string")return n;let e=n.length-1,i=n[e];if(n[0]==="{"&&i==="}"){let o,s=n.slice(1,e);try{o=JSON.parse("["+s+"]")}catch{o=s?s.split(","):[]}return o.map(a=>CS(t,a))}return n},oN=n=>typeof n=="string"?n.replace(" ","T"):n,kf=n=>{let t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};var Zs=class{constructor(t,e,i={},r=ec){this.channel=t,this.event=e,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this._hasReceived(t)&&e((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(i=>i.status===t).forEach(i=>i.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}};var nc=class n{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let i=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},r=>{let{onJoin:o,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=n.syncState(this.state,r,o,s),this.pendingDiffs.forEach(u=>{this.state=n.syncDiff(this.state,u,o,s)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},r=>{let{onJoin:o,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=n.syncDiff(this.state,r,o,s),a())}),this.onJoin((r,o,s)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:o,newPresences:s})}),this.onLeave((r,o,s)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:o,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,i,r){let o=this.cloneDeep(t),s=this.transformState(e),a={},u={};return this.map(o,(f,h)=>{s[f]||(u[f]=h)}),this.map(s,(f,h)=>{let m=o[f];if(m){let b=h.map(I=>I.presence_ref),_=m.map(I=>I.presence_ref),w=h.filter(I=>_.indexOf(I.presence_ref)<0),M=m.filter(I=>b.indexOf(I.presence_ref)<0);w.length>0&&(a[f]=w),M.length>0&&(u[f]=M)}else a[f]=h}),this.syncDiff(o,{joins:a,leaves:u},i,r)}static syncDiff(t,e,i,r){let{joins:o,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(o,(a,u)=>{var f;let h=(f=t[a])!==null&&f!==void 0?f:[];if(t[a]=this.cloneDeep(u),h.length>0){let m=t[a].map(_=>_.presence_ref),b=h.filter(_=>m.indexOf(_.presence_ref)<0);t[a].unshift(...b)}i(a,h,u)}),this.map(s,(a,u)=>{let f=t[a];if(!f)return;let h=u.map(m=>m.presence_ref);f=f.filter(m=>h.indexOf(m.presence_ref)<0),t[a]=f,r(a,f,u),f.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{let r=t[i];return"metas"in r?e[i]=r.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):e[i]=r,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var ic=(function(n){return n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system",n})(ic||{}),rr=(function(n){return n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR",n})(rr||{});var rc=class n{constructor(t,e={config:{}},i){var r,o;if(this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=Ct.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Zs(this,Bn.join,this.params,this.timeout),this.rejoinTimer=new Ys(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ct.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ct.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Ct.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ct.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Ct.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Bn.reply,{},(s,a)=>{this._trigger(this._replyEventName(a),s)}),this.presence=new nc(this),this.broadcastEndpointURL=kf(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var i,r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Ct.closed){let{config:{broadcast:s,presence:a,private:u}}=this.params,f=(r=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(_=>_.filter))!==null&&r!==void 0?r:[],h=!!this.bindings[ic.PRESENCE]&&this.bindings[ic.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,m={},b={broadcast:s,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:f,private:u};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(_=>t?.(rr.CHANNEL_ERROR,_)),this._onClose(()=>t?.(rr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},m)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",w=>y(this,[w],function*({postgres_changes:_}){var M;if(this.socket.setAuth(),_===void 0){t?.(rr.SUBSCRIBED);return}else{let I=this.bindings.postgres_changes,A=(M=I?.length)!==null&&M!==void 0?M:0,L=[];for(let $=0;$<A;$++){let j=I[$],{filter:{event:se,schema:je,table:F,filter:Q}}=j,Ie=_&&_[$];if(Ie&&Ie.event===se&&Ie.schema===je&&Ie.table===F&&Ie.filter===Q)L.push(Object.assign(Object.assign({},j),{id:Ie.id}));else{this.unsubscribe(),this.state=Ct.errored,t?.(rr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=L,t&&t(rr.SUBSCRIBED);return}})).receive("error",_=>{this.state=Ct.errored,t?.(rr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(_).join(", ")||"error")))}).receive("timeout",()=>{t?.(rr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(i){return y(this,arguments,function*(t,e={}){return yield this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)})}untrack(){return y(this,arguments,function*(t={}){return yield this.send({type:"presence",event:"untrack"},t)})}on(t,e,i){return this.state===Ct.joined&&t===ic.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,e,i)}httpSend(r,o){return y(this,arguments,function*(t,e,i={}){var s;let a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(e==null)return Promise.reject("Payload is required for httpSend()");let u={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},f=yield this._fetchWithTimeout(this.broadcastEndpointURL,u,(s=i.timeout)!==null&&s!==void 0?s:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{let m=yield f.json();h=m.error||m.message||h}catch{}return Promise.reject(new Error(h))})}send(i){return y(this,arguments,function*(t,e={}){var r,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:s,payload:a}=t,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{let h=yield this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return yield(o=h.body)===null||o===void 0?void 0:o.cancel(),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var a,u,f;let h=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(u=(a=this.params)===null||a===void 0?void 0:a.config)===null||u===void 0?void 0:u.broadcast)===null||f===void 0)&&f.ack)&&s("ok"),h.receive("ok",()=>s("ok")),h.receive("error",()=>s("error")),h.receive("timeout",()=>s("timed out"))})})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ct.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Bn.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new Zs(this,Bn.leave,{},t),i.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ct.closed,this.bindings={}}_fetchWithTimeout(t,e,i){return y(this,null,function*(){let r=new AbortController,o=setTimeout(()=>r.abort(),i),s=yield this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(o),s})}_push(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Zs(this,t,e,i);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>ES){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,i){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,i){var r,o;let s=t.toLocaleLowerCase(),{close:a,error:u,leave:f,join:h}=Bn;if(i&&[a,u,f,h].indexOf(s)>=0&&i!==this._joinRef())return;let b=this._onMessage(s,e,i);if(e&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(_=>{var w,M,I;return((w=_.filter)===null||w===void 0?void 0:w.event)==="*"||((I=(M=_.filter)===null||M===void 0?void 0:M.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===s}).map(_=>_.callback(b,i)):(o=this.bindings[s])===null||o===void 0||o.filter(_=>{var w,M,I,A,L,$;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in _){let j=_.id,se=(w=_.filter)===null||w===void 0?void 0:w.event;return j&&((M=e.ids)===null||M===void 0?void 0:M.includes(j))&&(se==="*"||se?.toLocaleLowerCase()===((I=e.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{let j=(L=(A=_?.filter)===null||A===void 0?void 0:A.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return j==="*"||j===(($=e?.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===s}).map(_=>{if(typeof b=="object"&&"ids"in b){let w=b.data,{schema:M,table:I,commit_timestamp:A,type:L,errors:$}=w;b=Object.assign(Object.assign({},{schema:M,table:I,commit_timestamp:A,eventType:L,new:{},old:{},errors:$}),this._getPayloadRecords(w))}_.callback(b,i)})}_isClosed(){return this.state===Ct.closed}_isJoined(){return this.state===Ct.joined}_isJoining(){return this.state===Ct.joining}_isLeaving(){return this.state===Ct.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,i){let r=t.toLocaleLowerCase(),o={type:r,filter:e,callback:i};return this.bindings[r]?this.bindings[r].push(o):this.bindings[r]=[o],this}_off(t,e){let i=t.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(r=>{var o;return!(((o=r.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&n.isEqual(r.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let i in t)if(t[i]!==e[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Bn.close,{},t)}_onError(t){this._on(Bn.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ct.joining,this.joinPush.resend(t))}_getPayloadRecords(t){let e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Lv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Lv(t.columns,t.old_record)),e}};var jv=()=>{},Ff={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},aN=[1e3,2e3,5e3,1e4],lN=1e4,cN=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,oc=class{constructor(t,e){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ec,this.transport=null,this.heartbeatIntervalMs=Ff.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=jv,this.ref=0,this.reconnectTimer=null,this.logger=jv,this.conn=null,this.sendBuffer=[],this.serializer=new Nf,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...s)=>import("./chunk-HXKWO5LS.js").then(({default:a})=>a(...s)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...s)=>o(...s)},!(!((i=e?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${kv.websocket}`,this.httpEndpoint=kf(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Nv.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:bS}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},t?this.conn.close(t,e??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(t){return y(this,null,function*(){let e=yield t.unsubscribe();return this.channels.length===0&&this.disconnect(),e})}removeAllChannels(){return y(this,null,function*(){let t=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t})}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case tc.connecting:return Mo.Connecting;case tc.open:return Mo.Open;case tc.closing:return Mo.Closing;default:return Mo.Closed}}isConnected(){return this.connectionState()===Mo.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){let i=`realtime:${t}`,r=this.getChannels().find(o=>o.topic===i);if(r)return r;{let o=new rc(`realtime:${t}`,e,this);return this.channels.push(o),o}}push(t){let{topic:e,event:i,payload:r,ref:o}=t,s=()=>{this.encode(t,a=>{var u;(u=this.conn)===null||u===void 0||u.send(a)})};this.log("push",`${e} ${i} (${o})`,r),this.isConnected()?s():this.sendBuffer.push(s)}setAuth(t=null){return y(this,null,function*(){this._authPromise=this._performAuth(t);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return y(this,null,function*(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(wS,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},Ff.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")})}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(i=>i.topic===t&&(i._isJoined()||i._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply")try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:i,event:r,payload:o,ref:s}=e,a=s?`(${s})`:"",u=o.status||"";this.log("receive",`${u} ${i} ${r} ${a}`.trim(),o),this.channels.filter(f=>f._isMember(i)).forEach(f=>f._trigger(r,o,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Bn.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;let i=t.match(/\?/)?"&":"?",r=new URLSearchParams(e);return`${t}${i}${r}`}_workerObjectUrl(t){let e;if(t)e=t;else{let i=new Blob([cN],{type:"application/javascript"});e=URL.createObjectURL(i)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}_performAuth(t=null){return y(this,null,function*(){let e;t?e=t:this.accessToken?e=yield this.accessToken():e=this.accessTokenValue,this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(i=>{let r={access_token:e,version:yS};e&&i.updateJoinPayload(r),i.joinedOnce&&i._isJoined()&&i._push(Bn.access_token,{access_token:e})}))})}_waitForAuthIfNeeded(){return y(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(t="general"){this.setAuth().catch(e=>{this.log("error",`error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(i=>{try{i(e)}catch(r){this.log("error",`error in ${t} callback`,r)}})}catch(i){this.log("error",`error triggering ${t} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Ys(()=>y(this,null,function*(){setTimeout(()=>y(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),Ff.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(t){var e,i,r,o,s,a,u,f,h;if(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(i=t?.timeout)!==null&&i!==void 0?i:ec,this.heartbeatIntervalMs=(r=t?.heartbeatIntervalMs)!==null&&r!==void 0?r:Ff.HEARTBEAT_INTERVAL,this.worker=(o=t?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(s=t?.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(a=t?.heartbeatCallback)!==null&&a!==void 0?a:jv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=t?.reconnectAfterMs)!==null&&u!==void 0?u:m=>aN[m-1]||lN,this.encode=(f=t?.encode)!==null&&f!==void 0?f:(m,b)=>b(JSON.stringify(m)),this.decode=(h=t?.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}};Ve();var Qs=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Pe(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Lf=class extends Qs{constructor(t,e,i){super(t),this.name="StorageApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Ao=class extends Qs{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};Ve();Ve();var Xs=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)},SS=()=>G(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-HXKWO5LS.js")).Response:Response}),jf=n=>{if(Array.isArray(n))return n.map(e=>jf(e));if(typeof n=="function"||n!==Object(n))return n;let t={};return Object.entries(n).forEach(([e,i])=>{let r=e.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[r]=jf(i)}),t},xS=n=>{if(typeof n!="object"||n===null)return!1;let t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Vv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),uN=(n,t,e)=>G(void 0,void 0,void 0,function*(){let i=yield SS();n instanceof i&&!e?.noResolveJson?n.json().then(r=>{let o=n.status||500,s=r?.statusCode||o+"";t(new Lf(Vv(r),o,s))}).catch(r=>{t(new Ao(Vv(r),r))}):t(new Ao(Vv(n),n))}),dN=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"||!i?r:(xS(i)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(i)):r.body=i,t?.duplex&&(r.duplex=t.duplex),Object.assign(Object.assign({},r),e))};function sc(n,t,e,i,r,o){return G(this,void 0,void 0,function*(){return new Promise((s,a)=>{n(e,dN(t,i,r,o)).then(u=>{if(!u.ok)throw u;return i?.noResolveJson?u:u.json()}).then(u=>s(u)).catch(u=>uN(u,a,i))})})}function Or(n,t,e,i){return G(this,void 0,void 0,function*(){return sc(n,"GET",t,e,i)})}function _n(n,t,e,i,r){return G(this,void 0,void 0,function*(){return sc(n,"POST",t,i,r,e)})}function ac(n,t,e,i,r){return G(this,void 0,void 0,function*(){return sc(n,"PUT",t,i,r,e)})}function DS(n,t,e,i){return G(this,void 0,void 0,function*(){return sc(n,"HEAD",t,Object.assign(Object.assign({},e),{noResolveJson:!0}),i)})}function ea(n,t,e,i,r){return G(this,void 0,void 0,function*(){return sc(n,"DELETE",t,i,r,e)})}Ve();Ve();var Vf=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}execute(){return G(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pe(t))return{data:null,error:t};throw t}})}};var IS,Uv=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[IS]="BlobDownloadBuilder",this.promise=null}asStream(){return new Vf(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return G(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pe(t))return{data:null,error:t};throw t}})}};IS=Symbol.toStringTag;var TS=Uv;var fN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},MS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Uf=class{constructor(t,e={},i,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=i,this.fetch=Xs(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,e,i,r){return G(this,void 0,void 0,function*(){try{let o,s=Object.assign(Object.assign({},MS),r),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(s.upsert)}),u=s.metadata;typeof Blob<"u"&&i instanceof Blob?(o=new FormData,o.append("cacheControl",s.cacheControl),u&&o.append("metadata",this.encodeMetadata(u)),o.append("",i)):typeof FormData<"u"&&i instanceof FormData?(o=i,o.append("cacheControl",s.cacheControl),u&&o.append("metadata",this.encodeMetadata(u))):(o=i,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,u&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),r?.headers&&(a=Object.assign(Object.assign({},a),r.headers));let f=this._removeEmptyFolders(e),h=this._getFinalPath(f),m=yield(t=="PUT"?ac:_n)(this.fetch,`${this.url}/object/${h}`,o,Object.assign({headers:a},s?.duplex?{duplex:s.duplex}:{}));return{data:{path:f,id:m.Id,fullPath:m.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Pe(o))return{data:null,error:o};throw o}})}upload(t,e,i){return G(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(t,e,i,r){return G(this,void 0,void 0,function*(){let o=this._removeEmptyFolders(t),s=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let u,f=Object.assign({upsert:MS.upsert},r),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",f.cacheControl),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.append("cacheControl",f.cacheControl)):(u=i,h["cache-control"]=`max-age=${f.cacheControl}`,h["content-type"]=f.contentType);let m=yield ac(this.fetch,a.toString(),u,{headers:h});return{data:{path:o,fullPath:m.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Pe(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(t,e){return G(this,void 0,void 0,function*(){try{let i=this._getFinalPath(t),r=Object.assign({},this.headers);e?.upsert&&(r["x-upsert"]="true");let o=yield _n(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:r}),s=new URL(this.url+o.url),a=s.searchParams.get("token");if(!a)throw new Qs("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:a},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Pe(i))return{data:null,error:i};throw i}})}update(t,e,i){return G(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(t,e,i){return G(this,void 0,void 0,function*(){try{return{data:yield _n(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}copy(t,e,i){return G(this,void 0,void 0,function*(){try{return{data:{path:(yield _n(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}createSignedUrl(t,e,i){return G(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t),o=yield _n(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:e},i?.transform?{transform:i.transform}:{}),{headers:this.headers}),s=i?.download?`&download=${i.download===!0?"":i.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${s}`)},{data:o,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}createSignedUrls(t,e,i){return G(this,void 0,void 0,function*(){try{let r=yield _n(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),o=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:r.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${o}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}download(t,e){let r=typeof e?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(e?.transform||{}),s=o?`?${o}`:"",a=this._getFinalPath(t),u=()=>Or(this.fetch,`${this.url}/${r}/${a}${s}`,{headers:this.headers,noResolveJson:!0});return new TS(u,this.shouldThrowOnError)}info(t){return G(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{let i=yield Or(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:jf(i),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Pe(i))return{data:null,error:i};throw i}})}exists(t){return G(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{return yield DS(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Pe(i)&&i instanceof Ao){let r=i.originalError;if([400,404].includes(r?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(t,e){let i=this._getFinalPath(t),r=[],o=e?.download?`download=${e.download===!0?"":e.download}`:"";o!==""&&r.push(o);let a=typeof e?.transform<"u"?"render/image":"object",u=this.transformOptsToQueryString(e?.transform||{});u!==""&&r.push(u);let f=r.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${i}${f}`)}}}remove(t){return G(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}list(t,e,i){return G(this,void 0,void 0,function*(){try{let r=Object.assign(Object.assign(Object.assign({},fN),e),{prefix:t||""});return{data:yield _n(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},i),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}listV2(t,e){return G(this,void 0,void 0,function*(){try{let i=Object.assign({},t);return{data:yield _n(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},e),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Pe(i))return{data:null,error:i};throw i}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){let e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};Ve();var zf="2.77.0";var Bf={"X-Client-Info":`storage-js/${zf}`};var $f=class{constructor(t,e={},i,r){this.shouldThrowOnError=!1;let o=new URL(t);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bf),e),this.fetch=Xs(i)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return G(this,void 0,void 0,function*(){try{let e=this.listBucketOptionsToQueryString(t);return{data:yield Or(this.fetch,`${this.url}/bucket${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}getBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield Or(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}createBucket(t){return G(this,arguments,void 0,function*(e,i={public:!1}){try{return{data:yield _n(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Pe(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return G(this,void 0,void 0,function*(){try{return{data:yield ac(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Pe(i))return{data:null,error:i};throw i}})}emptyBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield _n(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}deleteBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(t){let e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}};Ve();var Hf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bf),e),this.fetch=Xs(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield _n(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}listBuckets(t){return G(this,void 0,void 0,function*(){try{let e=new URLSearchParams;t?.limit!==void 0&&e.set("limit",t.limit.toString()),t?.offset!==void 0&&e.set("offset",t.offset.toString()),t?.sortColumn&&e.set("sortColumn",t.sortColumn),t?.sortOrder&&e.set("sortOrder",t.sortOrder),t?.search&&e.set("search",t.search);let i=e.toString(),r=i?`${this.url}/bucket?${i}`:`${this.url}/bucket`;return{data:yield Or(this.fetch,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}deleteBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Pe(e))return{data:null,error:e};throw e}})}};Ve();Ve();var ta={"X-Client-Info":`storage-js/${zf}`,"Content-Type":"application/json"};var Wf=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function qt(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var na=class extends Wf{constructor(t,e,i){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Gf=class extends Wf{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};Ve();var ia=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)};var AS=n=>{if(typeof n!="object"||n===null)return!1;let t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var RS=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),pN=(n,t,e)=>G(void 0,void 0,void 0,function*(){if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!e?.noResolveJson){let r=n.status||500,o=n;if(typeof o.json=="function")o.json().then(s=>{let a=s?.statusCode||s?.code||r+"";t(new na(RS(s),r,a))}).catch(()=>{let s=r+"",a=o.statusText||`HTTP ${r} error`;t(new na(a,r,s))});else{let s=r+"",a=o.statusText||`HTTP ${r} error`;t(new na(a,r,s))}}else t(new Gf(RS(n),n))}),hN=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"||!i?r:(AS(i)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(i)):r.body=i,Object.assign(Object.assign({},r),e))};function mN(n,t,e,i,r,o){return G(this,void 0,void 0,function*(){return new Promise((s,a)=>{n(e,hN(t,i,r,o)).then(u=>{if(!u.ok)throw u;if(i?.noResolveJson)return u;let f=u.headers.get("content-type");return!f||!f.includes("application/json")?{}:u.json()}).then(u=>s(u)).catch(u=>pN(u,a,i))})})}function Jt(n,t,e,i,r){return G(this,void 0,void 0,function*(){return mN(n,"POST",t,i,r,e)})}var qf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ta),e),this.fetch=ia(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return G(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getIndex(t,e){return G(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(qt(i))return{data:null,error:i};throw i}})}listIndexes(t){return G(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteIndex(t,e){return G(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(qt(i))return{data:null,error:i};throw i}})}};Ve();var Jf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ta),e),this.fetch=ia(i)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return G(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getVectors(t){return G(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}listVectors(t){return G(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Jt(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}queryVectors(t){return G(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteVectors(t){return G(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}};Ve();var Kf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},ta),e),this.fetch=ia(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return G(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getBucket(t){return G(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}listBuckets(){return G(this,arguments,void 0,function*(t={}){try{return{data:yield Jt(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteBucket(t){return G(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}};var lc=class extends Kf{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new Yf(this.url,this.headers,t,this.fetch)}},Yf=class extends qf{constructor(t,e,i,r){super(t,e,r),this.vectorBucketName=i}createIndex(t){let e=Object.create(null,{createIndex:{get:()=>super.createIndex}});return G(this,void 0,void 0,function*(){return e.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return G(this,arguments,void 0,function*(e={}){return t.listIndexes.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){let e=Object.create(null,{getIndex:{get:()=>super.getIndex}});return G(this,void 0,void 0,function*(){return e.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){let e=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return G(this,void 0,void 0,function*(){return e.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new Zf(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},Zf=class extends Jf{constructor(t,e,i,r,o){super(t,e,o),this.vectorBucketName=i,this.indexName=r}putVectors(t){let e=Object.create(null,{putVectors:{get:()=>super.putVectors}});return G(this,void 0,void 0,function*(){return e.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){let e=Object.create(null,{getVectors:{get:()=>super.getVectors}});return G(this,void 0,void 0,function*(){return e.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return G(this,arguments,void 0,function*(e={}){return t.listVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){let e=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return G(this,void 0,void 0,function*(){return e.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){let e=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return G(this,void 0,void 0,function*(){return e.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}};var cc=class extends $f{constructor(t,e={},i,r){super(t,e,i,r)}from(t){return new Uf(this.url,this.headers,t,this.fetch)}get vectors(){return new lc(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Hf(this.url+"/iceberg",this.headers,this.fetch)}};var OS="2.77.0";var uc="";typeof Deno<"u"?uc="deno":typeof document<"u"?uc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?uc="react-native":uc="node";var gN={"X-Client-Info":`supabase-js-${uc}/${OS}`},PS={headers:gN},NS={schema:"public"},kS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},FS={};o_();var vN=n=>{let t;return n?t=n:typeof fetch>"u"?t=i_:t=fetch,(...e)=>t(...e)},_N=()=>typeof Headers>"u"?r_:Headers,LS=(n,t,e)=>{let i=vN(e),r=_N();return(o,s)=>y(null,null,function*(){var a;let u=(a=yield t())!==null&&a!==void 0?a:n,f=new r(s?.headers);return f.has("apikey")||f.set("apikey",n),f.has("Authorization")||f.set("Authorization",`Bearer ${u}`),i(o,Object.assign(Object.assign({},s),{headers:f}))})};function yN(n){return n.endsWith("/")?n:n+"/"}function jS(n,t){var e,i;let{db:r,auth:o,realtime:s,global:a}=n,{db:u,auth:f,realtime:h,global:m}=t,b={db:Object.assign(Object.assign({},u),r),auth:Object.assign(Object.assign({},f),o),realtime:Object.assign(Object.assign({},h),s),storage:{},global:Object.assign(Object.assign(Object.assign({},m),a),{headers:Object.assign(Object.assign({},(e=m?.headers)!==null&&e!==void 0?e:{}),(i=a?.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>y(null,null,function*(){return""})};return n.accessToken?b.accessToken=n.accessToken:delete b.accessToken,b}function VS(n){let t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(yN(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}Ve();Ve();var Qf="2.77.0";var Ro=30*1e3,Xf=3,ep=Xf*Ro,US="http://localhost:9999",zS="supabase.auth.token";var BS={"X-Client-Info":`gotrue-js/${Qf}`};var dc="X-Supabase-Api-Version",zv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$S=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,HS=600*1e3;var Pr=class extends Error{constructor(t,e,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=i}};function ie(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}var tp=class extends Pr{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}};function WS(n){return ie(n)&&n.name==="AuthApiError"}var $n=class extends Pr{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}},Pi=class extends Pr{constructor(t,e,i,r){super(t,i,r),this.name=e,this.status=i}},Hn=class extends Pi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function GS(n){return ie(n)&&n.name==="AuthSessionMissingError"}var or=class extends Pi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Oo=class extends Pi{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}},Po=class extends Pi{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function qS(n){return ie(n)&&n.name==="AuthImplicitGrantRedirectError"}var fc=class extends Pi{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},ra=class extends Pi{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}};function np(n){return ie(n)&&n.name==="AuthRetryableFetchError"}var pc=class extends Pi{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}};var No=class extends Pi{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}};var ip="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),JS=` 	
\r=`.split(""),bN=(()=>{let n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<JS.length;t+=1)n[JS[t].charCodeAt(0)]=-2;for(let t=0;t<ip.length;t+=1)n[ip[t].charCodeAt(0)]=t;return n})();function KS(n,t,e){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){let i=t.queue>>t.queuedBits-6&63;e(ip[i]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){let i=t.queue>>t.queuedBits-6&63;e(ip[i]),t.queuedBits-=6}}function YS(n,t,e){let i=bN[n];if(i>-1)for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Bv(n){let t=[],e=s=>{t.push(String.fromCodePoint(s))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},o=s=>{CN(s,i,e)};for(let s=0;s<n.length;s+=1)YS(n.charCodeAt(s),r,o);return t.join("")}function wN(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function EN(n,t){for(let e=0;e<n.length;e+=1){let i=n.charCodeAt(e);if(i>55295&&i<=56319){let r=(i-55296)*1024&65535;i=(n.charCodeAt(e+1)-56320&65535|r)+65536,e+=1}wN(i,t)}}function CN(n,t,e){if(t.utf8seq===0){if(n<=127){e(n);return}for(let i=1;i<6;i+=1)if((n>>7-i&1)===0){t.utf8seq=i;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Nr(n){let t=[],e={queue:0,queuedBits:0},i=r=>{t.push(r)};for(let r=0;r<n.length;r+=1)YS(n.charCodeAt(r),e,i);return new Uint8Array(t)}function ZS(n){let t=[];return EN(n,e=>t.push(e)),new Uint8Array(t)}function sr(n){let t=[],e={queue:0,queuedBits:0},i=r=>{t.push(r)};return n.forEach(r=>KS(r,e,i)),KS(null,e,i),t.join("")}function QS(n){return Math.round(Date.now()/1e3)+n}function XS(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let t=Math.random()*16|0;return(n=="x"?t:t&3|8).toString(16)})}var an=()=>typeof window<"u"&&typeof document<"u",ko={tested:!1,writable:!1},rp=()=>{if(!an())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ko.tested)return ko.writable;let n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ko.tested=!0,ko.writable=!0}catch{ko.tested=!0,ko.writable=!1}return ko.writable};function ex(n){let t={},e=new URL(n);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((r,o)=>{t[o]=r})}catch{}return e.searchParams.forEach((i,r)=>{t[r]=i}),t}var op=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)},tx=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Fo=(n,t,e)=>y(null,null,function*(){yield n.setItem(t,JSON.stringify(e))}),kr=(n,t)=>y(null,null,function*(){let e=yield n.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}}),ar=(n,t)=>y(null,null,function*(){yield n.removeItem(t)}),hc=class n{constructor(){this.promise=new n.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}};hc.promiseConstructor=Promise;function sp(n){let t=n.split(".");if(t.length!==3)throw new No("Invalid JWT structure");for(let i=0;i<t.length;i++)if(!$S.test(t[i]))throw new No("JWT not in base64url format");return{header:JSON.parse(Bv(t[0])),payload:JSON.parse(Bv(t[1])),signature:Nr(t[2]),raw:{header:t[0],payload:t[1]}}}function nx(n){return y(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),n)})})}function ix(n,t){return new Promise((i,r)=>{y(null,null,function*(){for(let o=0;o<1/0;o++)try{let s=yield n(o);if(!t(o,null,s)){i(s);return}}catch(s){if(!t(o,s)){r(s);return}}})})}function SN(n){return("0"+n.toString(16)).substr(-2)}function xN(){let t=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=e.length,r="";for(let o=0;o<56;o++)r+=e.charAt(Math.floor(Math.random()*i));return r}return crypto.getRandomValues(t),Array.from(t,SN).join("")}function DN(n){return y(this,null,function*(){let e=new TextEncoder().encode(n),i=yield crypto.subtle.digest("SHA-256",e),r=new Uint8Array(i);return Array.from(r).map(o=>String.fromCharCode(o)).join("")})}function IN(n){return y(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;let e=yield DN(n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function Lo(n,t,e=!1){return y(this,null,function*(){let i=xN(),r=i;e&&(r+="/PASSWORD_RECOVERY"),yield Fo(n,`${t}-code-verifier`,r);let o=yield IN(i);return[o,i===o?"plain":"s256"]})}var TN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function rx(n){let t=n.headers.get(dc);if(!t||!t.match(TN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ox(n){if(!n)throw new Error("Missing exp claim");let t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function sx(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var MN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function jo(n){if(!MN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ap(){let n={};return new Proxy(n,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){let i=e.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function $v(n){return JSON.parse(JSON.stringify(n))}var Vo=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),AN=[502,503,504];function ax(n){return y(this,null,function*(){var t;if(!tx(n))throw new ra(Vo(n),0);if(AN.includes(n.status))throw new ra(Vo(n),n.status);let e;try{e=yield n.json()}catch(o){throw new $n(Vo(o),o)}let i,r=rx(n);if(r&&r.getTime()>=zv["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?i=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(i=e.error_code),i){if(i==="weak_password")throw new pc(Vo(e),n.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(i==="session_not_found")throw new Hn}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((o,s)=>o&&typeof s=="string",!0))throw new pc(Vo(e),n.status,e.weak_password.reasons);throw new tp(Vo(e),n.status||500,i)})}var RN=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),e))};function le(n,t,e,i){return y(this,null,function*(){var r;let o=Object.assign({},i?.headers);o[dc]||(o[dc]=zv["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);let s=(r=i?.query)!==null&&r!==void 0?r:{};i?.redirectTo&&(s.redirect_to=i.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",u=yield ON(n,t,e+a,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(u):{data:Object.assign({},u),error:null}})}function ON(n,t,e,i,r,o){return y(this,null,function*(){let s=RN(t,i,r,o),a;try{a=yield n(e,Object.assign({},s))}catch(u){throw console.error(u),new ra(Vo(u),0)}if(a.ok||(yield ax(a)),i?.noResolveJson)return a;try{return yield a.json()}catch(u){yield ax(u)}})}function Wn(n){var t;let e=null;PN(n)&&(e=Object.assign({},n),n.expires_at||(e.expires_at=QS(n.expires_in)));let i=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:e,user:i},error:null}}function Hv(n){let t=Wn(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((e,i)=>e&&typeof i=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ni(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function lx(n){return{data:n,error:null}}function cx(n){let{action_link:t,email_otp:e,hashed_token:i,redirect_to:r,verification_type:o}=n,s=Li(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:i,redirect_to:r,verification_type:o},u=Object.assign({},s);return{data:{properties:a,user:u},error:null}}function Wv(n){return n}function PN(n){return n.access_token&&n.refresh_token&&n.expires_in}var lp=["global","local","others"];var oa=class{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=op(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(i){return y(this,arguments,function*(t,e=lp[0]){if(lp.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${lp.join(", ")}`);try{return yield le(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ie(r))return{data:null,error:r};throw r}})}inviteUserByEmail(i){return y(this,arguments,function*(t,e={}){try{return yield le(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ni})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}})}generateLink(t){return y(this,null,function*(){try{let{options:e}=t,i=Li(t,["options"]),r=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(r.new_email=i?.newEmail,delete r.newEmail),yield le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:cx,redirectTo:e?.redirectTo})}catch(e){if(ie(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return y(this,null,function*(){try{return yield le(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ni})}catch(e){if(ie(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return y(this,null,function*(){var e,i,r,o,s,a,u;try{let f={nextPage:null,lastPage:0,total:0},h=yield le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Wv});if(h.error)throw h.error;let m=yield h.json(),b=(s=h.headers.get("x-total-count"))!==null&&s!==void 0?s:0,_=(u=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&u!==void 0?u:[];return _.length>0&&(_.forEach(w=>{let M=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(w.split(";")[1].split("=")[1]);f[`${I}Page`]=M}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(ie(f))return{data:{users:[]},error:f};throw f}})}getUserById(t){return y(this,null,function*(){jo(t);try{return yield le(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ni})}catch(e){if(ie(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,e){return y(this,null,function*(){jo(t);try{return yield le(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ni})}catch(i){if(ie(i))return{data:{user:null},error:i};throw i}})}deleteUser(t,e=!1){return y(this,null,function*(){jo(t);try{return yield le(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ni})}catch(i){if(ie(i))return{data:{user:null},error:i};throw i}})}_listFactors(t){return y(this,null,function*(){jo(t.userId);try{let{data:e,error:i}=yield le(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:e,error:i}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_deleteFactor(t){return y(this,null,function*(){jo(t.userId),jo(t.id);try{return{data:yield le(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_listOAuthClients(t){return y(this,null,function*(){var e,i,r,o,s,a,u;try{let f={nextPage:null,lastPage:0,total:0},h=yield le(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Wv});if(h.error)throw h.error;let m=yield h.json(),b=(s=h.headers.get("x-total-count"))!==null&&s!==void 0?s:0,_=(u=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&u!==void 0?u:[];return _.length>0&&(_.forEach(w=>{let M=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(w.split(";")[1].split("=")[1]);f[`${I}Page`]=M}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(ie(f))return{data:{clients:[]},error:f};throw f}})}_createOAuthClient(t){return y(this,null,function*(){try{return yield le(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_getOAuthClient(t){return y(this,null,function*(){try{return yield le(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_deleteOAuthClient(t){return y(this,null,function*(){try{return yield le(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_regenerateOAuthClientSecret(t){return y(this,null,function*(){try{return yield le(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}};function Gv(n={}){return{getItem:t=>n[t]||null,setItem:(t,e)=>{n[t]=e},removeItem:t=>{delete n[t]}}}var Uo={debug:!!(globalThis&&rp()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},mc=class extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}},cp=class extends mc{};function qv(n,t,e){return y(this,null,function*(){Uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);let i=new globalThis.AbortController;return t>0&&setTimeout(()=>{i.abort(),Uo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},r=>y(null,null,function*(){if(r){Uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return yield e()}finally{Uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(t===0)throw Uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new cp(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Uo.debug)try{let o=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}})))})}function ux(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Jv(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function dx(n){return parseInt(n,16)}function fx(n){let t=new TextEncoder().encode(n);return"0x"+Array.from(t,i=>i.toString(16).padStart(2,"0")).join("")}function px(n){var t;let{chainId:e,domain:i,expirationTime:r,issuedAt:o=new Date,nonce:s,notBefore:a,requestId:u,resources:f,scheme:h,uri:m,version:b}=n;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}let _=Jv(n.address),w=h?`${h}://${i}`:i,M=n.statement?`${n.statement}
`:"",I=`${w} wants you to sign in with your Ethereum account:
${_}

${M}`,A=`URI: ${m}
Version: ${b}
Chain ID: ${e}${s?`
Nonce: ${s}`:""}
Issued At: ${o.toISOString()}`;if(r&&(A+=`
Expiration Time: ${r.toISOString()}`),a&&(A+=`
Not Before: ${a.toISOString()}`),u&&(A+=`
Request ID: ${u}`),f){let L=`
Resources:`;for(let $ of f){if(!$||typeof $!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${$}`);L+=`
- ${$}`}A+=L}return`${I}
${A}`}Ve();var Qe=class extends Error{constructor({message:t,code:e,cause:i,name:r}){var o;super(t,{cause:i}),this.__isWebAuthnError=!0,this.name=(o=r??(i instanceof Error?i.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=e}},zo=class extends Qe{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}};function hx({error:n,options:t}){var e,i,r;let{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Qe({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((e=o.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new Qe({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Qe({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Qe({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Qe({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Qe({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return o.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Qe({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Qe({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){let s=window.location.hostname;if(Kv(s)){if(o.rp.id!==s)return new Qe({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Qe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Qe({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Qe({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Qe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function mx({error:n,options:t}){let{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Qe({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Qe({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){let i=window.location.hostname;if(Kv(i)){if(e.rpId!==i)return new Qe({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Qe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Qe({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Qe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}var Yv=class{createNewAbortSignal(){if(this.controller){let e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){let t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}},NN=new Yv;function vx(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);let{challenge:t,user:e,excludeCredentials:i}=n,r=Li(n,["challenge","user","excludeCredentials"]),o=Nr(t).buffer,s=Object.assign(Object.assign({},e),{id:Nr(e.id).buffer}),a=Object.assign(Object.assign({},r),{challenge:o,user:s});if(i&&i.length>0){a.excludeCredentials=new Array(i.length);for(let u=0;u<i.length;u++){let f=i[u];a.excludeCredentials[u]=Object.assign(Object.assign({},f),{id:Nr(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return a}function _x(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);let{challenge:t,allowCredentials:e}=n,i=Li(n,["challenge","allowCredentials"]),r=Nr(t).buffer,o=Object.assign(Object.assign({},i),{challenge:r});if(e&&e.length>0){o.allowCredentials=new Array(e.length);for(let s=0;s<e.length;s++){let a=e[s];o.allowCredentials[s]=Object.assign(Object.assign({},a),{id:Nr(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return o}function yx(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let e=n;return{id:n.id,rawId:n.id,response:{attestationObject:sr(new Uint8Array(n.response.attestationObject)),clientDataJSON:sr(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function bx(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let e=n,i=n.getClientExtensionResults(),r=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:sr(new Uint8Array(r.authenticatorData)),clientDataJSON:sr(new Uint8Array(r.clientDataJSON)),signature:sr(new Uint8Array(r.signature)),userHandle:r.userHandle?sr(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Kv(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function gx(){var n,t;return!!(an()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}function kN(n){return y(this,null,function*(){try{let t=yield navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new zo("Browser returned unexpected credential type",t)}:{data:null,error:new zo("Empty credential response",t)}}catch(t){return{data:null,error:hx({error:t,options:n})}}})}function FN(n){return y(this,null,function*(){try{let t=yield navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new zo("Browser returned unexpected credential type",t)}:{data:null,error:new zo("Empty credential response",t)}}catch(t){return{data:null,error:mx({error:t,options:n})}}})}var LN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},jN={userVerification:"preferred",hints:["security-key"]};function up(...n){let t=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),e=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),i={};for(let r of n)if(r)for(let o in r){let s=r[o];if(s!==void 0)if(Array.isArray(s))i[o]=s;else if(e(s))i[o]=s;else if(t(s)){let a=i[o];t(a)?i[o]=up(a,s):i[o]=up(s)}else i[o]=s}return i}function VN(n,t){return up(LN,n,t||{})}function UN(n,t){return up(jN,n,t||{})}var dp=class{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(t){return y(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))})}_challenge(s,a){return y(this,arguments,function*({factorId:t,webauthn:e,friendlyName:i,signal:r},o){try{let{data:u,error:f}=yield this.client.mfa.challenge({factorId:t,webauthn:e});if(!u)return{data:null,error:f};let h=r??NN.createNewAbortSignal();if(u.webauthn.type==="create"){let{user:m}=u.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${i}`),m.displayName||(m.displayName=m.name)}switch(u.webauthn.type){case"create":{let m=VN(u.webauthn.credential_options.publicKey,o?.create),{data:b,error:_}=yield kN({publicKey:m,signal:h});return b?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:b}},error:null}:{data:null,error:_}}case"request":{let m=UN(u.webauthn.credential_options.publicKey,o?.request),{data:b,error:_}=yield FN(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:m,signal:h}));return b?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:b}},error:null}:{data:null,error:_}}}}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new $n("Unexpected error in challenge",u)}}})}_verify(r){return y(this,arguments,function*({challengeId:t,factorId:e,webauthn:i}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:i})})}_authenticate(s,a){return y(this,arguments,function*({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r}},o){if(!e)return{data:null,error:new Pr("rpId is required for WebAuthn authentication")};try{if(!gx())return{data:null,error:new $n("Browser does not support WebAuthn",null)};let{data:u,error:f}=yield this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:i},signal:r},{request:o});if(!u)return{data:null,error:f};let{webauthn:h}=u;return this._verify({factorId:t,challengeId:u.challengeId,webauthn:{type:h.type,rpId:e,rpOrigins:i,credential_response:h.credential_response}})}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new $n("Unexpected error in authenticate",u)}}})}_register(s,a){return y(this,arguments,function*({friendlyName:t,rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r},o){if(!e)return{data:null,error:new Pr("rpId is required for WebAuthn registration")};try{if(!gx())return{data:null,error:new $n("Browser does not support WebAuthn",null)};let{data:u,error:f}=yield this._enroll({friendlyName:t});if(!u)return yield this.client.mfa.listFactors().then(b=>{var _;return(_=b.data)===null||_===void 0?void 0:_.all.find(w=>w.factor_type==="webauthn"&&w.friendly_name===t&&w.status!=="unverified")}).then(b=>b?this.client.mfa.unenroll({factorId:b?.id}):void 0),{data:null,error:f};let{data:h,error:m}=yield this._challenge({factorId:u.id,friendlyName:u.friendly_name,webauthn:{rpId:e,rpOrigins:i},signal:r},{create:o});return h?this._verify({factorId:u.id,challengeId:h.challengeId,webauthn:{rpId:e,rpOrigins:i,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:m}}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new $n("Unexpected error in register",u)}}})}};ux();var zN={url:US,storageKey:zS,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:BS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function wx(n,t,e){return y(this,null,function*(){return yield e()})}var sa={},BN=(()=>{class n{get jwks(){var e,i;return(i=(e=sa[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(e){sa[this.storageKey]=Object.assign(Object.assign({},sa[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,i;return(i=(e=sa[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){sa[this.storageKey]=Object.assign(Object.assign({},sa[this.storageKey]),{cachedAt:e})}constructor(e){var i,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=n.nextInstanceID,n.nextInstanceID+=1,this.instanceID>0&&an()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let o=Object.assign(Object.assign({},zN),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new oa({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=op(o.fetch),this.lock=o.lock||wx,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:an()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=qv:this.lock=wx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new dp(this)},this.persistSession?(o.storage?this.storage=o.storage:rp()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Gv(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Gv(this.memoryStorage)),an()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",s=>y(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Qf}) ${new Date().toISOString()}`,...e),this}initialize(){return y(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=y(this,null,function*(){return yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return y(this,null,function*(){var e;try{let i=ex(window.location.href),r="none";if(this._isImplicitGrantCallback(i)?r="implicit":(yield this._isPKCECallback(i))&&(r="pkce"),an()&&this.detectSessionInUrl&&r!=="none"){let{data:o,error:s}=yield this._getSessionFromURL(i,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),qS(s)){let f=(e=s.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:s}}return yield this._removeSession(),{error:s}}let{session:a,redirectType:u}=o;return this._debug("#_initialize()","detected session in URL",a,"redirect type",u),yield this._saveSession(a),setTimeout(()=>y(this,null,function*(){u==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",a):yield this._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(i){return ie(i)?{error:i}:{error:new $n("Unexpected error during initialization",i)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return y(this,null,function*(){var i,r,o;try{let s=yield le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(i=e?.options)===null||i===void 0?void 0:i.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Wn}),{data:a,error:u}=s;if(u||!a)return{data:{user:null,session:null},error:u};let f=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(s){if(ie(s))return{data:{user:null,session:null},error:s};throw s}})}signUp(e){return y(this,null,function*(){var i,r,o;try{let s;if("email"in e){let{email:m,password:b,options:_}=e,w=null,M=null;this.flowType==="pkce"&&([w,M]=yield Lo(this.storage,this.storageKey)),s=yield le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:_?.emailRedirectTo,body:{email:m,password:b,data:(i=_?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:_?.captchaToken},code_challenge:w,code_challenge_method:M},xform:Wn})}else if("phone"in e){let{phone:m,password:b,options:_}=e;s=yield le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:b,data:(r=_?.data)!==null&&r!==void 0?r:{},channel:(o=_?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:_?.captchaToken}},xform:Wn})}else throw new Oo("You must provide either an email or phone number and a password");let{data:a,error:u}=s;if(u||!a)return{data:{user:null,session:null},error:u};let f=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(s){if(ie(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithPassword(e){return y(this,null,function*(){try{let i;if("email"in e){let{email:s,password:a,options:u}=e;i=yield le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Hv})}else if("phone"in e){let{phone:s,password:a,options:u}=e;i=yield le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Hv})}else throw new Oo("You must provide either an email or phone number and a password");let{data:r,error:o}=i;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new or}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithOAuth(e){return y(this,null,function*(){var i,r,o,s;return yield this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})})}exchangeCodeForSession(e){return y(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>y(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return y(this,null,function*(){let{chain:i}=e;switch(i){case"ethereum":return yield this.signInWithEthereum(e);case"solana":return yield this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}})}signInWithEthereum(e){return y(this,null,function*(){var i,r,o,s,a,u,f,h,m,b,_;let w,M;if("message"in e)w=e.message,M=e.signature;else{let{chain:I,wallet:A,statement:L,options:$}=e,j;if(an())if(typeof A=="object")j=A;else{let ot=window;if("ethereum"in ot&&typeof ot.ethereum=="object"&&"request"in ot.ethereum&&typeof ot.ethereum.request=="function")j=ot.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!$?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=A}let se=new URL((i=$?.url)!==null&&i!==void 0?i:window.location.href),je=yield j.request({method:"eth_requestAccounts"}).then(ot=>ot).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!je||je.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let F=Jv(je[0]),Q=(r=$?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!Q){let ot=yield j.request({method:"eth_chainId"});Q=dx(ot)}let Ie={domain:se.host,address:F,statement:L,uri:se.href,version:"1",chainId:Q,nonce:(o=$?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(a=(s=$?.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(u=$?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(f=$?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(h=$?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(m=$?.signInWithEthereum)===null||m===void 0?void 0:m.resources};w=px(Ie),M=yield j.request({method:"personal_sign",params:[fx(w),F]})}try{let{data:I,error:A}=yield le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:M},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:Wn});if(A)throw A;return!I||!I.session||!I.user?{data:{user:null,session:null},error:new or}:(I.session&&(yield this._saveSession(I.session),yield this._notifyAllSubscribers("SIGNED_IN",I.session)),{data:Object.assign({},I),error:A})}catch(I){if(ie(I))return{data:{user:null,session:null},error:I};throw I}})}signInWithSolana(e){return y(this,null,function*(){var i,r,o,s,a,u,f,h,m,b,_,w;let M,I;if("message"in e)M=e.message,I=e.signature;else{let{chain:A,wallet:L,statement:$,options:j}=e,se;if(an())if(typeof L=="object")se=L;else{let F=window;if("solana"in F&&typeof F.solana=="object"&&("signIn"in F.solana&&typeof F.solana.signIn=="function"||"signMessage"in F.solana&&typeof F.solana.signMessage=="function"))se=F.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof L!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");se=L}let je=new URL((i=j?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in se&&se.signIn){let F=yield se.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j?.signInWithSolana),{version:"1",domain:je.host,uri:je.href}),$?{statement:$}:null)),Q;if(Array.isArray(F)&&F[0]&&typeof F[0]=="object")Q=F[0];else if(F&&typeof F=="object"&&"signedMessage"in F&&"signature"in F)Q=F;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Q&&"signature"in Q&&(typeof Q.signedMessage=="string"||Q.signedMessage instanceof Uint8Array)&&Q.signature instanceof Uint8Array)M=typeof Q.signedMessage=="string"?Q.signedMessage:new TextDecoder().decode(Q.signedMessage),I=Q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in se)||typeof se.signMessage!="function"||!("publicKey"in se)||typeof se!="object"||!se.publicKey||!("toBase58"in se.publicKey)||typeof se.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");M=[`${je.host} wants you to sign in with your Solana account:`,se.publicKey.toBase58(),...$?["",$,""]:[""],"Version: 1",`URI: ${je.href}`,`Issued At: ${(o=(r=j?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=j?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((a=j?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((u=j?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((f=j?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((h=j?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((b=(m=j?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||b===void 0)&&b.length?["Resources",...j.signInWithSolana.resources.map(Q=>`- ${Q}`)]:[]].join(`
`);let F=yield se.signMessage(new TextEncoder().encode(M),"utf8");if(!F||!(F instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");I=F}}try{let{data:A,error:L}=yield le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:M,signature:sr(I)},!((_=e.options)===null||_===void 0)&&_.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Wn});if(L)throw L;return!A||!A.session||!A.user?{data:{user:null,session:null},error:new or}:(A.session&&(yield this._saveSession(A.session),yield this._notifyAllSubscribers("SIGNED_IN",A.session)),{data:Object.assign({},A),error:L})}catch(A){if(ie(A))return{data:{user:null,session:null},error:A};throw A}})}_exchangeCodeForSession(e){return y(this,null,function*(){let i=yield kr(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(i??"").split("/");try{let{data:s,error:a}=yield le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Wn});if(yield ar(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new or}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:a})}catch(s){if(ie(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}})}signInWithIdToken(e){return y(this,null,function*(){try{let{options:i,provider:r,token:o,access_token:s,nonce:a}=e,u=yield le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:Wn}),{data:f,error:h}=u;return h?{data:{user:null,session:null},error:h}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new or}:(f.session&&(yield this._saveSession(f.session),yield this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:h})}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithOtp(e){return y(this,null,function*(){var i,r,o,s,a;try{if("email"in e){let{email:u,options:f}=e,h=null,m=null;this.flowType==="pkce"&&([h,m]=yield Lo(this.storage,this.storageKey));let{error:b}=yield le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(i=f?.data)!==null&&i!==void 0?i:{},create_user:(r=f?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:h,code_challenge_method:m},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){let{phone:u,options:f}=e,{data:h,error:m}=yield le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(o=f?.data)!==null&&o!==void 0?o:{},create_user:(s=f?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(a=f?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:m}}throw new Oo("You must provide either an email or phone number.")}catch(u){if(ie(u))return{data:{user:null,session:null},error:u};throw u}})}verifyOtp(e){return y(this,null,function*(){var i,r;try{let o,s;"options"in e&&(o=(i=e.options)===null||i===void 0?void 0:i.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);let{data:a,error:u}=yield le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:Wn});if(u)throw u;if(!a)throw new Error("An error occurred on token verification.");let f=a.session,h=a.user;return f?.access_token&&(yield this._saveSession(f),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}})}signInWithSSO(e){return y(this,null,function*(){var i,r,o;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=yield Lo(this.storage,this.storageKey)),yield le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:lx})}catch(s){if(ie(s))return{data:null,error:s};throw s}})}reauthenticate(){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return y(this,null,function*(){try{return yield this._useSession(e=>y(this,null,function*(){let{data:{session:i},error:r}=e;if(r)throw r;if(!i)throw new Hn;let{error:o}=yield le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:o}}))}catch(e){if(ie(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return y(this,null,function*(){try{let i=`${this.url}/resend`;if("email"in e){let{email:r,type:o,options:s}=e,{error:a}=yield le(this.fetch,"POST",i,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:r,type:o,options:s}=e,{data:a,error:u}=yield le(this.fetch,"POST",i,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:u}}throw new Oo("You must provide either an email or phone number and a type")}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}getSession(){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return this._useSession(i=>y(this,null,function*(){return i}))}))})}_acquireLock(e,i){return y(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=y(this,null,function*(){return yield r,yield i()});return this.pendingInLock.push(y(this,null,function*(){try{yield o}catch{}})),o}return yield this.lock(`lock:${this.storageKey}`,e,()=>y(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let r=i();for(this.pendingInLock.push(y(this,null,function*(){try{yield r}catch{}})),yield r;this.pendingInLock.length;){let o=[...this.pendingInLock];yield Promise.all(o),this.pendingInLock.splice(0,o.length)}return yield r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return y(this,null,function*(){this._debug("#_useSession","begin");try{let i=yield this.__loadSession();return yield e(i)}finally{this._debug("#_useSession","end")}})}__loadSession(){return y(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,i=yield kr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};let r=e.expires_at?e.expires_at*1e3-Date.now()<ep:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){let a=yield kr(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=ap()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,h,m)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,h,m))})}return{data:{session:e},error:null}}let{data:o,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return y(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return y(this,null,function*(){try{return e?yield le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ni}):yield this._useSession(i=>y(this,null,function*(){var r,o,s;let{data:a,error:u}=i;if(u)throw u;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Hn}:yield le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=a.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ni})}))}catch(i){if(ie(i))return GS(i)&&(yield this._removeSession(),yield ar(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}})}updateUser(r){return y(this,arguments,function*(e,i={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._updateUser(e,i)}))})}_updateUser(r){return y(this,arguments,function*(e,i={}){try{return yield this._useSession(o=>y(this,null,function*(){let{data:s,error:a}=o;if(a)throw a;if(!s.session)throw new Hn;let u=s.session,f=null,h=null;this.flowType==="pkce"&&e.email!=null&&([f,h]=yield Lo(this.storage,this.storageKey));let{data:m,error:b}=yield le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:h}),jwt:u.access_token,xform:Ni});if(b)throw b;return u.user=m.user,yield this._saveSession(u),yield this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}}))}catch(o){if(ie(o))return{data:{user:null},error:o};throw o}})}setSession(e){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return y(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Hn;let i=Date.now()/1e3,r=i,o=!0,s=null,{payload:a}=sp(e.access_token);if(a.exp&&(r=a.exp,o=r<=i),o){let{data:u,error:f}=yield this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!u)return{data:{user:null,session:null},error:null};s=u}else{let{data:u,error:f}=yield this._getUser(e.access_token);if(f)throw f;s={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:r-i,expires_at:r},yield this._saveSession(s),yield this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(i){if(ie(i))return{data:{session:null,user:null},error:i};throw i}})}refreshSession(e){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;if(!e){let{data:a,error:u}=i;if(u)throw u;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Hn;let{data:o,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}}))}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}_getSessionFromURL(e,i){return y(this,null,function*(){try{if(!an())throw new Po("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Po(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new fc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Po("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new fc("No code detected.");let{data:$,error:j}=yield this._exchangeCodeForSession(e.code);if(j)throw j;let se=new URL(window.location.href);return se.searchParams.delete("code"),window.history.replaceState(window.history.state,"",se.toString()),{data:{session:$.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:a,expires_in:u,expires_at:f,token_type:h}=e;if(!s||!u||!a||!h)throw new Po("No session defined in URL");let m=Math.round(Date.now()/1e3),b=parseInt(u),_=m+b;f&&(_=parseInt(f));let w=_-m;w*1e3<=Ro&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${b}s`);let M=_-b;m-M>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",M,_,m):m-M<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",M,_,m);let{data:I,error:A}=yield this._getUser(s);if(A)throw A;let L={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:b,expires_at:_,refresh_token:a,token_type:h,user:I.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:e.type},error:null}}catch(r){if(ie(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return y(this,null,function*(){let i=yield kr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)})}signOut(){return y(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return y(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{error:s};let a=(r=o.session)===null||r===void 0?void 0:r.access_token;if(a){let{error:u}=yield this.admin.signOut(a,e);if(u&&!(WS(u)&&(u.status===404||u.status===401||u.status===403)))return{error:u}}return e!=="others"&&(yield this._removeSession(),yield ar(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){let i=XS(),r={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,r),y(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){this._emitInitialSession(i)}))}),{data:{subscription:r}}}_emitInitialSession(e){return y(this,null,function*(){return yield this._useSession(i=>y(this,null,function*(){var r,o;try{let{data:{session:s},error:a}=i;if(a)throw a;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}}))})}resetPasswordForEmail(r){return y(this,arguments,function*(e,i={}){let o=null,s=null;this.flowType==="pkce"&&([o,s]=yield Lo(this.storage,this.storageKey,!0));try{return yield le(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(a){if(ie(a))return{data:null,error:a};throw a}})}getUserIdentities(){return y(this,null,function*(){var e;try{let{data:i,error:r}=yield this.getUser();if(r)throw r;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(ie(i))return{data:null,error:i};throw i}})}linkIdentity(e){return y(this,null,function*(){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)})}linkIdentityOAuth(e){return y(this,null,function*(){var i;try{let{data:r,error:o}=yield this._useSession(s=>y(this,null,function*(){var a,u,f,h,m;let{data:b,error:_}=s;if(_)throw _;let w=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return yield le(this.fetch,"GET",w,{headers:this.headers,jwt:(m=(h=b.session)===null||h===void 0?void 0:h.access_token)!==null&&m!==void 0?m:void 0})}));if(o)throw o;return an()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ie(r))return{data:{provider:e.provider,url:null},error:r};throw r}})}linkIdentityIdToken(e){return y(this,null,function*(){return yield this._useSession(i=>y(this,null,function*(){var r;try{let{error:o,data:{session:s}}=i;if(o)throw o;let{options:a,provider:u,token:f,access_token:h,nonce:m}=e,b=yield le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=s?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:u,id_token:f,access_token:h,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Wn}),{data:_,error:w}=b;return w?{data:{user:null,session:null},error:w}:!_||!_.session||!_.user?{data:{user:null,session:null},error:new or}:(_.session&&(yield this._saveSession(_.session),yield this._notifyAllSubscribers("USER_UPDATED",_.session)),{data:_,error:w})}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}}))})}unlinkIdentity(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r,o;let{data:s,error:a}=i;if(a)throw a;return yield le(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return y(this,null,function*(){let i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{let r=Date.now();return yield ix(o=>y(this,null,function*(){return o>0&&(yield nx(200*Math.pow(2,o-1))),this._debug(i,"refreshing attempt",o),yield le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Wn})}),(o,s)=>{let a=200*Math.pow(2,o);return s&&np(s)&&Date.now()+a-r<Ro})}catch(r){if(this._debug(i,"error",r),ie(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(i,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,i){return y(this,null,function*(){let r=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",r),an()&&!i.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return y(this,null,function*(){var e,i;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=yield kr(this.storage,this.storageKey);if(o&&this.userStorage){let a=yield kr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:o.user},yield Fo(this.userStorage,this.storageKey+"-user",a)),o.user=(e=a?.user)!==null&&e!==void 0?e:ap()}else if(o&&!o.user&&!o.user){let a=yield kr(this.storage,this.storageKey+"-user");a&&a?.user?(o.user=a.user,yield ar(this.storage,this.storageKey+"-user"),yield Fo(this.storage,this.storageKey,o)):o.user=ap()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&(yield this._removeSession());return}let s=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<ep;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${ep}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=yield this._callRefreshToken(o.refresh_token);a&&(console.error(a),np(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),yield this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{let{data:a,error:u}=yield this._getUser(o.access_token);!u&&a?.user?(o.user=a.user,yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else yield this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return y(this,null,function*(){var i,r;if(!e)throw new Hn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new hc;let{data:s,error:a}=yield this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Hn;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let u={data:s.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(s){if(this._debug(o,"error",s),ie(s)){let a={data:null,error:s};return np(s)||(yield this._removeSession()),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}})}_notifyAllSubscribers(e,i,r=!0){return y(this,null,function*(){let o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",i,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:i});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(u=>y(this,null,function*(){try{yield u.callback(e,i)}catch(f){s.push(f)}}));if(yield Promise.all(a),s.length>0){for(let u=0;u<s.length;u+=1)console.error(s[u]);throw s[0]}}finally{this._debug(o,"end")}})}_saveSession(e){return y(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let i=Object.assign({},e),r=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&i.user&&(yield Fo(this.userStorage,this.storageKey+"-user",{user:i.user}));let o=Object.assign({},i);delete o.user;let s=$v(o);yield Fo(this.storage,this.storageKey,s)}else{let o=$v(i);yield Fo(this.storage,this.storageKey,o)}})}_removeSession(){return y(this,null,function*(){this._debug("#_removeSession()"),yield ar(this.storage,this.storageKey),yield ar(this.storage,this.storageKey+"-code-verifier"),yield ar(this.storage,this.storageKey+"-user"),this.userStorage&&(yield ar(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&an()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}_startAutoRefresh(){return y(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Ro);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>y(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return y(this,null,function*(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return y(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return y(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return y(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>y(this,null,function*(){try{let e=Date.now();try{return yield this._useSession(i=>y(this,null,function*(){let{data:{session:r}}=i;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let o=Math.floor((r.expires_at*1e3-e)/Ro);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ro}ms, refresh threshold is ${Xf} ticks`),o<=Xf&&(yield this._callRefreshToken(r.refresh_token))}))}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof mc)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return y(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!an()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>y(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return y(this,null,function*(){let i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,i,r){return y(this,null,function*(){let o=[`provider=${encodeURIComponent(i)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){let[s,a]=yield Lo(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});o.push(u.toString())}if(r?.queryParams){let s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`})}_unenroll(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;return s?{data:null,error:s}:yield le(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_enroll(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r,o;let{data:s,error:a}=i;if(a)return{data:null,error:a};let u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:f,error:h}=yield le(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&f.type==="totp"&&(!((o=f?.totp)===null||o===void 0)&&o.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_verify(e){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{data:null,error:s};let a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?yx(e.webauthn.credential_response):bx(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:f}=yield le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:f})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}}))})}_challenge(e){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{data:null,error:s};let a=yield le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;let{data:u}=a;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:vx(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:_x(u.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(i){if(ie(i))return{data:null,error:i};throw i}}))})}_challengeAndVerify(e){return y(this,null,function*(){let{data:i,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})})}_listFactors(){return y(this,null,function*(){var e;let{data:{user:i},error:r}=yield this.getUser();if(r)return{data:null,error:r};let o={all:[],phone:[],totp:[],webauthn:[]};for(let s of(e=i?.factors)!==null&&e!==void 0?e:[])o.all.push(s),s.status==="verified"&&o[s.factor_type].push(s);return{data:o,error:null}})}_getAuthenticatorAssuranceLevel(){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){return yield this._useSession(e=>y(this,null,function*(){var i,r;let{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:a}=sp(o.access_token),u=null;a.aal&&(u=a.aal);let f=u;((r=(i=o.user.factors)===null||i===void 0?void 0:i.filter(b=>b.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");let m=a.amr||[];return{data:{currentLevel:u,nextLevel:f,currentAuthenticationMethods:m},error:null}}))}))})}fetchJwk(r){return y(this,arguments,function*(e,i={keys:[]}){let o=i.keys.find(f=>f.kid===e);if(o)return o;let s=Date.now();if(o=this.jwks.keys.find(f=>f.kid===e),o&&this.jwks_cached_at+HS>s)return o;let{data:a,error:u}=yield le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=s,o=a.keys.find(f=>f.kid===e),!o)?null:o})}getClaims(r){return y(this,arguments,function*(e,i={}){try{let o=e;if(!o){let{data:M,error:I}=yield this.getSession();if(I||!M.session)return{data:null,error:I};o=M.session.access_token}let{header:s,payload:a,signature:u,raw:{header:f,payload:h}}=sp(o);i?.allowExpired||ox(a.exp);let m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(s.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!m){let{error:M}=yield this.getUser(o);if(M)throw M;return{data:{claims:a,header:s,signature:u},error:null}}let b=sx(s.alg),_=yield crypto.subtle.importKey("jwk",m,b,!0,["verify"]);if(!(yield crypto.subtle.verify(b,_,u,ZS(`${f}.${h}`))))throw new No("Invalid JWT signature");return{data:{claims:a,header:s,signature:u},error:null}}catch(o){if(ie(o))return{data:null,error:o};throw o}})}}return n.nextInstanceID=0,n})(),Zv=BN;var $N=Zv,Qv=$N;var fp=class extends Qv{constructor(t){super(t)}};var pp=class{constructor(t,e,i){var r,o,s;this.supabaseUrl=t,this.supabaseKey=e;let a=VS(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let u=`sb-${a.hostname.split(".")[0]}-auth-token`,f={db:NS,realtime:FS,auth:Object.assign(Object.assign({},kS),{storageKey:u}),global:PS},h=jS(i??{},f);this.storageKey=(r=h.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,b)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=h.auth)!==null&&s!==void 0?s:{},this.headers,h.global.fetch),this.fetch=LS(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new vS(new URL("rest/v1",a).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new cc(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Ql(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return y(this,null,function*(){var t,e;if(this.accessToken)return yield this.accessToken();let{data:i}=yield this.auth.getSession();return(e=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,userStorage:o,storageKey:s,flowType:a,lock:u,debug:f},h,m){let b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fp({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),h),storageKey:s,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,userStorage:o,flowType:a,lock:u,debug:f,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(_=>_.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new oc(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,i)=>{this._handleTokenChanged(e,"CLIENT",i?.access_token)})}_handleTokenChanged(t,e,i){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var Ex=(n,t,e)=>new pp(n,t,e);function HN(){if(typeof window<"u"||typeof process>"u")return!1;let n=process.version;if(n==null)return!1;let t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}HN()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var Xv={production:!1,supabaseUrl:"https://qgtquamtmzqvytxwlwst.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFndHF1YW10bXpxdnl0eHdsd3N0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NTU0NzMsImV4cCI6MjA3NzIzMTQ3M30.xR4HjqI1lYoFLgbZl1zJ4eLRXjM_uraIdK2l_6t2G4A"};var it=class n{supabase;constructor(){let t={getItem:e=>y(null,null,function*(){return localStorage.getItem(e)}),setItem:(e,i)=>y(null,null,function*(){localStorage.setItem(e,i)}),removeItem:e=>y(null,null,function*(){localStorage.removeItem(e)})};this.supabase=Ex(Xv.supabaseUrl,Xv.supabaseKey,{auth:{storage:t,detectSessionInUrl:!1}})}getClient(){return this.supabase}static \u0275fac=function(e){return new(e||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var ae=class n{constructor(t,e,i,r){this.http=t;this.router=e;this.supabaseService=i;this.ngZone=r;this.initializeAuth()}apiUrl="http://localhost:3000/api";currentUserSubject=new Ge(null);currentUser$=this.currentUserSubject.asObservable();isInitialized=!1;initializeAuth(){return y(this,null,function*(){if(!this.isInitialized)try{let t=this.supabaseService.getClient(),{data:{session:e}}=yield t.auth.getSession();e?.user?yield this.loadAndPublishUser(e.user.id):this.checkStoredToken(),t.auth.onAuthStateChange((i,r)=>y(this,null,function*(){this.ngZone.run(()=>y(this,null,function*(){console.log("Auth state changed:",i,r),r?.user?yield this.loadAndPublishUser(r.user.id):(this.currentUserSubject.next(null),this.clearAuthData(),this.router.url.includes("/login")||this.router.navigate(["/login"]))}))})),this.isInitialized=!0}catch(t){console.error("Error initializing auth:",t),this.clearAuthData()}})}loadAndPublishUser(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("users").select("*").eq("id",t).maybeSingle();if(r){console.error("[AuthService] load user error",r),this.ngZone.run(()=>this.currentUserSubject.next(null));return}let o=i;if(o&&!o.company_id&&o.role==="admin"){let{data:s,error:a}=yield e.from("companies").select("id").eq("admin_user_id",t).maybeSingle();if(!a&&s?.id){let{error:u}=yield e.from("users").update({company_id:s.id}).eq("id",t);u||(o=J(P({},o),{company_id:s.id}))}}o&&typeof o.company_id=="string"&&(o.company_id==="null"||o.company_id==="undefined"||o.company_id.trim()==="")&&(o=J(P({},o),{company_id:null})),this.ngZone.run(()=>{this.currentUserSubject.next(o),this.storeAuthData({user:o})})}catch(e){console.error("[AuthService] unexpected error loadAndPublishUser",e),this.ngZone.run(()=>this.currentUserSubject.next(null))}})}clearAuthData(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}register(t){return B(this.registerWithSupabase(t))}login(t,e){return y(this,null,function*(){try{let i=this.supabaseService.getClient(),{data:r,error:o}=yield i.auth.signInWithPassword({email:t,password:e});if(o)throw o;if(!r?.user)throw new Error("Login fallito: nessun user restituito");return yield this.loadAndPublishUser(r.user.id),{auth:r,user:this.currentUserSubject.value}}catch(i){throw console.error("Login error:",i),i}})}loginWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.auth.signInWithPassword({email:t.email,password:t.password});if(r)throw r;if(i.user){let{data:o,error:s}=yield e.from("users").select("*").eq("id",i.user.id).single();if(s)throw s;this.storeAuthData({token:i.session.access_token,user:o}),this.currentUserSubject.next(o)}return i})}getAuthHeaders(){let t=this.getToken();return new xi({Authorization:`Bearer ${t}`,"Content-Type":"application/json"})}logout(){return y(this,null,function*(){try{yield this.supabaseService.getClient().auth.signOut()}catch(t){console.error("Logout error:",t)}finally{this.clearAuthData(),this.ngZone.run(()=>{this.currentUserSubject.next(null),this.router.navigate(["/login"])})}})}getToken(){return localStorage.getItem("auth_token")}isAuthenticated(){return!!this.currentUserSubject.value}hasRole(t){return this.currentUserSubject.value?.role===t}storeAuthData(t){t.token&&localStorage.setItem("auth_token",t.token),t.user&&localStorage.setItem("user_data",JSON.stringify(t.user))}checkStoredToken(){let t=this.getToken(),e=localStorage.getItem("user_data");if(t&&e)try{let i=JSON.parse(e);this.ngZone.run(()=>this.currentUserSubject.next(i))}catch{this.clearAuthData()}}retryOnLock(t,e=4,i=120){return y(this,null,function*(){let r=0;for(;;)try{return yield t()}catch(o){let s=o?.name??"",a=o?.message??"";if(!(s==="NavigatorLockAcquireTimeoutError"||a.includes("NavigatorLock")||a.includes("acquire"))||r>=e-1)throw o;let f=i*Math.pow(2,r)+Math.round(Math.random()*i);yield new Promise(h=>setTimeout(h,f)),r++}})}registerAdmin(t){return B(this.registerWithSupabase(t))}registerUser(t){return B(this.registerUserWithSupabase(t))}registerWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.auth.signUp({email:t.admin.email,password:t.admin.password,options:{data:{first_name:t.admin.first_name,last_name:t.admin.last_name,role:"admin"}}});if(r)throw r;if(!i||!i.user)throw new Error("Auth provider non ha restituito user");let o=i.user.id;console.debug("[AuthService] Admin auth creato con ID:",o);try{let{error:s}=yield e.from("users").insert([{id:o,company_id:null,first_name:t.admin.first_name,last_name:t.admin.last_name,email:t.admin.email,phone:t.admin.phone,timezone:t.admin.timezone||"Europe/Rome",is_active:!0,role:"admin"}]);if(s)throw s;let{data:a,error:u}=yield e.from("companies").insert([{name:t.company.name,vat:t.company.vat,address:t.company.address,city:t.company.city,province:t.company.province,civic_number:t.company.civic_number,website:t.company.website,legal_form:t.company.legal_form,category:t.company.category,opening_hours:t.company.opening_hours,admin_user_id:o}]).select().single();if(u)throw yield e.from("users").delete().eq("id",o),u;console.debug("[AuthService] Company creata con ID:",a.id);let{error:f}=yield e.from("users").update({company_id:a.id}).eq("id",o);if(f)throw yield e.from("companies").delete().eq("id",a.id),yield e.from("users").delete().eq("id",o),f;return{user:i.user,company:a}}catch(s){throw console.error("[AuthService] Errore durante registrazione admin:",s),s}})}registerUserWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient();if(console.debug("[AuthService] registerUserWithSupabase payload:",t),!t.company_id)throw new Error("Company ID non fornito per la registrazione utente");console.debug("[AuthService] Company ID from payload:",t.company_id),console.debug("[AuthService] Saltando verifica azienda - procedo con company_id:",t.company_id);let{data:i,error:r}=yield e.auth.signUp({email:t.user.email,password:t.user.password,options:{data:{first_name:t.user.first_name,last_name:t.user.last_name,role:"employee"}}});if(r)throw console.error("[AuthService] Auth signup error:",r),r;if(!i||!i.user)throw new Error("Registrazione fallita: impossibile creare l'utente (auth returned no user)");let o=i.user.id;console.debug("[AuthService] User auth creato con ID:",o);let{error:s}=yield e.from("users").insert([{id:o,company_id:t.company_id,first_name:t.user.first_name,last_name:t.user.last_name,email:t.user.email,phone:t.user.phone,timezone:t.user.timezone||"Europe/Rome",is_active:!0,role:"employee"}]);if(s)throw console.error("[AuthService] Errore inserimento utente:",s),s.code==="23503"?new Error("Azienda non trovata nel database. Contatta l'amministratore."):s;return console.debug("[AuthService] Registrazione utente completata con successo"),{user:i.user}})}updateUserProfile(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient();try{let s=yield i.auth.getSession();console.debug("[AuthService] session user id:",s?.data?.session?.user?.id??null)}catch(s){console.debug("[AuthService] getSession failed",s)}console.debug("[AuthService] updateUserProfile patch:",e,"target userId:",t);let{data:r,error:o}=yield i.from("users").update(e).eq("id",t).select().maybeSingle();if(o)throw console.error("[AuthService] updateUserProfile error:",o),o;return r&&this.currentUserSubject.next(r),r})}hasManagerPermission(t,e){return y(this,null,function*(){let i=this.currentUserSubject.value;if(!i)return!1;if(i.role==="admin")return!0;if(i.role!=="manager")return!1;e||(e=i.company_id);try{let r=this.supabaseService.getClient(),{data:o}=yield r.from("companies").select("manager_visibility").eq("id",e).maybeSingle(),a=(o?.manager_visibility||{})[i.id]||{};switch(t){case"manage_departments":return!!a.can_manage_departments;case"view_all_employees":return!!a.can_view_all_employees;default:return!1}}catch(r){return console.error("[AuthService] hasManagerPermission error",r),!1}})}static \u0275fac=function(e){return new(e||n)(U(Di),U(De),U(it),U(Be))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function WN(n,t){if(n&1&&(c(0,"div",19),d(1),l()),n&2){let e=g();p(),R(" ",e.errorMessage," ")}}function GN(n,t){n&1&&(c(0,"span",22),d(1,"Email obbligatoria"),l())}function qN(n,t){n&1&&(c(0,"span",22),d(1,"Email non valida"),l())}function JN(n,t){if(n&1&&(c(0,"div",20),E(1,GN,2,0,"span",21)(2,qN,2,0,"span",21),l()),n&2){let e=g();p(),v("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),p(),v("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function KN(n,t){n&1&&(c(0,"span",22),d(1,"Password obbligatoria"),l())}function YN(n,t){if(n&1&&(c(0,"span",22),d(1),l()),n&2){let e=g(2);p(),R(" Minimo ",e.password==null||e.password.errors==null?null:e.password.errors.minlength.requiredLength," caratteri ")}}function ZN(n,t){if(n&1&&(c(0,"div",20),E(1,KN,2,0,"span",21)(2,YN,2,1,"span",21),l()),n&2){let e=g();p(),v("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),p(),v("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}function QN(n,t){n&1&&(c(0,"span"),d(1,"Accedi"),l())}function XN(n,t){n&1&&O(0,"div",23)}var hp=class n{constructor(t,e,i){this.fb=t;this.authService=e;this.router=i;this.loginForm=this.fb.group({email:["",[ee.required,ee.email]],password:["",[ee.required,ee.minLength(6)]]})}loginForm;isLoading=!1;errorMessage="";ngOnInit(){this.authService.isAuthenticated()&&this.router.navigate(["/home"])}onSubmit(){return y(this,null,function*(){if(this.loginForm.valid){this.isLoading=!0,this.errorMessage="";let t=this.loginForm.value;try{yield this.authService.login(t.email,t.password),this.isLoading=!1,yield this.router.navigate(["/home"])}catch(e){this.isLoading=!1,this.errorMessage=e?.message||e?.error?.message||"Errore durante il login. Riprova.",console.error("Login error:",e)}}else this.markFormGroupTouched()})}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(t=>{this.loginForm.get(t)?.markAsTouched()})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}static \u0275fac=function(e){return new(e||n)(D(Un),D(ae),D(De))};static \u0275cmp=ve({type:n,selectors:[["app-login"]],decls:31,vars:11,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","440px"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],["class","status-message error",4,"ngIf"],[1,"form-group"],[1,"form-label"],["type","email","formControlName","email","placeholder","inserisci@email.com",1,"form-input"],["class","error-messages",4,"ngIf"],["type","password","formControlName","password","placeholder","Inserisci la password",1,"form-input"],["type","submit",1,"promethea-button","outline",3,"disabled"],[4,"ngIf"],["class","loading-spinner small",4,"ngIf"],[1,"form-footer"],["routerLink","/register",1,"link"],["routerLink","/forgot-password",1,"link","text-sm"],[1,"status-message","error"],[1,"error-messages"],["class","error",4,"ngIf"],[1,"error"],[1,"loading-spinner","small"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),d(5,"Accedi alla Piattaforma"),l(),c(6,"p",5),d(7,"Inserisci le tue credenziali per accedere"),l()()(),c(8,"form",6),x("ngSubmit",function(){return i.onSubmit()}),E(9,WN,2,1,"div",7),c(10,"div",8)(11,"label",9),d(12,"Email"),l(),O(13,"input",10),E(14,JN,3,2,"div",11),l(),c(15,"div",8)(16,"label",9),d(17,"Password"),l(),O(18,"input",12),E(19,ZN,3,2,"div",11),l(),c(20,"button",13),E(21,QN,2,0,"span",14)(22,XN,1,0,"div",15),l(),c(23,"div",16)(24,"div",5),d(25," Non hai un account? "),O(26,"br"),c(27,"a",17),d(28,"Registrati"),l()(),c(29,"a",18),d(30,"Password dimenticata?"),l()()()()()),e&2&&(p(8),v("formGroup",i.loginForm),p(),v("ngIf",i.errorMessage),p(4),Ce("error",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),p(),v("ngIf",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),p(4),Ce("error",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),p(),v("ngIf",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),p(),v("disabled",i.isLoading),p(),v("ngIf",!i.isLoading),p(),v("ngIf",i.isLoading))},dependencies:[be,Se,zn,mn,Me,Oe,hn,gn,Mn,Gt],styles:[".link[_ngcontent-%COMP%]{color:var(--text-color)}.form-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:var(--gutter-sm)}"]})};var aa=class n{constructor(t){this.supabaseService=t}listByCompany(t){let e=this.supabaseService.getClient();return B(e.from("employee_invitations").select("*").eq("company_id",t).order("created_at",{ascending:!0}).then(i=>{if(i.error)throw i.error;return i.data||[]}))}addInvite(t,e,i){let r=this.supabaseService.getClient(),s={company_id:t?String(t).trim().replace(/^["']+|["']+$/g,""):null,email:(e||"").toLowerCase().trim(),invited_by:i??null,accepted:!1,token:null};return B(r.from("employee_invitations").insert([s]).select().then(a=>{if(a.error)throw a.error;return a.data&&a.data[0]?a.data[0]:null}))}removeInviteById(t){let e=this.supabaseService.getClient();return B(e.from("employee_invitations").delete().eq("id",t).then(i=>{if(i.error)throw i.error;return i}))}isEmailInvited(t,e){if(!t)return B(Promise.resolve(!1));let i=this.supabaseService.getClient();return B(i.from("employee_invitations").select("id").eq("company_id",t).ilike("email",e).limit(1).then(r=>{if(r.error)throw r.error;return r.data&&r.data.length>0}))}getInviteForEmail(t){let e=this.supabaseService.getClient(),i=(t||"").toString().trim().toLowerCase(),r=e.from("employee_invitations").select("*").ilike("email",i).eq("accepted",!1).order("created_at",{ascending:!1}).limit(1).then(o=>{if(o.error)throw o.error;let s=Array.isArray(o.data)&&o.data.length?o.data[0]:null;return s&&s.company_id&&(s.company_id=String(s.company_id).trim().replace(/^["']+|["']+$/g,"")||null),s});return B(r)}markAccepted(t){let e=this.supabaseService.getClient();return B(e.from("employee_invitations").update({accepted:!0}).eq("id",t).then(i=>{if(i.error)throw i.error;return i.data}))}static \u0275fac=function(e){return new(e||n)(U(it))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var gt=class n{constructor(t,e){this.supabaseService=t;this.authService=e}refreshSubject=new Ge(void 0);refresh$=this.refreshSubject.asObservable();getDipendenti(t,e=!1){if(!t||t==="null"||t==="undefined")return K([]);let r=this.supabaseService.getClient().from("users").select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").eq("company_id",t);e||(r=r.eq("is_active",!0));let o=r.then(s=>{if(s.error)throw s.error;return(Array.isArray(s.data)?s.data:[]).map(u=>{if(u&&u.job_title){let f=Array.isArray(u.job_title)?u.job_title[0]??null:u.job_title;u.job_title_id=f?.id??u.job_title_id??null,u.job_title=f?.name??(typeof u.job_title=="string"?u.job_title:null)}else u.job_title_id=u.job_title_id??null,u.job_title=typeof u.job_title=="string"?u.job_title:null;return u})});return B(o)}getDipendenteById(t){if(!t)return K(null);let i=this.supabaseService.getClient().from("users").select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").eq("id",t).maybeSingle().then(r=>{if(r.error)throw r.error;let o=r.data;if(o&&o.job_title){let s=Array.isArray(o.job_title)?o.job_title[0]??null:o.job_title;o.job_title_id=s?.id??o.job_title_id??null,o.job_title=s?.name??(typeof o.job_title=="string"?o.job_title:null)}else o.job_title_id=o.job_title_id??null,o.job_title=typeof o.job_title=="string"?o.job_title:null;return o});return B(i)}checkEmployeeDepartmentConflict(t,e){let r=this.supabaseService.getClient().from("users").select("department_id, department:departments(id, company_id, name, description)").eq("id",t).maybeSingle().then(o=>{if(o.error)throw o.error;let s=o.data;if(!s?.department_id)return{hasConflict:!1};if(s.department_id===e)return{hasConflict:!1};let a=s.department;return Array.isArray(a)&&(a=a[0]??null),{hasConflict:!0,currentDepartment:a||void 0}});return B(r)}canDeleteDepartment(t){let i=this.supabaseService.getClient().from("users").select("id",{count:"exact"}).eq("department_id",t).then(r=>{if(r.error)throw r.error;let o=r.count||0;return{canDelete:o===0,employeeCount:o}});return B(i)}updateUser(t,e){if(!t)return K(null);let r=this.supabaseService.getClient().from("users").update(J(P({},e),{updated_at:new Date().toISOString(),last_modified_by:this.authService?.currentUserSubject?.value?.id??null})).eq("id",t).select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").maybeSingle().then(o=>{if(o.error)throw console.error("[Dipendenti.updateUser] error",o.error),o.error;let s=o.data;if(s&&s.department&&Array.isArray(s.department)&&(s.department=s.department.length?s.department[0]:null),s&&s.job_title){let a=Array.isArray(s.job_title)?s.job_title[0]??null:s.job_title;s.job_title_id=a?.id??s.job_title_id??null,s.job_title=a?.name??(typeof s.job_title=="string"?s.job_title:null)}else s.job_title_id=s.job_title_id??null,s.job_title=typeof s.job_title=="string"?s.job_title:null;console.debug("[Dipendenti.updateUser] normalized success",s);try{this.refreshSubject.next()}catch{}return s});return B(r)}createUser(t){let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{let r={first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone??null,timezone:t.timezone??"Europe/Rome",hire_date:t.hire_date??null,company_id:t.company_id??null,is_active:!0,created_at:new Date().toISOString()};t.password&&(r.password=t.password);let o=yield e.from("users").insert([r]).select().maybeSingle();if(o.error)throw o.error;return o.data}catch(r){throw console.error("[Dipendenti.createUser] error",r),r}});return B(i)}deleteUser(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=new Date().toISOString(),{data:o,error:s}=yield e.from("users").update({is_active:!1,deleted_at:r,updated_at:r}).eq("id",t).select().maybeSingle();if(s)throw console.error("[Dipendenti.deleteUser] error",s),s;try{this.refreshSubject.next()}catch{}return o});return B(i)}restoreUser(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("users").update({is_active:!0,deleted_at:null,updated_at:new Date().toISOString()}).eq("id",t).select().maybeSingle();if(o)throw console.error("[Dipendenti.restoreUser] error",o),o;try{this.refreshSubject.next()}catch{}return r});return B(i)}static \u0275fac=function(e){return new(e||n)(U(it),U(ae))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var He=class n{constructor(t,e,i,r){this.http=t;this.authService=e;this.supabaseService=i;this.dipendentiService=r}baseUrl="/api/companies";getAziendaByAdmin(t){if(!t||t==="null"||t==="undefined")return console.warn("[CompanyService] getAziendaByAdmin called with invalid adminUserId:",t),K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{let r=yield e.from("companies").select("*").eq("admin_user_id",t).maybeSingle();return console.debug("[CompanyService.getAziendaByAdmin] supabase response",{adminUserId:t,res:r}),r?.error?(console.warn("[CompanyService] getAziendaByAdmin supabase error",r.error),null):r?.data??null}catch(r){return console.error("[CompanyService] getAziendaByAdmin unexpected",r),null}});return B(i)}getAzienda(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("companies").select("*").eq("id",t).maybeSingle();if(o)throw console.error("[CompanyService] getAzienda error",o),o;return r});return B(i)}getAziendaById(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{console.debug("[CompanyService] getAziendaById searching for:",t);let{data:r,error:o}=yield e.from("companies").select("*").eq("id",t).maybeSingle();return console.debug("[CompanyService] getAziendaById result:",{data:r,error:o}),o?(console.error("[CompanyService] getAziendaById supabase error:",o),null):r}catch(r){return console.error("[CompanyService] getAziendaById unexpected error:",r),null}});return B(i)}getAllCompanies(){let t=this.supabaseService.getClient(),e=y(this,null,function*(){try{let i=yield t.from("companies").select("*");return i?.error?(console.error("[CompanyService] getAllCompanies error",i.error),[]):i?.data||[]}catch(i){return console.error("[CompanyService] getAllCompanies unexpected",i),[]}});return B(e)}getAziendaForUser(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){try{if(e&&e!=="null"&&e!=="undefined"){let o=yield i.from("companies").select("*").eq("id",e).maybeSingle();if(!o?.error&&o?.data)return o.data}if(t){let o=yield i.from("companies").select("*").eq("admin_user_id",t).maybeSingle();if(!o?.error&&o?.data)return o.data}return null}catch(o){return console.error("[CompanyService] getAziendaForUser unexpected",o),null}});return B(r)}aggiornaAzienda(t,e){let i=this.supabaseService.getClient(),r=s=>{let a=new Set(["id","created_at","updated_at","admin_user_id"]),u={};return Object.keys(s||{}).forEach(f=>{if(a.has(f))return;let h=s[f];typeof h>"u"||(u[f]=h)}),u},o=y(this,null,function*(){try{let s=r(e);console.debug("[CompanyService] aggiornaAzienda supabase try payload:",s);let a=yield i.from("companies").update(s).eq("id",t).select().maybeSingle();if(console.debug("[CompanyService] aggiornaAzienda supabase response",a),!a?.error&&a?.data)return console.debug("[CompanyService] aggiornaAzienda supabase success",a.data),a.data;if(a?.error)throw console.error("[CompanyService] aggiornaAzienda supabase error",a.error),a.error}catch(s){throw console.error("[CompanyService] aggiornaAzienda unexpected",s,{companyId:t,payload:e}),s}});return B(o)}getDipendenti(t,e="*"){return this.dipendentiService.getDipendenti(t)}cambiaStatoDipendente(t,e){return this.dipendentiService.updateUser(t,{is_active:!!e})}eliminaDipendente(t){return this.dipendentiService.deleteUser(t)}creaDipendente(t){return this.dipendentiService.createUser({first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone??null,timezone:t.timezone??"Europe/Rome",hire_date:t.hire_date??null,company_id:t.company_id??t.company?.id??null,password:t.password??void 0})}resolveManagerConfig(t,e){if(!t||!e)return{mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_edit_employees:!1};let r=(t.manager_visibility??{})?.[e]??{};return{mode:r.mode??"self",user_ids:Array.isArray(r.user_ids)?r.user_ids:[],roles:Array.isArray(r.roles)?r.roles:[],department_ids:Array.isArray(r.department_ids)?r.department_ids:[],can_view_all_employees:!!r.can_view_all_employees,can_manage_departments:!!r.can_manage_departments,can_manage_job_titles:!!r.can_manage_job_titles,can_view_reports:!!r.can_view_reports,can_edit_employees:!!r.can_edit_employees,can_modify_timbrature:!!r.can_modify_timbrature}}filterEmployeesByVisibility(t,e,i){if(!Array.isArray(t)||t.length===0)return[];let r=this.resolveManagerConfig(e,i);if(r.can_view_all_employees)return t;switch(r.mode){case"self":return t.filter(o=>String(o.id)===String(i));case"selected_users":return t.filter(o=>r.user_ids.includes(o.id));case"roles":return t.filter(o=>o.role&&r.roles.includes(o.role));case"department":return t.filter(o=>{let s=o.department?.id??o.department_id??null;return s&&r.department_ids.includes(s)});default:return t.filter(o=>String(o.id)===String(i))}}static \u0275fac=function(e){return new(e||n)(U(Di),U(ae),U(it),U(gt))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function ek(n,t){n&1&&(c(0,"span",42),d(1,"Obbligatorio"),l())}function tk(n,t){if(n&1&&(c(0,"div",40),E(1,ek,2,0,"span",41),l()),n&2){let e=g(2);p(),v("ngIf",e.company_name==null||e.company_name.errors==null?null:e.company_name.errors.required)}}function nk(n,t){n&1&&(c(0,"span",42),d(1,"Obbligatorio"),l())}function ik(n,t){n&1&&(c(0,"span",42),d(1,"Formato non valido"),l())}function rk(n,t){if(n&1&&(c(0,"div",40),E(1,nk,2,0,"span",41)(2,ik,2,0,"span",41),l()),n&2){let e=g(2);p(),v("ngIf",e.vat==null||e.vat.errors==null?null:e.vat.errors.required),p(),v("ngIf",e.vat==null||e.vat.errors==null?null:e.vat.errors.pattern)}}function ok(n,t){if(n&1&&(c(0,"option",43),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function sk(n,t){if(n&1&&(c(0,"option",43),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function ak(n,t){if(n&1&&(c(0,"div",44)(1,"div",45),d(2),l(),O(3,"input",46),c(4,"span",5),d(5,"\u2014"),l(),O(6,"input",47),c(7,"label",48),O(8,"input",49),c(9,"span",5),d(10,"Chiuso"),l()()()),n&2){let e,i,r,o=t.$implicit,s=g(2);Ce("closed",(e=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:e.value),v("formGroupName",o.key),p(2),T(o.label),p(),si("aria-label",el("",o.label," apertura")),v("disabled",(i=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:i.value),p(3),si("aria-label",el("",o.label," chiusura")),v("disabled",(r=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:r.value),p(2),si("aria-label",el("",o.label," chiuso"))}}function lk(n,t){if(n&1&&(c(0,"div",10)(1,"h2",4)(2,"span",22),d(3,"business"),l(),d(4," Dati Azienda"),l(),c(5,"div",23)(6,"div")(7,"label",24),d(8,"Nome Azienda *"),l(),O(9,"input",25),E(10,tk,2,1,"div",15),l(),c(11,"div")(12,"label",24),d(13,"Partita IVA *"),l(),O(14,"input",26),E(15,rk,3,2,"div",15),l(),c(16,"div")(17,"label",24),d(18,"Provincia"),l(),O(19,"input",27),l(),c(20,"div")(21,"label",24),d(22,"Citt\xE0"),l(),O(23,"input",28),l(),c(24,"div")(25,"label",24),d(26,"Indirizzo"),l(),O(27,"input",29),l(),c(28,"div")(29,"label",24),d(30,"Civico"),l(),O(31,"input",30),l(),c(32,"div")(33,"label",24),d(34,"Sito web"),l(),O(35,"input",31),l(),c(36,"div")(37,"label",24),d(38,"Forma legale"),l(),c(39,"select",32)(40,"option",33),d(41,"Seleziona forma legale"),l(),E(42,ok,2,2,"option",34),l()(),c(43,"div")(44,"label",24),d(45,"Categoria"),l(),c(46,"select",35)(47,"option",33),d(48,"Seleziona categoria"),l(),E(49,sk,2,2,"option",34),l()(),c(50,"div",36)(51,"label",24),d(52,"Orari settimanali"),l(),c(53,"div",37),E(54,ak,11,12,"div",38),l(),c(55,"div",39),d(56,' Lascia vuoto open/close per i giorni chiusi oppure seleziona "Chiuso". '),l()()()()),n&2){let e=g();p(10),v("ngIf",(e.company_name==null?null:e.company_name.invalid)&&(e.company_name==null?null:e.company_name.touched)),p(5),v("ngIf",(e.vat==null?null:e.vat.invalid)&&(e.vat==null?null:e.vat.touched)),p(27),v("ngForOf",e.companyLegalForms),p(7),v("ngForOf",e.companyCategories),p(5),v("ngForOf",e.days)}}function ck(n,t){if(n&1&&(c(0,"div",10)(1,"h2",4)(2,"span",22),d(3,"person"),l(),d(4),l(),c(5,"div",23)(6,"div")(7,"label",24),d(8,"Nome *"),l(),O(9,"input",50),l(),c(10,"div")(11,"label",24),d(12,"Cognome *"),l(),O(13,"input",51),l(),c(14,"div")(15,"label",24),d(16,"Email *"),l(),O(17,"input",52),l(),c(18,"div")(19,"label",24),d(20,"Telefono *"),l(),O(21,"input",53),l(),c(22,"div")(23,"label",24),d(24,"Password *"),l(),O(25,"input",54),l(),c(26,"div")(27,"label",24),d(28,"Conferma Password *"),l(),O(29,"input",55),l()()()),n&2){let e=g();p(4),R(" ",e.mode==="admin"?"Dati Amministratore":"Dati Utente"," ")}}function uk(n,t){n&1&&(c(0,"div",40)(1,"span",42),d(2,"Devi accettare i termini"),l()())}function dk(n,t){if(n&1&&(c(0,"div",56),d(1),l()),n&2){let e=g();p(),T(e.errorMessage)}}function fk(n,t){if(n&1&&(c(0,"div",57),d(1),l()),n&2){let e=g();p(),T(e.successMessage)}}function pk(n,t){n&1&&(c(0,"span"),d(1,"Registrati"),l())}function hk(n,t){n&1&&(c(0,"span"),d(1,"Attendere\u2026"),l())}var mk=["S.r.l.","S.r.l.s.","S.p.A.","S.a.s.","S.n.c.","S.s.","Ditta Individuale","Libero Professionista"],gk=["Agricoltura","Industria","Costruzioni","Commercio","Alimentare","Trasporti","Servizi","ICT","Professioni","Altro"],mp=class n{constructor(t,e,i,r,o,s){this.fb=t;this.authService=e;this.router=i;this.route=r;this.invitiService=o;this.companyService=s;let a=this.fb.group({});this.days.forEach(u=>{a.addControl(u.key,this.fb.group({open:[""],close:[""],closed:[!1]}))}),this.registerForm=this.fb.group({company_name:["",[ee.required,ee.minLength(2)]],vat:["",[ee.required,ee.pattern(/^[0-9]{11}$/)]],address:[""],city:[""],province:[""],civic_number:[""],website:[""],legal_form:[""],category:[""],opening_hours:a,first_name:["",[ee.required,ee.minLength(2)]],last_name:["",[ee.required,ee.minLength(2)]],email:["",[ee.required,ee.email]],phone:["",[ee.required,ee.pattern(/^[0-9+\s\-()]{6,20}$/)]],birth_date:[""],birth_place:[""],fiscal_code:[""],timezone:["Europe/Rome"],is_active:[!1],hire_date:[""],password:["",[ee.required,ee.minLength(8)]],confirmPassword:["",[ee.required]],terms:[!1,[ee.requiredTrue]]},{validators:this.passwordMatchValidator})}mode="user";registerForm;isLoading=!1;errorMessage="";successMessage="";closed_days=[];weekDays=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];sub;companyLegalForms=mk;companyCategories=gk;days=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];ngOnInit(){let t=this.route.snapshot.queryParamMap.get("mode");(t==="user"||t==="admin")&&(this.mode=t),this.setMode(this.mode)}setMode(t){this.mode=t,t==="admin"?(this.registerForm.get("company_name")?.setValidators([ee.required,ee.minLength(2)]),this.registerForm.get("vat")?.setValidators([ee.required,ee.pattern(/^[0-9]{11}$/)]),this.registerForm.get("first_name")?.setValidators([ee.required,ee.minLength(2)]),this.registerForm.get("last_name")?.setValidators([ee.required,ee.minLength(2)]),this.registerForm.get("email")?.setValidators([ee.required,ee.email]),this.registerForm.get("phone")?.setValidators([ee.required,ee.pattern(/^[0-9+\s\-()]{6,20}$/)])):(this.registerForm.get("company_name")?.clearValidators(),this.registerForm.get("vat")?.clearValidators(),this.registerForm.get("first_name")?.setValidators([ee.required,ee.minLength(2)]),this.registerForm.get("last_name")?.setValidators([ee.required,ee.minLength(2)]),this.registerForm.get("email")?.setValidators([ee.required,ee.email]),this.registerForm.get("phone")?.setValidators([ee.required,ee.pattern(/^[0-9+\s\-()]{6,20}$/)])),Object.keys(this.registerForm.controls).forEach(e=>this.registerForm.get(e)?.updateValueAndValidity())}toggleClosedDay(t){let e=t.target,i=e.value;e.checked?this.closed_days.includes(i)||this.closed_days.push(i):this.closed_days=this.closed_days.filter(r=>r!==i)}passwordMatchValidator(t){let e=t.get("password")?.value,i=t.get("confirmPassword")?.value;return e&&i&&e!==i?{passwordMismatch:!0}:null}get company_name(){return this.registerForm.get("company_name")}get vat(){return this.registerForm.get("vat")}get first_name(){return this.registerForm.get("first_name")}get last_name(){return this.registerForm.get("last_name")}get email(){return this.registerForm.get("email")}get phone(){return this.registerForm.get("phone")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get terms(){return this.registerForm.get("terms")}onSubmit(){if(console.log("onSubmit invoked",{mode:this.mode,valid:this.registerForm.valid}),this.registerForm.invalid){this.registerForm.markAllAsTouched();return}this.isLoading=!0;let t=this.registerForm.value;if(this.mode==="admin"){let e={company:{name:t.company_name,vat:t.vat,address:t.address||null,city:t.city||null,province:t.province||null,civic_number:t.civic_number||null,website:t.website||null,legal_form:t.legal_form||null,category:t.category||null,opening_hours:t.opening_hours},admin:{first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone||null,birth_date:t.birth_date||null,birth_place:t.birth_place||null,fiscal_code:t.fiscal_code||null,timezone:t.timezone||"Europe/Rome",is_active:!!t.is_active,hire_date:t.hire_date||null,password:t.password}};this.sub=this.authService.registerAdmin(e).subscribe({next:i=>{this.isLoading=!1,this.successMessage="Registrazione admin completata",setTimeout(()=>this.router.navigate(["/login"]),1500)},error:i=>{this.isLoading=!1,this.errorMessage=i?.message||"Errore",console.error(i)}})}else this.isLoading=!0,this.sub=this.invitiService.getInviteForEmail(t.email).pipe(St(1),qe(e=>{if(!e)return this.isLoading=!1,this.errorMessage="La tua email non \xE8 autorizzata. Contatta l'amministratore dell'azienda.",jt;console.debug("[Register] invite found:",e);let r=(o=>{if(!o)return null;let s=String(o).trim();return s=s.replace(/^["']+|["']+$/g,""),s||null})(e.company_id);return console.debug("[Register] companyIdFromInvite:",r),r?this.completeUserRegistration(t,e,r):(this.isLoading=!1,this.errorMessage="Invito non valido: company_id mancante.",jt)})).subscribe({next:e=>{this.isLoading=!1,this.successMessage="Registrazione utente completata",setTimeout(()=>this.router.navigate(["/login"]),1500)},error:e=>{this.isLoading=!1,this.errorMessage=e?.message||"Errore durante la registrazione",console.error("Registration error:",e)}})}completeUserRegistration(t,e,i){let r={user:{first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone,password:t.password,timezone:t.timezone||"Europe/Rome"},company_id:i};return console.debug("[Register] Final payload:",r),this.authService.registerUser(r).pipe(St(1),qe(o=>this.invitiService.markAccepted(e.id).pipe(St(1),fe(()=>o))))}ngOnDestroy(){this.sub?.unsubscribe()}goToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(D(Un),D(ae),D(De),D(Wt),D(aa),D(He))};static \u0275cmp=ve({type:n,selectors:[["app-register"]],decls:36,vars:14,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","900px","margin","auto"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"section-header",2,"justify-content","center","padding","var(--gutter-md)"],["type","button",1,"promethea-button",3,"click"],["novalidate","",1,"generic-form",3,"ngSubmit","formGroup"],["class","form-section",4,"ngIf"],[1,"form-section"],[1,"form-group"],[1,"checkbox-label"],["type","checkbox","formControlName","terms",1,"checkbox-input"],["href","#",1,"link"],["class","error-messages",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","status-message info",4,"ngIf"],[1,"form-footer",2,"display","flex","justify-content","flex-end","gap","var(--gutter-sm)","margin-top","var(--gutter-md)"],["type","button",1,"promethea-button","ghost",3,"click","disabled"],["type","submit",1,"promethea-button",3,"disabled"],[4,"ngIf"],[1,"material-icons"],[1,"grid-form"],[1,"form-label"],["type","text","formControlName","company_name","placeholder","Nome azienda",1,"form-input"],["type","text","formControlName","vat","placeholder","12345678901",1,"form-input"],["type","text","formControlName","province","placeholder","MI",1,"form-input"],["type","text","formControlName","city","placeholder","Milano",1,"form-input"],["type","text","formControlName","address","placeholder","Via Roma 1",1,"form-input"],["type","text","formControlName","civic_number","placeholder","1/A",1,"form-input"],["type","url","formControlName","website","placeholder","https://esempio.it",1,"form-input"],["formControlName","legal_form",1,"form-input"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","category",1,"form-input"],[1,"form-group",2,"grid-column","1 / -1"],["formGroupName","opening_hours",2,"display","flex","flex-direction","column","gap","0.5rem"],["class","opening-row","style","display:flex; gap:0.5rem; align-items:center;",3,"formGroupName","closed",4,"ngFor","ngForOf"],[1,"text-muted",2,"font-size","0.9rem","margin-top","0.35rem"],[1,"error-messages"],["class","error",4,"ngIf"],[1,"error"],[3,"value"],[1,"opening-row",2,"display","flex","gap","0.5rem","align-items","center",3,"formGroupName"],[2,"width","110px","font-weight","600"],["type","time","formControlName","open",1,"form-input",2,"width","140px",3,"disabled","aria-label"],["type","time","formControlName","close",1,"form-input",2,"width","140px",3,"disabled","aria-label"],[1,"closed-label",2,"display","flex","align-items","center","gap","0.3rem","margin-left","0.5rem"],["type","checkbox","formControlName","closed",3,"aria-label"],["type","text","formControlName","first_name",1,"form-input"],["type","text","formControlName","last_name",1,"form-input"],["type","email","formControlName","email",1,"form-input"],["type","tel","formControlName","phone",1,"form-input"],["type","password","formControlName","password",1,"form-input"],["type","password","formControlName","confirmPassword",1,"form-input"],[1,"status-message","error"],[1,"status-message","info"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),d(5,"Crea il Tuo Account"),l(),c(6,"p",5),d(7,"Seleziona il tipo di registrazione"),l()()(),c(8,"div",6)(9,"button",7),x("click",function(){return i.setMode("admin")}),d(10,"Azienda / Admin"),l(),c(11,"button",7),x("click",function(){return i.setMode("user")}),d(12,"Dipendente"),l()(),c(13,"form",8),x("ngSubmit",function(){return i.onSubmit()}),E(14,lk,57,5,"div",9)(15,ck,30,1,"div",9),c(16,"div",10)(17,"div",11)(18,"label",12),O(19,"input",13),d(20," Accetto i "),c(21,"a",14),d(22,"Termini e Condizioni"),l(),d(23," e la "),c(24,"a",14),d(25,"Privacy"),l(),d(26," * "),l(),E(27,uk,3,0,"div",15),l()(),E(28,dk,2,1,"div",16)(29,fk,2,1,"div",17),c(30,"div",18)(31,"button",19),x("click",function(){return i.goToLogin()}),d(32,"Annulla"),l(),c(33,"button",20),E(34,pk,2,0,"span",21)(35,hk,2,0,"span",21),l()()()()()),e&2&&(p(9),Ce("active",i.mode==="admin"),p(2),Ce("active",i.mode==="user"),p(2),v("formGroup",i.registerForm),p(),v("ngIf",i.mode==="admin"),p(),v("ngIf",i.mode==="user"||i.mode==="admin"),p(12),v("ngIf",(i.terms==null?null:i.terms.invalid)&&(i.terms==null?null:i.terms.touched)),p(),v("ngIf",i.errorMessage),p(),v("ngIf",i.successMessage),p(2),v("disabled",i.isLoading),p(2),v("disabled",i.isLoading||i.registerForm.invalid),p(),v("ngIf",!i.isLoading),p(),v("ngIf",i.isLoading))},dependencies:[be,Le,Se,zn,mn,kt,Ft,Me,xo,mt,Oe,hn,gn,Mn,Js],styles:[".opening-row[_ngcontent-%COMP%]{padding:.35rem 0;align-items:center;transition:opacity .18s ease,background-color .18s ease}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{height:40px;padding:.45rem .75rem}.opening-row.closed[_ngcontent-%COMP%]{opacity:.6;pointer-events:auto;background:color-mix(in srgb,var(--background) 92%,transparent);border-radius:8px;padding-left:.5rem}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:disabled{background:color-mix(in srgb,var(--smoke-color-1) 6%,var(--background));border-color:color-mix(in srgb,var(--smoke-color-1) 45%,transparent);color:color-mix(in srgb,var(--text-color) 60%,transparent);cursor:not-allowed;box-shadow:none}.closed-label[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{font-size:.92rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);font-weight:600}@media (max-width: 640px){.opening-row[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.4rem}.opening-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{width:100%;font-size:.95rem}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{width:48%;min-width:120px}}"]})};function vk(n,t){n&1&&d(0," Email obbligatoria ")}function _k(n,t){n&1&&d(0," Inserisci un indirizzo email valido ")}function yk(n,t){if(n&1&&(c(0,"div",14),te(1,vk,1,0),te(2,_k,1,0),l()),n&2){let e,i,r=g();p(),ne(!((e=r.forgotPasswordForm.get("email"))==null||e.errors==null)&&e.errors.required?1:-1),p(),ne(!((i=r.forgotPasswordForm.get("email"))==null||i.errors==null)&&i.errors.email?2:-1)}}function bk(n,t){if(n&1&&(c(0,"div",23)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.errorMessage," ")}}function wk(n,t){if(n&1&&(c(0,"div",24)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.successMessage," ")}}function Ek(n,t){n&1&&(c(0,"span",4),d(1,"send"),l())}function Ck(n,t){n&1&&O(0,"span",28)}var gp=class n{constructor(t,e,i){this.fb=t;this.authService=e;this.router=i;this.forgotPasswordForm=this.fb.group({email:["",[ee.required,ee.email]]})}forgotPasswordForm;isLoading=!1;errorMessage="";successMessage="";ngOnInit(){}onSubmit(){return y(this,null,function*(){if(this.forgotPasswordForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=this.forgotPasswordForm.get("email")?.value;yield this.simulaInvioEmailReset(t),this.successMessage="Email di recupero inviata! Controlla la tua casella di posta.",this.forgotPasswordForm.reset(),setTimeout(()=>{this.router.navigate(["/login"])},3e3)}catch(t){console.error("Errore nel recupero password:",t),this.errorMessage=this.getErrorMessage(t)}finally{this.isLoading=!1}})}markFormGroupTouched(){Object.keys(this.forgotPasswordForm.controls).forEach(t=>{this.forgotPasswordForm.get(t)?.markAsTouched()})}simulaInvioEmailReset(t){return y(this,null,function*(){return new Promise((e,i)=>{setTimeout(()=>{Math.random()<.1?i({code:"NETWORK_ERROR",message:"Errore di connessione. Riprova pi\xF9 tardi."}):e()},1500)})})}getErrorMessage(t){return t?.code==="NETWORK_ERROR"?t.message:t?.code==="USER_NOT_FOUND"?"Nessun account trovato con questa email.":t?.code==="TOO_MANY_REQUESTS"?"Troppi tentativi. Riprova pi\xF9 tardi.":"Si \xE8 verificato un errore. Riprova pi\xF9 tardi."}hasError(t,e){let i=this.forgotPasswordForm.get(t);return i?i.hasError(e)&&i.touched:!1}static \u0275fac=function(e){return new(e||n)(D(Un),D(ae),D(De))};static \u0275cmp=ve({type:n,selectors:[["app-forgot-password"]],decls:73,vars:8,consts:[[1,"gradient-container"],[1,"form-card"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"filter-group"],[1,"form-label"],["type","email","formControlName","email","placeholder","inserisci la tua email","autocomplete","email"],[1,"error"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-content"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],[1,"status-message","error"],[1,"status-message","info"],[1,"form-actions"],["type","button","routerLink","/login",1,"promethea-button","ghost"],["type","submit",1,"promethea-button",3,"disabled"],[1,"loading-spinner"],[1,"form-footer"],["routerLink","/support",1,"link"]],template:function(e,i){if(e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5,"key"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Recupera Password"),l(),c(9,"p",7),d(10,"Inserisci la tua email per reimpostare la password"),l()()(),c(11,"form",8),x("ngSubmit",function(){return i.onSubmit()}),c(12,"div",9)(13,"h2",6)(14,"span",4),d(15,"email"),l(),d(16," Informazioni Account "),l(),c(17,"div",10)(18,"div",11)(19,"label",12)(20,"span",4),d(21,"alternate_email"),l(),d(22," Email * "),l(),O(23,"input",13),te(24,yk,3,2,"div",14),l()()(),c(25,"div",9)(26,"div",15)(27,"div",16)(28,"span",4),d(29,"info"),l(),c(30,"h3",17),d(31,"Cosa succede dopo?"),l()(),c(32,"div",18)(33,"div",19)(34,"span",4),d(35,"send"),l(),c(36,"div",20)(37,"span",21),d(38,"Invio email"),l(),c(39,"span",22),d(40,"Riceverai un link per reimpostare la password"),l()()(),c(41,"div",19)(42,"span",4),d(43,"schedule"),l(),c(44,"div",20)(45,"span",21),d(46,"Validit\xE0"),l(),c(47,"span",22),d(48,"Il link scade dopo 24 ore"),l()()(),c(49,"div",19)(50,"span",4),d(51,"security"),l(),c(52,"div",20)(53,"span",21),d(54,"Sicurezza"),l(),c(55,"span",22),d(56,"Il link \xE8 personale e sicuro"),l()()()()()(),te(57,bk,4,1,"div",23),te(58,wk,4,1,"div",24),c(59,"div",25)(60,"button",26)(61,"span",4),d(62,"arrow_back"),l(),d(63," Torna al Login "),l(),c(64,"button",27),te(65,Ek,2,0,"span",4),te(66,Ck,1,0,"span",28),d(67),l()(),c(68,"div",29)(69,"p",7),d(70," Problemi? "),c(71,"a",30),d(72,"Contatta il supporto"),l()()()()()()),e&2){let r;p(11),v("formGroup",i.forgotPasswordForm),p(13),ne((r=i.forgotPasswordForm.get("email"))!=null&&r.invalid&&((r=i.forgotPasswordForm.get("email"))!=null&&r.touched)?24:-1),p(33),ne(i.errorMessage?57:-1),p(),ne(i.successMessage?58:-1),p(6),v("disabled",i.forgotPasswordForm.invalid||i.isLoading),p(),ne(i.isLoading?-1:65),p(),ne(i.isLoading?66:-1),p(),R(" ",i.isLoading?"Invio in corso...":"Invia Link di Reset"," ")}},dependencies:[be,zn,mn,Me,Oe,hn,gn,Mn,Ut,Gt],styles:["[_nghost-%COMP%]{display:block;width:100%}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{max-width:95%!important;padding:var(--gutter-lg)!important}.form-actions[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}.form-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})};var Gn=class n{message="";fullScreen=!0;size="64px";get style(){return{"--spinner-size":this.size}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=ve({type:n,selectors:[["app-loading-spinner"]],inputs:{message:"message",fullScreen:"fullScreen",size:"size"},decls:7,vars:4,consts:[["role","status","aria-live","polite","aria-busy","true",1,"spinner-overlay"],[1,"spinner-wrap",3,"ngStyle"],["aria-hidden","true",1,"loading-spinner"],[1,"spinner-message"],[1,"visually-hidden"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1),O(2,"div",2),c(3,"div",3),d(4),l(),c(5,"span",4),d(6,"Caricamento in corso"),l()()()),e&2&&(Ce("fullscreen",i.fullScreen),p(),v("ngStyle",i.style),p(3),T(i.message||"Caricamento in corso..."))},dependencies:[be,ul],styles:[".spinner-overlay[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--gutter-lg);width:100%;box-sizing:border-box;pointer-events:none}.spinner-overlay.fullscreen[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;background:var(--background);pointer-events:auto}.spinner-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:calc(var(--gutter-sm) / 2);padding:calc(var(--gutter-sm));border-radius:12px;background:transparent}.visually-hidden[_ngcontent-%COMP%]{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}.loading-spinner[_ngcontent-%COMP%]{min-width:48px;min-height:48px;width:var(--fs-xl);height:var(--fs-xl);border-radius:50%;border:6px solid color-mix(in srgb,var(--muted) 25%,transparent);border-top-color:var(--primary-color, #1976d2);box-sizing:border-box;animation:_ngcontent-%COMP%_spinner-rotate .9s linear infinite}.spinner-message[_ngcontent-%COMP%]{margin-top:8px;color:var(--text-muted);opacity:.95;text-align:center;max-width:min(320px,80vw);white-space:normal;line-height:1.2;font-weight:700;font-style:italic}@keyframes _ngcontent-%COMP%_spinner-rotate{to{transform:rotate(360deg)}}"]})};var vt=class n{constructor(t,e,i){this.http=t;this.authService=e;this.supabaseService=i}timbrature=Ze([]);base="/api/timbrature";pendingRequestsSubject=new Ge(0);pendingRequests$=this.pendingRequestsSubject.asObservable();fetchTimbrature(){return y(this,arguments,function*(t={}){try{let e=this.supabaseService.getClient(),i=t.select??"*, user:users(id,first_name,last_name,role)",r=e.from("timbrature").select(i);if(t.userId&&(r=r.eq("user_id",t.userId)),t.companyId&&(r=r.eq("company_id",t.companyId)),t.deleted===!0?r=r.eq("deleted",!0):r=r.eq("deleted",!1),t.date){let a=new Date(t.date);a.setHours(0,0,0,0);let u=new Date(a);u.setDate(u.getDate()+1),r=r.gte("start_ts",a.toISOString()).lt("start_ts",u.toISOString())}else if(t.from&&(r=r.gte("start_ts",t.from.toISOString())),t.to){let a=new Date(t.to);a.setDate(a.getDate()+1),r=r.lt("start_ts",a.toISOString())}r=r.order("start_ts",{ascending:!!t.orderAsc}),t.limit&&(r=r.limit(t.limit));let{data:o,error:s}=yield r;if(s)throw console.error("[TimbratureService] fetchTimbrature error",s),s;return o??[]}catch(e){throw console.error("[TimbratureService] fetchTimbrature unexpected",e),e}})}getRecent(t=10){let e=this.authService.getAuthHeaders();return this.http.get(`${this.base}?limit=${t}`,{headers:e})}approve(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.base}/${t}/approve`,{},{headers:e})}punchIn(){let t=this.authService.getAuthHeaders();return this.http.post(`${this.base}/punch-in`,{},{headers:t})}punchOut(){let t=this.authService.getAuthHeaders();return this.http.post(`${this.base}/punch-out`,{},{headers:t})}eliminaTimbratura(t){let e=this.authService.getAuthHeaders();return this.http.delete(`${this.base}/${t}`,{headers:e})}getTimbraturaBId(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("timbrature").select("*, user:users(id,first_name,last_name,role)").eq("id",t).maybeSingle();if(r)throw console.error("[TimbratureService] getTimbraturaBId error",r),r;return i}catch(e){throw console.error("[TimbratureService] getTimbraturaBId unexpected",e),e}})}aggiornaTimbratura(t,e){return y(this,null,function*(){try{let i=this.supabaseService.getClient(),{data:r,error:o}=yield i.from("timbrature").update(e).eq("id",t).select().maybeSingle();if(o)throw console.error("[TimbratureService] aggiornaTimbratura error",o),o;return r}catch(i){throw console.error("[TimbratureService] aggiornaTimbratura unexpected",i),i}})}creaTimbraturaSupabase(t){return y(this,null,function*(){return this.creaTimbratura(t)})}getTimbraturePerGiorno(t,e){return e.filter(i=>{let r=new Date(i.start_ts);return this.isStessoGiorno(r,t)})}isStessoGiorno(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}formattaOrarioTimbratura(t){let e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null,r=e.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});if(i){let o=i.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),s=t.total_minutes||Math.round((i.getTime()-e.getTime())/(1e3*60)),a=Math.floor(s/60),u=s%60;return`${r} - ${o} (${a}h ${u}m)`}else return`${r} - In corso`}getColoreTimbratura(t){return t.end_ts?"var(--primary)":"#ef4444"}getTimbratureUtente(t){return y(this,null,function*(){return this.fetchTimbrature({userId:t,orderAsc:!1})})}getTimbratureAzienda(t){return y(this,null,function*(){return this.fetchTimbrature({companyId:t,orderAsc:!1})})}creaTimbratura(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("timbrature").insert(t).select().maybeSingle();if(r)throw console.error("[TimbratureService] creaTimbratura error",r),r;return i}catch(e){throw console.error("[TimbratureService] creaTimbratura unexpected",e),e}})}getTimbraturePerCalendario(){return y(this,null,function*(){return this.fetchTimbrature({orderAsc:!1})})}hasTimbraturaPerGiorno(t,e,i){return y(this,null,function*(){if(!t||!e)return!1;let r=typeof e=="string"?new Date(e):new Date(e);r.setHours(0,0,0,0);let o=new Date(r);o.setDate(o.getDate()+1);try{let s=this.supabaseService.getClient();console.debug("[TimbratureService] hasTimbraturaPerGiorno check",{userId:t,targetISO:r.toISOString(),nextISO:o.toISOString(),excludeId:i});let a=s.from("timbrature").select("id, start_ts, deleted").eq("user_id",t).eq("deleted",!1).gte("start_ts",r.toISOString()).lt("start_ts",o.toISOString()).limit(1),{data:u,error:f}=yield a;if(f)return console.error("[TimbratureService] hasTimbraturaPerGiorno error",f),!1;if(console.debug("[TimbratureService] hasTimbraturaPerGiorno result",{found:u}),!u||Array.isArray(u)&&u.length===0)return!1;let h=Array.isArray(u)?u[0]?.id:u?.id;return!(!h||i&&h===i)}catch(s){return console.error("[TimbratureService] hasTimbraturaPerGiorno unexpected",s),!1}})}getDeletedTimbrature(t){return y(this,null,function*(){return this.fetchTimbrature({userId:t??void 0,deleted:!0,orderAsc:!1})})}softDeleteTimbratura(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient(),{error:r}=yield i.from("timbrature").update({deleted:!0,deleted_at:new Date().toISOString(),deleted_by:e??null}).eq("id",t);if(r)throw console.error("[TimbratureService] softDeleteTimbratura error",r),r})}restoreTimbratura(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{error:i}=yield e.from("timbrature").update({deleted:!1,deleted_at:null,deleted_by:null}).eq("id",t);if(i)throw console.error("[TimbratureService] restoreTimbratura error",i),i})}getRichiesteModifica(t,e){return y(this,null,function*(){try{let r=this.supabaseService.getClient().from("richieste_modifica_timbrature").select("*, timbratura:timbrature(id, start_ts, total_minutes, user_id), user:users(id,first_name,last_name,email)").order("created_at",{ascending:!1});t&&(r=r.eq("company_id",t)),e&&(r=r.eq("status",e));let{data:o,error:s}=yield r;if(s)throw console.error("[TimbratureService] getRichiesteModifica error",s),s;return o??[]}catch(i){throw console.error("[TimbratureService] getRichiesteModifica unexpected",i),i}})}aggiornaRichiestaModifica(t,e,i,r=!1){return y(this,null,function*(){try{let o=this.supabaseService.getClient();if(e==="approved"&&r){let{data:u,error:f}=yield o.from("richieste_modifica_timbrature").select("*").eq("id",t).maybeSingle();if(f)throw f;if(u&&u.timbratura_id&&u.requested_changes){let{error:h}=yield o.from("timbrature").update(u.requested_changes).eq("id",u.timbratura_id);if(h)throw h}}let{data:s,error:a}=yield o.from("richieste_modifica_timbrature").update({status:e,admin_response:i??null,updated_at:new Date().toISOString()}).eq("id",t).select().maybeSingle();if(a)throw console.error("[TimbratureService] aggiornaRichiestaModifica error",a),a;try{let u=s?.company_id??null;yield this.updatePendingModificationCount(u)}catch(u){console.warn("[TimbratureService] updatePendingModificationCount after aggiornaRichiestaModifica failed",u)}return s}catch(o){throw console.error("[TimbratureService] aggiornaRichiestaModifica unexpected",o),o}})}creaRichiestaModifica(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("richieste_modifica_timbrature").insert({timbratura_id:t.timbratura_id,user_id:t.user_id,company_id:t.company_id,requested_changes:t.requested_changes,original_data:t.original_data??null,reason:t.reason??null,status:"pending"}).select().maybeSingle();if(r)throw console.error("[TimbratureService] creaRichiestaModifica error",r),r;return this.updatePendingModificationCount(t.company_id).catch(o=>{console.warn("[TimbratureService] updatePendingModificationCount after creaRichiestaModifica failed",o)}),i})}updatePendingModificationCount(t){return y(this,null,function*(){try{if(typeof this.getRichiesteModifica=="function"){let s=yield this.getRichiesteModifica(t??void 0,"pending"),a=Array.isArray(s)?s.length:0;return this.pendingRequestsSubject.next(a),console.debug("[TimbratureService] pendingRequests updated ->",a),a}let e=this,i=null;if(typeof e.getPendingModificationRequests=="function")i=e.getPendingModificationRequests(t);else{let s=t?`/api/companies/${t}/timbrature/requests/pending`:"/api/timbrature/requests/pending";i=bn(this.http.get(s))}let r;i&&typeof i.subscribe=="function"?r=yield bn(i):i&&typeof i.then=="function"?r=yield i:r=i;let o=0;return Array.isArray(r)?o=r.length:r&&Array.isArray(r.data)?o=r.data.length:r&&typeof r.count=="number"?o=r.count:o=Number(r)||0,this.pendingRequestsSubject.next(Number(o)||0),console.debug("[TimbratureService] pendingRequests updated ->",o),Number(o)||0}catch(e){return console.warn("[TimbratureService] updatePendingModificationCount error",e),this.pendingRequestsSubject.next(0),0}})}startTimbratura(t){return y(this,null,function*(){let e=J(P({},t),{end_ts:null});return yield this.creaTimbratura(e)})}completeTimbratura(t,e){return y(this,null,function*(){let i=yield this.getTimbraturaBId(t);if(!i)throw new Error(`Timbratura ${t} non trovata`);if(!i.start_ts)throw new Error(`Timbratura ${t} non ha start_ts valido`);let r=new Date(i.start_ts),o=new Date(e);if(isNaN(r.getTime())||isNaN(o.getTime()))throw new Error("Timestamp non valido");let s=Math.max(0,Math.round((o.getTime()-r.getTime())/6e4)),a={end_ts:e,total_minutes:s};return yield this.aggiornaTimbratura(t,a)})}static \u0275fac=function(e){return new(e||n)(U(Di),U(ae),U(it))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function Sk(n,t){n&1&&O(0,"app-loading-spinner")}function xk(n,t){if(n&1&&(c(0,"p",10),d(1),l()),n&2){let e=g();p(),R("Benvenuto in ",e.company.name)}}function Dk(n,t){if(n&1&&(et(0),d(1),tt()),n&2){let e=g(3);p(),R(" ",e.timbratureService.formattaOrarioTimbratura(e.todaysTimbratura)," ")}}function Ik(n,t){n&1&&(c(0,"div",25),d(1,"Non presente"),l())}function Tk(n,t){if(n&1&&(et(0),E(1,Dk,2,1,"ng-container",24)(2,Ik,2,0,"ng-template",null,0,xn),tt()),n&2){let e=en(3),i=g(2);p(),v("ngIf",i.todaysTimbratura)("ngIfElse",e)}}function Mk(n,t){if(n&1&&(et(0),d(1),tt()),n&2){let e=g(2);p(),R(" ",e.getTimbratureOggi()," ")}}function Ak(n,t){if(n&1&&(c(0,"div",13)(1,"h3",14),d(2,"Dipendenti Attivi"),l(),c(3,"div",15),d(4),l(),c(5,"p",10),d(6,"Nell'azienda"),l()()),n&2){let e=g(2);p(4),T(e.getDipendentiAttivi())}}function Rk(n,t){n&1&&(c(0,"button",26)(1,"span",5),d(2,"people"),l(),d(3," Gestisci Dipendenti "),l())}function Ok(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12)(2,"div",13)(3,"h3",14),d(4,"Ore Lavorate"),l(),c(5,"div",15),d(6),Z(7,"number"),l(),c(8,"p",10),d(9),l()(),c(10,"div",13)(11,"h3",14),d(12,"Timbrature Oggi"),l(),c(13,"div",15),E(14,Tk,4,2,"ng-container",1)(15,Mk,2,1,"ng-container",1),l(),c(16,"p",10),d(17),l()(),E(18,Ak,7,1,"div",16),c(19,"div",13)(20,"h3",14),d(21,"Stato"),l(),c(22,"div",15)(23,"span",17),d(24),l()(),c(25,"p",10),d(26,"Il tuo account"),l()()(),c(27,"div",18)(28,"h2",7)(29,"span",5),d(30,"flash_on"),l(),d(31," Azioni Rapide "),l(),c(32,"div",19)(33,"button",20),x("click",function(){C(e);let r=g();return S(r.nuovaTimbraturaWithCheck())}),c(34,"span",5),d(35,"add_circle"),l(),d(36," Nuova Timbratura "),l(),c(37,"button",21)(38,"span",5),d(39,"list"),l(),d(40," Vedi Timbrature "),l(),c(41,"button",22)(42,"span",5),d(43,"settings"),l(),d(44," Impostazioni "),l(),E(45,Rk,4,0,"button",23),l()()()}if(n&2){let e=g();p(6),R("",X(7,10,e.getOreLavorateMese(),"1.1-1"),"h"),p(3),R(" ",(e.currentUser==null?null:e.currentUser.role)==="employee"?"Tue ore questo mese":"Totale ore questo mese"," "),p(5),v("ngIf",(e.currentUser==null?null:e.currentUser.role)==="employee"),p(),v("ngIf",e.currentUser&&e.currentUser.role!=="employee"),p(2),R(" ",(e.currentUser==null?null:e.currentUser.role)==="employee"?"La tua timbratura di oggi":"Timbrature odierne nell'azienda"," "),p(),v("ngIf",e.hasRole("admin")||e.hasRole("manager")),p(5),Cr(e.currentUser!=null&&e.currentUser.is_active?"active":"inactive"),p(),R(" ",e.currentUser!=null&&e.currentUser.is_active?"Attivo":"Inattivo"," "),p(21),v("ngIf",e.hasRole("admin"))}}var vp=class n{constructor(t,e,i,r){this.authService=t;this.companyService=e;this.timbratureService=i;this.router=r}currentUser=null;company=null;timbrature=[];todaysTimbratura=null;dipendenti=[];isLoading=!0;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&this.caricaDatiHome(t.company_id)})}caricaDatiHome(t){return y(this,null,function*(){this.isLoading=!0;try{this.companyService.getAzienda(t).subscribe({next:e=>{this.company=e},error:e=>{console.error("Errore nel caricamento dati azienda:",e)}}),this.currentUser&&(this.currentUser.role==="employee"?this.timbrature=yield this.timbratureService.getTimbratureUtente(this.currentUser.id):this.currentUser.role==="admin"?this.timbrature=yield this.timbratureService.getTimbratureAzienda(t):this.currentUser.role==="manager"&&(this.timbrature=yield this.timbratureService.getTimbratureUtente(this.currentUser.id)),this.updateTodayTimbratura()),this.hasRole("admin")||this.hasRole("manager")?this.companyService.getDipendenti(t).subscribe({next:e=>{this.dipendenti=e,this.isLoading=!1},error:e=>{console.error("Errore nel caricamento dipendenti:",e),this.isLoading=!1}}):this.isLoading=!1}catch(e){console.error("Errore nel caricamento dati home:",e),this.isLoading=!1}})}hasRole(t){return this.authService.hasRole(t)}getOreLavorateSettimana(){if(!this.timbrature||this.timbrature.length===0)return 0;let{inizioSettimana:t,oggi:e}=this.getIntervaloSettimanaCorrente(),i=this.timbrature.filter(s=>{if(!s.end_ts)return!1;let a=new Date(s.start_ts);return a>=t&&a<=e}),r=i;return this.currentUser?.role==="employee"&&(r=i.filter(s=>s.user_id===this.currentUser?.id)),r.reduce((s,a)=>s+(a.total_minutes||0),0)/60}getTimbratureOggi(){if(!this.timbrature||this.timbrature.length===0)return 0;let t=new Date;t.setHours(0,0,0,0);let e=new Date(t);e.setDate(e.getDate()+1);let i=this.timbrature.filter(r=>{let o=new Date(r.start_ts);return o>=t&&o<e});return this.currentUser?.role==="employee"?i.filter(r=>r.user_id===this.currentUser?.id).length:i.length}getDipendentiAttivi(){return this.dipendenti.filter(t=>t.is_active).length}getIntervaloSettimanaCorrente(){let t=new Date;t.setHours(23,59,59,999);let e=t.getDay(),i=e===0?6:e-1,r=new Date(t);return r.setDate(t.getDate()-i),r.setHours(0,0,0,0),{inizioSettimana:r,oggi:t}}nuovaTimbraturaWithCheck(){return y(this,null,function*(){try{if(!this.currentUser){this.router.navigate(["/crea-timbratura"]);return}let t=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1);let r=t.find(o=>{let s=new Date(o.start_ts);return s>=e&&s<i});if(r){let o=new Date(r.start_ts).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});window.confirm(`\xC8 gi\xE0 presente una timbratura in data di oggi con ingresso alle ${o}.
Vuoi modificarla?`)&&this.router.navigate(["/crea-timbratura"],{queryParams:{edit:r.id,mode:"edit"}})}else this.router.navigate(["/crea-timbratura"])}catch(t){console.error("[Home] nuovaTimbraturaWithCheck error",t),this.router.navigate(["/crea-timbratura"])}})}updateTodayTimbratura(){if(this.todaysTimbratura=null,!this.currentUser||!this.timbrature||!this.timbrature.length)return;let t=new Date;t.setHours(0,0,0,0);let e=new Date(t);e.setDate(t.getDate()+1);let i=this.timbrature.find(r=>{if(!r?.start_ts)return!1;let o=new Date(r.start_ts);return o>=t&&o<e&&(this.currentUser?.role==="admin"||r.user_id===this.currentUser?.id)})||null;this.todaysTimbratura=i}getOreLavorateMese(){if(!this.timbrature||!this.timbrature.length)return 0;let t=new Date,e=t.getFullYear(),i=t.getMonth(),r=0;for(let o of this.timbrature){if(!o?.start_ts)continue;let s=new Date(o.start_ts);if(!(s.getFullYear()!==e||s.getMonth()!==i)){if(typeof o.total_minutes=="number"){r+=o.total_minutes;continue}if(o.end_ts){let a=new Date(o.end_ts),f=Math.max(0,Math.round((a.getTime()-s.getTime())/6e4)),h=o.breaks;if(Array.isArray(h)&&h.length){for(let m of h)if(typeof m=="number")f-=m;else if(typeof m?.minutes=="number")f-=m.minutes;else if(m?.start&&m?.end){let b=new Date(m.start),_=new Date(m.end);f-=Math.max(0,Math.round((_.getTime()-b.getTime())/6e4))}}r+=Math.max(0,f)}}}return r/60}static \u0275fac=function(e){return new(e||n)(D(ae),D(He),D(vt),D(De))};static \u0275cmp=ve({type:n,selectors:[["app-home"]],decls:11,vars:3,consts:[["noTimbr",""],[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],["class","text-muted",4,"ngIf"],["class","dashboard-grid",4,"ngIf"],[1,"text-muted"],[1,"dashboard-grid"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"],["class","card",4,"ngIf"],[1,"chip"],[1,"form-section"],[1,"grid-alternative"],["type","button",1,"promethea-button",3,"click"],["routerLink","/timbrature",1,"promethea-button","outline"],["routerLink","/impostazioni",1,"promethea-button","secondary"],["class","promethea-button ghost","routerLink","/dipendenti",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"muted"],["routerLink","/dipendenti",1,"promethea-button","ghost"]],template:function(e,i){e&1&&(E(0,Sk,1,0,"app-loading-spinner",1),c(1,"div",2)(2,"div",3)(3,"div",4)(4,"span",5),d(5,"dashboard"),l()(),c(6,"div",6)(7,"h1",7),d(8,"Dashboard"),l(),E(9,xk,2,1,"p",8),l()(),E(10,Ok,46,13,"div",9),l()),e&2&&(v("ngIf",i.isLoading),p(9),v("ngIf",i.company),p(),v("ngIf",!i.isLoading))},dependencies:[be,Se,Ut,Gt,Gn,tn],encapsulation:2})};function Pk(n,t){n&1&&O(0,"app-loading-spinner")}function Nk(n,t){if(n&1){let e=k();c(0,"button",31),x("click",function(){C(e);let r=g();return S(r.toggleShowDeleted())}),c(1,"span",4),d(2,"delete_outline"),l(),d(3),l()}if(n&2){let e=g();p(3),R(" ",e.showDeletedSection?"Nascondi cestino":"Timbrature cancellate ("+(e.deletedTimbrature.length||0)+")"," ")}}function kk(n,t){n&1&&(c(0,"div",32)(1,"h2",33),d(2,"Richieste di modifica timbrature"),l()())}function Fk(n,t){n&1&&(c(0,"div",34),d(1,"Nessuna richiesta di modifica in attesa."),l())}function Lk(n,t){if(n&1&&(c(0,"div")(1,"strong"),d(2),l(),c(3,"span",34),d(4),l(),c(5,"span"),d(6," \u2192 "),l(),c(7,"span"),d(8),l()()),n&2){let e=t.$implicit;p(2),R("",e.label,":"),p(2),T(e.old),p(4),T(e.newVal)}}function jk(n,t){if(n&1){let e=k();c(0,"tr")(1,"td"),d(2),l(),c(3,"td"),d(4),Z(5,"date"),l(),c(6,"td",35),E(7,Lk,9,3,"div",37),l(),c(8,"td",36)(9,"button",38),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.handleRichiestaAction(r,"approve"))}),d(10,"Approva"),l(),c(11,"button",39),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.handleRichiestaAction(r,"reject"))}),d(12,"Rifiuta"),l()()()}if(n&2){let e=t.$implicit,i=g(2);p(2),_e("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name),p(2),T(X(5,4,e.timbratura==null?null:e.timbratura.start_ts,"yyyy-MM-dd")),p(3),v("ngForOf",i.formatRequestedChanges(e))}}function Vk(n,t){if(n&1&&(c(0,"table",26)(1,"thead")(2,"tr")(3,"th"),d(4,"Utente"),l(),c(5,"th"),d(6,"Data"),l(),c(7,"th",35),d(8,"Richiesta"),l(),c(9,"th",36),d(10,"Azioni"),l()()(),c(11,"tbody"),E(12,jk,13,7,"tr",37),l()()),n&2){let e=g();p(12),v("ngForOf",e.richiesteModifica)}}function Uk(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function zk(n,t){if(n&1&&(c(0,"td")(1,"div",47)(2,"div",48),d(3),l(),c(4,"div",49)(5,"strong"),d(6),l()()()()),n&2){let e=g().$implicit,i=g();p(3),R(" ",i.getInitials(e.user==null?null:e.user.first_name,e.user==null?null:e.user.last_name)," "),p(3),_e("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name)}}function Bk(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e=g().$implicit;p(),R(" ",e.breaks.length," ")}}function $k(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function Hk(n,t){if(n&1&&(c(0,"span",50),d(1),l()),n&2){let e=g().$implicit,i=g();v("title",e.notes),p(),R(" ",i.troncaTesto(e.notes,30)," ")}}function Wk(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function Gk(n,t){n&1&&(c(0,"div",51)(1,"span",4),d(2,"hourglass_top"),l(),c(3,"span"),d(4,"La tua timbratura \xE8 in attesa di modifica"),l()())}function qk(n,t){if(n&1){let e=k();c(0,"button",52),x("click",function(r){C(e);let o=g().$implicit;return g().completaTimbratura(o),S(r.stopPropagation())}),d(1," Completa "),l()}}function Jk(n,t){if(n&1){let e=k();c(0,"button",53),x("click",function(r){C(e);let o=g().$implicit;return g().eliminaTimbratura(o),S(r.stopPropagation())}),c(1,"span",4),d(2,"delete"),l()()}}function Kk(n,t){if(n&1){let e=k();c(0,"tr",40),x("click",function(){let r=C(e).$implicit,o=g();return S(r.end_ts?o.visualizzaTimbratura(r):o.completaTimbratura(r))}),E(1,zk,7,3,"td",0),c(2,"td"),d(3),Z(4,"date"),l(),c(5,"td"),d(6),Z(7,"date"),l(),c(8,"td"),d(9),Z(10,"date"),l(),c(11,"td"),d(12),Z(13,"number"),l(),c(14,"td"),E(15,Bk,2,1,"span",0)(16,$k,2,0,"span",0),l(),c(17,"td"),E(18,Hk,2,2,"span",41)(19,Wk,2,0,"span",0),l(),c(20,"td"),E(21,Gk,5,0,"div",42),c(22,"div",43)(23,"button",44),x("click",function(r){let o=C(e).$implicit;return g().visualizzaTimbratura(o),S(r.stopPropagation())}),c(24,"span",4),d(25,"visibility"),l()(),E(26,qk,2,0,"button",45)(27,Jk,3,0,"button",46),l()()()}if(n&2){let e=t.$implicit,i=g();p(),v("ngIf",i.hasRole("admin")||i.managerViewingOthers),p(2),T(X(4,12,e.start_ts,"dd/MM/yyyy")),p(3),T(X(7,15,e.start_ts,"HH:mm")),p(3),T(e.end_ts?X(10,18,e.end_ts,"HH:mm"):"In corso..."),p(3),R("",X(13,21,e.total_minutes/60,"1.1-1"),"h"),p(3),v("ngIf",e.breaks&&e.breaks.length>0),p(),v("ngIf",!e.breaks||e.breaks.length===0),p(2),v("ngIf",e.notes),p(),v("ngIf",!e.notes),p(2),v("ngIf",(i.currentUser==null?null:i.currentUser.role)==="employee"&&(e.id?i.pendingTimbraturaIds.has(e.id):!1)),p(5),v("ngIf",!e.end_ts&&((i.currentUser==null?null:i.currentUser.role)==="admin"||(i.currentUser==null?null:i.currentUser.role)==="manager"&&i.managerCanModifyTimbrature||e.user_id===(i.currentUser==null?null:i.currentUser.id))),p(),v("ngIf",i.hasRole("admin"))}}function Yk(n,t){n&1&&(c(0,"div",54)(1,"span",4),d(2,"inbox"),l(),c(3,"h3"),d(4,"Nessuna timbratura trovata"),l(),c(5,"p"),d(6,"Non sono state trovate timbrature con i filtri attuali."),l()())}function Zk(n,t){if(n&1&&(c(0,"div",55)(1,"div",56),d(2),l()()),n&2){let e=g();p(2),_e(" Mostrando ",e.timbratureFiltrate.length," di ",e.timbrature.length," timbrature ")}}function Qk(n,t){n&1&&(c(0,"div",54)(1,"span",4),d(2,"inbox"),l(),c(3,"h3"),d(4,"Nessuna timbratura nel cestino"),l()())}function Xk(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function eF(n,t){if(n&1&&(c(0,"td"),d(1),l()),n&2){let e=g().$implicit;p(),_e("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name)}}function tF(n,t){if(n&1){let e=k();c(0,"button",58),x("click",function(r){C(e);let o=g().$implicit;return g(3).ripristinaTimbratura(o),S(r.stopPropagation())}),c(1,"span",4),d(2,"undo"),l()()}}function nF(n,t){if(n&1&&(c(0,"tr"),E(1,eF,2,2,"td",0),c(2,"td"),d(3),Z(4,"date"),l(),c(5,"td"),d(6),Z(7,"date"),l(),c(8,"td"),d(9),Z(10,"number"),l(),c(11,"td"),d(12),Z(13,"date"),l(),c(14,"td")(15,"div",43),E(16,tF,3,0,"button",57),l()()()),n&2){let e=t.$implicit,i=g(3);p(),v("ngIf",i.hasRole("admin")||i.managerViewingOthers),p(2),T(X(4,6,e.start_ts,"dd/MM/yyyy")),p(3),T(X(7,9,e.start_ts,"HH:mm")),p(3),R("",X(10,12,e.total_minutes/60,"1.1-1"),"h"),p(3),T(e.deleted_at?X(13,15,e.deleted_at,"dd/MM/yyyy HH:mm"):"-"),p(4),v("ngIf",i.hasRole("admin")||i.hasRole("manager")&&(e.user_id?i.visibleEmployeeIds.has(e.user_id):!1))}}function iF(n,t){if(n&1&&(c(0,"table",26)(1,"thead")(2,"tr"),E(3,Xk,2,0,"th",0),c(4,"th"),d(5,"Data"),l(),c(6,"th"),d(7,"Ora Inizio"),l(),c(8,"th"),d(9,"Ore Totali"),l(),c(10,"th"),d(11,"Eliminata il"),l(),c(12,"th"),d(13,"Azioni"),l()()(),c(14,"tbody"),E(15,nF,17,18,"tr",37),l()()),n&2){let e=g(2);p(3),v("ngIf",e.hasRole("admin")||e.managerViewingOthers),p(12),v("ngForOf",e.deletedTimbrature)}}function rF(n,t){if(n&1&&(c(0,"div",23)(1,"h2",6),d(2,"Timbrature cancellate"),l(),c(3,"div",24),E(4,Qk,5,0,"div",28)(5,iF,16,2,"table",25),l()()),n&2){let e=g();p(4),v("ngIf",e.deletedTimbrature.length===0),p(),v("ngIf",e.deletedTimbrature.length>0)}}var _p=class n{constructor(t,e,i,r,o){this.timbratureService=t;this.authService=e;this.companyService=i;this.dipendentiService=r;this.router=o}timbrature=[];timbratureFiltrate=[];currentUser=null;isLoading=!1;showDeletedSection=!1;deletedTimbrature=[];richiesteModifica=[];userPendingRequests=[];pendingTimbraturaIds=new Set;pendingRequestsSub;visibleEmployeeIds=new Set;managerCanModifyTimbrature=!1;managerViewingOthers=!1;filtroDataInizio="";filtroDataFine="";filtroStato="";filtroOggi=!1;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t?(this.computeManagerPermissions().then(()=>y(this,null,function*(){t.role==="manager"&&this.managerCanModifyTimbrature&&(yield this.computeVisibleEmployeesForCurrentUser()),yield this.caricaTimbrature(),t.role==="admin"||t.role==="manager"&&this.managerCanModifyTimbrature?yield this.caricaRichiesteModifica():yield this.caricaRichiesteModificaUtente()})).catch(e=>{console.warn("[ListaTimbrature] computeManagerPermissions failed",e),this.caricaTimbrature(),this.caricaRichiesteModificaUtente()}),this.pendingRequestsSub=this.timbratureService.pendingRequests$.subscribe(()=>{this.currentUser&&(this.currentUser.role==="admin"||this.currentUser.role==="manager"&&this.managerCanModifyTimbrature?this.caricaRichiesteModifica():this.caricaRichiesteModificaUtente())}),this.caricaDeletedTimbrature().catch(e=>console.warn("[ListaTimbrature] caricaDeletedTimbrature preload error",e))):(this.timbrature=[],this.timbratureFiltrate=[],this.deletedTimbrature=[])})}caricaTimbrature(){return y(this,null,function*(){if(this.currentUser){this.isLoading=!0;try{let t=[],e=this.currentUser;if(e.role==="employee")t=yield this.timbratureService.getTimbratureUtente(e.id);else if(e.role==="admin")t=yield this.timbratureService.getTimbratureAzienda(e.company_id);else if(e.role==="manager"){let i=yield this.timbratureService.getTimbraturePerCalendario();this.managerViewingOthers?this.visibleEmployeeIds&&this.visibleEmployeeIds.size>0?t=i.filter(r=>this.visibleEmployeeIds.has(String(r.user_id))):t=i:t=i.filter(r=>String(r.user_id)===String(e.id))}else t=yield this.timbratureService.getTimbratureUtente(e.id);if(this.timbrature=t||[],e.role==="manager"){let i=Array.isArray(t)&&t.some(r=>String(r.user_id)!==String(e.id));this.managerViewingOthers=this.managerViewingOthers||i}if(e.role==="manager"&&this.managerViewingOthers&&Array.isArray(this.timbrature)&&this.timbrature.some(r=>!r.user))try{let r=yield bn(this.dipendentiService.getDipendenti(e.company_id)),o=new Map((r||[]).map(s=>[String(s.id),s]));this.timbrature=(this.timbrature||[]).map(s=>{if(!s.user){let a=o.get(String(s.user_id));a&&(s.user={first_name:a.first_name,last_name:a.last_name,email:a.email})}return s})}catch(r){console.warn("[ListaTimbrature] join employees failed",r)}this.applicaFiltri()}catch(t){console.error("Errore nel caricamento delle timbrature:",t)}finally{this.isLoading=!1}}})}applicaFiltri(){let t=this.timbrature;if(this.filtroDataInizio){let e=new Date(this.filtroDataInizio);t=t.filter(i=>new Date(i.start_ts)>=e)}if(this.filtroDataFine){let e=new Date(this.filtroDataFine);e.setHours(23,59,59,999),t=t.filter(i=>new Date(i.start_ts)<=e)}if(this.filtroStato&&(this.filtroStato==="attiva"?t=t.filter(e=>!e.end_ts):this.filtroStato==="completata"&&(t=t.filter(e=>!!e.end_ts))),this.filtroOggi){let e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1),t=t.filter(r=>{let o=new Date(r.start_ts);return o>=e&&o<i})}this.timbratureFiltrate=t}filtraOggi(){this.filtroOggi=!this.filtroOggi,this.filtroOggi&&(this.filtroDataInizio="",this.filtroDataFine=""),this.applicaFiltri()}nuovaTimbraturaWithCheck(){return y(this,null,function*(){try{if(!this.currentUser){this.router.navigate(["/crea-timbratura"]);return}let t=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1);let r=t.find(o=>{let s=new Date(o.start_ts);return s>=e&&s<i});if(r){let o=new Date(r.start_ts).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});window.confirm(`\xC8 gi\xE0 presente una timbratura in data di oggi con ingresso alle ${o}.
Vuoi modificarla?`)&&this.router.navigate(["/crea-timbratura"],{queryParams:{edit:r.id,mode:"edit"}})}else this.router.navigate(["/crea-timbratura"])}catch(t){console.error("[ListaTimbrature] nuovaTimbraturaWithCheck error",t),this.router.navigate(["/crea-timbratura"])}})}visualizzaTimbratura(t){this.router.navigate(["/crea-timbratura"],{queryParams:{edit:t.id,mode:"edit"}})}troncaTesto(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}hasRole(t){return this.currentUser?.role===t}getInitials(t,e){if(!t&&!e)return"?";let i=t?.charAt(0)?.toUpperCase()||"",r=e?.charAt(0)?.toUpperCase()||"";return i+r}caricaDeletedTimbrature(){return y(this,null,function*(){if(!this.currentUser){this.deletedTimbrature=[];return}try{this.currentUser.role==="admin"?this.deletedTimbrature=yield this.timbratureService.getDeletedTimbrature():this.deletedTimbrature=yield this.timbratureService.getDeletedTimbrature(this.currentUser.id)}catch(t){console.error("[ListaTimbrature] caricaDeletedTimbrature error",t),this.deletedTimbrature=[]}})}eliminaTimbratura(t){return y(this,null,function*(){if(!(!this.currentUser||!confirm("Confermi lo spostamento della timbratura nel cestino? (potrai ripristinarla)")))try{yield this.timbratureService.softDeleteTimbratura(t.id,this.currentUser.id),yield this.caricaTimbrature(),this.showDeletedSection&&(yield this.caricaDeletedTimbrature())}catch(i){console.error("[ListaTimbrature] eliminaTimbratura error",i),alert("Errore durante lo spostamento nel cestino.")}})}ripristinaTimbratura(t){return y(this,null,function*(){if(confirm("Ripristinare la timbratura dal cestino?"))try{yield this.timbratureService.restoreTimbratura(t.id),yield this.caricaTimbrature(),yield this.caricaDeletedTimbrature()}catch(i){console.error("[ListaTimbrature] ripristinaTimbratura error",i),alert("Errore durante il ripristino.")}})}toggleShowDeleted(){this.showDeletedSection=!this.showDeletedSection,this.showDeletedSection&&this.caricaDeletedTimbrature()}caricaRichiesteModifica(){return y(this,null,function*(){try{let t=this.currentUser?.company_id,e=yield this.timbratureService.getRichiesteModifica(t,"pending");if(this.currentUser?.role==="admin"){this.richiesteModifica=e;return}if(this.currentUser?.role==="manager"&&!this.managerCanModifyTimbrature){this.richiesteModifica=e.filter(i=>String(i.user_id??i.user?.id??i.timbratura?.user_id)===String(this.currentUser.id));return}if(this.currentUser?.role==="manager"&&this.managerCanModifyTimbrature){let i=new Set(Array.from(this.visibleEmployeeIds||[]).map(String));i.size===0?this.richiesteModifica=e.filter(r=>String(r.user_id??r.user?.id??r.timbratura?.user_id)===String(this.currentUser.id)):this.richiesteModifica=e.filter(r=>i.has(String(r.user_id??r.user?.id??r.timbratura?.user_id)));return}this.richiesteModifica=e.filter(i=>String(i.user_id??i.user?.id??i.timbratura?.user_id)===String(this.currentUser?.id))}catch(t){console.error("[ListaTimbrature] caricaRichiesteModifica error",t),this.richiesteModifica=[]}})}handleRichiestaAction(t,e){return y(this,null,function*(){if(confirm(`Confermi ${e==="approve"?"approvazione":"rifiuto"} della richiesta?`))try{if(this.currentUser?.role==="manager"&&!this.managerCanModifyTimbrature){alert("Non hai i permessi per gestire le richieste di modifica.");return}e==="approve"?yield this.timbratureService.aggiornaRichiestaModifica(t.id,"approved",this.currentUser?.role==="admin"?"Approvata da admin":"Approvata da manager",!0):yield this.timbratureService.aggiornaRichiestaModifica(t.id,"rejected",this.currentUser?.role==="admin"?"Rifiutata da admin":"Rifiutata da manager",!1),yield this.caricaTimbrature(),yield this.caricaRichiesteModifica()}catch(r){console.error("[ListaTimbrature] handleRichiestaAction error",r),alert("Errore durante l'operazione")}})}formatRequestedChanges(t){let e=[];if(!t?.requested_changes)return e;let i=t.requested_changes||{},r=t.original_data||{},o=s=>s?new Date(s).toLocaleString():"\u2014";return i.start_ts!==void 0&&e.push({label:"Inizio",old:o(r.start_ts),newVal:o(i.start_ts)}),i.end_ts!==void 0&&e.push({label:"Fine",old:o(r.end_ts),newVal:o(i.end_ts)}),i.notes!==void 0&&e.push({label:"Note",old:r.notes??"\u2014",newVal:i.notes??"\u2014"}),e}caricaRichiesteModificaUtente(){return y(this,null,function*(){try{if(!this.currentUser){this.userPendingRequests=[],this.pendingTimbraturaIds.clear();return}let t=this.currentUser.company_id,e=yield this.timbratureService.getRichiesteModifica(t??void 0,"pending"),i=Array.isArray(e)?e:[];this.userPendingRequests=i.filter(r=>String(r.user_id??r.user?.id??r.timbratura?.user_id)===String(this.currentUser.id)),this.pendingTimbraturaIds=new Set(this.userPendingRequests.map(r=>String(r.timbratura_id??r.timbratura?.id??"")))}catch(t){console.error("[ListaTimbrature] caricaRichiesteModificaUtente error",t),this.userPendingRequests=[],this.pendingTimbraturaIds.clear()}})}ngOnDestroy(){this.pendingRequestsSub?.unsubscribe()}computeVisibleEmployeesForCurrentUser(){return y(this,null,function*(){if(this.visibleEmployeeIds.clear(),!(!this.currentUser||!this.currentUser.company_id)&&!this.hasRole("admin")&&this.hasRole("manager"))try{let t=this.currentUser.company_id,e=yield bn(this.dipendentiService.getDipendenti(t)),i=null;try{i=yield bn(this.companyService.getAziendaForUser(this.currentUser.id,t))}catch{i=null}(this.companyService.filterEmployeesByVisibility(e,i,String(this.currentUser.id))||[]).forEach(o=>{o?.id&&this.visibleEmployeeIds.add(String(o.id))})}catch(t){console.warn("[ListaTimbrature] computeVisibleEmployeesForCurrentUser error",t),this.visibleEmployeeIds.clear()}})}computeManagerPermissions(){return y(this,null,function*(){if(this.managerCanModifyTimbrature=!1,this.managerViewingOthers=!1,!(!this.currentUser||this.currentUser.role!=="manager"))try{let t=yield bn(this.companyService.getAziendaForUser(this.currentUser.id,this.currentUser.company_id)),e=this.companyService.resolveManagerConfig(t,String(this.currentUser.id));this.managerCanModifyTimbrature=!!e?.can_modify_timbrature;let i=e?.mode??"self",r=Array.isArray(e?.user_ids)&&e.user_ids.length>0||Array.isArray(e?.roles)&&e.roles.length>0||Array.isArray(e?.department_ids)&&e.department_ids.length>0;this.managerViewingOthers=i!=="self"||!!e?.can_view_all_employees||r}catch(t){console.warn("[ListaTimbrature] computeManagerPermissions error",t),this.managerCanModifyTimbrature=!1,this.managerViewingOthers=!1}})}completaTimbratura(t){return y(this,null,function*(){if(!t||!t.id||!this.currentUser)return;let e=String(t.user_id)===String(this.currentUser.id),i=this.currentUser.role==="admin",r=this.currentUser.role==="manager"&&this.managerCanModifyTimbrature;if(!(e||i||r)){alert("Non hai i permessi per completare questa timbratura.");return}let o=confirm("Chiudere la timbratura ora? Premi OK per chiudere ora, Annulla per inserire orario manuale."),s=null;if(o)s=new Date().toISOString();else{let a=prompt('Inserisci orario di fine (formati: "YYYY-MM-DD HH:mm" o "HH:mm" per oggi). Esempio: 2025-11-13 18:30');if(!a)return;let u=this.parseInputToIso(a);if(!u){alert("Orario non valido. Operazione annullata.");return}s=u}try{this.isLoading=!0,yield this.timbratureService.completeTimbratura(t.id,s),yield this.caricaTimbrature(),this.currentUser?.role==="admin"||this.currentUser?.role==="manager"&&this.managerCanModifyTimbrature?yield this.caricaRichiesteModifica():yield this.caricaRichiesteModificaUtente()}catch(a){console.error("[ListaTimbrature] completaTimbratura error",a),alert("Errore durante la chiusura della timbratura.")}finally{this.isLoading=!1}})}parseInputToIso(t){t=t.trim();let e=new Date(t);if(!isNaN(e.getTime())&&/\d{4}-\d{2}-\d{2}T/.test(t))return e.toISOString();let i=t.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{1,2}):(\d{2})$/);if(i){let[,s,a,u,f,h]=i,m=new Date(Number(s),Number(a)-1,Number(u),Number(f),Number(h));return isNaN(m.getTime())?null:m.toISOString()}let r=t.match(/^(\d{1,2}):(\d{2})$/);if(r){let s=new Date,[,a,u]=r,f=new Date(s.getFullYear(),s.getMonth(),s.getDate(),Number(a),Number(u));return isNaN(f.getTime())?null:f.toISOString()}let o=new Date(t);return isNaN(o.getTime())?null:o.toISOString()}static \u0275fac=function(e){return new(e||n)(D(vt),D(ae),D(He),D(gt),D(De))};static \u0275cmp=ve({type:n,selectors:[["app-lista-timbrature"]],decls:71,vars:15,consts:[[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],["value","attiva"],["value","completata"],[1,"actions-container"],[1,"promethea-button","ghost",3,"click"],[1,"promethea-button",3,"click"],["class","promethea-button outline",3,"click",4,"ngIf"],["style","margin-top:var(--gutter-lg)",4,"ngIf"],["class","muted",4,"ngIf"],[1,"table-section"],[1,"table-container"],["class","crm-table",4,"ngIf"],[1,"crm-table"],["style","cursor:pointer;",3,"click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","pagination-container",4,"ngIf"],["class","table-section",4,"ngIf"],[1,"promethea-button","outline",3,"click"],[2,"margin-top","var(--gutter-lg)"],[1,"section-title",2,"margin","0"],[1,"muted"],[1,"col-richiesta"],[1,"col-azioni"],[4,"ngFor","ngForOf"],[1,"promethea-button","small",3,"click"],[1,"promethea-button","small","secondary",3,"click"],[2,"cursor","pointer",3,"click"],["class","notes-preview",3,"title",4,"ngIf"],["class","status-message warning","style","margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem;",4,"ngIf"],[1,"action-buttons"],["title","Visualizza",1,"icon-button",3,"click"],["class","promethea-button ghost small",3,"click",4,"ngIf"],["class","icon-button","title","Elimina",3,"click",4,"ngIf"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],[1,"notes-preview",3,"title"],[1,"status-message","warning",2,"margin-bottom","0.5rem","display","flex","align-items","center","gap","0.5rem"],[1,"promethea-button","ghost","small",3,"click"],["title","Elimina",1,"icon-button",3,"click"],[1,"empty-state"],[1,"pagination-container"],[1,"pagination-info"],["class","icon-button","title","Ripristina",3,"click",4,"ngIf"],["title","Ripristina",1,"icon-button",3,"click"]],template:function(e,i){e&1&&(E(0,Pk,1,0,"app-loading-spinner",0),c(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5,"view_list"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Lista Timbrature"),l(),c(9,"p",7),d(10,"Visualizza e gestisci tutte le tue timbrature"),l()()(),c(11,"div",8)(12,"div",9)(13,"div",10)(14,"label",11),d(15,"Data Inizio"),l(),c(16,"input",12),W("ngModelChange",function(o){return q(i.filtroDataInizio,o)||(i.filtroDataInizio=o),o}),x("change",function(){return i.applicaFiltri()}),l()(),c(17,"div",10)(18,"label",11),d(19,"Data Fine"),l(),c(20,"input",12),W("ngModelChange",function(o){return q(i.filtroDataFine,o)||(i.filtroDataFine=o),o}),x("change",function(){return i.applicaFiltri()}),l()(),c(21,"div",10)(22,"label",11),d(23,"Stato"),l(),c(24,"select",13),W("ngModelChange",function(o){return q(i.filtroStato,o)||(i.filtroStato=o),o}),x("change",function(){return i.applicaFiltri()}),c(25,"option",14),d(26,"Tutti"),l(),c(27,"option",15),d(28,"Attive"),l(),c(29,"option",16),d(30,"Completate"),l()()()(),c(31,"div",17)(32,"button",18),x("click",function(){return i.filtraOggi()}),c(33,"span",4),d(34,"today"),l(),d(35," Oggi "),l(),c(36,"button",19),x("click",function(){return i.nuovaTimbraturaWithCheck()}),c(37,"span",4),d(38,"add"),l(),d(39," Nuova Timbratura "),l(),E(40,Nk,4,1,"button",20),l()(),E(41,kk,3,0,"div",21)(42,Fk,2,0,"div",22),c(43,"div",23)(44,"div",24),E(45,Vk,13,1,"table",25),l()(),c(46,"div",23)(47,"div",24)(48,"table",26)(49,"thead")(50,"tr"),E(51,Uk,2,0,"th",0),c(52,"th"),d(53,"Data"),l(),c(54,"th"),d(55,"Ora Inizio"),l(),c(56,"th"),d(57,"Ora Fine"),l(),c(58,"th"),d(59,"Ore Totali"),l(),c(60,"th"),d(61,"Pause"),l(),c(62,"th"),d(63,"Note"),l(),c(64,"th"),d(65,"Azioni"),l()()(),c(66,"tbody"),E(67,Kk,28,24,"tr",27),l()()(),E(68,Yk,7,0,"div",28),l(),E(69,Zk,3,2,"div",29)(70,rF,6,2,"div",30),l()),e&2&&(v("ngIf",i.isLoading),p(16),H("ngModel",i.filtroDataInizio),p(4),H("ngModel",i.filtroDataFine),p(4),H("ngModel",i.filtroStato),p(8),Ce("active",i.filtroOggi),p(8),v("ngIf",i.currentUser),p(),v("ngIf",((i.currentUser==null?null:i.currentUser.role)==="admin"||(i.currentUser==null?null:i.currentUser.role)==="manager"&&i.managerCanModifyTimbrature)&&i.richiesteModifica.length>0),p(),v("ngIf",((i.currentUser==null?null:i.currentUser.role)==="admin"||(i.currentUser==null?null:i.currentUser.role)==="manager"&&i.managerCanModifyTimbrature)&&i.richiesteModifica.length===0),p(3),v("ngIf",((i.currentUser==null?null:i.currentUser.role)==="admin"||(i.currentUser==null?null:i.currentUser.role)==="manager"&&i.managerCanModifyTimbrature)&&i.richiesteModifica.length>0),p(6),v("ngIf",i.hasRole("admin")||i.managerViewingOthers),p(16),v("ngForOf",i.timbratureFiltrate),p(),v("ngIf",i.timbratureFiltrate.length===0),p(),v("ngIf",i.timbratureFiltrate.length>0),p(),v("ngIf",i.showDeletedSection))},dependencies:[be,Le,Se,Ut,Lt,kt,Ft,Me,mt,Oe,Et,Gn,tn,dt],styles:[".table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-richiesta[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-richiesta[_ngcontent-%COMP%]{width:55%;min-width:260px;white-space:normal;vertical-align:top}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%]{width:130px;max-width:160px;white-space:nowrap;text-align:center;vertical-align:middle}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni-small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]{width:90px;max-width:110px;white-space:nowrap;text-align:center;vertical-align:middle}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%]   .promethea-button.small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{padding:6px 8px;min-height:36px}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-richiesta[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-richiesta[_ngcontent-%COMP%]{width:auto;min-width:160px}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni-small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]{width:auto}}"]})};function oF(n,t){n&1&&(et(0),c(1,"span",4),d(2,"content_copy"),l(),tt())}function sF(n,t){n&1&&(et(0),O(1,"span",32),tt())}function aF(n,t){if(n&1){let e=k();c(0,"button",31),x("click",function(){C(e);let r=g(2);return S(r.copiaGiornoPrecedente())}),E(1,oF,3,0,"ng-container",25)(2,sF,2,0,"ng-container",25),d(3," Copia Precedente "),l()}if(n&2){let e=g(2);v("disabled",e.caricandoTimbraturaPrecedente),p(),v("ngIf",!e.caricandoTimbraturaPrecedente),p(),v("ngIf",e.caricandoTimbraturaPrecedente)}}function lF(n,t){if(n&1&&(c(0,"div",29),E(1,aF,4,3,"button",30),l()),n&2){let e=g();p(),v("ngIf",e.timbraturaPrecedenteDisponibile)}}function cF(n,t){n&1&&(c(0,"div",33)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Modalit\xE0 Richiesta Modifica"),l()(),c(8,"div",35),d(9," Stai modificando una timbratura esistente. Le modifiche verranno inviate come richiesta all'amministratore che potr\xE0 approvarle o respingerle. "),l()()()())}function uF(n,t){n&1&&(c(0,"div",36)(1,"div",34)(2,"span",4),d(3,"admin_panel_settings"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Modalit\xE0 Amministratore"),l()(),c(8,"div",35),d(9," Le modifiche verranno applicate immediatamente alla timbratura. "),l()()()())}function dF(n,t){if(n&1&&(c(0,"div",37)(1,"div",34)(2,"span",4),d(3,"warning"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Hai gi\xE0 una timbratura per questa data"),l()(),c(8,"div",35),d(9),Z(10,"date"),l()()()()),n&2){let e=g();p(9),R(" ",e.existingTimbraturaForDate?"Ingresso alle "+X(10,1,e.existingTimbraturaForDate.start_ts,"HH:mm"):"",". Non \xE8 consentito creare pi\xF9 di una timbratura nello stesso giorno. ")}}function fF(n,t){n&1&&(c(0,"span"),d(1,"Data obbligatoria"),l())}function pF(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e,i=g(2);p(),T((e=i.timbraturaForm.get("data"))==null||e.errors==null||e.errors.futureDate==null?null:e.errors.futureDate.message)}}function hF(n,t){if(n&1&&(c(0,"div",18),E(1,fF,2,0,"span",25)(2,pF,2,1,"span",25),l()),n&2){let e,i,r=g();p(),v("ngIf",(e=r.timbraturaForm.get("data"))==null?null:e.hasError("required")),p(),v("ngIf",(i=r.timbraturaForm.get("data"))==null?null:i.hasError("futureDate"))}}function mF(n,t){n&1&&(c(0,"span"),d(1,"Ora ingresso obbligatoria"),l())}function gF(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e,i=g(2);p(),T((e=i.timbraturaForm.get("ora_inizio"))==null||e.errors==null||e.errors.futureTime==null?null:e.errors.futureTime.message)}}function vF(n,t){if(n&1&&(c(0,"div",18),E(1,mF,2,0,"span",25)(2,gF,2,1,"span",25),l()),n&2){let e,i,r=g();p(),v("ngIf",(e=r.timbraturaForm.get("ora_inizio"))==null?null:e.hasError("required")),p(),v("ngIf",(i=r.timbraturaForm.get("ora_inizio"))==null?null:i.hasError("futureTime"))}}function _F(n,t){if(n&1&&(c(0,"div",18),d(1),l()),n&2){let e=g();p(),R(" ",e.timeRangeErrorMessage," ")}}function yF(n,t){if(n&1&&(c(0,"div",18),d(1),l()),n&2){let e,i=g();p(),R(" ",(e=i.timbraturaForm.get("ora_fine"))==null||e.errors==null||e.errors.futureTime==null?null:e.errors.futureTime.message," ")}}function bF(n,t){if(n&1){let e=k();c(0,"button",46),x("click",function(){C(e);let r=g().$index,o=g();return S(o.rimuoviPausa(r))}),c(1,"span",4),d(2,"delete"),l()()}}function wF(n,t){if(n&1&&(c(0,"div",44),d(1),l()),n&2){let e,i=g().$index,r=g();p(),R(" ",(e=r.getPausaControl(i,"inizio").errors)==null||e.futureTime==null?null:e.futureTime.message," ")}}function EF(n,t){if(n&1&&(c(0,"div",44),d(1),l()),n&2){let e,i=g().$index,r=g();p(),R(" ",(e=r.getPausaControl(i,"fine").errors)==null||e.futureTime==null?null:e.futureTime.message," ")}}function CF(n,t){if(n&1&&(c(0,"div",45),d(1),l()),n&2){let e=g().$index,i=g();p(),R(" ",i.getPauseTimeErrorMessage(e)," ")}}function SF(n,t){if(n&1&&(c(0,"div",22)(1,"div",38)(2,"div",39)(3,"span",4),d(4,"schedule"),l(),c(5,"strong"),d(6),l()(),E(7,bF,3,0,"button",40),l(),c(8,"div",41)(9,"div",42)(10,"label",15),d(11,"Inizio"),l(),O(12,"input",43),te(13,wF,2,1,"div",44),l(),c(14,"div",42)(15,"label",15),d(16,"Fine"),l(),O(17,"input",43),te(18,EF,2,1,"div",44),l()(),te(19,CF,2,1,"div",45),l()),n&2){let e=t.$index,i=g();p(6),R("Pausa ",e+1),p(),v("ngIf",i.canRemovePause(e)),p(5),v("formControl",i.getPausaControl(e,"inizio")),p(),ne(i.getPausaControl(e,"inizio").hasError("futureTime")?13:-1),p(4),v("formControl",i.getPausaControl(e,"fine")),p(),ne(i.getPausaControl(e,"fine").hasError("futureTime")?18:-1),p(),ne(i.hasPauseTimeError(e)?19:-1)}}function xF(n,t){n&1&&(et(0),c(1,"span",4),d(2,"my_location"),l(),tt())}function DF(n,t){n&1&&(et(0),O(1,"span",32),tt())}function IF(n,t){n&1&&(c(0,"div",56),d(1,"Ottenendo posizione\u2026"),l())}function TF(n,t){if(n&1&&(c(0,"small"),d(1),Z(2,"number"),l()),n&2){let e=g(3);p(),R("(",X(2,1,e.posizioneAttuale.accuracy,"1.0-0")," m)")}}function MF(n,t){if(n&1&&(c(0,"div",57)(1,"span",58),d(2,"check_circle"),l(),d(3," Posizione ottenuta "),E(4,TF,3,4,"small",25),l()),n&2){let e=g(2);p(4),v("ngIf",e.posizioneAttuale.accuracy)}}function AF(n,t){n&1&&(c(0,"div",59),d(1,"Nessuna posizione"),l())}function RF(n,t){n&1&&(c(0,"span",75),d(1,"Disponibile"),l())}function OF(n,t){n&1&&(c(0,"span",76)(1,"span",77),d(2,"check_circle"),l(),d(3," Selezionato "),l())}function PF(n,t){if(n&1){let e=k();c(0,"button",78),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.selezionaPunto(r))}),c(1,"span",4),d(2,"location_on"),l(),d(3," Seleziona "),l()}}function NF(n,t){if(n&1){let e=k();c(0,"button",79),x("click",function(){C(e);let r=g(4);return S(r.deselezionaPunto())}),c(1,"span",4),d(2,"close"),l(),d(3," Deseleziona "),l()}}function kF(n,t){if(n&1&&(c(0,"div",65)(1,"div",66)(2,"div",67)(3,"strong"),d(4),l(),c(5,"div",68),d(6),l(),c(7,"div",69),d(8),l()(),c(9,"div",70),E(10,RF,2,0,"span",71)(11,OF,4,0,"span",72)(12,PF,4,0,"button",73)(13,NF,4,0,"button",74),l()()()),n&2){let e=t.$implicit,i=g(3);p(4),T((e==null?null:e.name)||"Punto di timbratura"),p(2),T(i.pointLabel(e)),p(2),R("Distanza: ",i.distanceToPoint(e)," m"),p(2),v("ngIf",!i.isPuntoSelezionato(e)),p(),v("ngIf",i.isPuntoSelezionato(e)),p(),v("ngIf",!i.isPuntoSelezionato(e)),p(),v("ngIf",i.isPuntoSelezionato(e))}}function FF(n,t){n&1&&(c(0,"div",80)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Seleziona un punto"),l()(),c(8,"div",81),d(9," Seleziona il punto di timbratura corretto per procedere. "),l()()()())}function LF(n,t){if(n&1&&(c(0,"div",82)(1,"div",34)(2,"span",4),d(3,"check_circle"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Punto selezionato"),l()(),c(8,"div",81),d(9),l()()()()),n&2){let e=g(3);p(9),R(" ",(e.puntoSelezionato==null?null:e.puntoSelezionato.name)||"Punto di timbratura"," - Puoi procedere con la timbratura. ")}}function jF(n,t){if(n&1&&(c(0,"div",60)(1,"div",61),d(2),l(),E(3,kF,14,7,"div",62)(4,FF,10,0,"div",63)(5,LF,10,1,"div",64),l()),n&2){let e=g(2);p(2),R(" Punti di timbratura disponibili (",e.getPuntiNelRaggio().length,"): "),p(),v("ngForOf",e.getPuntiNelRaggio()),p(),v("ngIf",!e.puntoSelezionato),p(),v("ngIf",e.puntoSelezionato)}}function VF(n,t){if(n&1&&(c(0,"div",85)(1,"div",68),d(2,"Punto pi\xF9 vicino:"),l(),c(3,"div",86)(4,"strong"),d(5),l(),O(6,"br"),c(7,"span",87),d(8),l(),O(9,"br"),c(10,"span",87),d(11),l()()()),n&2){let e=g(3);p(5),T((e.nearestPoint==null?null:e.nearestPoint.name)||"Punto di timbratura"),p(3),T(e.pointLabel(e.nearestPoint)),p(3),R("Distanza: ",e.distanceToNearest," m")}}function UF(n,t){if(n&1&&(c(0,"div",83)(1,"div",34)(2,"span",4),d(3,"warning"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Nessun punto disponibile"),l()(),c(8,"div",35),d(9,"Non ti trovi nel raggio di nessun punto di timbratura configurato."),l(),E(10,VF,12,3,"div",84),l()()()),n&2){let e=g(2);p(10),v("ngIf",e.nearestPoint)}}function zF(n,t){n&1&&(c(0,"div",88)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Posizione non verificata"),l()(),c(8,"div",35),d(9,' La tua posizione non \xE8 stata ancora verificata. Usa "Ottieni Posizione" per vedere i punti di timbratura disponibili. '),l()()()())}function BF(n,t){n&1&&(c(0,"div",89)(1,"div",34)(2,"span",4),d(3,"error"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Non puoi timbrare"),l()(),c(8,"div",35),d(9,"Non sono configurati punti di timbratura per la tua azienda."),l()()()())}function $F(n,t){if(n&1&&(c(0,"div",89),d(1),l()),n&2){let e=g(2);p(),T(e.errorMessage)}}function HF(n,t){if(n&1&&(c(0,"div",88),d(1),l()),n&2){let e=g(2);p(),T(e.successMessage)}}function WF(n,t){if(n&1){let e=k();c(0,"div")(1,"div",14)(2,"label",15)(3,"span",4),d(4,"location_on"),l(),d(5," Posizione "),l(),c(6,"div",47)(7,"button",48),x("click",function(){C(e);let r=g();return S(r.ottieniPosizione())}),E(8,xF,3,0,"ng-container",25)(9,DF,2,0,"ng-container",25),d(10),l(),E(11,IF,2,0,"div",49)(12,MF,5,1,"div",50)(13,AF,2,0,"div",51),l(),E(14,jF,6,4,"div",52)(15,UF,11,1,"div",53)(16,zF,10,0,"div",54)(17,BF,10,0,"div",55)(18,$F,2,1,"div",55)(19,HF,2,1,"div",54),l()()}if(n&2){let e=g();p(7),v("disabled",e.ottenendoPosizione),p(),v("ngIf",!e.ottenendoPosizione),p(),v("ngIf",e.ottenendoPosizione),p(),R(" ",e.ottenendoPosizione?"Ottenendo...":"Ottieni Posizione"," "),p(),v("ngIf",e.ottenendoPosizione),p(),v("ngIf",!e.ottenendoPosizione&&e.posizioneAttuale),p(),v("ngIf",!e.ottenendoPosizione&&!e.posizioneAttuale),p(),v("ngIf",e.posizioneAttuale&&e.getPuntiNelRaggio().length>0),p(),v("ngIf",e.posizioneAttuale&&e.getPuntiNelRaggio().length===0),p(),v("ngIf",!e.posizioneAttuale&&!e.ottenendoPosizione),p(),v("ngIf",((e.currentCompany==null||e.currentCompany.punch_points==null?null:e.currentCompany.punch_points.length)??0)===0),p(),v("ngIf",e.errorMessage),p(),v("ngIf",e.successMessage)}}function GF(n,t){if(n&1&&(c(0,"div",91)(1,"h3",92),d(2,"Pause"),l(),c(3,"div",93),d(4),l()()),n&2){let e=g(2);p(4),T(e.formattaOreMinuti(e.calcolaPauseTotali()))}}function qF(n,t){if(n&1&&(c(0,"div",12)(1,"h2",6)(2,"span",4),d(3,"summarize"),l(),d(4," Riepilogo "),l(),c(5,"div",90)(6,"div",91)(7,"h3",92),d(8,"Ore Totali"),l(),c(9,"div",93),d(10),l()(),te(11,GF,5,1,"div",91),c(12,"div",91)(13,"h3",92),d(14,"Ore Lavorative"),l(),c(15,"div",93),d(16),l()()()()),n&2){let e=g();p(10),T(e.formattaOreMinuti(e.calcolaOreTotali())),p(),ne(e.calcolaPauseTotali()>0?11:-1),p(5),T(e.formattaOreMinuti(e.calcolaLavoroEffettivo()))}}function JF(n,t){if(n&1&&(et(0),c(1,"span",4),d(2),l(),tt()),n&2){let e=g();p(2),T(e.isEditMode?(e.currentUser==null?null:e.currentUser.role)==="admin"?"save":"send":"save")}}function KF(n,t){n&1&&(et(0),O(1,"span",32),tt())}function YF(n,t){let e={},i={},r=o=>o??null;if(t.start_ts!==void 0){let o=r(n.start_ts),s=r(t.start_ts);o!==s&&(e.start_ts=s,i.start_ts=o)}if(t.end_ts!==void 0){let o=r(n.end_ts),s=r(t.end_ts);o!==s&&(e.end_ts=s,i.end_ts=o)}if(t.notes!==void 0){let o=r(n.notes),s=r(t.notes);o!==s&&(e.notes=s,i.notes=o)}return{requested_changes:e,original_data:i}}var yp=class n{constructor(t,e,i,r,o,s){this.fb=t;this.timbratureService=e;this.authService=i;this.router=r;this.route=o;this.companyService=s;this.timbraturaForm=this.createForm()}POSITION_ACCURACY_THRESHOLD=150;editReason=null;timbraturaForm;isLoading=!1;errorMessage="";successMessage="";ottenendoPosizione=!1;posizioneAttuale=null;posizioneValida=!1;nearestPoint=null;distanceToNearest=null;currentUser=null;currentCompany=null;existingTimbraturaForDate=null;hasTimbraturaForSelectedDate=!1;requiresGeolocation=!1;timbraturaPrecedenteDisponibile=!1;caricandoTimbraturaPrecedente=!1;timbraturaPrecedente=null;isEditMode=!1;timbraturaOriginale=null;timbraturaId=null;puntoSelezionato=null;ngOnInit(){return y(this,null,function*(){let t=new Date().toISOString().split("T")[0];this.timbraturaForm.patchValue({data:t}),this.timbraturaForm.get("data")?.valueChanges.subscribe(()=>{this.timbraturaForm.get("ora_inizio")?.updateValueAndValidity(),this.timbraturaForm.get("ora_fine")?.updateValueAndValidity(),this.revalidateAllPauses(),this.checkExistingTimbraturaForDate(this.timbraturaForm.value.data).catch(e=>console.error(e))}),this.route.queryParams.subscribe(e=>{e.edit&&e.mode==="edit"&&(this.isEditMode=!0,this.timbraturaId=e.edit,this.timbraturaId&&this.caricaTimbraturaPerModifica(this.timbraturaId))}),this.authService.currentUser$.subscribe(e=>y(this,null,function*(){this.currentUser=e,e&&this.companyService.getAziendaForUser(e.id,e.company_id).subscribe({next:i=>y(this,null,function*(){this.currentCompany=i,this.requiresGeolocation=i?.timbratura_type==="punti",console.debug("[CreaTimbratura] company caricata",{id:i?.id,name:i?.name,punch_points_length:Array.isArray(i?.punch_points)?i.punch_points.length:0,punch_points:i?.punch_points}),this.isEditMode||(yield this.verificaTimbraturaPrecedente(),this.checkExistingTimbraturaForDate(this.timbraturaForm.value.data).catch(r=>console.error(r)))}),error:i=>console.error("[CreaTimbratura] errore carica azienda",i)})}))})}checkExistingTimbraturaForDate(t){return y(this,null,function*(){try{if(this.existingTimbraturaForDate=null,this.hasTimbraturaForSelectedDate=!1,!this.currentUser||!t)return;let e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),i=new Date(t);i.setHours(0,0,0,0);let r=e.find(o=>{if(!o.start_ts)return!1;let s=new Date(o.start_ts);return s.setHours(0,0,0,0),s.getTime()===i.getTime()})||null;r&&(this.existingTimbraturaForDate=r,this.hasTimbraturaForSelectedDate=!0)}catch(e){throw console.error("[CreaTimbratura] checkExistingTimbraturaForDate error",e),this.hasTimbraturaForSelectedDate=!1,this.existingTimbraturaForDate=null,e}})}caricaTimbraturaPerModifica(t){return y(this,null,function*(){try{if(this.isLoading=!0,this.timbraturaOriginale=yield this.timbratureService.getTimbraturaBId(t),!this.timbraturaOriginale){this.errorMessage="Timbratura non trovata",this.router.navigate(["/lista-timbrature"]);return}if(this.currentUser?.role!=="admin"&&this.timbraturaOriginale.user_id!==this.currentUser?.id){this.errorMessage="Non hai i permessi per modificare questa timbratura",this.router.navigate(["/lista-timbrature"]);return}this.popolaFormConDatiEsistenti(this.timbraturaOriginale)}catch(e){console.error("Errore nel caricamento della timbratura:",e),this.errorMessage="Errore nel caricamento della timbratura",this.router.navigate(["/lista-timbrature"])}finally{this.isLoading=!1}})}verificaTimbraturaPrecedente(){return y(this,null,function*(){if(this.currentUser)try{let t=this.calcolaGiornoLavorativoPrecedente();if(!t)return;let e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id);this.timbraturaPrecedente=e.find(i=>{let r=new Date(i.start_ts).toISOString().split("T")[0],o=t.toISOString().split("T")[0];return r===o})||null,this.timbraturaPrecedenteDisponibile=!!this.timbraturaPrecedente}catch(t){console.error("Errore nella verifica timbratura precedente:",t)}})}calcolaGiornoLavorativoPrecedente(){let t=new Date;t.setHours(0,0,0,0);let i=(this.currentCompany?.closed_days||[]).map(a=>{if(typeof a=="number")return a;if(typeof a=="string"){let u=parseInt(a,10);return isNaN(u)?-1:u}return-1}).filter(a=>a>=0&&a<=6),r=i.length>0?i:[0,6],o=new Date(t);o.setDate(o.getDate()-1);let s=0;for(;s<7&&r.includes(o.getDay());)o.setDate(o.getDate()-1),s++;return s<7?o:null}copiaGiornoPrecedente(){return y(this,null,function*(){if(this.timbraturaPrecedente){this.caricandoTimbraturaPrecedente=!0;try{let t=this.timbraturaPrecedente,e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null;if(this.timbraturaForm.patchValue({ora_inizio:e.toTimeString().substring(0,5),ora_fine:i?i.toTimeString().substring(0,5):"",notes:t.notes||""}),t.breaks&&Array.isArray(t.breaks)){for(;this.pause.length>0;)this.pause.removeAt(0);t.breaks.length>0?t.breaks.forEach(r=>{let o=new Date(r.start),s=new Date(r.end),a=this.fb.group({inizio:[o.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)],fine:[s.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator});this.pause.push(a)}):this.pause.push(this.creaPausaGroup())}if(t.locations&&Array.isArray(t.locations)&&t.locations.length>0){let r=t.locations[0];if(this.posizioneAttuale={lat:r.lat,lng:r.lng,indirizzo:r.address,timestamp:new Date,accuracy:0},this.posizioneValida=!0,this.currentCompany?.timbratura_type==="punti"){let o=this.checkInsidePoints(this.posizioneAttuale);this.posizioneValida=o.inside,this.nearestPoint=o.nearest,this.distanceToNearest=o.distance}}this.successMessage="Dati copiati dal giorno lavorativo precedente!",setTimeout(()=>this.successMessage="",3e3)}catch(t){console.error("Errore nella copia:",t),this.errorMessage="Errore durante la copia dei dati precedenti",setTimeout(()=>this.errorMessage="",3e3)}finally{this.caricandoTimbraturaPrecedente=!1}}})}formattaOreMinuti(t){let e=Math.floor(t),i=Math.round((t-e)*60);return e===0&&i===0?"0h":e===0?`${i}m`:i===0?`${e}h`:`${e}h ${i}m`}popolaFormConDatiEsistenti(t){let e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null;if(this.timbraturaForm.patchValue({data:e.toISOString().split("T")[0],ora_inizio:e.toTimeString().substring(0,5),ora_fine:i?i.toTimeString().substring(0,5):"",notes:t.notes||""}),t.breaks&&Array.isArray(t.breaks)){for(;this.pause.length>0;)this.pause.removeAt(0);t.breaks.forEach(r=>{let o=new Date(r.start),s=new Date(r.end),a=this.fb.group({inizio:[o.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)],fine:[s.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator});this.pause.push(a)})}if(this.pause.length===0&&this.pause.push(this.creaPausaGroup()),t.locations&&Array.isArray(t.locations)&&t.locations.length>0){let r=t.locations[0];this.posizioneAttuale={lat:r.lat,lng:r.lng,indirizzo:r.address,timestamp:new Date(r.timestamp),accuracy:0},this.posizioneValida=!0}}createForm(){return this.fb.group({data:["",[ee.required,this.noFutureDateValidator]],ora_inizio:["",[ee.required,this.noFutureTimeValidator.bind(this)]],ora_fine:["",this.noFutureTimeValidator.bind(this)],notes:[""],pause:this.fb.array([this.creaPausaGroup()])},{validators:this.timeRangeValidator})}noFutureTimeValidator(t){if(!t.value)return null;let e=this.timbraturaForm?.get("data");if(!e?.value)return null;let i=e.value,r=new Date().toISOString().split("T")[0];if(i!==r)return null;let o=new Date,s=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`;return t.value>s?{futureTime:{message:"Non \xE8 possibile inserire orari futuri per la data odierna"}}:null}get maxTimeForToday(){let t=this.timbraturaForm?.get("data");if(!t?.value)return null;let e=t.value,i=new Date().toISOString().split("T")[0];if(e===i){let r=new Date;return`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`}return null}get isSelectedDateToday(){let t=this.timbraturaForm?.get("data");if(!t?.value)return!1;let e=t.value,i=new Date().toISOString().split("T")[0];return e===i}timeRangeValidator(t){let e=t.get("ora_inizio")?.value,i=t.get("ora_fine")?.value;return!e||!i?null:i<=e?{invalidTimeRange:{message:"L'ora di uscita deve essere successiva all'ora di ingresso"}}:null}get hasTimeRangeError(){return this.timbraturaForm.hasError("invalidTimeRange")}get timeRangeErrorMessage(){return this.timbraturaForm.getError("invalidTimeRange")?.message||""}noFutureDateValidator(t){if(!t.value)return null;let e=new Date(t.value),i=new Date;return i.setHours(23,59,59,999),e>i?{futureDate:{message:"Non \xE8 possibile inserire timbrature future"}}:null}get maxDate(){return new Date().toISOString().split("T")[0]}creaPausaGroup(){return this.fb.group({inizio:["",this.noFutureTimeValidator.bind(this)],fine:["",this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator})}revalidateAllPauses(){this.pause.controls.forEach(t=>{t.get("inizio")?.updateValueAndValidity(),t.get("fine")?.updateValueAndValidity()})}pauseTimeRangeValidator(t){let e=t.get("inizio")?.value,i=t.get("fine")?.value;return!e||!i?null:i<=e?{invalidPauseTimeRange:{message:"La fine pausa deve essere successiva all'inizio pausa"}}:null}hasPauseTimeError(t){return this.pause.at(t).hasError("invalidPauseTimeRange")}getPauseTimeErrorMessage(t){return this.pause.at(t).getError("invalidPauseTimeRange")?.message||""}get pause(){return this.timbraturaForm.get("pause")}getPausaControl(t,e){return this.pause.at(t).get(e)}aggiungiPausa(){this.pause.push(this.creaPausaGroup())}rimuoviPausa(t){this.pause.length>1&&t>=0&&t<this.pause.length&&this.pause.removeAt(t)}isPauseUsed(t){let e=this.pause.at(t),i=e.get("inizio")?.value,r=e.get("fine")?.value;return!!(i||r)}canRemovePause(t){return this.pause.length>1&&this.isPauseUsed(t)}ottieniPosizione(){if(this.puntoSelezionato=null,this.posizioneValida=!1,this.ottenendoPosizione=!0,this.errorMessage="",this.nearestPoint=null,this.distanceToNearest=null,!navigator.geolocation){this.errorMessage="Geolocalizzazione non supportata dal browser",this.ottenendoPosizione=!1;return}let t=[],e=6,i=8e3,r=Date.now(),o=h=>{console.debug("[CreaTimbratura] sample coords",h.coords.latitude,h.coords.longitude,h.coords.accuracy),t.push(h),(typeof h.coords.accuracy=="number"&&h.coords.accuracy<=this.POSITION_ACCURACY_THRESHOLD||t.length>=e||Date.now()-r>i)&&u()},s=h=>{console.error("[CreaTimbratura] geolocation error",h),f(),this.errorMessage=h.message||"Errore nella richiesta di posizione",this.ottenendoPosizione=!1},a=navigator.geolocation.watchPosition(o,s,{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}),u=()=>{let h=null;for(let m of t){if(!h){h=m;continue}let b=typeof m.coords.accuracy=="number"?m.coords.accuracy:1/0,_=typeof h.coords.accuracy=="number"?h.coords.accuracy:1/0;b<_&&(h=m)}if(h)if(console.debug("[CreaTimbratura] best sample",h.coords.latitude,h.coords.longitude,h.coords.accuracy),this.posizioneAttuale={lat:h.coords.latitude,lng:h.coords.longitude,timestamp:new Date,accuracy:h.coords.accuracy},this.currentCompany?.timbratura_type==="punti"){let m=this.checkInsidePoints(this.posizioneAttuale);this.nearestPoint=m.nearest,this.distanceToNearest=m.distance}else this.posizioneValida=!0;else this.errorMessage="Impossibile ottenere campioni di posizione";f(),this.ottenendoPosizione=!1},f=()=>{typeof a=="number"&&navigator.geolocation.clearWatch&&(navigator.geolocation.clearWatch(a),a=-1)};setTimeout(()=>{this.ottenendoPosizione&&u()},i+200)}getPuntiNelRaggio(){return!this.posizioneAttuale||this.currentCompany?.timbratura_type!=="punti"?[]:(this.currentCompany.punch_points||[]).filter(e=>this.isInsidePoint(e))}checkInsidePoints(t){let e={inside:!1,nearest:null,distance:null};if(!t||!this.currentCompany)return e;let i=this.currentCompany.punch_points||[];if(!i.length)return e;let r=null,o=Number.POSITIVE_INFINITY;console.debug("[checkInsidePoints] posizione utente",t,"punti disponibili",i.length);for(let s of i){let a=this.toNumber(s.lat),u=this.toNumber(s.lng),f=this.toNumber(s.radius_m)||50;if(!isFinite(a)||!isFinite(u)){console.warn("[checkInsidePoints] punto senza coordinate numeriche",s);continue}let h=this.distanzaMetri(t.lat,t.lng,a,u);console.debug("[checkInsidePoints] punto",{id:s.id,name:s.name,plat:a,plng:u,pradius:f,distance_m:Math.round(h)}),h<o&&(o=h,r=J(P({},s),{lat:a,lng:u,radius_m:f}))}return r?(e.nearest=r,e.distance=Math.round(o),e.inside=o<=(r.radius_m||50),console.debug("[checkInsidePoints] nearest",e.nearest,"distance",e.distance,"inside",e.inside)):console.debug("[checkInsidePoints] nessun punto valido trovato"),e}toNumber(t){if(t==null)return NaN;if(typeof t=="number")return t;if(typeof t=="string"){let e=t.trim().replace(",",".");return Number(e)}return Number(t)}calcolaOreTotali(){let t=this.timbraturaForm.value;if(!t.ora_inizio||!t.ora_fine)return 0;let e=new Date(`2000-01-01T${t.ora_inizio}`),r=new Date(`2000-01-01T${t.ora_fine}`).getTime()-e.getTime();return Math.max(0,r/(1e3*60*60))}calcolaPauseTotali(){let t=0;return this.timbraturaForm.value.pause.forEach(i=>{if(i.inizio&&i.fine){let r=new Date(`2000-01-01T${i.inizio}`),s=new Date(`2000-01-01T${i.fine}`).getTime()-r.getTime();t+=Math.max(0,s/(1e3*60*60))}}),t}calcolaLavoroEffettivo(){let t=this.calcolaOreTotali(),e=this.calcolaPauseTotali();return Math.max(0,t-e)}preparaDatiTimbratura(){let t=this.timbraturaForm.value,e=new Date(`${t.data}T${t.ora_inizio}`),i=t.ora_fine?new Date(`${t.data}T${t.ora_fine}`):null,r=t.pause.filter(a=>a.inizio&&a.fine).map(a=>({start:new Date(`${t.data}T${a.inizio}`).toISOString(),end:new Date(`${t.data}T${a.fine}`).toISOString()})),o=this.posizioneAttuale?[{lat:this.posizioneAttuale.lat,lng:this.posizioneAttuale.lng,address:this.posizioneAttuale.indirizzo,timestamp:this.posizioneAttuale.timestamp.toISOString()}]:[],s=Math.round(this.calcolaLavoroEffettivo()*60);return{id:this.timbraturaId||void 0,start_ts:e.toISOString(),end_ts:i?.toISOString()||null,breaks:r.length>0?r:null,locations:o.length>0?o:null,notes:t.notes||null,total_minutes:s,company_id:this.currentUser?.company_id||"",user_id:this.currentUser?.id||""}}onSubmit(){return y(this,null,function*(){if(this.timbraturaForm.invalid){this.timbraturaForm.markAllAsTouched();return}if(!this.currentUser||!this.currentUser.id){this.errorMessage="Utente non autenticato";return}this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=this.isEditMode?this.timbraturaOriginale?.id:void 0;if(this.currentUser.role!=="admin"&&(yield this.timbratureService.hasTimbraturaPerGiorno(this.currentUser.id,this.timbraturaForm.value.data,t))){this.isLoading=!1,this.errorMessage="Hai gi\xE0 una timbratura per questa data. Non \xE8 consentito creare pi\xF9 di una timbratura al giorno.";return}}catch(t){console.error("[CreaTimbratura] errore controllo timbratura esistente",t)}try{if(this.currentCompany?.timbratura_type==="punti"){let t=this.currentCompany.punch_points||[];if(!t.length){this.isLoading=!1,this.errorMessage="Nessun punto di timbratura configurato per l'azienda.";return}if(this.puntoSelezionato)this.posizioneAttuale=this.posizioneAttuale??{lat:Number(this.puntoSelezionato.lat),lng:Number(this.puntoSelezionato.lng),timestamp:new Date,accuracy:0},this.posizioneValida=!0;else{if(!this.posizioneAttuale)try{let r=yield this.askForPositionOnce(12e3);this.posizioneAttuale={lat:r.coords.latitude,lng:r.coords.longitude,timestamp:new Date,accuracy:r.coords.accuracy},console.debug("[CreaTimbratura] posizione ottenuta onSubmit",this.posizioneAttuale)}catch(r){this.isLoading=!1,this.errorMessage=r?.message||"Impossibile ottenere la posizione";return}if((this.posizioneAttuale?.accuracy??1/0)>this.POSITION_ACCURACY_THRESHOLD){this.isLoading=!1,this.errorMessage=`Precisione posizione insufficiente (${Math.round(this.posizioneAttuale?.accuracy??0)} m). Usa un dispositivo con GPS o seleziona manualmente il punto.`;return}}let e=null,i=Number.POSITIVE_INFINITY;for(let r of t){let o=Number(r.lat),s=Number(r.lng);if(!isFinite(o)||!isFinite(s))continue;let a=this.distanzaMetri(this.posizioneAttuale.lat,this.posizioneAttuale.lng,o,s);a<i&&(i=a,e=J(P({},r),{lat:o,lng:s,radius_m:Number(r.radius_m)||50}))}if(this.nearestPoint=e??null,this.distanceToNearest=i===Number.POSITIVE_INFINITY?null:Math.round(i),!e){this.isLoading=!1,this.errorMessage="Nessun punto di timbratura valido configurato (coordinate mancanti).";return}if(this.posizioneValida=i<=(e.radius_m||50),console.debug("[CreaTimbratura] verifica geofence",{nearest:e,nearestDist:i,posizioneValida:this.posizioneValida}),!this.posizioneValida){this.isLoading=!1,this.errorMessage=`Sei fuori dai punti di timbratura consentiti. Distanza: ${Math.round(i)} m (raggio: ${e.radius_m} m).`;return}}this.isEditMode?yield this.handleModificaTimbratura():yield this.saveTimbratura()}catch(t){console.error("[CreaTimbratura] errore onSubmit",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante il salvataggio della timbratura"}})}handleModificaTimbratura(){return y(this,null,function*(){if(!this.timbraturaOriginale||!this.currentUser){this.errorMessage="Dati mancanti per la modifica";return}try{let t=this.timbraturaForm.value,e=new Date(this.timbraturaOriginale.start_ts).toISOString().split("T")[0],i=new Date(`${e}T${t.ora_inizio}`).toISOString(),r=t.ora_fine?new Date(`${e}T${t.ora_fine}`).toISOString():null,o=(t.pause||[]).filter(f=>f.inizio&&f.fine).map(f=>({start:new Date(`${e}T${f.inizio}`).toISOString(),end:new Date(`${e}T${f.fine}`).toISOString()})),s=this.posizioneAttuale?[{lat:this.posizioneAttuale.lat,lng:this.posizioneAttuale.lng,address:this.posizioneAttuale.indirizzo,timestamp:this.posizioneAttuale.timestamp.toISOString()}]:this.timbraturaOriginale.locations??null,a=Math.round(this.calcolaLavoroEffettivo()*60),u={id:this.timbraturaOriginale.id,user_id:this.timbraturaOriginale.user_id,company_id:this.timbraturaOriginale.company_id,start_ts:i,end_ts:r??null,breaks:o.length>0?o:null,locations:s&&s.length>0?s:null,notes:t.notes||this.timbraturaOriginale.notes||null,total_minutes:a};if(this.currentUser.role==="admin")yield this.timbratureService.aggiornaTimbratura(this.timbraturaOriginale.id,u),this.isLoading=!1,this.successMessage="Timbratura aggiornata con successo!",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),1200);else{let f={timbratura_id:this.timbraturaOriginale.id,user_id:this.currentUser.id,company_id:this.currentUser.company_id,status:"pending",requested_changes:u,original_data:this.timbraturaOriginale,reason:"Richiesta di modifica tramite interfaccia utente"};yield this.timbratureService.creaRichiestaModifica(f),this.isLoading=!1,this.successMessage="Richiesta di modifica inviata! L'amministratore la valuter\xE0.",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),2e3)}}catch(t){console.error("[CreaTimbratura] errore aggiornamento",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante l'aggiornamento della timbratura"}})}distanzaMetri(t,e,i,r){let s=M=>M*Math.PI/180,a=s(t),u=s(i),f=s(i-t),h=s(r-e),m=Math.sin(f/2),b=Math.sin(h/2),_=m*m+Math.cos(a)*Math.cos(u)*b*b;return 6371e3*(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)))}saveTimbratura(){return y(this,null,function*(){try{let t=this.preparaDatiTimbratura();if(t.company_id=this.currentCompany?.id||this.currentUser?.company_id||t.company_id,!t.user_id||!t.company_id){this.isLoading=!1,this.errorMessage="Impossibile determinare utente o azienda";return}let e=yield this.timbratureService.creaTimbraturaSupabase(t);console.debug("[CreaTimbratura] timbratura creata",e),this.isLoading=!1,this.successMessage="Timbratura registrata con successo!",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),1200)}catch(t){console.error("[CreaTimbratura] errore saveTimbratura",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante il salvataggio della timbratura"}})}submitAfterManualConfirm(t){t&&(this.posizioneAttuale={lat:Number(t.lat),lng:Number(t.lng),timestamp:new Date,accuracy:0},this.posizioneValida=!0,this.nearestPoint=t,this.distanceToNearest=0,this.isLoading=!0,this.errorMessage="",this.isEditMode?this.handleModificaTimbratura():this.saveTimbratura())}askForPositionOnce(t=1e4){return new Promise((e,i)=>{if(!navigator.geolocation)return i(new Error("Geolocalizzazione non supportata"));navigator.geolocation.getCurrentPosition(e,r=>{i(r)},{enableHighAccuracy:!0,timeout:t,maximumAge:0})})}pointRadius(t){let e=Number(t?.radius_m??t?.raggio??50);return isFinite(e)&&e>0?e:50}distanceToPoint(t){if(!this.posizioneAttuale)return null;let e=Number(t?.lat),i=Number(t?.lng);if(!isFinite(e)||!isFinite(i))return null;let r=this.distanzaMetri(this.posizioneAttuale.lat,this.posizioneAttuale.lng,e,i);return Math.round(r)}isInsidePoint(t){let e=this.distanceToPoint(t);if(e===null)return!1;let i=this.pointRadius(t);return e<=i}pointLabel(t){if(!t)return"Punto";let e=(t?.address||"").toString().trim();if(!e)return t?.name||"Punto";let i=e.split(",").map(_=>_.trim()).filter(Boolean),r=["italia","italy"];for(;i.length&&r.includes(i[i.length-1].toLowerCase());)i.pop();for(;i.length&&/^\d{4,}$/.test(i[i.length-1]);)i.pop();let o="",s="",a="",u="",f=/\b(Via|Viale|Corso|Piazza|Piazzale|Strada|Largo|P.za|Piazzetta|Vicolo|Borgo|Contrada)\b/i;if(i.length>=2&&/^\d+/.test(i[0]))s=i[0],o=i[1];else if(i.length>=2&&/^\d+/.test(i[1]))o=i[0],s=i[1];else{let _=i.findIndex(w=>f.test(w));if(_>=0){o=i[_];let w=o.match(/^(.*\D)\s+(\d+\S*)$/);w&&(o=w[1].trim(),s=w[2].trim())}else{o=i[0]||"";let w=o.match(/^(.*\D)\s+(\d+\S*)$/);w&&(o=w[1].trim(),s=w[2].trim())}}for(let _=i.length-1;_>=0;_--){let w=i[_];if(!(!w||w===o||w===s)&&!(/^\d+$/.test(w)||w.length>40)){if(!a)a=w;else if(!u&&w.length<=30){u=w;break}}}let h=o?s?`${o} ${s}`:o:t?.name||"Punto",m=this.pointRadius(t),b=h;return u&&(b+=`, ${u}`),a&&(b+=`, ${a}`),b+=`, raggio: ${m} m`,b}hasPauseErrors(){for(let t=0;t<this.pause.length;t++){let e=this.pause.at(t);if(e.invalid)return!0;let i=e.get("inizio"),r=e.get("fine");if(i?.hasError("futureTime")||r?.hasError("futureTime"))return!0}return!1}getSubmitButtonText(){return this.isLoading?this.isEditMode?this.currentUser?.role==="admin"?"Salvando...":"Inviando richiesta...":"Salvando...":this.isEditMode?this.currentUser?.role==="admin"?"Salva Modifiche":"Invia Richiesta Modifica":"Salva Timbratura"}selezionaPunto(t){this.puntoSelezionato=t,this.posizioneValida=!0,this.posizioneAttuale={lat:Number(t?.lat),lng:Number(t?.lng),indirizzo:t?.address||t?.indirizzo||null,timestamp:new Date,accuracy:0},this.successMessage=`Punto selezionato: ${t?.name||"Punto di timbratura"}`,setTimeout(()=>this.successMessage="",3e3),console.debug("[CreaTimbratura] Punto selezionato:",{nome:t?.name,indirizzo:this.pointLabel(t),distanza:this.distanceToPoint(t)})}deselezionaPunto(){this.puntoSelezionato=null,this.posizioneValida=!1}isPuntoSelezionato(t){return this.puntoSelezionato&&this.puntoSelezionato.id===t.id}submitEditRequest(t,e){return y(this,null,function*(){let{requested_changes:i,original_data:r}=YF(t,e);if(Object.keys(i).length===0){alert("Nessuna modifica da inviare.");return}if(!t?.id){console.error("[CreaTimbratura] missing original.id"),alert("Dati timbratura mancanti.");return}if(!this.currentUser?.id||!this.currentUser?.company_id){console.error("[CreaTimbratura] missing currentUser ids"),alert("Utente/azienda non disponibili.");return}let o={timbratura_id:t.id,user_id:this.currentUser.id,company_id:this.currentUser.company_id,requested_changes:i,original_data:Object.keys(r).length?r:null,reason:this.editReason??null,status:"pending"};try{yield this.timbratureService.creaRichiestaModifica(o),alert("Richiesta inviata.")}catch(s){console.error("errore invio richiesta",s),alert("Errore invio richiesta")}})}submitTimbratura(t=!1){return y(this,null,function*(){let e={company_id:this.currentCompany.id,user_id:this.currentUser.id,start_ts:this.timbraturaForm.value.start_ts,end_ts:t?null:this.timbraturaForm.value.end_ts,notes:this.timbraturaForm.value.notes??null,total_minutes:0};t&&(yield this.timbratureService.startTimbratura(e))})}static \u0275fac=function(e){return new(e||n)(D(Un),D(vt),D(ae),D(De),D(Wt),D(He))};static \u0275cmp=ve({type:n,selectors:[["app-crea-timbratura"]],decls:79,vars:20,consts:[[1,"gradient-container"],[1,"form-card"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],["class","header-actions",4,"ngIf"],["class","status-message info","style","margin-bottom: var(--gutter-lg);",4,"ngIf"],["class","status-message warning","style","margin-bottom: var(--gutter-lg);",4,"ngIf"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"filter-group"],[1,"form-label"],["type","date","formControlName","data",3,"max"],["class","status-message warning","style","margin-top:8px",4,"ngIf"],[1,"error"],["type","time","formControlName","ora_inizio"],["type","time","formControlName","ora_fine"],[1,"pause-container"],[1,"card","small",2,"margin-bottom","var(--gutter-md)"],["type","button",1,"promethea-button","outline",3,"click","disabled"],["formControlName","notes","rows","4","placeholder","Note opzionali sulla timbratura...",1,"mobile-textarea"],[4,"ngIf"],[1,"form-actions"],["type","button","routerLink","/lista-timbrature",1,"promethea-button","ghost"],["type","submit",1,"promethea-button",3,"disabled"],[1,"header-actions"],["type","button","class","promethea-button ghost","title","Copia orari e luogo dal giorno lavorativo precedente",3,"disabled","click",4,"ngIf"],["type","button","title","Copia orari e luogo dal giorno lavorativo precedente",1,"promethea-button","ghost",3,"click","disabled"],[1,"loading-spinner"],[1,"status-message","info",2,"margin-bottom","var(--gutter-lg)"],[2,"display","flex","align-items","flex-start","gap","8px"],[1,"muted",2,"margin-top","6px"],[1,"status-message","warning",2,"margin-bottom","var(--gutter-lg)"],[1,"status-message","warning",2,"margin-top","8px"],[1,"card-header",2,"justify-content","space-between"],[2,"display","flex","align-items","center","gap","var(--gutter-sm)","flex","1"],["type","button","class","promethea-button small secondary",3,"click",4,"ngIf"],[1,"pause-inputs",2,"margin-top","var(--gutter-sm)"],[1,"form-group"],["type","time",1,"form-control",3,"formControl"],[1,"error",2,"margin-top","4px"],[1,"error",2,"margin-top","8px"],["type","button",1,"promethea-button","small","secondary",3,"click"],[1,"location-actions",2,"display","flex","align-items","center","gap","8px"],["type","button",1,"promethea-button","secondary",3,"click","disabled"],["class","chip","style","background:#fff7e6;color:#8a6d00",4,"ngIf"],["class","chip","style","background:#e6fff1;color:#0a7a3a",4,"ngIf"],["class","chip","style","background:#f0f0f0;color:#333",4,"ngIf"],["style","margin-top:12px",4,"ngIf"],["class","status-message warning","style","margin-top:12px",4,"ngIf"],["class","status-message info","style","margin-top:12px",4,"ngIf"],["class","status-message error","style","margin-top:12px",4,"ngIf"],[1,"chip",2,"background","#fff7e6","color","#8a6d00"],[1,"chip",2,"background","#e6fff1","color","#0a7a3a"],[1,"material-icons",2,"vertical-align","middle"],[1,"chip",2,"background","#f0f0f0","color","#333"],[2,"margin-top","12px"],[1,"muted",2,"margin-bottom","8px"],["class","card small","style","margin-bottom:8px",4,"ngFor","ngForOf"],["class","status-message info","style","margin-top:8px",4,"ngIf"],["class","status-message success","style","margin-top:8px",4,"ngIf"],[1,"card","small",2,"margin-bottom","8px"],[2,"display","flex","justify-content","space-between","align-items","center"],[2,"flex","1"],[1,"muted",2,"font-size","0.9rem"],[1,"muted",2,"font-size","0.85rem"],[2,"display","flex","align-items","center","gap","8px"],["class","chip active",4,"ngIf"],["class","chip","style","background:#e6fff1;color:#0a7a3a;border:1px solid #22c55e",4,"ngIf"],["type","button","class","promethea-button small","title","Seleziona questo punto per timbrare",3,"click",4,"ngIf"],["type","button","class","promethea-button small secondary","title","Deseleziona questo punto",3,"click",4,"ngIf"],[1,"chip","active"],[1,"chip",2,"background","#e6fff1","color","#0a7a3a","border","1px solid #22c55e"],[1,"material-icons",2,"font-size","14px","vertical-align","middle"],["type","button","title","Seleziona questo punto per timbrare",1,"promethea-button","small",3,"click"],["type","button","title","Deseleziona questo punto",1,"promethea-button","small","secondary",3,"click"],[1,"status-message","info",2,"margin-top","8px"],[1,"muted",2,"margin-top","4px"],[1,"status-message","success",2,"margin-top","8px"],[1,"status-message","warning",2,"margin-top","12px"],["style","margin-top:8px",4,"ngIf"],[2,"margin-top","8px"],[2,"background","#f8f9fa","padding","8px","border-radius","6px","margin-top","4px"],[1,"muted"],[1,"status-message","info",2,"margin-top","12px"],[1,"status-message","error",2,"margin-top","12px"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"]],template:function(e,i){if(e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5),l()(),c(6,"div",5)(7,"h1",6),d(8),l(),c(9,"p",7),d(10),l()(),E(11,lF,2,1,"div",8),l(),E(12,cF,10,0,"div",9)(13,uF,10,0,"div",10),c(14,"form",11),x("ngSubmit",function(){return i.onSubmit()}),c(15,"div",12)(16,"h2",6)(17,"span",4),d(18,"schedule"),l(),d(19," Orario Timbratura "),l(),c(20,"div",13)(21,"div",14)(22,"label",15)(23,"span",4),d(24,"event"),l(),d(25," Data * "),l(),O(26,"input",16),E(27,dF,11,4,"div",17),te(28,hF,3,2,"div",18),l(),c(29,"div",14)(30,"label",15)(31,"span",4),d(32,"play_arrow"),l(),d(33," Ora Ingresso * "),l(),O(34,"input",19),te(35,vF,3,2,"div",18),l(),c(36,"div",14)(37,"label",15)(38,"span",4),d(39,"stop"),l(),d(40," Ora Uscita "),l(),O(41,"input",20),te(42,_F,2,1,"div",18),te(43,yF,2,1,"div",18),l()()(),c(44,"div",12)(45,"h2",6)(46,"span",4),d(47,"free_breakfast"),l(),d(48," Gestione Pause "),l(),c(49,"div",21),At(50,SF,20,7,"div",22,Pg),c(52,"button",23),x("click",function(){return i.aggiungiPausa()}),c(53,"span",4),d(54,"add"),l(),d(55," Aggiungi Pausa "),l()()(),c(56,"div",12)(57,"h2",6)(58,"span",4),d(59,"notes"),l(),d(60," Dettagli Aggiuntivi "),l(),c(61,"div",13)(62,"div",14)(63,"label",15)(64,"span",4),d(65,"sticky_note_2"),l(),d(66," Note "),l(),O(67,"textarea",24),l()(),E(68,WF,20,13,"div",25),l(),te(69,qF,17,3,"div",12),c(70,"div",26)(71,"button",27)(72,"span",4),d(73,"arrow_back"),l(),d(74," Torna alle Timbrature "),l(),c(75,"button",28),E(76,JF,3,1,"ng-container",25)(77,KF,2,0,"ng-container",25),d(78),l()()()()()),e&2){let r,o,s;p(5),T(i.isEditMode?"edit":"assignment_add"),p(3),T(i.isEditMode?"Modifica Timbratura":"Nuova Timbratura"),p(2),T(i.isEditMode?"Richiedi modifiche alla tua timbratura":"Registra la tua timbratura giornaliera"),p(),v("ngIf",!i.isEditMode),p(),v("ngIf",i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)!=="admin"),p(),v("ngIf",i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)==="admin"),p(),v("formGroup",i.timbraturaForm),p(12),v("max",i.maxDate),p(),v("ngIf",i.hasTimbraturaForSelectedDate&&!i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)!=="admin"),p(),ne((r=i.timbraturaForm.get("data"))!=null&&r.invalid&&((r=i.timbraturaForm.get("data"))!=null&&r.touched)?28:-1),p(7),ne((o=i.timbraturaForm.get("ora_inizio"))!=null&&o.invalid&&((o=i.timbraturaForm.get("ora_inizio"))!=null&&o.touched)?35:-1),p(7),ne(i.hasTimeRangeError?42:-1),p(),ne((s=i.timbraturaForm.get("ora_fine"))!=null&&s.hasError("futureTime")?43:-1),p(7),Rt(i.pause.controls),p(2),v("disabled",i.hasPauseErrors()),p(16),v("ngIf",(i.currentCompany==null?null:i.currentCompany.timbratura_type)==="punti"),p(),ne(i.calcolaOreTotali()>0?69:-1),p(6),v("disabled",i.timbraturaForm.invalid||i.isLoading||(i.currentCompany==null?null:i.currentCompany.timbratura_type)==="punti"&&!i.posizioneValida),p(),v("ngIf",!i.isLoading),p(),v("ngIf",i.isLoading),p(),R(" ",i.getSubmitButtonText()," ")}},dependencies:[be,Le,Se,zn,mn,Me,Oe,hn,pv,gn,Mn,Ut,Gt,tn,dt],styles:[".pause-inputs[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-md)}.pause-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}@media (max-width: 768px){.pause-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}}.header-actions[_ngcontent-%COMP%]{margin-left:auto;display:flex;gap:var(--gutter-sm)}.header-actions[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)}.mobile-textarea[_ngcontent-%COMP%]{min-height:10rem}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 15%,transparent);color:var(--success);border:1px solid color-mix(in srgb,var(--success) 30%,transparent)}@media (max-width: 768px){.pause-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}.header-actions[_ngcontent-%COMP%]{margin-left:0;margin-top:var(--gutter-sm)}.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);border:1px solid color-mix(in srgb,var(--primary) 30%,transparent)}.status-message.success[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 10%,transparent);border:1px solid color-mix(in srgb,var(--success) 20%,transparent);color:var(--success)}.status-message.success[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--success)}@media (max-width: 768px){.promethea-button.small[_ngcontent-%COMP%]{padding:4px 8px;font-size:.8rem}.promethea-button.small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px}}"]})};var la=class n{constructor(t,e){this.supabaseService=t;this.authService=e}getAnnunciAzienda(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("announcements").select("*").eq("company_id",t).order("created_at",{ascending:!1});if(o)throw console.error("[AnnouncementsService] getAnnunciAzienda error",o),o;return Array.isArray(r)?r:[]});return B(i)}creaAnnuncio(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){let o=yield ze(this.authService.currentUser$);if(!o||o.role!=="admin")throw new Error("Solo gli admin possono creare annunci");let s={company_id:t,title:e.title,content:e.content,created_by:o.id,created_at:new Date().toISOString(),is_active:!0},{data:a,error:u}=yield i.from("announcements").insert([s]).select().maybeSingle();if(u)throw console.error("[AnnouncementsService] creaAnnuncio error",u),u;return a});return B(r)}generateId(){return"ann_"+Math.random().toString(36).substr(2,9)}getAnnunciAziendaWithReadStatus(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield ze(this.authService.currentUser$),{data:o,error:s}=yield e.from("announcements").select("*").eq("company_id",t).order("created_at",{ascending:!1});if(s)throw s;let a=Array.isArray(o)?o:[];if(!r||a.length===0)return a.map(m=>J(P({},m),{is_read:!1}));let u=a.map(m=>m.id).filter(m=>!!m),f=[];if(u.length>0){let m=yield e.from("announcements_reads").select("announcement_id, read_at").in("announcement_id",u).eq("user_id",r.id);if(m.error)throw m.error;f=Array.isArray(m.data)?m.data:[]}let h=new Map;return(f||[]).forEach(m=>h.set(m.announcement_id,m.read_at)),a.map(m=>J(P({},m),{is_read:m.id?h.has(m.id):!1}))});return B(i)}markAsRead(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield ze(this.authService.currentUser$);if(!r)throw new Error("User not authenticated");let o={announcement_id:t,user_id:r.id,read_at:new Date().toISOString()},{data:s,error:a}=yield e.from("announcements_reads").upsert([o],{onConflict:"announcement_id,user_id"}).select().maybeSingle();if(a)throw a;return s});return B(i)}markAsUnread(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield ze(this.authService.currentUser$);if(!r)throw new Error("User not authenticated");let{error:o}=yield e.from("announcements_reads").delete().eq("announcement_id",t).eq("user_id",r.id);if(o)throw o;return!0});return B(i)}getUnreadCountForUser(t){return y(this,null,function*(){if(!t)return 0;let e=this.supabaseService.getClient(),i=yield ze(this.authService.currentUser$);if(!i)return 0;let{data:r,error:o}=yield e.from("announcements").select("id").eq("company_id",t).eq("is_active",!0);if(o)throw o;let s=(r||[]).map(m=>m.id);if(s.length===0)return 0;let{data:a,error:u}=yield e.from("announcements_reads").select("announcement_id").in("announcement_id",s).eq("user_id",i.id);if(u)throw u;let f=new Set((a||[]).map(m=>m.announcement_id));return s.filter(m=>!f.has(m)).length})}static \u0275fac=function(e){return new(e||n)(U(it),U(ae))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var ZF=["announcementsSection"];function QF(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"corporate_fare"),l(),c(4,"h3",13),d(5,"Informazioni Azienda"),l()(),c(6,"div",22)(7,"div",23)(8,"span",24),d(9,"Nome Azienda"),l(),c(10,"span",25),d(11),l()(),c(12,"div",23)(13,"span",24),d(14,"Partita IVA"),l(),c(15,"span",25),d(16),l()(),c(17,"div",23)(18,"span",24),d(19,"Forma Giuridica"),l(),c(20,"span",25),d(21),l()(),c(22,"div",23)(23,"span",24),d(24,"Settore"),l(),c(25,"span",25),d(26),l()()()()),n&2){let e=g();p(11),T(e.azienda.name),p(5),T(e.azienda.vat),p(5),T(e.azienda.legal_form||"Non specificata"),p(5),T(e.azienda.category||"Non specificato")}}function XF(n,t){if(n&1&&(c(0,"span",29),d(1),l()),n&2){let e=g(3);p(),_e(" ",e.azienda.city,", ",e.azienda.province," ")}}function eL(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"location_on"),l(),c(3,"div",27)(4,"span",24),d(5,"Indirizzo"),l(),c(6,"span",25),d(7),l(),E(8,XF,2,2,"span",28),l()()),n&2){let e=g(2);p(7),R(" ",e.azienda.address," "),p(),v("ngIf",e.azienda.city||e.azienda.province)}}function tL(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"phone"),l(),c(3,"div",27)(4,"span",24),d(5,"Telefono"),l(),c(6,"span",25),d(7),l()()()),n&2){let e=g(2);p(7),T(e.azienda.numero_telefono)}}function nL(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"email"),l(),c(3,"div",27)(4,"span",24),d(5,"Email"),l(),c(6,"span",25)(7,"a",30),d(8),l()()()()),n&2){let e=g(2);p(7),v("href","mailto:"+e.azienda.email,Ja),p(),T(e.azienda.email)}}function iL(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"web"),l(),c(3,"div",27)(4,"span",24),d(5,"Sito Web"),l(),c(6,"a",31),d(7),l()()()),n&2){let e=g(2);p(6),v("href",e.azienda.website,Ja),p(),T(e.azienda.website)}}function rL(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"person"),l(),c(3,"div",27)(4,"span",24),d(5,"Amministratore"),l(),c(6,"span",25),d(7),l(),c(8,"span",29),d(9),l()()()),n&2){let e=g(2);p(7),_e("",e.adminAzienda.first_name," ",e.adminAzienda.last_name),p(2),T(e.adminAzienda.email)}}function oL(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"contact_page"),l(),c(4,"h3",13),d(5,"Contatti"),l()(),c(6,"div",22),E(7,eL,9,2,"div",26)(8,tL,8,1,"div",26)(9,nL,9,2,"div",26)(10,iL,8,2,"div",26)(11,rL,10,3,"div",26),l()()),n&2){let e=g();p(7),v("ngIf",e.azienda.address||e.azienda.civic_number||e.azienda.city||e.azienda.province),p(),v("ngIf",e.azienda.numero_telefono),p(),v("ngIf",e.azienda.email),p(),v("ngIf",e.azienda.website),p(),v("ngIf",e.adminAzienda)}}function sL(n,t){if(n&1&&(c(0,"div",23)(1,"span",24),d(2,"Orario Ufficio"),l(),c(3,"span",25),d(4),l()()),n&2){let e=g(2);p(4),_e("",e.azienda.opening_time," - ",e.azienda.closing_time)}}function aL(n,t){if(n&1&&(c(0,"div",36)(1,"span",37),d(2),l(),c(3,"span",38),d(4),l()()),n&2){let e=t.$implicit,i=g(2);p(2),T(e.label),p(),Ce("closed",i.isGiornoChiuso(e.key)),p(),R(" ",i.getOrarioGiorno(e.key)," ")}}function lL(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"schedule"),l(),c(4,"h3",13),d(5,"Orari di Lavoro"),l()(),c(6,"div",22),E(7,sL,5,2,"div",26),c(8,"div",32)(9,"h4",33),d(10,"Orari Settimanali"),l(),c(11,"div",34),E(12,aL,5,4,"div",35),l()()()()),n&2){let e=g();p(7),v("ngIf",e.azienda.opening_time&&e.azienda.closing_time),p(5),v("ngForOf",e.giorniSettimana)}}function cL(n,t){if(n&1&&(c(0,"div",41)(1,"div",42),d(2),l(),c(3,"div",43)(4,"div",44),d(5),l(),c(6,"div",45),d(7),l()(),c(8,"div",46),d(9),l()()),n&2){let e=t.$implicit,i=g(2);p(2),_e(" ",((e==null?null:e.first_name)||"")==null?null:((e==null?null:e.first_name)||"").charAt(0),"",((e==null?null:e.last_name)||"")==null?null:((e==null?null:e.last_name)||"").charAt(0)," "),p(3),_e("",e==null?null:e.first_name," ",e==null?null:e.last_name),p(),Cr("role-"+(e==null?null:e.role)),p(),R(" ",i.getRuoloLabel(e==null?null:e.role)," "),p(),Ce("active",e==null?null:e.is_active),p(),R(" ",e!=null&&e.is_active?"Attivo":"Inattivo"," ")}}function uL(n,t){if(n&1&&(c(0,"div",11)(1,"h2",7)(2,"span",5),d(3,"groups"),l(),d(4," Team Aziendale "),l(),c(5,"div",39),E(6,cL,10,10,"div",40),l()()),n&2){let e=g();p(6),v("ngForOf",e.dipendenti)}}function dL(n,t){if(n&1){let e=k();c(0,"button",47),x("click",function(){C(e);let r=g();return S(r.mostraFormAnnuncio=!r.mostraFormAnnuncio)}),c(1,"span",5),d(2,"add"),l(),d(3," Nuovo Annuncio "),l()}}function fL(n,t){if(n&1){let e=k();c(0,"div",48)(1,"h3",33)(2,"span",5),d(3,"create"),l(),d(4," Crea Nuovo Annuncio "),l(),c(5,"div",49)(6,"label",50),d(7,"Titolo Annuncio"),l(),c(8,"input",51),W("ngModelChange",function(r){C(e);let o=g();return q(o.nuovoAnnuncio.title,r)||(o.nuovoAnnuncio.title=r),S(r)}),l()(),c(9,"div",49)(10,"label",50),d(11,"Contenuto"),l(),c(12,"textarea",52),W("ngModelChange",function(r){C(e);let o=g();return q(o.nuovoAnnuncio.content,r)||(o.nuovoAnnuncio.content=r),S(r)}),l()(),c(13,"div",53)(14,"button",54),x("click",function(){C(e);let r=g();return S(r.annullaCreazioneAnnuncio())}),d(15," Annulla "),l(),c(16,"button",55),x("click",function(){C(e);let r=g();return S(r.creaAnnuncio())}),c(17,"span",5),d(18,"publish"),l(),d(19," Pubblica Annuncio "),l()()()}if(n&2){let e=g();p(8),H("ngModel",e.nuovoAnnuncio.title),p(4),H("ngModel",e.nuovoAnnuncio.content),p(4),v("disabled",!e.nuovoAnnuncio.title||!e.nuovoAnnuncio.content)}}function pL(n,t){n&1&&(c(0,"span",67),d(1,"fiber_new"),l())}function hL(n,t){n&1&&(c(0,"span"),d(1,"\u2026"),l())}function mL(n,t){if(n&1){let e=k();c(0,"div",58)(1,"div",59)(2,"h4",60)(3,"a",61),x("click",function(r){let o=C(e).$implicit;return g(2).openAnnouncement(o),S(r.preventDefault())}),d(4),E(5,pL,2,0,"span",62),l()(),c(6,"span",63),d(7),Z(8,"date"),l()(),c(9,"p",64),d(10),Z(11,"slice"),E(12,hL,2,0,"span",65),l(),c(13,"div",66),d(14),l()()}if(n&2){let e=t.$implicit;p(4),R(" ",e.title," "),p(),v("ngIf",!e.is_read),p(2),T(X(8,6,e.created_at,"dd/MM/yyyy HH:mm")),p(3),T(tl(11,9,e.content,0,200)),p(2),v("ngIf",e.content.length>200),p(2),R("Pubblicato da ",e.author_name||e.author)}}function gL(n,t){if(n&1&&(c(0,"div",56,1),E(2,mL,15,13,"div",57),l()),n&2){let e=g();p(2),v("ngForOf",e.annunci)}}function vL(n,t){if(n&1){let e=k();c(0,"div",68),x("click",function(){C(e);let r=g();return S(r.closeAnnouncement())}),c(1,"div",69),x("click",function(r){return C(e),S(r.stopPropagation())}),c(2,"div",21)(3,"h3",13),d(4),l()(),c(5,"div",70)(6,"button",47),x("click",function(){C(e);let r=g();return S(r.toggleMarkUnread(r.selectedAnnouncement))}),d(7),l(),c(8,"button",54),x("click",function(){C(e);let r=g();return S(r.closeAnnouncement())}),d(9,"Chiudi"),l()(),c(10,"div",22)(11,"div",63),d(12),Z(13,"date"),l(),c(14,"div",71),d(15),l()()()()}if(n&2){let e=g();p(),v("ngStyle",e.modalStyle),p(3),T(e.selectedAnnouncement==null?null:e.selectedAnnouncement.title),p(3),R(" ",e.selectedAnnouncement!=null&&e.selectedAnnouncement.is_read?"Segna da leggere":"Segna come letto"," "),p(5),T(X(13,5,e.selectedAnnouncement==null?null:e.selectedAnnouncement.created_at,"dd/MM/yyyy HH:mm")),p(3),T(e.selectedAnnouncement==null?null:e.selectedAnnouncement.content)}}function _L(n,t){n&1&&(c(0,"p",8),d(1,' Clicca su "Nuovo Annuncio" per pubblicare il primo annuncio. '),l())}function yL(n,t){if(n&1&&(c(0,"div",72)(1,"span",5),d(2,"campaign"),l(),c(3,"h3"),d(4,"Nessun annuncio"),l(),c(5,"p"),d(6,"Non ci sono annunci aziendali al momento."),l(),E(7,_L,2,0,"p",73),l()),n&2){let e=g();p(7),v("ngIf",e.hasRole("admin"))}}function bL(n,t){n&1&&(c(0,"div",74),O(1,"div",75),c(2,"p"),d(3,"Caricamento annunci..."),l()())}var bp=class n{constructor(t,e,i,r,o){this.authService=t;this.companyService=e;this.announcementsService=i;this.timbratureService=r;this.dipendentiService=o}announcementsSectionRef;azienda=null;adminAzienda=null;dipendenti=[];statistiche=null;annunci=[];currentUser=null;isLoading=!0;selectedAnnouncement=null;showAnnouncementModal=!1;modalStyle={};giorniSettimana=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];mostraFormAnnuncio=!1;nuovoAnnuncio={title:"",content:""};isLoadingAnnunci=!1;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&this.caricaDatiAzienda(t.company_id)})}caricaDatiAzienda(t){this.isLoading=!0,this.companyService.getAzienda(t).subscribe(e=>{if(!e){console.warn("Nessuna azienda trovata per id",t),this.isLoading=!1;return}this.azienda=e,this.caricaDipendenti(t),this.caricaAnnunci()},e=>{console.error("Errore nel caricamento dati azienda:",e),this.isLoading=!1})}caricaDipendenti(t){console.debug("[ProfiloAziendale] caricaDipendenti start (using Dipendenti service)",{companyId:t}),this.dipendentiService.getDipendenti(t).subscribe({next:e=>{let i=Array.isArray(e)?e:[];console.debug("[ProfiloAziendale] dipendenti (from Dipendenti):",i.length,i.slice(0,5)),this.dipendenti=i,this.statistiche={dipendentiTotali:i.length,dipendentiAttivi:i.filter(r=>!!r?.is_active).length,timbratureOggi:0,presenzeOggi:0},this.caricaAdminAzienda(this.dipendenti),this.loadTimbratureAndPresenze(),this.isLoading=!1},error:e=>{console.error("[ProfiloAziendale] errore getDipendenti (Dipendenti):",e),this.dipendenti=[],this.statistiche={dipendentiTotali:0,dipendentiAttivi:0,timbratureOggi:this.statistiche?.timbratureOggi??0,presenzeOggi:this.statistiche?.presenzeOggi??0},this.isLoading=!1}})}caricaAdminAzienda(t){let e=t.find(i=>i.role==="admin");e&&(this.adminAzienda=e)}caricaStatistiche(t){let e=t.filter(i=>i.is_active).length;console.debug("[ProfiloAziendale] caricaStatistiche dipendenti.length=",t.length,"attivi=",e),this.statistiche={dipendentiTotali:t.length,dipendentiAttivi:e,timbratureOggi:0,presenzeOggi:0},this.loadTimbratureAndPresenze()}loadTimbratureAndPresenze(){if(!this.azienda?.id){console.debug("[ProfiloAziendale] no azienda id, skip timbrature");return}let t=this.azienda.id;this.timbratureService.getTimbratureAzienda(t).then(e=>{let i=Array.isArray(e)?e:[];console.debug("[ProfiloAziendale] timbrature azienda count:",i.length);let r=new Date,o=u=>{if(!u)return!1;let f=new Date(u);return f.getFullYear()===r.getFullYear()&&f.getMonth()===r.getMonth()&&f.getDate()===r.getDate()},s=i.filter(u=>o(u.start_ts??u.created_at??u.ts)),a=new Set(s.map(u=>u.user_id??u.uid)).size;this.statistiche||(this.statistiche={dipendentiTotali:this.dipendenti.length,dipendentiAttivi:this.dipendenti.filter(u=>u.is_active).length,timbratureOggi:0,presenzeOggi:0}),this.statistiche.timbratureOggi=s.length,this.statistiche.presenzeOggi=a}).catch(e=>{console.error("[ProfiloAziendale] errore getTimbratureAzienda:",e),this.statistiche||(this.statistiche={dipendentiTotali:this.dipendenti.length,dipendentiAttivi:this.dipendenti.filter(i=>i.is_active).length,timbratureOggi:0,presenzeOggi:0}),this.statistiche.timbratureOggi=0,this.statistiche.presenzeOggi=0})}caricaAnnunci(){this.azienda?.id&&(this.isLoadingAnnunci=!0,this.announcementsService.getAnnunciAziendaWithReadStatus(this.azienda.id).subscribe({next:t=>{this.annunci=t,this.isLoadingAnnunci=!1},error:t=>{console.error("Errore nel caricamento annunci:",t),this.isLoadingAnnunci=!1,this.annunci=[]}}))}ensureSectionVisible(){return y(this,null,function*(){let t=this.announcementsSectionRef?.nativeElement;t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),yield new Promise(e=>setTimeout(e,300)))})}openAnnouncement(t){return y(this,null,function*(){yield this.ensureSectionVisible();let e=this.announcementsSectionRef?.nativeElement,i=e?e.getBoundingClientRect():null,r=20,o=900,s=i?i.left+window.scrollX:window.scrollX+r,a=i?i.top+window.scrollY:window.scrollY+r,u=i?i.width:Math.min(window.innerWidth-r*2,o),f=Math.min(u*.9,o),h=Math.max(r,s+(u-f)/2),m=Math.min(800,Math.floor(window.innerHeight*.8)),b=window.scrollY+Math.max(r,(window.innerHeight-m)/2);this.modalStyle={position:"fixed",top:`${Math.floor(b)}px`,left:`${Math.floor(h)}px`,width:`${Math.floor(f)}px`},this.selectedAnnouncement=t,this.showAnnouncementModal=!0;let _=t?.id;_?this.announcementsService.markAsRead(_).subscribe({next:()=>{this.annunci=this.annunci.map(w=>w?.id===_?J(P({},w),{is_read:!0}):w),this.selectedAnnouncement&&this.selectedAnnouncement.id===_&&(this.selectedAnnouncement.is_read=!0)},error:w=>console.error("markAsRead err",w)}):t.is_read=!0})}closeAnnouncement(){this.showAnnouncementModal=!1,this.selectedAnnouncement=null,this.modalStyle={}}toggleMarkUnread(t){if(!t)return;let e=t.id;if(!e){t.is_read=!t.is_read,this.selectedAnnouncement&&this.selectedAnnouncement===t&&(this.selectedAnnouncement.is_read=t.is_read);return}t.is_read?this.announcementsService.markAsUnread(e).subscribe({next:()=>{this.annunci=this.annunci.map(i=>i?.id===e?J(P({},i),{is_read:!1}):i),this.selectedAnnouncement&&this.selectedAnnouncement.id===e&&(this.selectedAnnouncement.is_read=!1)},error:i=>console.error("markAsUnread err",i)}):this.announcementsService.markAsRead(e).subscribe({next:()=>{this.annunci=this.annunci.map(i=>i?.id===e?J(P({},i),{is_read:!0}):i),this.selectedAnnouncement&&this.selectedAnnouncement.id===e&&(this.selectedAnnouncement.is_read=!0)},error:i=>console.error("markAsRead err",i)})}creaAnnuncio(){if(!this.azienda?.id||!this.currentUser)return;let t={title:this.nuovoAnnuncio.title,content:this.nuovoAnnuncio.content,author_id:this.currentUser.id,author_name:`${this.currentUser.first_name} ${this.currentUser.last_name}`};this.announcementsService.creaAnnuncio(this.azienda.id,t).subscribe({next:e=>{this.annunci=[e,...this.annunci],this.nuovoAnnuncio={title:"",content:""},this.mostraFormAnnuncio=!1},error:e=>{console.error("Errore nella creazione annuncio:",e),alert("Errore nella creazione dell'annuncio: "+e.message)}})}annullaCreazioneAnnuncio(){this.mostraFormAnnuncio=!1,this.nuovoAnnuncio={title:"",content:""}}getMockAnnunci(){return[{id:"mock1",title:"Nuovo Orario Estivo",content:"A partire dal 1 giugno, l'orario di lavoro sar\xE0 dalle 8:00 alle 16:00.",author_id:"admin",author_name:"Amministrazione",created_at:new Date("2024-05-15").toISOString(),is_active:!0,date:new Date("2024-05-15"),author:"Amministrazione"}]}hasRole(t){return this.authService.hasRole(t)}isGiornoChiuso(t){if(!t)return!1;let e=this.azienda?.closed_days;return!e||!Array.isArray(e)?!1:e.some(i=>{if(!i)return!1;if(typeof i=="string"||typeof i=="number"){let o=String(i).split("|")[0];if(o.includes("/")){let[s,a]=o.split("/");return t>=s&&t<=a}return o===t}if(typeof i=="object"){let r=i.type||(i.start&&i.end?"range":"single");if(r==="single")return i.start===t;if(r==="range")return!i.start||!i.end?!1:t>=i.start&&t<=i.end}return!1})}getOrarioGiorno(t){if(!t)return"Non specificato";if(this.isGiornoChiuso(t))return"Chiuso";let i=this.azienda?.opening_hours?.[t];return i?i?.closed||!i?.open||!i?.close?"Chiuso":`${i.open} - ${i.close}`:this.azienda?.opening_time&&this.azienda?.closing_time?`${this.azienda.opening_time} - ${this.azienda.closing_time}`:"Non specificato"}getRuoloLabel(t){if(!t)return"Dipendente";switch(t){case"admin":return"Amministratore";case"manager":return"Manager";case"employee":return"Dipendente";default:return t.charAt(0).toUpperCase()+t.slice(1)}}static \u0275fac=function(e){return new(e||n)(D(ae),D(He),D(la),D(vt),D(gt))};static \u0275cmp=ve({type:n,selectors:[["app-profilo-aziendale"]],viewQuery:function(e,i){if(e&1&&Xa(ZF,5),e&2){let r;uo(r=fo())&&(i.announcementsSectionRef=r.first)}},decls:62,vars:14,consts:[["noAnnunci",""],["announcementsSection",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],["class","card",4,"ngIf"],[1,"form-section"],[1,"card"],[1,"card-title"],[1,"card-number"],["class","form-section",4,"ngIf"],["class","promethea-button outline",3,"click",4,"ngIf"],["class","form-card",4,"ngIf"],["class","announcements-list",4,"ngIf","ngIfElse"],["class","modal-overlay-fixed",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],[1,"card-header"],[1,"card-content"],[1,"info-item"],[1,"info-label"],[1,"info-value"],["class","info-item",4,"ngIf"],[1,"contact-info"],["class","info-detail",4,"ngIf"],[1,"info-detail"],[1,"info-link",3,"href"],["target","_blank",1,"info-link",3,"href"],[1,"opening-hours"],[1,"subsection-title"],[1,"hours-grid"],["class","hour-item",4,"ngFor","ngForOf"],[1,"hour-item"],[1,"day-label"],[1,"hour-value"],[1,"team-grid"],["class","team-member",4,"ngFor","ngForOf"],[1,"team-member"],[1,"member-avatar"],[1,"member-info"],[1,"member-name"],[1,"member-role","chip"],[1,"member-status"],[1,"promethea-button","outline",3,"click"],[1,"form-card"],[1,"form-group"],[1,"form-label"],["type","text","placeholder","Inserisci il titolo dell'annuncio",1,"form-input",3,"ngModelChange","ngModel"],["placeholder","Inserisci il contenuto dell'annuncio","rows","4",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"promethea-button","ghost",3,"click"],[1,"promethea-button",3,"click","disabled"],[1,"announcements-list"],["class","announcement-item",4,"ngFor","ngForOf"],[1,"announcement-item"],[1,"announcement-header"],[1,"announcement-title"],["href","#",1,"info-link",3,"click"],["class","material-icons","title","Non letto",4,"ngIf"],[1,"announcement-date"],[1,"announcement-content"],[4,"ngIf"],[1,"announcement-author"],["title","Non letto",1,"material-icons"],[1,"modal-overlay-fixed",3,"click"],[1,"form-card","modal-popup-card",3,"click","ngStyle"],[1,"actions-container",2,"padding","var(--gutter-md) 0"],[2,"white-space","pre-line","margin-top","var(--gutter-md)"],[1,"empty-state"],["class","text-muted",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"]],template:function(e,i){if(e&1&&(c(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),d(4,"business"),l()(),c(5,"div",6)(6,"h1",7),d(7,"Profilo Aziendale"),l(),c(8,"p",8),d(9,"Informazioni e contatti dell'azienda"),l()()(),c(10,"div",9),E(11,QF,27,4,"div",10)(12,oL,12,5,"div",10)(13,lL,13,2,"div",10),l(),c(14,"div",11)(15,"h2",7)(16,"span",5),d(17,"insights"),l(),d(18," Statistiche Aziendali "),l(),c(19,"div",9)(20,"div",12)(21,"h3",13),d(22,"Dipendenti Totali"),l(),c(23,"div",14),d(24),l(),c(25,"p",8),d(26,"Persone nell'azienda"),l()(),c(27,"div",12)(28,"h3",13),d(29,"Dipendenti Attivi"),l(),c(30,"div",14),d(31),l(),c(32,"p",8),d(33,"Attualmente attivi"),l()(),c(34,"div",12)(35,"h3",13),d(36,"Timbrature Oggi"),l(),c(37,"div",14),d(38),l(),c(39,"p",8),d(40,"Registrate oggi"),l()(),c(41,"div",12)(42,"h3",13),d(43,"Presenze Oggi"),l(),c(44,"div",14),d(45),l(),c(46,"p",8),d(47,"Dipendenti in ufficio"),l()()()(),E(48,uL,7,1,"div",15),c(49,"div",11)(50,"div",3)(51,"h2",7)(52,"span",5),d(53,"announcement"),l(),d(54," Annunci Aziendali "),l(),E(55,dL,4,0,"button",16),l(),E(56,fL,20,3,"div",17)(57,gL,3,1,"div",18)(58,vL,16,8,"div",19)(59,yL,8,1,"ng-template",null,0,xn)(61,bL,4,0,"div",20),l()()),e&2){let r=en(60);p(11),v("ngIf",i.azienda),p(),v("ngIf",i.azienda),p(),v("ngIf",i.azienda),p(11),T((i.statistiche==null?null:i.statistiche.dipendentiTotali)||0),p(7),T((i.statistiche==null?null:i.statistiche.dipendentiAttivi)||0),p(7),T((i.statistiche==null?null:i.statistiche.timbratureOggi)||0),p(7),T((i.statistiche==null?null:i.statistiche.presenzeOggi)||0),p(3),v("ngIf",i.dipendenti.length>0),p(7),v("ngIf",i.hasRole("admin")),p(),v("ngIf",i.mostraFormAnnuncio&&i.hasRole("admin")),p(),v("ngIf",i.annunci.length>0)("ngIfElse",r),p(),v("ngIf",i.showAnnouncementModal),p(3),v("ngIf",i.isLoadingAnnunci)}},dependencies:[be,Le,Se,ul,Lt,Me,Oe,Et,fl,dt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000da;display:flex;align-items:center;justify-content:center;padding:2rem;z-index:9999}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:900px;max-height:calc(100vh - 4rem);overflow:auto;box-shadow:0 30px 60px #00000073;border-radius:16px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden}.announcements-list[_ngcontent-%COMP%]{position:relative;z-index:1}.announcements-modal-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:color-mix(in srgb,var(--background) 60%,transparent);display:flex;align-items:flex-start;justify-content:center;padding:1.2rem;z-index:50}.announcements-modal-card[_ngcontent-%COMP%]{width:100%;max-width:820px;margin-top:1rem;max-height:calc(100% - 2rem);overflow:auto;box-shadow:0 20px 40px #00000059;border-radius:12px}.modal-overlay-fixed[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000bf;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);display:flex;align-items:flex-start;justify-content:center;padding:var(--gutter-sm);z-index:12000;pointer-events:auto}.modal-popup-card[_ngcontent-%COMP%]{position:fixed;z-index:12001;box-shadow:0 30px 60px #0009;border-radius:12px;background:var(--background);max-height:calc(100vh - 40px);overflow:auto;padding:var(--gutter-lg);top:50%}"]})};function wL(n,t){if(n&1&&(c(0,"div",17),d(1),l()),n&2){let e=g();p(),T(e.error)}}function EL(n,t){n&1&&(c(0,"div",18),d(1,"Nessun invito presente"),l())}function CL(n,t){if(n&1){let e=k();c(0,"li",19)(1,"div",20)(2,"strong",21),d(3),l(),c(4,"small",18),d(5),Z(6,"date"),l()(),c(7,"div",22)(8,"button",23),x("click",function(){let r=C(e).$implicit,o=g();return S(o.rimuovi(r))}),c(9,"span",5),d(10,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=g();p(3),T(e.email),p(2),T(X(6,3,e.created_at,"dd/MM/yyyy")),p(3),v("disabled",i.loading)}}var ca=class n{constructor(t,e){this.invitiService=t;this.auth=e}companyId;closeModal=new ke;inviti=[];newEmail="";loading=!1;error="";userSub;currentUserId=null;ngOnInit(){this.userSub=this.auth.currentUser$.subscribe(t=>{this.currentUserId=t?.id??null}),this.load()}ngOnDestroy(){this.userSub?.unsubscribe()}load(){this.companyId&&this.invitiService.listByCompany(this.companyId).subscribe({next:t=>this.inviti=t,error:t=>{console.error("Inviti load error",t),t?.message?.includes('relation "employee_invitations" does not exist')&&console.warn("La tabella employee_invitations non esiste ancora in Supabase. Esegui la migrazione SQL.")}})}aggiungi(){if(this.error="",!this.newEmail||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.newEmail)){this.error="Inserire una email valida";return}if(!this.companyId){this.error="Company non disponibile";return}this.loading=!0;let t=this.currentUserId;this.invitiService.addInvite(this.companyId,this.newEmail,t??void 0).subscribe({next:()=>{this.newEmail="",this.loading=!1,this.load()},error:e=>{this.loading=!1,this.error="Errore aggiunta",console.error("Errore addInvite:",e),e?.message?.includes('relation "employee_invitations" does not exist')&&(this.error="Tabella inviti non trovata nel DB. Esegui la migrazione SQL.")}})}rimuovi(t){confirm(`Rimuovere ${t.email}?`)&&(this.loading=!0,this.invitiService.removeInviteById(t.id).subscribe({next:()=>{this.loading=!1,this.load()},error:e=>{this.loading=!1,console.error(e)}}))}close(){this.closeModal.emit()}static \u0275fac=function(e){return new(e||n)(D(aa),D(ae))};static \u0275cmp=ve({type:n,selectors:[["app-inviti-dipendenti"]],inputs:{companyId:"companyId"},outputs:{closeModal:"closeModal"},decls:23,vars:5,consts:[["tabindex","-1","role","dialog","aria-modal","true",1,"modal-overlay",3,"click"],[1,"modal-card",3,"click"],[1,"modal-header"],[1,"h3"],["aria-label","Chiudi",1,"icon-button",3,"click"],[1,"material-icons"],[1,"modal-body"],[1,"form-group"],[1,"form-label"],["type","email","placeholder","nome@esempio.it",1,"form-control",3,"ngModelChange","ngModel"],["class","text-error",4,"ngIf"],[1,"form-actions"],[1,"promethea-button",3,"click","disabled"],[1,"divider"],["class","text-muted",4,"ngIf"],[1,"invites-list"],["class","list-row",4,"ngFor","ngForOf"],[1,"text-error"],[1,"text-muted"],[1,"list-row"],[1,"invite-left"],[1,"invite-email"],[1,"invite-actions"],["aria-label","Rimuovi",1,"icon-button",3,"click","disabled"]],template:function(e,i){e&1&&(c(0,"div",0),x("click",function(){return i.close()}),c(1,"div",1),x("click",function(o){return o.stopPropagation()}),c(2,"header",2)(3,"h3",3),d(4,"Inviti dipendenti"),l(),c(5,"button",4),x("click",function(){return i.close()}),c(6,"span",5),d(7,"close"),l()()(),c(8,"section",6)(9,"div",7)(10,"label",8),d(11,"Email da invitare"),l(),c(12,"input",9),W("ngModelChange",function(o){return q(i.newEmail,o)||(i.newEmail=o),o}),l(),E(13,wL,2,1,"div",10),l(),c(14,"div",11)(15,"button",12),x("click",function(){return i.aggiungi()}),c(16,"span",5),d(17,"person_add"),l(),d(18," Aggiungi "),l()(),O(19,"hr",13),E(20,EL,2,0,"div",14),c(21,"ul",15),E(22,CL,11,6,"li",16),l()()()()),e&2&&(p(12),H("ngModel",i.newEmail),p(),v("ngIf",i.error),p(2),v("disabled",i.loading),p(5),v("ngIf",(i.inviti==null?null:i.inviti.length)===0),p(2),v("ngForOf",i.inviti))},dependencies:[be,Le,Se,Lt,Me,Oe,Et,dt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:var(--gutter-lg, 20px);background:#0000006b;z-index:1200}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:720px;background:var(--background);color:var(--text-color, #111);border-radius:12px;box-shadow:0 8px 28px #00000052;overflow:hidden}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 18px;border-bottom:1px solid color-mix(in srgb,var(--muted, #ddd) 18%,transparent)}.modal-body[_ngcontent-%COMP%]{padding:14px 18px 20px}.form-group[_ngcontent-%COMP%]{margin-bottom:12px}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:6px;font-weight:600}.form-control[type=email][_ngcontent-%COMP%]{width:100%;max-width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;margin-bottom:12px}.invites-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.invites-list[_ngcontent-%COMP%]   .list-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px dashed color-mix(in srgb,var(--muted, #ddd) 12%,transparent)}.invite-left[_ngcontent-%COMP%]{min-width:0;flex:1 1 auto;overflow:hidden}.invite-email[_ngcontent-%COMP%]{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.invite-actions[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:8px}@media (max-width:520px){.modal-card[_ngcontent-%COMP%]{max-width:calc(100% - 24px);margin:0 6px}.modal-header[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]{padding-left:12px;padding-right:12px}.form-actions[_ngcontent-%COMP%]{flex-wrap:wrap;gap:8px}}"]})};var xx=()=>[],SL=n=>["chip",n];function xL(n,t){n&1&&O(0,"app-loading-spinner")}function DL(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function IL(n,t){if(n&1){let e=k();c(0,"button",32),x("click",function(){C(e);let r=g();return S(r.openInvitiModal())}),c(1,"span",4),d(2,"person_add"),l(),d(3," Nuovo Dipendente "),l()}}function TL(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e=g();p(),R("(",e.dipendentiCestino.length||0,")")}}function ML(n,t){if(n&1){let e=k();c(0,"button",40),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaDipendente(r))}),c(1,"span",4),d(2,"person_off"),l()()}}function AL(n,t){if(n&1){let e=k();c(0,"tr")(1,"td")(2,"div",33)(3,"div",34),d(4),l(),c(5,"div",35)(6,"a",36),x("click",function(r){let o=C(e).$implicit,s=g();return S(s.apriDettaglio(o.id,r))}),c(7,"strong"),d(8),l()()()()(),c(9,"td"),d(10),l(),c(11,"td")(12,"span",37),d(13),l()(),c(14,"td"),d(15),l(),c(16,"td"),d(17),l(),c(18,"td"),d(19),Z(20,"date"),l(),c(21,"td")(22,"div",38),E(23,ML,3,0,"button",39),l()()()}if(n&2){let e=t.$implicit,i=g();p(4),_e(" ",(e.first_name||"")[0],"",(e.last_name||"")[0]," "),p(4),_e("",e.first_name||"-"," ",e.last_name||"-"),p(2),T(e.email||"-"),p(2),v("ngClass",Fg(14,SL,"role-"+(e.role||"unknown"))),p(),R(" ",e.role||"\u2014"," "),p(2),T(e.job_title||"\u2014"),p(2),T(e.phone||"-"),p(2),R(" ",e!=null&&e.hire_date?X(20,11,e.hire_date,"dd/MM/yyyy"):"Non specificata"," "),p(4),v("ngIf",i.hasRole("admin"))}}function RL(n,t){if(n&1){let e=k();c(0,"button",32),x("click",function(){C(e);let r=g(2);return S(r.openInvitiModal())}),c(1,"span",4),d(2,"person_add"),l(),d(3," Aggiungi il primo dipendente "),l()}}function OL(n,t){if(n&1&&(c(0,"div",41)(1,"span",4),d(2,"group"),l(),c(3,"h3"),d(4,"Nessun dipendente trovato"),l(),c(5,"p",42),d(6,"Non sono stati trovati dipendenti con i filtri attuali."),l(),E(7,RL,4,0,"button",21),l()),n&2){let e=g();p(7),v("ngIf",e.hasRole("admin"))}}function PL(n,t){if(n&1&&(c(0,"div",43)(1,"div",44),d(2),l()()),n&2){let e=g();p(2),_e(" Mostrando ",e.dipendentiFiltrati.length," di ",e.dipendenti.length," dipendenti ")}}function NL(n,t){if(n&1){let e=k();c(0,"tr")(1,"td")(2,"div",33)(3,"div",34),d(4),l(),c(5,"div",35)(6,"a",36),x("click",function(r){let o=C(e).$implicit,s=g(2);return S(s.apriDettaglio(o.id,r))}),c(7,"strong"),d(8),l()()()()(),c(9,"td"),d(10),l(),c(11,"td")(12,"span",45),d(13),l()(),c(14,"td"),d(15),l(),c(16,"td"),d(17),l(),c(18,"td"),d(19),Z(20,"date"),l(),c(21,"td")(22,"div",38)(23,"button",46),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.riattivaDipendente(r))}),c(24,"span",4),d(25,"cached"),l()()()()()}if(n&2){let e=t.$implicit;p(4),_e(" ",(e.first_name||"")[0],"",(e.last_name||"")[0]," "),p(4),_e("",e.first_name||"-"," ",e.last_name||"-"),p(2),T(e.email||"-"),p(3),T(e.role||"\u2014"),p(2),T(e.job_title||"\u2014"),p(2),T(e.phone||"-"),p(2),T(e!=null&&e.hire_date?X(20,9,e.hire_date,"dd/MM/yyyy"):"Non specificata")}}function kL(n,t){n&1&&(c(0,"div",41),d(1," Nessun dipendente nel cestino. "),l())}function FL(n,t){if(n&1&&(c(0,"div",23)(1,"h2",6),d(2),l(),c(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th"),d(8,"Nome"),l(),c(9,"th"),d(10,"Email"),l(),c(11,"th"),d(12,"Ruolo"),l(),c(13,"th"),d(14,"Mansione"),l(),c(15,"th"),d(16,"Telefono"),l(),c(17,"th"),d(18,"Data Assunzione"),l(),c(19,"th"),d(20,"Azioni"),l()()(),c(21,"tbody"),E(22,NL,26,12,"tr",26),l()(),E(23,kL,2,0,"div",27),l()()),n&2){let e=g();p(2),R("Cestino - dipendenti disattivati (",e.dipendentiCestino.length||0,")"),p(20),v("ngForOf",e.dipendentiFiltratiCestino||$e(4,xx))("ngForTrackBy",e.trackById),p(),v("ngIf",e.dipendentiFiltratiCestino.length===0)}}function LL(n,t){if(n&1){let e=k();c(0,"app-inviti-dipendenti",47),x("closeModal",function(){C(e);let r=g();return S(r.showInvitiModal=!1)}),l()}if(n&2){let e=g();v("companyId",(e.aziendaCorrente==null?null:e.aziendaCorrente.id)??null)}}var wp=class n{constructor(t,e,i,r){this.companyService=t;this.dipendentiService=e;this.authService=i;this.router=r}dipendenti=[];dipendentiAttivi=[];dipendentiCestino=[];dipendentiFiltratiAttivi=[];dipendentiFiltratiCestino=[];filtroMansione="";jobTitles=[];canEditEmployees=!1;dipendentiFiltrati=[];currentUser=null;isLoading=!1;showInvitiModal=!1;aziendaCorrente=null;mostraDisattivati=!1;filtroTesto="";filtroRuolo="";filtroStato="";ngOnInit(){this.isLoading=!0,this.authService.currentUser$.pipe(at(t=>!!t?.id),St(1),qe(t=>(this.currentUser=t??null,this.companyService.getAziendaForUser(t.id,t.company_id)))).subscribe({next:t=>{this.aziendaCorrente=t;let e=t&&t.id?t.id:this.currentUser?.company_id??null;if(this.currentUser?.role==="manager"){let i=this.companyService.resolveManagerConfig?this.companyService.resolveManagerConfig(t,this.currentUser.id):t?.manager_visibility?.[this.currentUser.id]??{mode:"self"};if((i.mode??"self")==="self"&&!i.can_view_all_employees){alert("Non hai i permessi per visualizzare la lista dipendenti. Visualizzi solo le tue timbrature."),this.router.navigate(["/home"]),this.isLoading=!1;return}this.canEditEmployees=!!i.can_edit_employees}if(e&&this.caricaDipendenti(e),this.currentUser?.role==="manager"){let i=this.companyService.resolveManagerConfig(t,this.currentUser.id);this.canEditEmployees=!!i.can_edit_employees}this.isLoading=!1},error:t=>{console.error("Errore caricamento azienda corrente",t),this.isLoading=!1}})}caricaDipendenti(t,e=!1){return y(this,null,function*(){try{let i=t??this.currentUser?.company_id??null;if(!i){this.dipendenti=[],this.dipendentiAttivi=[],this.dipendentiCestino=[],this.applicaFiltri();return}let r=yield ze(this.dipendentiService.getDipendenti(i)),o=Array.isArray(r)?r:[];if(this.currentUser?.role==="manager"){let s=yield ze(this.companyService.getAziendaForUser(this.currentUser.id,i));o=this.companyService.filterEmployeesByVisibility(o,s,this.currentUser.id)}this.dipendenti=o,this.dipendentiAttivi=o.filter(s=>!!s?.is_active),this.dipendentiCestino=o.filter(s=>!s?.is_active),this.applicaFiltri()}catch(i){console.error("[ListaDipendenti] caricaDipendenti error",i),this.dipendenti=[],this.dipendentiAttivi=[],this.dipendentiCestino=[],this.applicaFiltri()}})}toggleMostraDisattivati(){this.mostraDisattivati=!this.mostraDisattivati,this.mostraDisattivati&&this.aziendaCorrente?.id?this.caricaDipendenti(this.aziendaCorrente.id,!0):this.applicaFiltri()}applicaFiltri(){let t=(this.filtroTesto||"").toLowerCase(),e=this.filtroRuolo||"",i=this.filtroMansione??"",r=this.filtroStato||"",o=s=>(s||[]).filter(a=>{if(i){if(i==="__none__"){if(a.job_title)return!1}else if((a.job_title||"").toLowerCase()!==i.toLowerCase())return!1}return!(e&&(a.role||"")!==e||r==="attivo"&&!a.is_active||r==="inattivo"&&a.is_active||t&&!`${a.first_name||""} ${a.last_name||""} ${a.email||""}`.toLowerCase().includes(t))});this.dipendentiFiltratiAttivi=o(this.dipendentiAttivi),this.dipendentiFiltratiCestino=o(this.dipendentiCestino)}hasRole(t){return this.authService.hasRole(t)}openInvitiModal(){if(!this.aziendaCorrente||!this.aziendaCorrente.id){alert("Nessuna azienda associata. Assicurati che l'utente sia amministratore di una azienda.");return}this.showInvitiModal=!0}closeInvitiModal(){this.showInvitiModal=!1}cambiaStatoDipendente(t){if(!t?.id)return;let e=!t.is_active;if(!confirm(`Vuoi ${e?"riattivare":"disattivare"} il dipendente ${t.first_name} ${t.last_name}?`))return;this.isLoading=!0,(e?this.dipendentiService.restoreUser(t.id):this.dipendentiService.deleteUser(t.id)).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:o=>{console.error("Errore nello switch stato dipendente",o),alert("Errore durante l'operazione"),this.isLoading=!1}})}eliminaDipendente(t){t?.id&&confirm(`Sei sicuro di voler spostare nel cestino ${t.first_name} ${t.last_name}?`)&&(this.isLoading=!0,this.dipendentiService.deleteUser(t.id).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:e=>{console.error("Errore disattivazione",e),alert("Errore durante la disattivazione"),this.isLoading=!1}}))}riattivaDipendente(t){t?.id&&confirm(`Vuoi riattivare ${t.first_name} ${t.last_name}?`)&&(this.isLoading=!0,this.dipendentiService.restoreUser(t.id).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:e=>{console.error("Errore ripristino",e),alert("Errore durante il ripristino"),this.isLoading=!1}}))}trackById(t,e){return e?.id??t}apriDettaglio(t,e){if(this.currentUser?.role==="manager"&&!this.canEditEmployees){alert("Non hai i permessi per vedere i dettagli dei dipendenti. Contatta un amministratore.");return}this.router.navigate(["/dipendenti",t])}static \u0275fac=function(e){return new(e||n)(D(He),D(gt),D(ae),D(De))};static \u0275cmp=ve({type:n,selectors:[["app-lista-dipendenti"]],decls:70,vars:16,consts:[[1,"page-container"],[4,"ngIf"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Nome, cognome, email...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],["value","admin"],["value","manager"],["value","employee"],["value","__none__"],[3,"value",4,"ngFor","ngForOf"],[1,"actions-container"],["class","promethea-button",3,"click",4,"ngIf"],[1,"promethea-button","outline",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["class","pagination-container",4,"ngIf"],["class","table-section",4,"ngIf"],[3,"companyId","closeModal",4,"ngIf"],[3,"value"],[1,"promethea-button",3,"click"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],["href","#","title","Apri dettaglio",1,"link",3,"click"],[3,"ngClass"],[1,"action-buttons"],["class","icon-button","title","Elimina",3,"click",4,"ngIf"],["title","Elimina",1,"icon-button",3,"click"],[1,"empty-state"],[2,"margin-bottom","var(--gutter-lg)"],[1,"pagination-container"],[1,"pagination-info"],[1,"chip"],["title","Ripristina",1,"icon-button",3,"click"],[3,"closeModal","companyId"]],template:function(e,i){e&1&&(c(0,"div",0),E(1,xL,1,0,"app-loading-spinner",1),c(2,"div",2)(3,"div",3)(4,"span",4),d(5,"people"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Lista Dipendenti"),l(),c(9,"p",7),d(10,"Gestisci i dipendenti dell'azienda"),l()()(),c(11,"div",8)(12,"div",9)(13,"div",10)(14,"label",11),d(15,"Cerca"),l(),c(16,"input",12),W("ngModelChange",function(o){return q(i.filtroTesto,o)||(i.filtroTesto=o),o}),x("input",function(){return i.applicaFiltri()}),l()(),c(17,"div",10)(18,"label",11),d(19,"Ruolo"),l(),c(20,"select",13),W("ngModelChange",function(o){return q(i.filtroRuolo,o)||(i.filtroRuolo=o),o}),x("change",function(){return i.applicaFiltri()}),c(21,"option",14),d(22,"Tutti"),l(),c(23,"option",15),d(24,"Admin"),l(),c(25,"option",16),d(26,"Manager"),l(),c(27,"option",17),d(28,"Dipendente"),l()()(),c(29,"div",10)(30,"label",11),d(31,"Mansione"),l(),c(32,"select",13),W("ngModelChange",function(o){return q(i.filtroMansione,o)||(i.filtroMansione=o),o}),x("change",function(){return i.applicaFiltri()}),c(33,"option",14),d(34,"Tutte"),l(),c(35,"option",18),d(36,"Senza mansione"),l(),E(37,DL,2,2,"option",19),l()()(),c(38,"div",20),E(39,IL,4,0,"button",21),c(40,"button",22),x("click",function(){return i.toggleMostraDisattivati()}),c(41,"span",4),d(42),l(),d(43),E(44,TL,2,1,"span",1),l()()(),c(45,"div",23)(46,"div",24)(47,"table",25)(48,"thead")(49,"tr")(50,"th"),d(51,"Nome"),l(),c(52,"th"),d(53,"Email"),l(),c(54,"th"),d(55,"Ruolo"),l(),c(56,"th"),d(57,"Mansione"),l(),c(58,"th"),d(59,"Telefono"),l(),c(60,"th"),d(61,"Data Assunzione"),l(),c(62,"th"),d(63,"Azioni"),l()()(),c(64,"tbody"),E(65,AL,24,16,"tr",26),l()()(),E(66,OL,8,1,"div",27),l(),E(67,PL,3,2,"div",28)(68,FL,24,5,"div",29),l(),E(69,LL,1,1,"app-inviti-dipendenti",30)),e&2&&(p(),v("ngIf",i.isLoading),p(15),H("ngModel",i.filtroTesto),p(4),H("ngModel",i.filtroRuolo),p(12),H("ngModel",i.filtroMansione),p(5),v("ngForOf",i.jobTitles),p(2),v("ngIf",i.hasRole("admin")),p(3),T(i.mostraDisattivati?"visibility_off":"visibility"),p(),R(" ",i.mostraDisattivati?"Nascondi cestino":"Mostra cestino"," "),p(),v("ngIf",i.mostraDisattivati),p(21),v("ngForOf",i.dipendentiFiltratiAttivi||$e(15,xx))("ngForTrackBy",i.trackById),p(),v("ngIf",i.dipendentiFiltrati.length===0),p(),v("ngIf",i.dipendentiFiltrati.length>0),p(),v("ngIf",i.mostraDisattivati),p(),v("ngIf",i.showInvitiModal))},dependencies:[be,l0,Le,Se,Ut,Lt,kt,Ft,Me,mt,Oe,Et,Gn,ca,dt],styles:[".user-info-compact[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.user-avatar-small[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:var(--gradiente);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.8rem;flex-shrink:0}.user-details-compact[_ngcontent-%COMP%]{min-width:0}.user-details-compact[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chip.role-admin[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 20%,transparent);color:var(--primary)}.chip.role-manager[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.chip.role-employee[_ngcontent-%COMP%], .chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 20%,transparent);color:#ef4444}@media (max-width: 768px){.user-info-compact[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:0}.user-avatar-small[_ngcontent-%COMP%]{margin-bottom:4px}}"]})};var Fi=class n{constructor(t){this.supabaseService=t}getDepartments(t){let i=this.supabaseService.getClient().from("departments").select("*, employee_count:users(count)").eq("company_id",t).order("name").then(r=>{if(r.error)throw r.error;return(r.data||[]).map(o=>J(P({},o),{employee_count:o.employee_count?.[0]?.count||0}))});return B(i)}createDepartment(t){let e=this.supabaseService.getClient();return B(e.from("departments").insert([t]).select("*").maybeSingle().then(i=>{if(i.error)throw i.error;return i.data}))}updateDepartment(t,e){let r=this.supabaseService.getClient().from("departments").update(J(P({},e),{updated_at:new Date().toISOString()})).eq("id",t).select().single().then(o=>{if(o.error)throw o.error;return o.data});return B(r)}deleteDepartment(t){let i=this.supabaseService.getClient().from("departments").delete().eq("id",t).then(r=>{if(r.error)throw r.error});return B(i)}updateEmployeeDepartment(t,e){let r=this.supabaseService.getClient().from("users").update({department_id:e,updated_at:new Date().toISOString()}).eq("id",t).select("*, department:departments(id, name)").single().then(o=>{if(o.error)throw o.error;return o.data});return B(r)}getDipendentiConReparto(t){let i=this.supabaseService.getClient().from("users").select("*, department:departments(id, name)").eq("company_id",t).order("first_name").then(r=>{if(r.error)throw r.error;return r.data||[]});return B(i)}canDeleteDepartment(t){let i=this.supabaseService.getClient().from("users").select("id",{count:"exact"}).eq("department_id",t).then(r=>{if(r.error)throw r.error;let o=typeof r.count=="number"?r.count:0;return{canDelete:o===0,employeeCount:o}});return B(i)}static \u0275fac=function(e){return new(e||n)(U(it))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var jr=class n{constructor(t,e){this.supabaseService=t;this.authService=e}getJobTitles(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("job_titles").select("*").eq("company_id",t).order("name",{ascending:!0});if(o)throw o;return Array.isArray(r)?r:[]});return B(i)}createJobTitle(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient(),r=yield ze(this.authService.currentUser$),o={company_id:t,name:e.name,description:e.description??null,created_by:r?.id??null},{data:s,error:a}=yield i.from("job_titles").insert([o]).select().maybeSingle();if(a)throw a;return s})}updateJobTitle(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient();e.updated_at=new Date().toISOString();let{data:r,error:o}=yield i.from("job_titles").update(e).eq("id",t).select().maybeSingle();if(o)throw o;return r})}setJobTitleActive(t,e){return y(this,null,function*(){return this.updateJobTitle(t,{is_active:!!e,updated_at:new Date().toISOString()})})}deleteJobTitle(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{error:i}=yield e.from("job_titles").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",t);if(i)throw i})}static \u0275fac=function(e){return new(e||n)(U(it),U(ae))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dx=(n,t)=>t.id,jL=(n,t)=>t.giorno;function VL(n,t){if(n&1){let e=k();c(0,"div",9)(1,"button",44),x("click",function(){C(e);let r=g();return S(r.generaReport())}),c(2,"span",4),d(3,"download"),l(),d(4," Report "),l()()}}function UL(n,t){if(n&1&&(c(0,"div",45)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioSuccesso," ")}}function zL(n,t){if(n&1&&(c(0,"div",46)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioErrore," ")}}function BL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.first_name)||"Non specificato")}}function $L(n,t){if(n&1){let e=k();c(0,"input",47),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.first_name,r)||(o.editWorkModel.first_name=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.first_name)}}function HL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.last_name)||"Non specificato")}}function WL(n,t){if(n&1){let e=k();c(0,"input",48),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.last_name,r)||(o.editWorkModel.last_name=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.last_name)}}function GL(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g();R(" ",X(1,1,e.dipendente==null?null:e.dipendente.birth_date,"dd/MM/yyyy")," ")}}function qL(n,t){n&1&&d(0," Non specificata ")}function JL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.birth_place)||"Non specificato")}}function KL(n,t){if(n&1){let e=k();c(0,"input",49),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.birth_place,r)||(o.editWorkModel.birth_place=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.birth_place)}}function YL(n,t){if(n&1){let e=k();c(0,"button",50),x("click",function(){C(e);let r=g();return S(r.beginEditWorkInfo())}),c(1,"span",4),d(2,"edit"),l()()}}function ZL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T(e.getDepartmentName())}}function QL(n,t){if(n&1&&(c(0,"option",53),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),T(e.name)}}function XL(n,t){if(n&1){let e=k();c(0,"div",25)(1,"select",51),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.department_id,r)||(o.editWorkModel.department_id=r),S(r)}),c(2,"option",52),d(3,"Nessun reparto"),l(),At(4,QL,2,2,"option",53,Dx),l()()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.department_id),p(3),Rt(e.departments)}}function e3(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.job_title)||"Non specificata")}}function t3(n,t){if(n&1&&(c(0,"option",58),d(1),l()),n&2){let e=t.$implicit;v("value",e.id)("disabled",!e.is_active),p(),T(e.name)}}function n3(n,t){if(n&1){let e=k();et(0),c(1,"input",59),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.editWorkModel.job_title,r)||(o.editWorkModel.job_title=r),S(r)}),l(),tt()}if(n&2){let e=g(2);p(),H("ngModel",e.editWorkModel.job_title)}}function i3(n,t){if(n&1){let e=k();c(0,"div",27)(1,"select",54),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.job_title_id,r)||(o.editWorkModel.job_title_id=r),S(r)}),c(2,"option",52),d(3,"-- Seleziona mansione --"),l(),E(4,t3,2,3,"option",55),c(5,"option",56),d(6,"Altro (testo libero)"),l()(),E(7,n3,2,1,"ng-container",57),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.job_title_id),p(3),v("ngForOf",e.jobTitles),p(3),v("ngIf",e.editWorkModel.job_title_id===null||e.editWorkModel.job_title_id===""||e.editWorkModel.job_title_id==="__altro")}}function r3(n,t){if(n&1&&(c(0,"span",60),d(1),l()),n&2){let e=g();Cr("role-"+((e.dipendente==null?null:e.dipendente.role)||"employee")),p(),R(" ",e.getRuoloLabel(e.dipendente==null?null:e.dipendente.role)," ")}}function o3(n,t){if(n&1){let e=k();c(0,"select",61),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.role,r)||(o.editWorkModel.role=r),S(r)}),c(1,"option",62),d(2,"Dipendente"),l(),c(3,"option",63),d(4,"Manager"),l(),c(5,"option",64),d(6,"Amministratore"),l()()}if(n&2){let e=g();H("ngModel",e.editWorkModel.role)}}function s3(n,t){if(n&1&&(c(0,"span",60),d(1),l()),n&2){let e=g();Ce("active",e.dipendente==null?null:e.dipendente.is_active)("inactive",!(e.dipendente!=null&&e.dipendente.is_active)),p(),R(" ",e.dipendente!=null&&e.dipendente.is_active?"Attivo":"Inattivo"," ")}}function a3(n,t){if(n&1){let e=k();c(0,"label",31)(1,"input",65),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.is_active,r)||(o.editWorkModel.is_active=r),S(r)}),l(),d(2," Attivo "),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.is_active)}}function l3(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T(e.dipendente!=null&&e.dipendente.full_time?"Full-Time":"Part-Time")}}function c3(n,t){if(n&1){let e=k();c(0,"label",31)(1,"input",66),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.full_time,r)||(o.editWorkModel.full_time=r),S(r)}),l(),d(2," Full-Time "),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.full_time)}}function u3(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g(2);R(" ",X(1,1,e.dipendente==null?null:e.dipendente.hire_date,"dd/MM/yyyy")," ")}}function d3(n,t){n&1&&d(0," Non specificata ")}function f3(n,t){if(n&1&&(c(0,"span",20),te(1,u3,2,4)(2,d3,1,0),l()),n&2){let e=g();p(),ne(e.dipendente!=null&&e.dipendente.hire_date?1:2)}}function p3(n,t){if(n&1){let e=k();c(0,"input",67),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.hire_date,r)||(o.editWorkModel.hire_date=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.hire_date)}}function h3(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),R("",(e.dipendente==null?null:e.dipendente.monthly_hours)||0," ore")}}function m3(n,t){if(n&1){let e=k();c(0,"input",68),W("ngModelChange",function(r){C(e);let o=g();return q(o.editWorkModel.monthly_hours,r)||(o.editWorkModel.monthly_hours=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.monthly_hours)}}function g3(n,t){if(n&1){let e=k();c(0,"div",34)(1,"button",44),x("click",function(){C(e);let r=g();return S(r.onSaveWorkInfo())}),d(2," Salva modifiche "),l(),c(3,"button",69),x("click",function(){C(e);let r=g();return S(r.cancelEditWorkInfo())}),d(4,"Annulla"),l()()}}function v3(n,t){n&1&&(c(0,"th"),d(1,"Azioni"),l())}function _3(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g().$implicit;R(" ",X(1,1,e.end_ts,"HH:mm")," ")}}function y3(n,t){n&1&&d(0," In corso ")}function b3(n,t){if(n&1){let e=k();c(0,"td")(1,"div",71)(2,"button",72),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.modificaTimbratura(r))}),c(3,"span",4),d(4,"edit"),l()(),c(5,"button",72),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaTimbratura(r))}),c(6,"span",4),d(7,"delete"),l()()()()}}function w3(n,t){if(n&1&&(c(0,"tr")(1,"td"),d(2),Z(3,"date"),l(),c(4,"td"),d(5),Z(6,"date"),l(),c(7,"td"),te(8,_3,2,4)(9,y3,1,0),l(),c(10,"td"),d(11),Z(12,"number"),l(),c(13,"td"),d(14),l(),c(15,"td",70),d(16),l(),te(17,b3,8,0,"td"),l()),n&2){let e=t.$implicit,i=g();p(2),T(X(3,7,e.start_ts,"dd/MM/yyyy")),p(3),T(X(6,10,e.start_ts,"HH:mm")),p(3),ne(e.end_ts?8:9),p(3),R("",X(12,13,e.total_minutes/60,"1.1-1")," ore"),p(3),T(e.breaks?"S\xEC":"No"),p(2),T(e.notes||"Nessuna"),p(),ne(i.hasRole("admin")||i.hasRole("manager")?17:-1)}}function E3(n,t){n&1&&(c(0,"div",39)(1,"span",4),d(2,"schedule"),l(),c(3,"h3"),d(4,"Nessuna timbratura"),l(),c(5,"p"),d(6,"Non sono state trovate timbrature recenti per questo dipendente."),l()())}function C3(n,t){if(n&1&&(c(0,"div",42)(1,"div",73),O(2,"div",74),l(),c(3,"div",75),d(4),Z(5,"number"),l(),c(6,"div",76),d(7),l()()),n&2){let e=t.$implicit,i=g();p(2),Si("height",i.getAltezzaBarra(e.ore)+"%"),p(2),R("",X(5,4,e.ore,"1.1-1"),"h"),p(3),T(e.giorno)}}function S3(n,t){n&1&&(c(0,"div",43),O(1,"div",77),c(2,"p"),d(3,"Caricamento dettaglio dipendente..."),l()())}var Cp=class n{constructor(t,e,i,r,o,s,a,u){this.route=t;this.router=e;this.dipendentiService=i;this.timbratureService=r;this.departmentsService=o;this.jobTitlesService=s;this.authService=a;this.companyService=u}isLoading=!0;dipendente=null;timbratureRecenti=[];statistiche={oreLavorate:0,giorniPresenti:0,mediaOreGiornaliere:0,puntualita:0};andamentoSettimanale=[];jobTitles=[];isLoadingJobTitles=!1;editWorkModel={};departments=[];editingDepartment=!1;messaggioSuccesso="";messaggioErrore="";editingWorkInfo=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){console.error("Dipendente non trovato: id mancante nella route"),this.router.navigate(["/dipendenti"]);return}this.authService.currentUser$.pipe(St(1)).subscribe(e=>{if(!e){this.router.navigate(["/login"]);return}e.role==="manager"?this.companyService.getAziendaForUser(e.id,e.company_id).subscribe({next:i=>{if(!this.companyService.resolveManagerConfig(i,e.id).can_edit_employees){alert("Non hai i permessi per accedere al dettaglio dipendente. Contatta un amministratore."),this.router.navigate(["/dipendenti"]);return}this.loadDipendenteAndData(t)},error:i=>{console.warn("[DipendenteDettaglio] errore lettura azienda per permessi",i),this.router.navigate(["/dipendenti"])}}):this.loadDipendenteAndData(t)})}loadDipendenteAndData(t){this.isLoading=!0,this.dipendentiService.getDipendenteById(t).subscribe({next:e=>{e?(this.dipendente=e,this.dipendente?.company_id&&this.loadJobTitles(this.dipendente.company_id),this.caricaTimbratureRecenti(e.id),this.caricaStatistiche(e.id),this.caricaAndamentoSettimanale(e.id),this.caricaReparti()):(console.error("Dipendente non trovato",t),this.router.navigate(["/dipendenti"])),this.isLoading=!1},error:e=>{console.error("Errore caricamento dipendente",e),this.isLoading=!1,this.messaggioErrore="Errore nel caricamento del dipendente",this.nascondiMessaggioDopoTimeout()}})}caricaTimbratureRecenti(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t);console.debug("[DipendenteDettaglio] timbrature raw",e);let i=(Array.isArray(e)?e:[]).map(r=>J(P({},r),{start_ts:r?.start_ts?new Date(r.start_ts):null,end_ts:r?.end_ts?new Date(r.end_ts):null,total_minutes:Number(r?.total_minutes)||0})).filter(r=>r&&r.start_ts);i.sort((r,o)=>o.start_ts.getTime()-r.start_ts.getTime()),this.timbratureRecenti=i.slice(0,10),console.debug("[DipendenteDettaglio] timbratureRecenti",this.timbratureRecenti)}catch(e){console.error("Errore nel caricamento delle timbrature",e),this.timbratureRecenti=[]}})}caricaStatistiche(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t);console.debug("[DipendenteDettaglio] timbrature raw",e),this.calcolaStatistiche(Array.isArray(e)?e:[])}catch(e){console.error("Errore nel caricamento delle statistiche",e),this.statistiche={oreLavorate:120.5,giorniPresenti:15,mediaOreGiornaliere:8,puntualita:.85}}})}calcolaStatistiche(t){let e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()+1,1),o=t.filter(u=>{if(!u?.start_ts)return!1;let f=new Date(u.start_ts);return f>=i&&f<r}),s=o.reduce((u,f)=>{let h=Number(f.total_minutes)||0;return u+h/60},0),a=new Set(o.map(u=>new Date(u.start_ts).toISOString().slice(0,10))).size;this.statistiche={oreLavorate:s,giorniPresenti:a,mediaOreGiornaliere:a>0?s/a:0,puntualita:this.statistiche.puntualita},console.debug("[DipendenteDettaglio] statistiche calcolate",this.statistiche,{timbratureMeseCount:o.length})}caricaAndamentoSettimanale(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t),i=new Date,r=(i.getDay()+6)%7,o=new Date(i);o.setHours(0,0,0,0),o.setDate(o.getDate()-r);let s=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],a=[];for(let u=0;u<7;u++){let f=new Date(o);f.setDate(o.getDate()+u),f.setHours(0,0,0,0);let h=new Date(f);h.setDate(f.getDate()+1);let m=(Array.isArray(e)?e:[]).filter(b=>b&&b.start_ts).reduce((b,_)=>{try{let w=new Date(_.start_ts);if(w>=f&&w<h){let M=Number(_.total_minutes)||(_.end_ts?Math.round((new Date(_.end_ts).getTime()-w.getTime())/6e4):0);return b+(isFinite(M)?M:0)}}catch{}return b},0);a.push({giorno:s[u],ore:Math.round(m/60*10)/10})}this.andamentoSettimanale=a}catch(e){console.error("[DipendenteDettaglio] caricaAndamentoSettimanale error",e),this.andamentoSettimanale=[{giorno:"Lun",ore:0},{giorno:"Mar",ore:0},{giorno:"Mer",ore:0},{giorno:"Gio",ore:0},{giorno:"Ven",ore:0},{giorno:"Sab",ore:0},{giorno:"Dom",ore:0}]}})}caricaReparti(){this.dipendente?.company_id&&this.departmentsService.getDepartments(this.dipendente.company_id).subscribe({next:t=>{this.departments=t,this.editingWorkInfo&&(this.editWorkModel?.department_id===void 0||this.editWorkModel.department_id===null)&&(this.editWorkModel.department_id=this.dipendente?.department?.id??this.dipendente?.department_id??null)},error:t=>{console.error("Errore caricamento reparti",t)}})}saveWorkInfo(t){this.dipendente?.id&&(this.isLoading=!0,this.dipendentiService.updateUser(this.dipendente.id,t).subscribe({next:e=>{if(this.isLoading=!1,e){this.dipendente=e;let i=this.editWorkModel?.department_id??this.dipendente?.department?.id??null;if(i&&(!this.dipendente.department||!this.dipendente.department.id)){let r=Array.isArray(this.departments)?this.departments.find(o=>o&&o.id===i):void 0;r?this.dipendente.department={id:r.id,name:r.name}:this.dipendente?.company_id&&this.departmentsService.getDepartments(this.dipendente.company_id).subscribe({next:o=>{let s=Array.isArray(o)?o.find(a=>a&&a.id===i):void 0;s&&(this.dipendente.department={id:s.id,name:s.name})},error:o=>console.warn("[DipendenteDettaglio] errore fetch departments fallback",o)})}}this.messaggioSuccesso="Informazioni lavorative aggiornate",this.editingWorkInfo=!1,this.editingDepartment=!1,this.nascondiMessaggioDopoTimeout()},error:e=>{this.isLoading=!1,console.error("[DipendenteDettaglio] saveWorkInfo error",e),this.messaggioErrore="Errore durante il salvataggio",this.nascondiMessaggioDopoTimeout()}}))}cambiaReparto(t){this.saveWorkInfo({department_id:t||null})}nascondiMessaggioDopoTimeout(){setTimeout(()=>{this.messaggioSuccesso="",this.messaggioErrore=""},5e3)}getRuoloLabel(t){return t?{admin:"Amministratore",manager:"Manager",employee:"Dipendente"}[t]||t:"Dipendente"}getDifferenzaOre(){let t=this.dipendente?.monthly_hours||0;return(this.statistiche.oreLavorate||0)-t}getClasseDifferenzaOre(){return this.getDifferenzaOre()>=0?"positive":"negative"}getPercentualeCompletamento(){let t=this.dipendente?.monthly_hours||0,e=this.statistiche.oreLavorate||0;return t>0?e/t:0}getAltezzaBarra(t){let e=Math.max(...this.andamentoSettimanale.map(i=>i.ore));return e>0?t/e*100:0}modificaDipendente(){this.dipendente&&this.router.navigate(["/dipendenti",this.dipendente.id,"modifica"])}generaReport(){this.dipendente&&this.generaReportLocale()}generaReportLocale(){let t=`
      REPORT DIPENDENTE
      =================
      
      Nome: ${this.dipendente?.first_name} ${this.dipendente?.last_name}
      Email: ${this.dipendente?.email}
      Mansione: ${this.dipendente?.job_title}
      Reparto: ${this.dipendente?.department?.name||"Nessun reparto"}
      
      STATISTICHE MENSILI
      -------------------
      Ore lavorate: ${this.statistiche.oreLavorate}
      Giorni presenti: ${this.statistiche.giorniPresenti}
      Media ore/giorno: ${this.statistiche.mediaOreGiornaliere}
      Puntualit\xE0: ${(this.statistiche.puntualita*100).toFixed(1)}%
    `,e=new Blob([t],{type:"text/plain"}),i=window.URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download=`report_${this.dipendente?.first_name}_${this.dipendente?.last_name}.txt`,r.click(),window.URL.revokeObjectURL(i)}vediTutteTimbrature(){this.dipendente&&this.router.navigate(["/timbrature"],{queryParams:{dipendente:this.dipendente.id}})}modificaTimbratura(t){console.log("Modifica timbratura:",t),this.router.navigate(["/timbrature",t.id,"modifica"])}eliminaTimbratura(t){confirm("Sei sicuro di voler eliminare questa timbratura?")&&(console.log("Elimina timbratura:",t),this.timbratureRecenti=this.timbratureRecenti.filter(e=>e.id!==t.id))}hasRole(t){return t==="admin"}beginEditWorkInfo(){this.dipendente&&(this.editWorkModel={department_id:this.dipendente.department?.id??this.dipendente?.department_id??null,job_title_id:this.dipendente?.job_title_id??null,job_title:this.dipendente.job_title??null,role:this.dipendente.role??"employee",is_active:!!this.dipendente.is_active,full_time:!!this.dipendente.full_time,monthly_hours:typeof this.dipendente.monthly_hours=="number"?this.dipendente.monthly_hours:null,hire_date:this.dipendente?.hire_date??null,first_name:this.dipendente.first_name??null,last_name:this.dipendente.last_name??null,birth_place:this.dipendente.birth_place??null},this.editingWorkInfo=!0,this.editingDepartment=!0)}cancelEditWorkInfo(){this.editingWorkInfo=!1,this.editingDepartment=!1,this.editWorkModel={}}onSaveWorkInfo(){return y(this,null,function*(){if(this.dipendente?.id){this.isLoading=!0;try{if(this.editWorkModel.job_title_id==="__altro"&&(this.editWorkModel.job_title??"").trim())if(!this.hasRole("admin"))this.editWorkModel.job_title_id=null;else{if(!this.dipendente.company_id)throw new Error("Company id mancante, impossibile creare mansione");let s=yield this.jobTitlesService.createJobTitle(this.dipendente.company_id,{name:(this.editWorkModel.job_title??"").trim()});s?(this.jobTitles=[s,...this.jobTitles.filter(a=>a.id!==s.id)],this.editWorkModel.job_title_id=s.id):this.editWorkModel.job_title_id=null}let t=typeof this.editWorkModel.monthly_hours<"u"&&this.editWorkModel.monthly_hours!==null?Number(this.editWorkModel.monthly_hours):typeof this.dipendente.monthly_hours<"u"?this.dipendente.monthly_hours:null,e=this.editWorkModel.job_title_id==="__altro"?null:this.editWorkModel.job_title_id??this.dipendente?.job_title_id??null,i={department_id:typeof this.editWorkModel.department_id<"u"?this.editWorkModel.department_id:this.dipendente.department?.id??null,job_title_id:e,job_title:this.editWorkModel.job_title??this.dipendente.job_title??null,role:this.editWorkModel.role??this.dipendente.role??null,is_active:typeof this.editWorkModel.is_active<"u"?!!this.editWorkModel.is_active:!!this.dipendente.is_active,full_time:typeof this.editWorkModel.full_time<"u"?!!this.editWorkModel.full_time:!!this.dipendente.full_time,monthly_hours:t,hire_date:typeof this.editWorkModel.hire_date<"u"?this.editWorkModel.hire_date:this.dipendente?.hire_date??null,first_name:typeof this.editWorkModel.first_name<"u"?this.editWorkModel.first_name:this.dipendente.first_name??null,last_name:typeof this.editWorkModel.last_name<"u"?this.editWorkModel.last_name:this.dipendente.last_name??null,birth_place:typeof this.editWorkModel.birth_place<"u"?this.editWorkModel.birth_place:this.dipendente.birth_place??null};if(console.debug("[DipendenteDettaglio] onSaveWorkInfo payload",i),!confirm("Sei sicuro di voler salvare le modifiche al dipendente?")){console.debug("[DipendenteDettaglio] save cancelled by user"),this.isLoading=!1;return}let o=yield ze(this.dipendentiService.updateUser(this.dipendente.id,i));o&&(this.dipendente=o),i.first_name&&(this.dipendente.first_name=i.first_name),i.last_name&&(this.dipendente.last_name=i.last_name),i.birth_place&&(this.dipendente.birth_place=i.birth_place),i.hire_date&&(this.dipendente.hire_date=i.hire_date),this.editingWorkInfo=!1,this.editingDepartment=!1,this.messaggioSuccesso="Informazioni salvate",this.nascondiMessaggioDopoTimeout()}catch(t){console.error("[DipendenteDettaglio] onSaveWorkInfo error",t),this.messaggioErrore="Errore salvataggio: "+(t?.message||JSON.stringify(t))}finally{this.isLoading=!1}}})}getDepartmentName(){let t=this.dipendente?.department?.name;if(t)return t;let e=this.editWorkModel?.department_id??this.dipendente?.department_id??this.dipendente?.department?.id??null;if(!e)return"Nessun reparto assegnato";if(Array.isArray(this.departments)){let i=this.departments.find(r=>r&&r.id===e);if(i?.name)return i.name}return"Nessun reparto assegnato"}loadJobTitles(t){if(!t){this.jobTitles=[];return}this.isLoadingJobTitles=!0,this.jobTitlesService.getJobTitles(t).subscribe({next:e=>{this.jobTitles=Array.isArray(e)?e.filter(i=>i):[],this.isLoadingJobTitles=!1},error:e=>{console.error("[DipendenteDettaglio] loadJobTitles",e),this.jobTitles=[],this.isLoadingJobTitles=!1}})}static \u0275fac=function(e){return new(e||n)(D(Wt),D(De),D(gt),D(vt),D(Fi),D(jr),D(ae),D(He))};static \u0275cmp=ve({type:n,selectors:[["app-dipendente-dettaglio"]],decls:248,vars:50,consts:[["workForm","ngForm"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],["routerLink","/dipendenti",1,"link"],[1,"actions-container"],["class","status-message info",4,"ngIf"],["class","status-message error",4,"ngIf"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-content"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],["name","first_name","type","text",1,"form-control",3,"ngModel"],["name","last_name","type","text",1,"form-control",3,"ngModel"],["name","birth_place","type","text",1,"form-control",3,"ngModel"],["title","Modifica informazioni e reparto",1,"icon-button"],[2,"display","flex","gap","8px","align-items","center","width","100%"],["novalidate",""],[2,"display","flex","gap","8px","align-items","center"],[1,"chip",3,"class"],["name","role",1,"form-control",3,"ngModel"],[1,"chip",3,"active","inactive"],[2,"display","inline-flex","align-items","center","gap","8px"],["name","hire_date","type","date",1,"form-control",3,"ngModel"],["name","monthly_hours","type","number",1,"form-control",2,"width","140px",3,"ngModel"],[1,"form-actions",2,"margin-top","12px"],[1,"form-section"],[1,"promethea-button","outline",3,"click"],[1,"table-container"],[1,"crm-table"],[1,"empty-state"],[1,"chart-container"],[1,"chart-bars"],[1,"chart-bar"],[1,"loading-container"],[1,"promethea-button",3,"click"],[1,"status-message","info"],[1,"status-message","error"],["name","first_name","type","text",1,"form-control",3,"ngModelChange","ngModel"],["name","last_name","type","text",1,"form-control",3,"ngModelChange","ngModel"],["name","birth_place","type","text",1,"form-control",3,"ngModelChange","ngModel"],["title","Modifica informazioni e reparto",1,"icon-button",3,"click"],["name","department_id",1,"form-control",2,"min-width","240px",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","job_title_id",1,"form-control",2,"min-width","240px",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],["value","__altro"],[4,"ngIf"],[3,"value","disabled"],["name","job_title","type","text","placeholder","Inserisci mansione",1,"form-control",3,"ngModelChange","ngModel"],[1,"chip"],["name","role",1,"form-control",3,"ngModelChange","ngModel"],["value","employee"],["value","manager"],["value","admin"],["name","is_active","type","checkbox",3,"ngModelChange","ngModel"],["name","full_time","type","checkbox",3,"ngModelChange","ngModel"],["name","hire_date","type","date",1,"form-control",3,"ngModelChange","ngModel"],["name","monthly_hours","type","number",1,"form-control",2,"width","140px",3,"ngModelChange","ngModel"],[1,"promethea-button","ghost",3,"click"],[1,"notes-preview"],[1,"action-buttons"],[1,"icon-button",3,"click"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"bar-label"],[1,"loading-spinner"]],template:function(e,i){if(e&1){let r=k();c(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),d(4,"person"),l()(),c(5,"div",5)(6,"h1",6),d(7),l(),c(8,"p",7)(9,"a",8),d(10,"Dipendenti"),l(),d(11," / Dettaglio dipendente "),l()(),te(12,VL,5,0,"div",9),l(),E(13,UL,4,1,"div",10)(14,zL,4,1,"div",11),c(15,"div",12)(16,"div",13)(17,"div",14)(18,"span",4),d(19,"badge"),l(),c(20,"h2",15),d(21,"Informazioni Personali"),l()(),c(22,"div",16)(23,"div",17)(24,"span",4),d(25,"badge"),l(),c(26,"div",18)(27,"span",19),d(28,"Nome"),l(),te(29,BL,2,1,"span",20)(30,$L,1,1,"input",21),l()(),c(31,"div",17)(32,"span",4),d(33,"badge"),l(),c(34,"div",18)(35,"span",19),d(36,"Cognome"),l(),te(37,HL,2,1,"span",20)(38,WL,1,1,"input",22),l()(),c(39,"div",17)(40,"span",4),d(41,"email"),l(),c(42,"div",18)(43,"span",19),d(44,"Email"),l(),c(45,"span",20),d(46),l()()(),c(47,"div",17)(48,"span",4),d(49,"phone"),l(),c(50,"div",18)(51,"span",19),d(52,"Telefono"),l(),c(53,"span",20),d(54),l()()(),c(55,"div",17)(56,"span",4),d(57,"cake"),l(),c(58,"div",18)(59,"span",19),d(60,"Data di Nascita"),l(),c(61,"span",20),te(62,GL,2,4)(63,qL,1,0),l()()(),c(64,"div",17)(65,"span",4),d(66,"place"),l(),c(67,"div",18)(68,"span",19),d(69,"Luogo di Nascita"),l(),te(70,JL,2,1,"span",20)(71,KL,1,1,"input",23),l()(),c(72,"div",17)(73,"span",4),d(74,"fingerprint"),l(),c(75,"div",18)(76,"span",19),d(77,"Codice Fiscale"),l(),c(78,"span",20),d(79),l()()()()(),c(80,"div",13)(81,"div",14)(82,"span",4),d(83,"work"),l(),c(84,"h2",15),d(85,"Informazioni Lavorative"),l(),te(86,YL,3,0,"button",24),l(),c(87,"div",16)(88,"div",17)(89,"span",4),d(90,"groups"),l(),c(91,"div",18)(92,"span",19),d(93,"Reparto"),l(),te(94,ZL,2,1,"span",20)(95,XL,6,1,"div",25),l()(),c(96,"form",26,0)(98,"div",17)(99,"span",4),d(100,"business_center"),l(),c(101,"div",18)(102,"span",19),d(103,"Mansione"),l(),te(104,e3,2,1,"span",20)(105,i3,8,3,"div",27),l()(),c(106,"div",17)(107,"span",4),d(108,"admin_panel_settings"),l(),c(109,"div",18)(110,"span",19),d(111,"Ruolo"),l(),te(112,r3,2,3,"span",28)(113,o3,7,1,"select",29),l()(),c(114,"div",17)(115,"span",4),d(116,"toggle_on"),l(),c(117,"div",18)(118,"span",19),d(119,"Stato"),l(),te(120,s3,2,5,"span",30)(121,a3,3,1,"label",31),l()(),c(122,"div",17)(123,"span",4),d(124,"schedule"),l(),c(125,"div",18)(126,"span",19),d(127,"Tipo di Contratto"),l(),te(128,l3,2,1,"span",20)(129,c3,3,1,"label",31),l()(),c(130,"div",17)(131,"span",4),d(132,"work_outline"),l(),c(133,"div",18)(134,"span",19),d(135,"Data di Assunzione"),l(),te(136,f3,3,1,"span",20)(137,p3,1,1,"input",32),l()(),c(138,"div",17)(139,"span",4),d(140,"av_timer"),l(),c(141,"div",18)(142,"span",19),d(143,"Ore Mensili Previste"),l(),te(144,h3,2,1,"span",20)(145,m3,1,1,"input",33),l()(),te(146,g3,5,0,"div",34),l()()(),c(147,"div",13)(148,"div",14)(149,"span",4),d(150,"insights"),l(),c(151,"h2",15),d(152,"Statistiche Mese Corrente"),l()(),c(153,"div",16)(154,"div",17)(155,"span",19),d(156,"Ore Lavorate"),l(),c(157,"span",20),d(158),Z(159,"number"),l()(),c(160,"div",17)(161,"span",19),d(162,"Giorni Presenti"),l(),c(163,"span",20),d(164),l()(),c(165,"div",17)(166,"span",19),d(167,"Media Ore Giornaliere"),l(),c(168,"span",20),d(169),Z(170,"number"),l()(),c(171,"div",17)(172,"span",19),d(173,"Puntualit\xE0"),l(),c(174,"span",20),d(175),Z(176,"percent"),l()()()(),c(177,"div",13)(178,"div",14)(179,"span",4),d(180,"calendar_today"),l(),c(181,"h2",15),d(182,"Riepilogo Presenze"),l()(),c(183,"div",16)(184,"div",17)(185,"span",19),d(186,"Ore Previste"),l(),c(187,"span",20),d(188),l()(),c(189,"div",17)(190,"span",19),d(191,"Ore Raggiunte"),l(),c(192,"span",20),d(193),Z(194,"number"),l()(),c(195,"div",17)(196,"span",19),d(197,"Differenza"),l(),c(198,"span",20),d(199),Z(200,"number"),l()(),c(201,"div",17)(202,"span",19),d(203,"Progresso"),l(),c(204,"span",20),d(205),Z(206,"percent"),l()()()()(),c(207,"div",35)(208,"div",2)(209,"h2",6)(210,"span",4),d(211,"schedule"),l(),d(212," Timbrature Recenti "),l(),c(213,"button",36),x("click",function(){return C(r),S(i.vediTutteTimbrature())}),c(214,"span",4),d(215,"list"),l(),d(216," Vedi Tutte "),l()(),c(217,"div",37)(218,"table",38)(219,"thead")(220,"tr")(221,"th"),d(222,"Data"),l(),c(223,"th"),d(224,"Ingresso"),l(),c(225,"th"),d(226,"Uscita"),l(),c(227,"th"),d(228,"Ore Totali"),l(),c(229,"th"),d(230,"Pause"),l(),c(231,"th"),d(232,"Note"),l(),te(233,v3,2,0,"th"),l()(),c(234,"tbody"),At(235,w3,18,16,"tr",null,Dx),l()()(),te(237,E3,7,0,"div",39),l(),c(238,"div",35)(239,"h2",6)(240,"span",4),d(241,"bar_chart"),l(),d(242," Andamento Settimanale "),l(),c(243,"div",40)(244,"div",41),At(245,C3,8,7,"div",42,jL),l()()(),te(247,S3,4,0,"div",43),l()}e&2&&(p(7),_e("",i.dipendente==null?null:i.dipendente.first_name," ",i.dipendente==null?null:i.dipendente.last_name),p(5),ne(i.hasRole("admin")||i.hasRole("manager")?12:-1),p(),v("ngIf",i.messaggioSuccesso),p(),v("ngIf",i.messaggioErrore),p(15),ne(i.editingWorkInfo?30:29),p(8),ne(i.editingWorkInfo?38:37),p(9),T(i.dipendente==null?null:i.dipendente.email),p(8),T((i.dipendente==null?null:i.dipendente.phone)||"Non specificato"),p(8),ne(i.dipendente!=null&&i.dipendente.birth_date?62:63),p(8),ne(i.editingWorkInfo?71:70),p(9),T((i.dipendente==null?null:i.dipendente.fiscal_code)||"Non specificato"),p(7),ne(i.hasRole("admin")?86:-1),p(8),ne(i.editingDepartment?95:94),p(10),ne(i.editingWorkInfo?105:104),p(8),ne(i.editingWorkInfo?113:112),p(8),ne(i.editingWorkInfo?121:120),p(8),ne(i.editingWorkInfo?129:128),p(8),ne(i.editingWorkInfo?137:136),p(8),ne(i.editingWorkInfo?145:144),p(2),ne(i.editingWorkInfo?146:-1),p(12),R("",X(159,34,i.statistiche.oreLavorate,"1.1-1")," ore"),p(6),R("",i.statistiche.giorniPresenti," giorni"),p(5),R("",X(170,37,i.statistiche.mediaOreGiornaliere,"1.1-1")," ore"),p(6),T(Qi(176,40,i.statistiche.puntualita)),p(13),R("",(i.dipendente==null?null:i.dipendente.monthly_hours)||0," ore"),p(5),R("",X(194,42,i.statistiche.oreLavorate,"1.1-1")," ore"),p(5),Cr(i.getClasseDifferenzaOre()),p(),R(" ",X(200,45,i.getDifferenzaOre(),"1.1-1")," ore "),p(6),T(Qi(206,48,i.getPercentualeCompletamento())),p(28),ne(i.hasRole("admin")||i.hasRole("manager")?233:-1),p(2),Rt(i.timbratureRecenti),p(2),ne(i.timbratureRecenti.length===0?237:-1),p(8),Rt(i.andamentoSettimanale),p(2),ne(i.isLoading?247:-1))},dependencies:[be,Le,Se,Ut,Gt,Lt,mn,kt,Ft,Me,To,xo,mt,Oe,hn,Et,uv,tn,dl,dt],styles:["[_ngcontent-%COMP%]:root{--dip-card-min: 500px}.grid-cards[_ngcontent-%COMP%]{gap:var(--gutter-lg);grid-template-columns:repeat(auto-fit,minmax(var(--dip-card-min),1fr));max-width:calc((var(--dip-card-min) * 2) + var(--gutter-lg));width:100%;margin-left:auto;margin-right:auto;box-sizing:border-box}.grid-cards[_ngcontent-%COMP%] > .card[_ngcontent-%COMP%]{width:100%;max-width:none;box-sizing:border-box}"]})};var ua=class n{constructor(t,e){this.http=t;this.authService=e}baseUrl="/api/reports";generaReportTimbrature(t,e="xlsx"){let i=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/timbrature`,J(P({},t),{format:e}),{headers:i,responseType:"blob"})}esportaPDF(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/export/pdf`,t,{headers:e,responseType:"blob"})}esportaExcel(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/export/excel`,t,{headers:e,responseType:"blob"})}generaReportKPI(t){return this.http.post(`${this.baseUrl}/kpi`,t,{responseType:"blob"})}static \u0275fac=function(e){return new(e||n)(U(Di),U(ae))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function x3(n,t){n&1&&O(0,"app-loading-spinner")}function D3(n,t){if(n&1&&(c(0,"option",42),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),_e("",e.first_name," ",e.last_name)}}function I3(n,t){if(n&1){let e=k();et(0),c(1,"select",13),W("ngModelChange",function(r){C(e);let o=g();return q(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onFiltroChange())}),c(2,"option",20),d(3,"Tutti i dipendenti"),l(),E(4,D3,2,3,"option",21),l(),tt()}if(n&2){let e=g();p(),H("ngModel",e.filtroDipendente),p(3),v("ngForOf",e.dipendenti)}}function T3(n,t){if(n&1){let e=k();c(0,"div",43),d(1),l(),c(2,"input",44),W("ngModelChange",function(r){C(e);let o=g();return q(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),l()}if(n&2){let e=g();p(),_e(" ",e.currentUser==null?null:e.currentUser.first_name," ",e.currentUser==null?null:e.currentUser.last_name," "),p(),H("ngModel",e.filtroDipendente)}}function M3(n,t){if(n&1&&(c(0,"option",42),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),T(e.name)}}function A3(n,t){if(n&1&&(c(0,"div",45)(1,"div",46),O(2,"div",47),l(),c(3,"div",48),d(4),Z(5,"number"),l(),c(6,"div",49),d(7),l()()),n&2){let e=t.$implicit,i=g();p(2),Si("height",i.getAltezzaBarra(e.ore)+"%"),p(2),R("",X(5,4,e.ore,"1.0-1"),"h"),p(3),T(e.nome)}}function R3(n,t){if(n&1&&(c(0,"div",50)(1,"span",51),d(2),l(),c(3,"span",52),d(4),Z(5,"percent"),l()()),n&2){let e=t.$implicit;p(2),T(e.fascia),p(2),T(Qi(5,2,e.percentuale))}}function O3(n,t){if(n&1&&(c(0,"tr")(1,"td")(2,"div",53)(3,"div",54),d(4),l(),c(5,"div",55)(6,"strong"),d(7),l()()()(),c(8,"td"),d(9),Z(10,"number"),l(),c(11,"td"),d(12),Z(13,"number"),l(),c(14,"td"),d(15),l(),c(16,"td"),d(17),Z(18,"percent"),l(),c(19,"td")(20,"span",56),d(21),l()()()),n&2){let e=t.$implicit;p(4),R(" ",e.nome.charAt(0)," "),p(3),T(e.nome),p(2),R("",X(10,12,e.oreTotali,"1.1-1"),"h"),p(3),R("",X(13,15,e.oreMedieGiorno,"1.1-1"),"h"),p(3),_e("",e.giorniPresente,"/",e.giorniTotali),p(2),T(Qi(18,18,e.puntualita)),p(3),Ce("active",e.attivo)("inactive",!e.attivo),p(),R(" ",e.attivo?"Attivo":"Inattivo"," ")}}function P3(n,t){if(n&1&&(c(0,"div",50)(1,"span",51),d(2),l(),c(3,"span",52),d(4),Z(5,"number"),l()()),n&2){let e=t.$implicit;p(2),T(e.giorno),p(2),R("",X(5,2,e.ore,"1.1-1"),"h")}}function N3(n,t){if(n&1&&(c(0,"div",57)(1,"span",5),d(2,"info"),l(),c(3,"div",58)(4,"span",59),d(5),l(),c(6,"span",60),d(7),l(),c(8,"span",61),d(9),Z(10,"date"),l()()()),n&2){let e=t.$implicit;p(5),T(e.tipo),p(2),T(e.descrizione),p(2),_e("",e.dipendente," - ",Qi(10,4,e.data))}}function k3(n,t){n&1&&(c(0,"div",62)(1,"span",5),d(2,"check_circle"),l(),c(3,"h3"),d(4,"Nessuna anomalia"),l(),c(5,"p"),d(6,"Non sono state rilevate anomalie nelle timbrature"),l()())}var Sp=class n{constructor(t,e,i,r,o,s){this.timbratureService=t;this.dipendentiService=e;this.reportsService=i;this.authService=r;this.departmentsService=o;this.companyService=s}isLoading=!0;filtroPeriodo="mese";filtroDipendente="tutti";filtroReparto="tutti";kpi={oreTotali:0,presenzeMedie:0,oreMediePerDipendente:0,tassoPuntualita:0};orePerDipendente=[];performanceDipendenti=[];distribuzioneOrari=[];andamentoSettimanale=[];anomalie=[];dipendenti=[];reparti=[];currentUser=null;ngOnInit(){return y(this,null,function*(){let t=this.authService.currentUserSubject?.value??null;if(t){let i=t;this.currentUser=i,i.role==="employee"&&(this.filtroDipendente=i.id,this.dipendenti=[{id:i.id,first_name:i.first_name,last_name:i.last_name}]),yield this.caricaReparti(),yield this.caricaDipendenti(),yield this.caricaKPI();return}let e=this.authService.currentUserSubject?.subscribe?.(i=>y(this,null,function*(){if(!i)return;let r=i;this.currentUser=r,r.role==="employee"&&(this.filtroDipendente=r.id,this.dipendenti=[{id:r.id,first_name:r.first_name,last_name:r.last_name}]);try{yield this.caricaReparti(),yield this.caricaDipendenti(),yield this.caricaKPI()}finally{try{e.unsubscribe()}catch{}}}))})}caricaReparti(){return y(this,null,function*(){try{let t=this.currentUser?.company_id??null;if(!t){this.reparti=[];return}let e=yield bn(this.departmentsService.getDepartments(t));this.reparti=Array.isArray(e)?e:[]}catch(t){console.error("[KPI] caricaReparti error",t),this.reparti=[]}})}getDateRange(t){let e=new Date,i=new Date(e),r=new Date(e);switch(t){case"oggi":i.setHours(0,0,0,0),r=new Date(i),r.setDate(r.getDate()+1);break;case"settimana":let o=(e.getDay()+6)%7;i.setDate(e.getDate()-o),i.setHours(0,0,0,0),r=new Date(i),r.setDate(i.getDate()+7);break;case"trimestre":i.setMonth(e.getMonth()-3),i.setHours(0,0,0,0),r=new Date(e),r.setHours(23,59,59,999);break;case"mese":default:i.setDate(1),i.setHours(0,0,0,0),r=new Date(i.getFullYear(),i.getMonth()+1,1);break}return{start:i,end:r}}caricaDipendenti(){return y(this,null,function*(){try{let t=this.currentUser?.company_id??null;if(!t){this.dipendenti=[];return}let e=yield bn(this.dipendentiService.getDipendenti(t)),i=Array.isArray(e)?e:[];if(this.currentUser?.role==="manager")try{let r=yield bn(this.companyService.getAziendaForUser(this.currentUser.id,t));i=this.companyService.filterEmployeesByVisibility(i,r,String(this.currentUser.id))}catch(r){console.warn("[KPI] caricaDipendenti - non \xE8 stato possibile ottenere la azienda per filtro visibilit\xE0",r)}this.currentUser?.role==="employee"&&(i=i.filter(r=>String(r.id)===String(this.currentUser?.id))),this.dipendenti=i??[]}catch(t){console.error("Errore nel caricamento dei dipendenti",t),this.dipendenti=[]}})}caricaKPI(){return y(this,null,function*(){this.isLoading=!0;try{let t=this.currentUser?.company_id??null,e=[];this.currentUser?.role==="employee"?e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id):t?e=yield this.timbratureService.getTimbratureAzienda(t):e=[];let i=(this.dipendenti||[]).map(F=>String(F.id)).filter(Boolean);this.currentUser?.role!=="admin"&&(i.length===0?e=[]:e=e.filter(F=>i.includes(String(F.user_id))));let r=F=>!this.filtroReparto||this.filtroReparto==="tutti"?F:F.filter(Q=>Q.department_id===this.filtroReparto),o=F=>!this.filtroDipendente||this.filtroDipendente==="tutti"?F:F.filter(Q=>Q.user_id===this.filtroDipendente),s=this.getDateRange(this.filtroPeriodo),a=s.start.getTime(),u=s.end.getTime(),f=F=>{if(!F?.start_ts)return!1;let Q=new Date(F.start_ts).getTime();return Q>=a&&Q<u},h=o(r(e)).filter(f),m=h.reduce((F,Q)=>F+(Number(Q.total_minutes)||0),0);this.kpi.oreTotali=Math.round(m/60*10)/10;let b=[];for(let F=new Date(s.start);F<s.end;F.setDate(F.getDate()+1))b.push(new Date(F));let _=b.map(F=>{let Q=new Date(F);Q.setHours(0,0,0,0);let Ie=new Date(Q);return Ie.setDate(Ie.getDate()+1),new Set(h.filter(qn=>{let di=new Date(qn.start_ts);return di>=Q&&di<Ie}).map(qn=>qn.user_id)).size}),w=_.length||1;this.kpi.presenzeMedie=Math.round(_.reduce((F,Q)=>F+Q,0)/w*10)/10;let M={},I={},A=0;h.forEach(F=>{let Q=F.user_id??"unknown",Ie=Number(F.total_minutes)||0;M[Q]=(M[Q]||0)+Ie;let ot=new Date(F.start_ts).toISOString().slice(0,10);I[Q]=I[Q]||new Set,I[Q].add(ot);try{new Date(F.start_ts).getHours()<=9&&A++}catch{}});let L=(this.dipendenti||[]).reduce((F,Q)=>(F[Q.id]=Q,F),{});this.orePerDipendente=Object.keys(M).map(F=>({nome:L[F]?`${L[F].first_name} ${L[F].last_name}`:F||"Utente",ore:Math.round(M[F]/60*10)/10})).sort((F,Q)=>Q.ore-F.ore),this.performanceDipendenti=Object.keys(M).map(F=>{let Q=M[F],Ie=I[F]?I[F].size:0,ot=Math.round(Q/60*10)/10;return{nome:L[F]?`${L[F].first_name} ${L[F].last_name}`:F||"Utente",oreTotali:ot,oreMedieGiorno:Ie>0?Math.round(ot/Ie*10)/10:0,giorniPresente:Ie,giorniTotali:b.length,puntualita:0,attivo:!!(L[F]?.is_active??!0)}});let $=this.filtroDipendente&&this.filtroDipendente!=="tutti"?1:(this.dipendenti||[]).length||1;this.kpi.oreMediePerDipendente=Math.round(this.kpi.oreTotali/$*10)/10,this.kpi.tassoPuntualita=h.length>0?Math.round(A/h.length*100)/100:0;let j={before8:0,b8_830:0,b830_9:0,after9:0};h.forEach(F=>{try{let Q=new Date(F.start_ts),Ie=Q.getHours()*60+Q.getMinutes();Ie<480?j.before8++:Ie<510?j.b8_830++:Ie<540?j.b830_9++:j.after9++}catch{}});let se=h.length||1;this.distribuzioneOrari=[{fascia:"Prima delle 8:00",percentuale:Math.round(j.before8/se*100)/100},{fascia:"8:00 - 8:30",percentuale:Math.round(j.b8_830/se*100)/100},{fascia:"8:30 - 9:00",percentuale:Math.round(j.b830_9/se*100)/100},{fascia:"Dopo le 9:00",percentuale:Math.round(j.after9/se*100)/100}];let je=[];for(let F=6;F>=0;F--){let Q=new Date;Q.setHours(0,0,0,0),Q.setDate(Q.getDate()-F);let Ie=new Date(Q),ot=new Date(Q);ot.setDate(ot.getDate()+1);let qn=h.reduce((di,Bo)=>{let $o=new Date(Bo.start_ts);return $o>=Ie&&$o<ot?di+(Number(Bo.total_minutes)||0):di},0);je.push({giorno:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"][Q.getDay()===0?6:Q.getDay()-1],ore:Math.round(qn/60*10)/10})}this.andamentoSettimanale=je,this.anomalie=h.filter(F=>!F.end_ts||Number(F.total_minutes)<=0).map(F=>({tipo:F.end_ts?"Durata sospetta":"Uscita mancante",descrizione:F.end_ts?"Durata <= 0":"Uscita non registrata",dipendente:L[F.user_id]?`${L[F.user_id].first_name} ${L[F.user_id].last_name}`:F.user_id||"Utente",data:new Date(F.start_ts)}))}catch(t){console.error("Errore nel caricamento dei KPI",t)}finally{this.isLoading=!1}})}getAltezzaBarra(t){let e=Math.max(...this.orePerDipendente.map(i=>i.ore));return e>0?t/e*100:0}onFiltroChange(){this.caricaKPI()}aggiornaDati(){return y(this,null,function*(){yield this.caricaKPI()})}esportaReport(){return y(this,null,function*(){try{yield this.reportsService.generaReportKPI({periodo:this.filtroPeriodo,dipendente:this.filtroDipendente,reparto:this.filtroReparto}).toPromise(),alert("Report KPI esportato con successo!")}catch(t){console.error("Errore nell'esportazione del report",t),alert("Errore nell'esportazione del report")}})}simulaCaricamentoDati(){return new Promise(t=>setTimeout(()=>t(),300))}static \u0275fac=function(e){return new(e||n)(D(vt),D(gt),D(ua),D(ae),D(Fi),D(He))};static \u0275cmp=ve({type:n,selectors:[["app-kpi"]],decls:154,vars:27,consts:[["selfOnly",""],[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],[3,"ngModelChange","change","ngModel"],["value","oggi"],["value","settimana"],["value","mese"],["value","trimestre"],[4,"ngIf","ngIfElse"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value","tutti"],[3,"value",4,"ngFor","ngForOf"],[1,"actions-container"],[1,"promethea-button","outline",3,"click"],[1,"promethea-button",3,"click"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"card-content"],[1,"chart-container"],[1,"chart-bars"],["class","chart-bar",4,"ngFor","ngForOf"],[1,"hours-grid"],["class","hour-item",4,"ngFor","ngForOf"],[1,"form-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","info-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[3,"value"],[1,"readonly-field"],["type","hidden",3,"ngModelChange","ngModel"],[1,"chart-bar"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"bar-label"],[1,"hour-item"],[1,"day-label"],[1,"hour-value"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],[1,"chip"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],[1,"info-detail"],[1,"empty-state"]],template:function(e,i){if(e&1){let r=k();E(0,x3,1,0,"app-loading-spinner",1),c(1,"div",2)(2,"div",3)(3,"div",4)(4,"span",5),d(5,"insights"),l()(),c(6,"div",6)(7,"h1",7),d(8,"Key Performance Indicators"),l(),c(9,"p",8),d(10,"Metriche e statistiche sulle timbrature"),l()()(),c(11,"div",9)(12,"div",10)(13,"div",11)(14,"label",12),d(15,"Periodo"),l(),c(16,"select",13),W("ngModelChange",function(s){return C(r),q(i.filtroPeriodo,s)||(i.filtroPeriodo=s),S(s)}),x("change",function(){return C(r),S(i.onFiltroChange())}),c(17,"option",14),d(18,"Oggi"),l(),c(19,"option",15),d(20,"Questa Settimana"),l(),c(21,"option",16),d(22,"Questo Mese"),l(),c(23,"option",17),d(24,"Questo Trimestre"),l()()(),c(25,"div",11)(26,"label",12),d(27,"Dipendente"),l(),E(28,I3,5,2,"ng-container",18)(29,T3,3,3,"ng-template",null,0,xn),l(),c(31,"div",11)(32,"label",12),d(33,"Reparto"),l(),c(34,"select",19),W("ngModelChange",function(s){return C(r),q(i.filtroReparto,s)||(i.filtroReparto=s),S(s)}),x("change",function(){return C(r),S(i.onFiltroChange())}),c(35,"option",20),d(36,"Tutti"),l(),E(37,M3,2,2,"option",21),l()()(),c(38,"div",22)(39,"button",23),x("click",function(){return C(r),S(i.esportaReport())}),c(40,"span",5),d(41,"download"),l(),d(42," Esporta Report "),l(),c(43,"button",24),x("click",function(){return C(r),S(i.aggiornaDati())}),c(44,"span",5),d(45,"refresh"),l(),d(46," Aggiorna "),l()()(),c(47,"div",25)(48,"div",26)(49,"div",27)(50,"span",5),d(51,"schedule"),l(),c(52,"h3",28),d(53,"Ore Totali Lavorate"),l()(),c(54,"div",29),d(55),Z(56,"number"),l(),c(57,"p",8),d(58,"Nel periodo selezionato"),l()(),c(59,"div",26)(60,"div",27)(61,"span",5),d(62,"groups"),l(),c(63,"h3",28),d(64,"Presenze Medie"),l()(),c(65,"div",29),d(66),Z(67,"number"),l(),c(68,"p",8),d(69,"Dipendenti per giorno"),l()(),c(70,"div",26)(71,"div",27)(72,"span",5),d(73,"timelapse"),l(),c(74,"h3",28),d(75,"Ore Medie per Dip."),l()(),c(76,"div",29),d(77),Z(78,"number"),l(),c(79,"p",8),d(80,"Per dipendente"),l()(),c(81,"div",26)(82,"div",27)(83,"span",5),d(84,"access_time"),l(),c(85,"h3",28),d(86,"Puntualit\xE0"),l()(),c(87,"div",29),d(88),Z(89,"percent"),l(),c(90,"p",8),d(91,"Ingressi in orario"),l()()(),c(92,"div",25)(93,"div",26)(94,"div",27)(95,"span",5),d(96,"bar_chart"),l(),c(97,"h3",28),d(98,"Ore per Dipendente"),l()(),c(99,"div",30)(100,"div",31)(101,"div",32),E(102,A3,8,7,"div",33),l()()()(),c(103,"div",26)(104,"div",27)(105,"span",5),d(106,"pie_chart"),l(),c(107,"h3",28),d(108,"Distribuzione Orari"),l()(),c(109,"div",30)(110,"div",34),E(111,R3,6,4,"div",35),l()()()(),c(112,"div",36)(113,"h2",7)(114,"span",5),d(115,"leaderboard"),l(),d(116," Performance Dipendenti "),l(),c(117,"div",37)(118,"table",38)(119,"thead")(120,"tr")(121,"th"),d(122,"Dipendente"),l(),c(123,"th"),d(124,"Ore Totali"),l(),c(125,"th"),d(126,"Ore Medie/Giorno"),l(),c(127,"th"),d(128,"Giorni Presente"),l(),c(129,"th"),d(130,"Puntualit\xE0"),l(),c(131,"th"),d(132,"Status"),l()()(),c(133,"tbody"),E(134,O3,22,20,"tr",39),l()()()(),c(135,"div",25)(136,"div",26)(137,"div",27)(138,"span",5),d(139,"trending_up"),l(),c(140,"h3",28),d(141,"Andamento Settimanale"),l()(),c(142,"div",30)(143,"div",34),E(144,P3,6,5,"div",35),l()()(),c(145,"div",26)(146,"div",27)(147,"span",5),d(148,"warning"),l(),c(149,"h3",28),d(150,"Anomalie Rilevate"),l()(),c(151,"div",30),E(152,N3,11,6,"div",40)(153,k3,7,0,"div",41),l()()()()}if(e&2){let r=en(30);v("ngIf",i.isLoading),p(16),H("ngModel",i.filtroPeriodo),p(12),v("ngIf",(i.currentUser==null?null:i.currentUser.role)!=="employee")("ngIfElse",r),p(6),H("ngModel",i.filtroReparto),p(3),v("ngForOf",i.reparti),p(18),R("",X(56,16,i.kpi.oreTotali,"1.0-1"),"h"),p(11),T(X(67,19,i.kpi.presenzeMedie,"1.0-1")),p(11),R("",X(78,22,i.kpi.oreMediePerDipendente,"1.0-1"),"h"),p(11),T(Qi(89,25,i.kpi.tassoPuntualita)),p(14),v("ngForOf",i.orePerDipendente),p(9),v("ngForOf",i.distribuzioneOrari),p(23),v("ngForOf",i.performanceDipendenti),p(10),v("ngForOf",i.andamentoSettimanale),p(8),v("ngForOf",i.anomalie),p(),v("ngIf",i.anomalie.length===0)}},dependencies:[Lt,kt,Ft,Me,mt,Oe,Et,be,Le,Se,Gn,tn,dl,dt],encapsulation:2})};var ln=()=>({standalone:!0});function F3(n,t){n&1&&(c(0,"div",53),d(1," Nome obbligatorio "),l())}function L3(n,t){n&1&&(c(0,"div",53),d(1," Cognome obbligatorio "),l())}function j3(n,t){n&1&&(c(0,"div",53),d(1," Email obbligatoria e valida "),l())}function V3(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function U3(n,t){n&1&&O(0,"span",54)}function z3(n,t){if(n&1){let e=k();c(0,"div")(1,"form",16),x("ngSubmit",function(){C(e);let r=g();return S(r.salvaProfilo())}),c(2,"div",17)(3,"div",18)(4,"label",19)(5,"span",6),d(6,"badge"),l(),d(7," Nome * "),l(),O(8,"input",36),E(9,F3,2,0,"div",37),l(),c(10,"div",18)(11,"label",19)(12,"span",6),d(13,"badge"),l(),d(14," Cognome * "),l(),O(15,"input",38),E(16,L3,2,0,"div",37),l(),c(17,"div",18)(18,"label",19)(19,"span",6),d(20,"email"),l(),d(21," Email * "),l(),O(22,"input",39),E(23,j3,2,0,"div",37),l(),c(24,"div",18)(25,"label",19)(26,"span",6),d(27,"phone"),l(),d(28," Telefono "),l(),O(29,"input",40),l(),c(30,"div",18)(31,"label",19)(32,"span",6),d(33,"event_available"),l(),d(34," Data di Assunzione "),l(),O(35,"input",41),c(36,"div",42),d(37,"Modificabile solo dall'amministratore"),l()(),c(38,"div",18)(39,"label",19)(40,"span",6),d(41,"cake"),l(),d(42," Data di Nascita "),l(),O(43,"input",43),l(),c(44,"div",18)(45,"label",19)(46,"span",6),d(47,"place"),l(),d(48," Luogo di Nascita "),l(),O(49,"input",44),l(),c(50,"div",18)(51,"label",19)(52,"span",6),d(53,"badge"),l(),d(54," Codice Fiscale "),l(),O(55,"input",45),l(),c(56,"div",18)(57,"label",19)(58,"span",6),d(59,"work_outline"),l(),d(60," Job Title "),l(),O(61,"input",46),l(),c(62,"div",18)(63,"label",19)(64,"span",6),d(65,"schedule"),l(),d(66," Ore Mensili "),l(),O(67,"input",47),l(),c(68,"div",48)(69,"label",49),O(70,"input",50)(71,"span",30),d(72," Full time "),l()(),c(73,"div",18)(74,"label",19)(75,"span",6),d(76,"public"),l(),d(77," Timezone "),l(),O(78,"input",51),l(),c(79,"div",18)(80,"label",19)(81,"span",6),d(82,"work"),l(),d(83," Ruolo "),l(),O(84,"input",52),l(),c(85,"div",18)(86,"label",19)(87,"span",6),d(88,"business"),l(),d(89," Azienda "),l(),O(90,"input",52),l()(),c(91,"div",23)(92,"button",24),E(93,V3,2,0,"span",25)(94,U3,1,0,"span",26),d(95),l()()()()}if(n&2){let e,i,r,o=g();p(),v("formGroup",o.profiloForm),p(8),v("ngIf",((e=o.profiloForm.get("first_name"))==null?null:e.invalid)&&((e=o.profiloForm.get("first_name"))==null?null:e.touched)),p(7),v("ngIf",((i=o.profiloForm.get("last_name"))==null?null:i.invalid)&&((i=o.profiloForm.get("last_name"))==null?null:i.touched)),p(6),v("disabled",!0),p(),v("ngIf",((r=o.profiloForm.get("email"))==null?null:r.invalid)&&((r=o.profiloForm.get("email"))==null?null:r.touched)),p(12),v("disabled",!o.hasRole("admin")),p(49),v("value",o.currentUser==null?null:o.currentUser.role),p(6),v("value",(o.aziendaCorrente==null?null:o.aziendaCorrente.name)||"N/A"),p(2),v("disabled",o.profiloForm.invalid||o.salvataggioProfilo),p(),v("ngIf",!o.salvataggioProfilo),p(),v("ngIf",o.salvataggioProfilo),p(),R(" ",o.salvataggioProfilo?"Salvando...":"Salva Profilo"," ")}}function B3(n,t){n&1&&(c(0,"div",53),d(1," Nome azienda obbligatorio "),l())}function $3(n,t){n&1&&(c(0,"div",53),d(1," Partita IVA obbligatoria "),l())}function H3(n,t){if(n&1&&(c(0,"span"),d(1),Z(2,"number"),Z(3,"number"),l()),n&2){let e=g().$implicit;p(),_e("coord: ",X(2,2,e.lat,"1.5-5"),", ",X(3,5,e.lng,"1.5-5"))}}function W3(n,t){n&1&&(c(0,"span"),d(1,"coord: \u2014"),l())}function G3(n,t){if(n&1){let e=k();c(0,"div",78)(1,"div",79),d(2),l(),c(3,"div",80)(4,"div",81),d(5),l(),c(6,"div",82)(7,"span",83),d(8,"place"),l(),c(9,"div",84)(10,"div",85)(11,"strong",86),d(12),c(13,"small",87),d(14),l()(),c(15,"div",88),E(16,H3,4,8,"span",14)(17,W3,2,0,"span",14),l()(),c(18,"div",89)(19,"div",90),d(20),l(),c(21,"div",91)(22,"span",92),d(23),l()()()()()(),c(24,"div")(25,"button",93),x("click",function(){let r=C(e).index,o=g(4);return S(o.removePunchPoint(r))}),c(26,"span",6),d(27,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=t.index,r=g(4);p(2),R(" ",((e.name||e.address||"Punto "+(i+1))==null?null:(e.name||e.address||"Punto "+(i+1)).charAt(0))||i+1," "),p(3),T(e.name||e.address||"Punto "+(i+1)),p(7),R(" ",r.getStreet(e)," "),p(2),T(r.getCivic(e)),p(2),v("ngIf",(e==null?null:e.lat)&&(e==null?null:e.lng)),p(),v("ngIf",!(e!=null&&e.lat)||!(e!=null&&e.lng)),p(3),T(r.getCityProvince(e)||"\u2014"),p(3),R("raggio: ",e.radius_m||50," m")}}function q3(n,t){if(n&1){let e=k();c(0,"div",94)(1,"div",18)(2,"label",19),d(3,"Nome Punto"),l(),c(4,"input",95),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.name,r)||(o.newPoint.name=r),S(r)}),l()(),c(5,"div",96)(6,"div",97)(7,"label",19),d(8,"Via / Indirizzo"),l(),c(9,"input",98),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.address,r)||(o.newPoint.address=r),S(r)}),l()(),c(10,"div",99)(11,"label",19),d(12,"Civico"),l(),c(13,"input",100),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.civic_number,r)||(o.newPoint.civic_number=r),S(r)}),l()()(),c(14,"div",101)(15,"div",18)(16,"label",19),d(17,"Citt\xE0"),l(),c(18,"input",102),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.city,r)||(o.newPoint.city=r),S(r)}),l()(),c(19,"div",18)(20,"label",19),d(21,"Provincia"),l(),c(22,"input",103),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.province,r)||(o.newPoint.province=r),S(r)}),l()()(),c(23,"div",104)(24,"div",105)(25,"label",19),d(26,"Raggio (m)"),l(),c(27,"input",106),W("ngModelChange",function(r){C(e);let o=g(4);return q(o.newPoint.radius_m,r)||(o.newPoint.radius_m=r),S(r)}),l()()(),c(28,"div",23)(29,"button",33),x("click",function(){C(e);let r=g(4);return S(r.addPunchPoint())}),d(30," Salva Punto "),l()()()}if(n&2){let e=g(4);p(4),H("ngModel",e.newPoint.name),v("ngModelOptions",$e(13,ln)),p(5),H("ngModel",e.newPoint.address),v("ngModelOptions",$e(14,ln)),p(4),H("ngModel",e.newPoint.civic_number),v("ngModelOptions",$e(15,ln)),p(5),H("ngModel",e.newPoint.city),v("ngModelOptions",$e(16,ln)),p(4),H("ngModel",e.newPoint.province),v("ngModelOptions",$e(17,ln)),p(5),H("ngModel",e.newPoint.radius_m),v("ngModelOptions",$e(18,ln)),p(2),v("disabled",!(e.aziendaCorrente!=null&&e.aziendaCorrente.id)||e.salvataggioAzienda)}}function J3(n,t){if(n&1){let e=k();c(0,"div",70)(1,"h3",73)(2,"span",6),d(3,"place"),l(),d(4,"Punti di Timbratura"),l(),c(5,"div",74),E(6,G3,28,8,"div",75),l(),c(7,"div",76)(8,"button",33),x("click",function(){C(e);let r=g(3);return S(r.toggleAddPointForm())}),c(9,"span",6),d(10),l(),d(11),l()(),E(12,q3,31,19,"div",77),l()}if(n&2){let e=g(3);p(6),v("ngForOf",e.punchPoints),p(2),v("disabled",e.salvataggioAzienda),p(2),T(e.showAddPointForm?"close":"add"),p(),R(" ",e.showAddPointForm?"Annulla":"Aggiungi Punto"," "),p(),v("ngIf",e.showAddPointForm)}}function K3(n,t){if(n&1&&(c(0,"div",110)(1,"div",111),d(2),l(),c(3,"div",112)(4,"div",105)(5,"label",19),d(6,"Apertura"),l(),O(7,"input",113),l(),c(8,"div",105)(9,"label",19),d(10,"Chiusura"),l(),O(11,"input",114),l(),c(12,"div",115)(13,"label",49),O(14,"input",116)(15,"span",30),d(16," Chiuso "),l()()()()),n&2){let e=t.$implicit;v("formGroupName",e.key),p(2),T(e.label)}}function Y3(n,t){if(n&1){let e=k();c(0,"div")(1,"div",107),E(2,K3,17,2,"div",108),l(),c(3,"div",23)(4,"button",109),x("click",function(){C(e);let r=g(3);return S(r.resetOrariDefault())}),c(5,"span",6),d(6,"restore"),l(),d(7," Ripristina Orari Predefiniti "),l()()()}if(n&2){let e=g(3);p(2),v("ngForOf",e.giorniSettimana)}}function Z3(n,t){if(n&1){let e=k();c(0,"div",128)(1,"div")(2,"strong"),d(3),l(),c(4,"div",129),d(5),l()(),c(6,"div")(7,"button",93),x("click",function(){let r=C(e).index,o=g(4);return S(o.rimuoviGiornoChiusura(r))}),c(8,"span",6),d(9,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=g(4);p(3),T(i.formatClosedDay(e)),p(2),T(e.label||(e.type==="range"?"Intervallo":"Giorno singolo"))}}function Q3(n,t){if(n&1){let e=k();c(0,"div")(1,"div",117),E(2,Z3,10,2,"div",118),l(),c(3,"div",119)(4,"div",120)(5,"div",121)(6,"input",122),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.newDate,r)||(o.newDate=r),S(r)}),l()(),c(7,"div",121)(8,"input",123),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.newDateLabel,r)||(o.newDateLabel=r),S(r)}),l()(),c(9,"button",124),x("click",function(){C(e);let r=g(3);return S(r.aggiungiGiornoSingolo())}),d(10,"Aggiungi Giorno"),l()(),c(11,"div",125)(12,"div",121)(13,"input",122),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.rangeStart,r)||(o.rangeStart=r),S(r)}),l()(),c(14,"div",121)(15,"input",122),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.rangeEnd,r)||(o.rangeEnd=r),S(r)}),l()(),c(16,"button",124),x("click",function(){C(e);let r=g(3);return S(r.aggiungiIntervallo())}),d(17,"Aggiungi Intervallo"),l()(),c(18,"div",126)(19,"button",127),x("click",function(){C(e);let r=g(3);return S(r.ripristinaFestivita())}),d(20,"Ripristina Festivit\xE0"),l()()()()}if(n&2){let e=g(3);p(2),v("ngForOf",e.giorniChiusura),p(4),H("ngModel",e.newDate),v("ngModelOptions",$e(9,ln)),p(2),H("ngModel",e.newDateLabel),v("ngModelOptions",$e(10,ln)),p(5),H("ngModel",e.rangeStart),v("ngModelOptions",$e(11,ln)),p(2),H("ngModel",e.rangeEnd),v("ngModelOptions",$e(12,ln))}}function X3(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function ej(n,t){n&1&&O(0,"span",54)}function tj(n,t){if(n&1){let e=k();c(0,"div")(1,"form",16),x("ngSubmit",function(){C(e);let r=g(2);return S(r.salvaAzienda())}),c(2,"div",17)(3,"div",18)(4,"label",19)(5,"span",6),d(6,"corporate_fare"),l(),d(7," Nome Azienda * "),l(),O(8,"input",56),E(9,B3,2,0,"div",37),l(),c(10,"div",18)(11,"label",19)(12,"span",6),d(13,"receipt"),l(),d(14," Partita IVA * "),l(),O(15,"input",57),E(16,$3,2,0,"div",37),l(),c(17,"div",18)(18,"label",19)(19,"span",6),d(20,"location_on"),l(),d(21," Indirizzo "),l(),O(22,"input",58),l(),c(23,"div",18)(24,"label",19)(25,"span",6),d(26,"location_city"),l(),d(27," Citt\xE0 "),l(),O(28,"input",59),l(),c(29,"div",18)(30,"label",19)(31,"span",6),d(32,"map"),l(),d(33," Provincia "),l(),O(34,"input",60),l(),c(35,"div",18)(36,"label",19)(37,"span",6),d(38,"web"),l(),d(39," Sito Web "),l(),O(40,"input",61),l(),c(41,"div",18)(42,"label",19)(43,"span",6),d(44,"phone"),l(),d(45," Telefono Aziendale "),l(),O(46,"input",62),l(),c(47,"div",18)(48,"label",19)(49,"span",6),d(50,"email"),l(),d(51," Email Aziendale "),l(),O(52,"input",63),l(),c(53,"div",18)(54,"label",19)(55,"span",6),d(56,"room_preferences"),l(),d(57," Tipologia Timbratura "),l(),c(58,"div",64)(59,"label",65),O(60,"input",66)(61,"span",67),d(62," Libera "),l(),c(63,"label",65),O(64,"input",68)(65,"span",67),d(66," Punti Timbratura "),l()()(),E(67,J3,13,5,"div",69),c(68,"div",70)(69,"div",12),x("click",function(){C(e);let r=g(2);return S(r.toggleOpeningHours())}),c(70,"h3",8)(71,"span",6),d(72,"schedule"),l(),d(73," Orari di Lavoro "),l(),c(74,"button",71)(75,"span",6),d(76),l()()(),E(77,Y3,8,1,"div",14),l(),c(78,"div",70)(79,"div",12),x("click",function(){C(e);let r=g(2);return S(r.toggleClosedDays())}),c(80,"h3",8)(81,"span",6),d(82,"event_busy"),l(),d(83," Giorni di Chiusura (festivit\xE0 / chiusure)"),l(),c(84,"button",72)(85,"span",6),d(86),l()()(),E(87,Q3,21,13,"div",14),l()(),c(88,"div",23)(89,"button",24),E(90,X3,2,0,"span",25)(91,ej,1,0,"span",26),d(92),l()()()()}if(n&2){let e,i,r,o=g(2);p(),v("formGroup",o.aziendaForm),p(8),v("ngIf",((e=o.aziendaForm.get("name"))==null?null:e.invalid)&&((e=o.aziendaForm.get("name"))==null?null:e.touched)),p(7),v("ngIf",((i=o.aziendaForm.get("vat"))==null?null:i.invalid)&&((i=o.aziendaForm.get("vat"))==null?null:i.touched)),p(36),v("disabled",!0),p(15),v("ngIf",((r=o.aziendaForm.get("timbratura_type"))==null?null:r.value)==="punti"),p(7),Ci("aria-expanded",o.showOpeningHours),p(2),T(o.showOpeningHours?"expand_less":"expand_more"),p(),v("ngIf",o.showOpeningHours),p(7),si("aria-expanded",po(o.showClosedDays)),p(2),T(o.showClosedDays?"expand_less":"expand_more"),p(),v("ngIf",o.showClosedDays),p(2),v("disabled",o.aziendaForm.invalid||o.salvataggioAzienda),p(),v("ngIf",!o.salvataggioAzienda),p(),v("ngIf",o.salvataggioAzienda),p(),R(" ",o.salvataggioAzienda?"Salvando...":"Salva Azienda"," ")}}function nj(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleAzienda())}),c(2,"h2",8)(3,"span",6),d(4,"business"),l(),d(5," Dati Azienda"),l(),c(6,"button",55)(7,"span",6),d(8),l()()(),E(9,tj,93,16,"div",14),l()}if(n&2){let e=g();p(6),Ci("aria-expanded",e.showAzienda),p(2),T(e.showAzienda?"expand_less":"expand_more"),p(),v("ngIf",e.showAzienda)}}function ij(n,t){n&1&&(c(0,"div",139),O(1,"div",140),l())}function rj(n,t){if(n&1){let e=k();et(0),c(1,"input",149),W("ngModelChange",function(r){C(e);let o=g(6);return q(o.editingJobTitle.name,r)||(o.editingJobTitle.name=r),S(r)}),l(),tt()}if(n&2){let e=g(6);p(),H("ngModel",e.editingJobTitle.name)}}function oj(n,t){if(n&1&&d(0),n&2){let e=g().$implicit;T(e.name)}}function sj(n,t){if(n&1){let e=k();et(0),c(1,"input",149),W("ngModelChange",function(r){C(e);let o=g(6);return q(o.editingJobTitle.description,r)||(o.editingJobTitle.description=r),S(r)}),l(),tt()}if(n&2){let e=g(6);p(),H("ngModel",e.editingJobTitle.description)}}function aj(n,t){if(n&1&&d(0),n&2){let e=g().$implicit;T(e.description||"-")}}function lj(n,t){if(n&1){let e=k();c(0,"button",150),x("click",function(){C(e);let r=g().$implicit,o=g(5);return S(o.beginEditJobTitle(r))}),c(1,"span",6),d(2,"edit"),l()()}}function cj(n,t){if(n&1){let e=k();c(0,"button",150),x("click",function(){C(e);let r=g(6);return S(r.saveEditJobTitle())}),c(1,"span",6),d(2,"check"),l()()}}function uj(n,t){if(n&1){let e=k();c(0,"button",150),x("click",function(){C(e);let r=g(6);return S(r.cancelEditJobTitle())}),c(1,"span",6),d(2,"close"),l()()}}function dj(n,t){if(n&1){let e=k();c(0,"tr")(1,"td"),E(2,rj,2,1,"ng-container",145)(3,oj,1,1,"ng-template",null,1,xn),l(),c(5,"td"),E(6,sj,2,1,"ng-container",145)(7,aj,1,1,"ng-template",null,2,xn),l(),c(9,"td")(10,"span",92),d(11),l()(),c(12,"td")(13,"div",146),E(14,lj,3,0,"button",147)(15,cj,3,0,"button",147)(16,uj,3,0,"button",147),c(17,"button",148),x("click",function(r){let o=C(e).$implicit;return g(5).toggleJobTitleActive(o),S(r.stopPropagation())}),c(18,"span",6),d(19),l()()()()()}if(n&2){let e=t.$implicit,i=en(4),r=en(8),o=g(5);p(2),v("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id)("ngIfElse",i),p(4),v("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id)("ngIfElse",r),p(4),Ce("inactive",!e.is_active),p(),T(e.is_active?"Attiva":"Disattiva"),p(3),v("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)!==e.id),p(),v("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id),p(),v("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id),p(),v("title",po(e.is_active?"Disattiva":"Riattiva")),p(2),T(e.is_active?"toggle_on":"toggle_off")}}function fj(n,t){if(n&1&&(c(0,"table",143)(1,"thead")(2,"tr")(3,"th"),d(4,"Nome"),l(),c(5,"th"),d(6,"Descrizione"),l(),c(7,"th"),d(8,"Stato"),l(),c(9,"th"),d(10,"Azioni"),l()()(),c(11,"tbody"),E(12,dj,20,13,"tr",144),l()()),n&2){let e=g(4);p(12),v("ngForOf",e.jobTitles)}}function pj(n,t){n&1&&(c(0,"div",151)(1,"h3"),d(2,"Nessuna mansione"),l(),c(3,"p",9),d(4,"Aggiungi una nuova mansione per iniziare ad assegnarla ai dipendenti."),l()())}function hj(n,t){if(n&1&&(c(0,"div",141),E(1,fj,13,1,"table",142)(2,pj,5,0,"ng-template",null,0,xn),l()),n&2){let e=en(3),i=g(3);p(),v("ngIf",i.jobTitles.length>0)("ngIfElse",e)}}function mj(n,t){if(n&1){let e=k();c(0,"div")(1,"div",131)(2,"div",132)(3,"div",133)(4,"input",134),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.newJobTitleName,r)||(o.newJobTitleName=r),S(r)}),l(),c(5,"input",135),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.newJobTitleDescription,r)||(o.newJobTitleDescription=r),S(r)}),l(),c(6,"button",124),x("click",function(){C(e);let r=g(2);return S(r.createJobTitle(r.aziendaCorrente==null?null:r.aziendaCorrente.id))}),c(7,"span",6),d(8,"add"),l(),d(9," Aggiungi "),l()(),E(10,ij,2,0,"div",136),c(11,"div",137),E(12,hj,4,2,"div",138),l()()()()}if(n&2){let e=g(2);p(4),H("ngModel",e.newJobTitleName),p(),H("ngModel",e.newJobTitleDescription),p(5),v("ngIf",e.isLoadingJobTitles),p(2),v("ngIf",!e.isLoadingJobTitles)}}function gj(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleMansioni())}),c(2,"h2",8)(3,"span",6),d(4,"work_outline"),l(),d(5," Mansioni"),l(),c(6,"button",130)(7,"span",6),d(8),l()()(),E(9,mj,13,4,"div",14),l()}if(n&2){let e=g();p(6),si("aria-expanded",po(e.showMansioni)),p(2),T(e.showMansioni?"expand_less":"expand_more"),p(),v("ngIf",e.showMansioni)}}function vj(n,t){n&1&&(c(0,"div",151)(1,"span",6),d(2,"inbox"),l(),c(3,"p"),d(4,"Nessun reparto creato"),l()())}function _j(n,t){if(n&1&&(c(0,"p",172),d(1),l()),n&2){let e=g(2).$implicit;p(),T(e.description)}}function yj(n,t){n&1&&(c(0,"p",9),d(1,"Nessuna descrizione"),l())}function bj(n,t){if(n&1&&(c(0,"div",167)(1,"div",168)(2,"h4"),d(3),l(),c(4,"span",169),d(5),l()(),E(6,_j,2,1,"p",170)(7,yj,2,0,"p",171),l()),n&2){let e=g().$implicit;p(3),T(e.name),p(2),R("",e.employee_count||0," dipendenti"),p(),v("ngIf",e.description),p(),v("ngIf",!e.description)}}function wj(n,t){if(n&1){let e=k();c(0,"div",173)(1,"input",174),x("ngModelChange",function(r){C(e);let o=g(4);return S(o.editingDepartment&&(o.editingDepartment.name=r))}),l(),c(2,"textarea",175),x("ngModelChange",function(r){C(e);let o=g(4);return S(o.editingDepartment&&(o.editingDepartment.description=r))}),l()()}if(n&2){let e=g(4);p(),v("ngModel",(e.editingDepartment==null?null:e.editingDepartment.name)||""),p(),v("ngModel",(e.editingDepartment==null?null:e.editingDepartment.description)||"")}}function Ej(n,t){if(n&1){let e=k();c(0,"div",176)(1,"button",177),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.avviaModificaReparto(r))}),c(2,"span",6),d(3,"edit"),l()(),c(4,"button",178),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.eliminaReparto(r))}),c(5,"span",6),d(6,"delete"),l()()()}if(n&2){let e=g().$implicit;p(4),v("disabled",(e.employee_count||0)>0)}}function Cj(n,t){if(n&1){let e=k();c(0,"div")(1,"button",179),x("click",function(){C(e);let r=g(4);return S(r.salvaModificaReparto())}),c(2,"span",6),d(3,"check"),l()(),c(4,"button",180),x("click",function(){C(e);let r=g(4);return S(r.annullaModificaReparto())}),c(5,"span",6),d(6,"close"),l()()()}}function Sj(n,t){if(n&1&&(c(0,"div",161)(1,"div",162),E(2,bj,8,4,"div",163)(3,wj,3,2,"div",164),l(),c(4,"div",165),E(5,Ej,7,1,"div",166)(6,Cj,7,0,"div",14),l()()),n&2){let e=t.$implicit,i=g(3);p(2),v("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)!==e.id),p(),v("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)===e.id),p(2),v("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)!==e.id),p(),v("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)===e.id)}}function xj(n,t){if(n&1){let e=k();c(0,"div",154)(1,"div",155)(2,"h3",73),d(3,"Aggiungi Nuovo Reparto"),l(),c(4,"div",17)(5,"div",18)(6,"label",19),d(7,"Nome Reparto *"),l(),c(8,"input",156),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.newDepartmentName,r)||(o.newDepartmentName=r),S(r)}),l()(),c(9,"div",18)(10,"label",19),d(11,"Descrizione"),l(),c(12,"textarea",157),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.newDepartmentDescription,r)||(o.newDepartmentDescription=r),S(r)}),l()()(),c(13,"div",23)(14,"button",33),x("click",function(){C(e);let r=g(2);return S(r.aggiungiReparto())}),c(15,"span",6),d(16,"add"),l(),d(17," Aggiungi Reparto "),l()()(),c(18,"div",155)(19,"h3",73),d(20,"Reparti Esistenti"),l(),E(21,vj,5,0,"div",158),c(22,"div",159),E(23,Sj,7,4,"div",160),l()()()}if(n&2){let e=g(2);p(8),H("ngModel",e.newDepartmentName),v("ngModelOptions",$e(7,ln)),p(4),H("ngModel",e.newDepartmentDescription),v("ngModelOptions",$e(8,ln)),p(2),v("disabled",!e.newDepartmentName||!e.newDepartmentName.trim()||e.salvataggioAzienda),p(7),v("ngIf",e.departments.length===0),p(2),v("ngForOf",e.departments)}}function Dj(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleGestioneReparti())}),c(2,"h2",8)(3,"span",6),d(4,"groups"),l(),d(5," Gestione Reparti"),l(),c(6,"button",152)(7,"span",6),d(8),l()()(),E(9,xj,24,9,"div",153),l()}if(n&2){let e=g();p(6),si("aria-expanded",po(e.showGestioneReparti)),p(2),T(e.showGestioneReparti?"expand_less":"expand_more"),p(),v("ngIf",e.showGestioneReparti)}}function Ij(n,t){if(n&1&&(c(0,"option",183),d(1),l()),n&2){let e=t.$implicit;v("ngValue",e.id),p(),_d("",e.first_name," ",e.last_name," (",e.email,")")}}function Tj(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",199),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerUser(o.id,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),v("value",e.id)("checked",i.managerConfig.user_ids.includes(e.id)),p(),_e(" ",e.first_name," ",e.last_name," ")}}function Mj(n,t){if(n&1){let e=k();c(0,"div",42)(1,"button",109),x("click",function(){C(e);let r=g(5);return S(r.toggleShowEmployees())}),d(2),l()()}if(n&2){let e=g(5);p(2),R(" ",e.showAllEmployees?"Mostra meno":"Mostra tutti ("+e.companyEmployees.length+")"," ")}}function Aj(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Utenti"),l(),c(3,"div",196),E(4,Tj,3,4,"label",197),Z(5,"slice"),l(),E(6,Mj,3,1,"div",198),l()),n&2){let e=g(4);p(4),v("ngForOf",e.showAllEmployees?e.companyEmployees:tl(5,2,e.companyEmployees,0,10)),p(2),v("ngIf",e.companyEmployees.length>10)}}function Rj(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",199),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerRole(o,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),v("value",e)("checked",i.managerConfig.roles.includes(e)),p(),R(" ",e," ")}}function Oj(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Ruoli"),l(),c(3,"div",200),E(4,Rj,3,3,"label",197),l()()),n&2){let e=g(4);p(4),v("ngForOf",e.availableRoles)}}function Pj(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",199),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerDepartment(o.id,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),v("value",e.id)("checked",i.managerConfig.department_ids==null?null:i.managerConfig.department_ids.includes(e.id)),p(),R(" ",e.name," ")}}function Nj(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Reparti"),l(),c(3,"div",159),E(4,Pj,3,3,"label",197),l()()),n&2){let e=g(4);p(4),v("ngForOf",e.departments)}}function kj(n,t){if(n&1){let e=k();c(0,"div",186)(1,"div",18)(2,"label",19),d(3,"Modalit\xE0 di visibilit\xE0"),l(),c(4,"div",187)(5,"label",65)(6,"input",188),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(7," Solo proprie timbrature"),l(),c(8,"label",65)(9,"input",189),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(10," Lista utenti selezionati"),l(),E(11,Aj,7,6,"div",190),c(12,"label",65)(13,"input",191),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(14," Per ruolo"),l(),E(15,Oj,5,1,"div",190),c(16,"label",65)(17,"input",192),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(18," Per reparto"),l(),E(19,Nj,5,1,"div",190),c(20,"label",65)(21,"input",193),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),x("ngModelChange",function(r){C(e);let o=g(3);return S(o.managerConfig.can_view_all_employees=r==="all")}),l(),d(22," Pu\xF2 vedere tutti i dipendenti dell'azienda "),l()()(),c(23,"div",155)(24,"h4",73),d(25,"Permessi Responsabile"),l(),c(26,"div",194)(27,"label",49)(28,"input",29),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.can_manage_departments,r)||(o.managerConfig.can_manage_departments=r),S(r)}),l(),O(29,"span",30),d(30," Pu\xF2 gestire i reparti (creare, modificare, eliminare) "),l(),c(31,"label",49)(32,"input",29),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.can_manage_job_titles,r)||(o.managerConfig.can_manage_job_titles=r),S(r)}),l(),O(33,"span",30),d(34," Pu\xF2 gestire le mansioni (Aggiungi/Modifica/Disattiva) "),l(),c(35,"label",49)(36,"input",195),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.can_view_reports,r)||(o.managerConfig.can_view_reports=r),S(r)}),l(),O(37,"span",30),d(38," Pu\xF2 visualizzare i report aziendali "),l(),c(39,"label",49)(40,"input",195),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.can_edit_employees,r)||(o.managerConfig.can_edit_employees=r),S(r)}),l(),O(41,"span",30),d(42," Pu\xF2 modificare i dati dei dipendenti (anagrafiche) "),l(),c(43,"label",49)(44,"input",195),W("ngModelChange",function(r){C(e);let o=g(3);return q(o.managerConfig.can_modify_timbrature,r)||(o.managerConfig.can_modify_timbrature=r),S(r)}),l(),O(45,"span",30),d(46," Pu\xF2 modificare le timbrature (approva/applica richieste) "),l()()(),c(47,"div",23)(48,"button",33),x("click",function(){C(e);let r=g(3);return S(r.salvaManagerVisibility())}),d(49," Salva Visibilit\xE0 "),l()()()}if(n&2){let e=g(3);p(6),H("ngModel",e.managerConfig.mode),p(3),H("ngModel",e.managerConfig.mode),p(2),v("ngIf",e.managerConfig.mode==="selected_users"),p(2),H("ngModel",e.managerConfig.mode),p(2),v("ngIf",e.managerConfig.mode==="roles"),p(2),H("ngModel",e.managerConfig.mode),p(2),v("ngIf",e.managerConfig.mode==="department"),p(2),H("ngModel",e.managerConfig.mode),p(7),H("ngModel",e.managerConfig.can_manage_departments),p(4),H("ngModel",e.managerConfig.can_manage_job_titles),p(4),H("ngModel",e.managerConfig.can_view_reports),v("ngModelOptions",$e(17,ln)),p(4),H("ngModel",e.managerConfig.can_edit_employees),v("ngModelOptions",$e(18,ln)),p(4),H("ngModel",e.managerConfig.can_modify_timbrature),v("ngModelOptions",$e(19,ln)),p(4),v("disabled",e.salvataggioAzienda)}}function Fj(n,t){if(n&1){let e=k();c(0,"div",154)(1,"div",18)(2,"label",19),d(3,"Seleziona Responsabile"),l(),c(4,"select",182),W("ngModelChange",function(r){C(e);let o=g(2);return q(o.selectedManagerId,r)||(o.selectedManagerId=r),S(r)}),x("change",function(){C(e);let r=g(2);return S(r.onManagerSelected())}),c(5,"option",183),d(6,"-- Seleziona --"),l(),E(7,Ij,2,4,"option",184),l()(),E(8,kj,50,20,"div",185),l()}if(n&2){let e=g(2);p(4),H("ngModel",e.selectedManagerId),p(),v("ngValue",null),p(2),v("ngForOf",e.managerUsers),p(),v("ngIf",e.selectedManagerId)}}function Lj(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleVisibilitaResponsabili())}),c(2,"h2",8)(3,"span",6),d(4,"visibility"),l(),d(5," Visibilit\xE0 Responsabili"),l(),c(6,"button",181)(7,"span",6),d(8),l()()(),E(9,Fj,9,4,"div",153),l()}if(n&2){let e=g();p(6),si("aria-expanded",po(e.showVisibilitaResponsabili)),p(2),T(e.showVisibilitaResponsabili?"expand_less":"expand_more"),p(),v("ngIf",e.showVisibilitaResponsabili)}}function jj(n,t){n&1&&(c(0,"span",6),d(1,"lock"),l())}function Vj(n,t){n&1&&O(0,"span",54)}function Uj(n,t){if(n&1){let e=k();c(0,"label",28)(1,"input",29),W("ngModelChange",function(r){C(e);let o=g();return q(o.impostazioniNotifiche.notificheAmministratore,r)||(o.impostazioniNotifiche.notificheAmministratore=r),S(r)}),l(),O(2,"span",30),c(3,"div",31)(4,"strong"),d(5,"Notifiche Amministratore"),l(),c(6,"span"),d(7,"Ricevi notifiche per le attivit\xE0 aziendali"),l()()()}if(n&2){let e=g();p(),H("ngModel",e.impostazioniNotifiche.notificheAmministratore)}}function zj(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function Bj(n,t){n&1&&O(0,"span",54)}function $j(n,t){if(n&1&&(c(0,"div",201)(1,"span",6),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioSuccesso," ")}}function Hj(n,t){if(n&1&&(c(0,"div",202)(1,"span",6),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioErrore," ")}}var xp=class n{constructor(t,e,i,r,o,s){this.fb=t;this.authService=e;this.companyService=i;this.dipendentiService=r;this.jobtitleService=o;this.departmentsService=s;this.profiloForm=this.creaProfiloForm(),this.aziendaForm=this.creaAziendaForm(),this.sicurezzaForm=this.creaSicurezzaForm()}profiloForm;aziendaForm;sicurezzaForm;giorniChiusura=[];newDate=null;newDateLabel=null;rangeStart=null;rangeEnd=null;currentYear=new Date().getFullYear();punchPoints=[];newPoint={name:"",address:"",civic_number:"",city:null,province:null,lat:null,lng:null,radius_m:50};showAllEmployees=!1;companyEmployees=[];availableRoles=[];selectedManagerId=null;managerConfig={mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_manage_departments:!1,can_manage_job_titles:!1,can_view_reports:!1,can_edit_employees:!1,can_modify_timbrature:!1};managerVisibilityMap={};currentUser=null;aziendaCorrente=null;impostazioniNotifiche={emailNotifiche:!0,riepilogoGiornaliero:!1,notificheAmministratore:!0};closedDays=[];salvataggioProfilo=!1;salvataggioAzienda=!1;salvataggioPassword=!1;salvataggioNotifiche=!1;departments=[];newDepartmentName="";newDepartmentDescription="";editingDepartment=null;messaggioSuccesso="";messaggioErrore="";giorniSettimana=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];showAddPointForm=!1;showOpeningHours=!1;showProfilo=!1;showAzienda=!1;showReparti=!1;showClosedDays=!1;showGestioneReparti=!1;showVisibilitaResponsabili=!1;showMansioni=!1;jobTitles=[];isLoadingJobTitles=!1;newJobTitleName=null;newJobTitleDescription=null;editingJobTitle=null;ngOnInit(){this.aziendaForm=this.creaAziendaForm(),this.authService.currentUser$.subscribe(t=>{this.currentUser=t??null,t&&(this.caricaDatiProfilo(),this.companyService.getAziendaForUser(t.id,t.company_id).subscribe({next:e=>{if(!e){console.warn("[Impostazioni] nessuna azienda trovata per utente",t.id);return}this.aziendaCorrente=e,this.managerVisibilityMap=e.manager_visibility??{},this.loadManagerVisibilityData(),(this.hasRole("admin")||this.hasRole("manager")&&this.canManageDepartments())&&this.caricaReparti(),this.patchAziendaForm(e);let i=this.openingHoursGroup;i&&i.valueChanges.pipe(ih(800),rh((r,o)=>JSON.stringify(r)===JSON.stringify(o))).subscribe(()=>{this.aziendaCorrente?.id&&this.autoSaveOpeningHours()})},error:e=>{console.error("[Impostazioni] errore getAziendaForUser",e)}}))})}safeGet(t,e=""){return t??e}creaProfiloForm(){return this.fb.group({first_name:["",ee.required],last_name:["",ee.required],email:[{value:"",disabled:!0},[ee.required,ee.email]],phone:[""],hire_date:[""],birth_date:[""],birth_place:[""],fiscal_code:[""],job_title:[""],monthly_hours:[null],full_time:[!1],timezone:["Europe/Rome"]})}creaAziendaForm(){let t=this.fb.group({});return this.giorniSettimana.forEach(e=>{t.addControl(e.key,this.fb.group({open:[""],close:[""],closed:[!1]}))}),this.fb.group({name:["",ee.required],vat:["",ee.required],address:[""],city:[""],province:[""],numero_telefono:[""],email:[{value:"",disabled:!0},[ee.email]],website:[""],opening_hours:t,timbratura_type:["libera"]})}get openingHoursGroup(){return this.aziendaForm.get("opening_hours")}patchAziendaForm(t){let e=P({},t);t.opening_hours&&(e.opening_hours=t.opening_hours),e.timbratura_type=t.timbratura_type??"libera",this.aziendaForm.patchValue(e),this.aziendaForm.get("email")?.disable({emitEvent:!1}),this.punchPoints=t.punch_points?[...t.punch_points]:[],t.city&&(this.newPoint.city=t.city),t.province&&(this.newPoint.province=t.province);let i=this.openingHoursGroup,r=t?.opening_hours;console.log("[Impostazioni] Dati opening_hours dal DB:",r),r&&typeof r=="object"?this.giorniSettimana.forEach(s=>{let a=r[s.key],u=i.get(s.key);u&&a?(console.log(`[Impostazioni] Patch giorno ${s.key}:`,a),u.patchValue({open:a.open||"",close:a.close||"",closed:a.closed||!1})):console.warn(`[Impostazioni] FormGroup non trovato per giorno: ${s.key}`)}):console.warn("[Impostazioni] opening_hours non trovato o non valido:",r);let o=t.closed_days;o&&Array.isArray(o)&&o.length>0?this.giorniChiusura=o.map(s=>{if(!s)return null;if(typeof s=="string")if(s.includes("/")){let[a,u]=s.split("/");return{type:"range",start:a,end:u,label:`Chiusura ${this.formatDateDisplay(a)}`}}else{let a=this.festivitaMap()[s];return{type:"single",start:s,label:a??"Festa"}}return{type:s.type==="range"?"range":"single",start:s.start,end:s.end??void 0,label:s.label??(s.type==="range"?`Chiusura ${this.formatDateDisplay(s.start)}`:"Festa")}}).filter(Boolean):this.giorniChiusura.length===0&&(this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear))}debugOrari(){console.log("=== DEBUG ORARI ==="),console.log("giorniSettimana:",this.giorniSettimana),console.log("openingHoursGroup:",this.openingHoursGroup),console.log("openingHoursGroup valid:",this.openingHoursGroup?.valid),console.log("openingHoursGroup value:",JSON.stringify(this.openingHoursGroup?.value,null,2)),console.log("showOpeningHours:",this.showOpeningHours),this.giorniSettimana.forEach(t=>{let e=this.openingHoursGroup?.get(t.key);console.log(`${t.label} (${t.key}):`,{open:e?.get("open")?.value,close:e?.get("close")?.value,closed:e?.get("closed")?.value,valid:e?.valid})})}aggiungiGiornoSingolo(){if(!this.newDate)return;let t=(this.newDateLabel||"").trim()||"Festa personalizzata";this.giorniChiusura.some(i=>i.type==="single"&&i.start===this.newDate)||(this.giorniChiusura.push({type:"single",start:this.newDate,label:t}),this.newDate=null,this.newDateLabel=null,this.persistClosedDays())}aggiungiIntervallo(){if(!this.rangeStart||!this.rangeEnd)return;if(this.rangeEnd<this.rangeStart){let e=this.rangeStart;this.rangeStart=this.rangeEnd,this.rangeEnd=e}this.giorniChiusura.some(e=>e.type==="range"&&e.start===this.rangeStart&&e.end===this.rangeEnd)||(this.giorniChiusura.push({type:"range",start:this.rangeStart,end:this.rangeEnd,label:"Intervallo personalizzato"}),this.rangeStart=null,this.rangeEnd=null,this.persistClosedDays())}rimuoviGiornoChiusura(t){this.giorniChiusura.splice(t,1),this.persistClosedDays()}ripristinaFestivita(){this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear)}persistClosedDays(){if(!this.aziendaCorrente?.id){console.warn("[Impostazioni] persistClosedDays: aziendaCorrente mancante, skip save");return}let t={closed_days:this.closedDaysToPayload()};this.salvataggioAzienda=!0,this.messaggioErrore="",this.companyService.aggiornaAzienda(this.aziendaCorrente.id,t).subscribe({next:e=>{this.salvataggioAzienda=!1,e&&(this.aziendaCorrente=e,this.patchAziendaForm(e)),this.messaggioSuccesso="Festivit\xE0 salvata",this.nascondiMessaggioDopoTimeout()},error:e=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] errore persistClosedDays",e),this.messaggioErrore="Errore durante il salvataggio delle festivit\xE0",this.nascondiMessaggioDopoTimeout()}})}closedDaysToPayload(){return this.giorniChiusura.map(t=>t?t.type==="range"?{type:"range",start:t.start,end:t.end,label:t.label??`Chiusura ${this.formatDateDisplay(t.start)}`}:{type:"single",start:t.start,label:t.label??"Festa"}:null).filter(Boolean)}creaSicurezzaForm(){return this.fb.group({currentPassword:[""],newPassword:[""],confirmPassword:[""]})}caricaDatiProfilo(){this.currentUser&&(this.profiloForm.patchValue({first_name:this.currentUser.first_name,last_name:this.currentUser.last_name,email:this.currentUser.email,phone:this.currentUser.phone||"",hire_date:this.currentUser.hire_date??"",birth_date:this.currentUser.birth_date??"",birth_place:this.currentUser.birth_place??"",fiscal_code:this.currentUser.fiscal_code??"",job_title:this.currentUser.job_title??"",monthly_hours:this.currentUser.monthly_hours??null,full_time:this.currentUser.full_time??!1,timezone:this.currentUser.timezone??"Europe/Rome"}),this.currentUser.notifications_preferences&&(this.impostazioniNotifiche=P(P({},this.impostazioniNotifiche),this.currentUser.notifications_preferences)),this.hasRole("admin")?this.profiloForm.get("hire_date")?.enable():this.profiloForm.get("hire_date")?.disable())}caricaDatiAzienda(t){t&&this.companyService.getAzienda(t).subscribe({next:e=>{if(!e){console.warn("Nessuna azienda trovata per id",t);return}this.aziendaCorrente=e;let i=P({},e);e.opening_hours&&(i.opening_hours=e.opening_hours),this.aziendaForm.patchValue(i);let r=e.closed_days;r&&Array.isArray(r)&&r.length>0?this.giorniChiusura=r.map(s=>{if(typeof s!="string")return null;if(s.includes("/")){let[a,u]=s.split("/");return{type:"range",start:a,end:u,label:`Chiusura ${this.formatDateDisplay(a)}`}}else{let a=this.festivitaMap()[s];return{type:"single",start:s,label:a??"Festa"}}}).filter(Boolean):this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear);let o=this.openingHoursGroup;e.opening_hours&&Object.keys(e.opening_hours).forEach(s=>{let a=o.get(s);a&&(a.get("open")?.setValue(e.opening_hours?.[s]?.open??""),a.get("close")?.setValue(e.opening_hours?.[s]?.close??""),a.get("closed")?.setValue(!!e.opening_hours?.[s]?.closed))})},error:e=>{console.error("Errore nel caricamento dati azienda:",e)}})}hasRole(t){return this.authService.hasRole(t)}salvaProfilo(){return y(this,null,function*(){if(this.profiloForm.invalid||!this.currentUser){this.profiloForm.markAllAsTouched();return}this.salvataggioProfilo=!0,this.messaggioErrore="";try{let t=this.profiloForm.getRawValue(),e={first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone||null,birth_date:t.birth_date?t.birth_date:null,birth_place:t.birth_place||null,fiscal_code:t.fiscal_code||null,job_title:t.job_title||null,monthly_hours:t.monthly_hours!==""&&t.monthly_hours!=null?Number(t.monthly_hours):null,full_time:!!t.full_time,timezone:t.timezone||null};this.hasRole("admin")&&(e.hire_date=t.hire_date?t.hire_date:null),e.notifications_preferences=this.impostazioniNotifiche;let i=yield this.authService.updateUserProfile(this.currentUser.id,e);this.currentUser=i??this.currentUser,this.messaggioSuccesso="Profilo aggiornato con successo!",this.nascondiMessaggioDopoTimeout(),this.showSystemNotification("Aggiornato il profilo con successo")}catch(t){console.error("[Impostazioni] errore salvaProfilo",t),this.messaggioErrore="Errore durante il salvataggio del profilo"}finally{this.salvataggioProfilo=!1}})}salvaAzienda(){if(this.aziendaForm.invalid){this.aziendaForm.markAllAsTouched();return}this.salvataggioAzienda=!0,this.messaggioErrore="";let t=this.aziendaForm.value,e={},i=this.aziendaForm.get("opening_hours");this.giorniSettimana.forEach(o=>{let s=i.get(o.key);e[o.key]={open:s.get("open")?.value||null,close:s.get("close")?.value||null,closed:!!s.get("closed")?.value}});let r=J(P({},t),{opening_hours:e,closed_days:this.closedDaysToPayload(),timbratura_type:t.timbratura_type??"libera",punch_points:this.punchPoints});console.debug("[Impostazioni] salvaAzienda payload:",r,"companyId:",this.aziendaCorrente?.id),this.companyService.aggiornaAzienda(this.aziendaCorrente.id,r).subscribe({next:o=>{this.salvataggioAzienda=!1,o&&(this.aziendaCorrente=o,this.patchAziendaForm(o)),this.messaggioSuccesso="Dati azienda aggiornati con successo!",this.nascondiMessaggioDopoTimeout()},error:o=>{this.salvataggioAzienda=!1,this.messaggioErrore="Errore durante il salvataggio dei dati azienda",console.error("Errore aggiornamento azienda:",o)}})}showSystemNotification(t,e=!1){return y(this,null,function*(){if(!("Notification"in window)){console.debug("[Impostazioni] Notification API non disponibile");return}if(!(location.protocol==="https:"||location.hostname==="localhost"||location.hostname==="127.0.0.1")){console.debug("[Impostazioni] Notification API richiede HTTPS o localhost");return}try{if(Notification.permission==="granted"){new Notification(t,{silent:!1});return}if(Notification.permission!=="denied"){let r=yield Notification.requestPermission();r==="granted"?new Notification(t,{silent:!1}):console.debug("[Impostazioni] Notification permission non concessa:",r)}else console.debug("[Impostazioni] Notification permission \xE8 denied")}catch(r){console.warn("[Impostazioni] errore Notification API",r)}})}cambiaPassword(){if(this.sicurezzaForm.invalid){this.sicurezzaForm.markAllAsTouched();return}this.salvataggioPassword=!0,this.messaggioErrore="",setTimeout(()=>{this.salvataggioPassword=!1,this.sicurezzaForm.reset(),this.messaggioSuccesso="Password cambiata con successo!",this.nascondiMessaggioDopoTimeout()},1e3)}salvaNotifiche(){return y(this,null,function*(){if(!this.currentUser){console.debug("[Impostazioni] salvaNotifiche: utente non autenticato");return}this.salvataggioNotifiche=!0,this.messaggioErrore="";let t=null;try{"Notification"in window?location.protocol==="https:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"?(t=yield Notification.requestPermission(),console.debug("[Impostazioni] Notification.requestPermission =>",t)):console.debug("[Impostazioni] Notification API richiede HTTPS o localhost"):console.debug("[Impostazioni] Notification API non disponibile")}catch(i){console.warn("[Impostazioni] errore requestPermission",i)}let e={notifications_preferences:this.impostazioniNotifiche};console.debug("[Impostazioni] salvaNotifiche payload:",e);try{let i=yield this.authService.updateUserProfile(this.currentUser.id,e);if(console.debug("[Impostazioni] updateUserProfile response:",i),this.currentUser=i??this.currentUser,this.salvataggioNotifiche=!1,this.messaggioSuccesso="Preferenze notifiche salvate!",this.nascondiMessaggioDopoTimeout(),t==="granted")try{new Notification("Aggiornato il profilo con successo")}catch(r){console.warn("[Impostazioni] errore creazione Notification",r)}else console.debug("[Impostazioni] permesso notifiche non concesso, nessuna notifica di sistema mostrata")}catch(i){let r=i&&(i.message||i.error||JSON.stringify(i))||"Errore sconosciuto";if(console.error("[Impostazioni] errore salvaNotifiche",i),this.salvataggioNotifiche=!1,this.messaggioErrore="Errore durante il salvataggio delle preferenze: "+r,t==="granted")try{new Notification("Salvataggio preferenze fallito")}catch{}}})}toggleGiornoChiusura(t){let e=t.target,i=e.value;if(i){e.checked?this.giorniChiusura.some(o=>o.type==="single"&&o.start===i)||this.giorniChiusura.push({type:"single",start:i,label:"Festa personalizzata"}):this.giorniChiusura=this.giorniChiusura.filter(r=>!(r.type==="single"&&r.start===i));try{this.persistClosedDays()}catch(r){console.warn("[Impostazioni] persistClosedDays failed from toggleGiornoChiusura",r)}}}formatDateDisplay(t){if(!t)return"";let e=t.split("-");if(e.length!==3)return t;let[i,r,o]=e;return`${o}/${r}/${i}`}formatClosedDay(t){return t?t.type==="range"?`${this.formatDateDisplay(t.start)} \u2192 ${this.formatDateDisplay(t.end??"")}`:this.formatDateDisplay(t.start):""}nascondiMessaggioDopoTimeout(){setTimeout(()=>{this.messaggioSuccesso="",this.messaggioErrore=""},5e3)}getFestivitaItalianeDetailed(t){let e=h=>h.toString().padStart(2,"0"),i=h=>`${h.getFullYear()}-${e(h.getMonth()+1)}-${e(h.getDate())}`,r={[i(new Date(t,0,1))]:"Capodanno",[i(new Date(t,0,6))]:"Epifania",[i(new Date(t,3,25))]:"Festa della Liberazione",[i(new Date(t,4,1))]:"Festa del Lavoro",[i(new Date(t,5,2))]:"Festa della Repubblica",[i(new Date(t,7,15))]:"Ferragosto",[i(new Date(t,10,1))]:"Ognissanti",[i(new Date(t,11,8))]:"Immacolata Concezione",[i(new Date(t,11,25))]:"Natale",[i(new Date(t,11,26))]:"Santo Stefano"},o=this.calculateEasterDate(t),s=i(o),a=new Date(o);a.setDate(a.getDate()+1);let u=i(a),f=[];return Object.keys(r).forEach(h=>f.push({type:"single",start:h,label:r[h]})),f.push({type:"single",start:s,label:"Pasqua"}),f.push({type:"single",start:u,label:"Pasquetta"}),f.sort((h,m)=>h.start>m.start?1:h.start<m.start?-1:0),f}festivitaMap(){let t=this.getFestivitaItalianeDetailed(this.currentYear),e={};return t.forEach(i=>{e[i.start]=i.label??"Festa"}),e}calculateEasterDate(t){let e=t%19,i=Math.floor(t/100),r=t%100,o=Math.floor(i/4),s=i%4,a=Math.floor((i+8)/25),u=Math.floor((i-a+1)/3),f=(19*e+i-o-u+15)%30,h=Math.floor(r/4),m=r%4,b=(32+2*s+2*h-f-m)%7,_=Math.floor((e+11*f+22*b)/451),w=Math.floor((f+b-7*_+114)/31),M=(f+b-7*_+114)%31+1;return new Date(t,w-1,M)}loadManagerVisibilityData(){if(!this.aziendaCorrente?.id){console.debug("[Impostazioni] loadManagerVisibilityData called without aziendaCorrente.id");return}let t=this.aziendaCorrente.id;console.debug("[Impostazioni] loadManagerVisibilityData companyId=",t),this.dipendentiService.getDipendenti(t).subscribe({next:e=>{let i=e??[];console.debug("[Impostazioni] loadManagerVisibilityData response count=",i.length),this.companyEmployees=i;let r=new Set;i.forEach(o=>{o&&typeof o.role=="string"&&o.role.trim()&&r.add(o.role)}),this.availableRoles=Array.from(r),i.length===0&&console.warn("[Impostazioni] loadManagerVisibilityData: no employees returned for company",t)},error:e=>{console.error("[Impostazioni] errore loadManagerVisibilityData",e)}})}onManagerSelected(){if(!this.selectedManagerId){this.managerConfig={mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_manage_departments:!1,can_manage_job_titles:!1,can_view_reports:!1,can_edit_employees:!1,can_modify_timbrature:!1};return}let t=this.managerVisibilityMap[this.selectedManagerId]??{mode:"self",user_ids:[],roles:[]};this.managerConfig={mode:t.mode??"self",user_ids:Array.isArray(t.user_ids)?t.user_ids:[],roles:Array.isArray(t.roles)?t.roles:[],department_ids:Array.isArray(t.department_ids)?t.department_ids:[],can_view_all_employees:!!t.can_view_all_employees,can_manage_departments:!!t.can_manage_departments,can_manage_job_titles:!!t.can_manage_job_titles,can_view_reports:!!t.can_view_reports,can_edit_employees:!!t.can_edit_employees,can_modify_timbrature:!!t.can_modify_timbrature}}canManageJobTitles(){return this.hasRole("admin")?!0:this.currentUser?!!(this.managerVisibilityMap[this.currentUser.id]??{}).can_manage_job_titles:!1}canManageDepartments(){return this.hasRole("admin")?!0:this.currentUser?!!(this.managerVisibilityMap[this.currentUser.id]??{}).can_manage_departments:!1}toggleManagerUser(t,e){let i=e.target.checked,r=this.managerConfig.user_ids.indexOf(t);i&&r===-1?this.managerConfig.user_ids.push(t):!i&&r!==-1&&this.managerConfig.user_ids.splice(r,1)}toggleManagerRole(t,e){e.target.checked?this.managerConfig.roles.includes(t)||this.managerConfig.roles.push(t):this.managerConfig.roles=this.managerConfig.roles.filter(r=>r!==t)}salvaManagerVisibility(){if(!this.aziendaCorrente||!this.aziendaCorrente.id||!this.selectedManagerId)return;this.managerVisibilityMap[this.selectedManagerId]=P({},this.managerConfig);let t={manager_visibility:this.managerVisibilityMap};this.salvataggioAzienda=!0,console.debug("[Impostazioni] salvaManagerVisibility payload =>",{companyId:this.aziendaCorrente.id,payload:t}),this.companyService.aggiornaAzienda(this.aziendaCorrente.id,t).subscribe({next:e=>{this.salvataggioAzienda=!1,console.debug("[Impostazioni] salvaManagerVisibility response =>",e),this.messaggioSuccesso="Visibilit\xE0 responsabile salvata",this.nascondiMessaggioDopoTimeout()},error:e=>{this.salvataggioAzienda=!1,this.messaggioErrore="Errore salvataggio visibilit\xE0 responsabile: "+(e?.message||JSON.stringify(e)),console.error("[Impostazioni] salvaManagerVisibility error",e)}})}addPunchPoint(){return y(this,null,function*(){if(this.messaggioErrore="",!this.aziendaCorrente?.id){if(!this.currentUser){this.messaggioErrore="Azienda non selezionata e utente non autenticato",console.debug("[Impostazioni] addPunchPoint abort: aziendaCorrente missing and no currentUser",{currentUser:this.currentUser});return}try{let u=yield ze(this.companyService.getAziendaForUser(this.currentUser.id,this.currentUser.company_id));u&&(this.aziendaCorrente=u,this.punchPoints=[...u.punch_points||[]],this.patchAziendaForm(u))}catch(u){console.warn("[Impostazioni] fallback getAziendaForUser failed",u)}}if(!this.aziendaCorrente?.id){this.messaggioErrore="Azienda non selezionata",console.debug("[Impostazioni] addPunchPoint abort: aziendaCorrente missing after reload attempt",{currentUser:this.currentUser});return}let t=P({},this.newPoint);t.radius_m=Number(t.radius_m)||50;let e=t.address||"",i=t.civic_number||"",r=t.city||this.aziendaCorrente?.city||"",o=t.province||this.aziendaCorrente?.province||"",s=yield this.geocodeAddress(e,i,r,o);if(!s){this.messaggioErrore="Impossibile trovare coordinate per l'indirizzo inserito. Controlla indirizzo/civico/citt\xE0.";return}t.lat=s.lat,t.lng=s.lng,t.address=s.displayName,t.id=Math.random().toString(36).slice(2,9),delete t.civic_number;let a=[...this.punchPoints||[],t];this.salvataggioAzienda=!0,this.companyService.aggiornaAzienda(this.aziendaCorrente.id,{punch_points:a}).subscribe({next:u=>y(this,null,function*(){this.salvataggioAzienda=!1,console.debug("[Impostazioni] aggiornaAzienda response",u);try{if(!this.currentUser)console.warn("[Impostazioni] currentUser non definito, salto refresh azienda");else{let f=yield ze(this.companyService.getAziendaForUser(this.currentUser.id,this.currentUser.company_id));f&&(this.aziendaCorrente=f,this.punchPoints=[...f.punch_points||[]],this.patchAziendaForm(f))}}catch(f){console.warn("[Impostazioni] impossibile ricaricare azienda dopo update",f),u&&(this.aziendaCorrente=u,this.punchPoints=u.punch_points||a,this.patchAziendaForm(u))}this.messaggioSuccesso="Punto di timbratura salvato",this.nascondiMessaggioDopoTimeout()}),error:u=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] errore salva punch_point",u),this.messaggioErrore="Errore durante il salvataggio del punto (verifica permessi / console network)"}})})}removePunchPoint(t){this.punchPoints.splice(t,1)}toggleShowEmployees(){this.showAllEmployees=!this.showAllEmployees}geocodeAddress(t,e,i,r){return y(this,null,function*(){let o=[];t&&o.push(t),e&&o.push(e),i&&o.push(i),r&&o.push(r);let s=o.join(", ");if(!s)return null;let a="https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(s);try{let u=yield fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(!u.ok)return null;let f=yield u.json();if(!Array.isArray(f)||f.length===0)return null;let h=f[0];return{lat:Number(h.lat),lng:Number(h.lon),displayName:h.display_name}}catch(u){return console.error("[Impostazioni] geocodeAddress error",u),null}})}getStreet(t){let e=(t?.address||t?.name||"").toString().trim();if(!e)return"";let i=e.split(",").map(s=>s.trim()).filter(Boolean),r=i[0]||"",o=r.match(/^(.*\D)\s+(\d+\S*)$/);return o?o[1].trim():i.length>=2&&/^\d+\S*$/.test(i[0])?i[1]:r}getCivic(t){let e=(t?.address||"").toString().trim();if(!e)return"";let i=e.split(",").map(s=>s.trim()).filter(Boolean),o=(i[0]||"").match(/^(.*\D)\s+(\d+\S*)$/);return o?o[2].trim():i.length>=2&&/^\d+\S*$/.test(i[0])?i[0]:i.length>=2&&/^\d+\S*$/.test(i[1])?i[1]:""}getCityProvince(t){let e=(t?.city||"").toString().trim(),i=(t?.province||"").toString().trim();if(e||i)return`${e}${i&&e!==i?" "+i:""}`.trim();let r=(t?.address||"").toString().trim();if(!r)return"";let o=r.split(",").map(f=>f.trim()).filter(Boolean),s=["italia","italy"];for(;o.length&&s.includes(o[o.length-1].toLowerCase());)o.pop();for(;o.length&&/^\d{4,}$/.test(o[o.length-1]);)o.pop();let a=this.getStreet(t),u=this.getCivic(t);for(let f=o.length-1;f>=0;f--){let h=o[f];if(h&&!(h===a||h===u)&&!(/^\d+$/.test(h)||h.length>40))return h}return""}caricaReparti(){if(!this.aziendaCorrente?.id){console.debug("[Impostazioni] caricaReparti called without aziendaCorrente.id");return}console.debug("[Impostazioni] caricaReparti companyId=",this.aziendaCorrente.id),this.departmentsService.getDepartments(this.aziendaCorrente.id).subscribe({next:t=>{console.debug("[Impostazioni] caricaReparti response count=",(t||[]).length),this.departments=t},error:t=>{console.error("[Impostazioni] errore caricamento reparti",t)}})}aggiungiReparto(){if(!this.newDepartmentName.trim()||!this.aziendaCorrente?.id)return;let t={company_id:this.aziendaCorrente.id,name:this.newDepartmentName.trim(),description:this.newDepartmentDescription.trim()||void 0};this.departmentsService.createDepartment(t).subscribe({next:e=>{this.departments.push(e),this.newDepartmentName="",this.newDepartmentDescription="",this.messaggioSuccesso="Reparto aggiunto con successo",this.nascondiMessaggioDopoTimeout()},error:e=>{console.error("[Impostazioni] errore aggiunta reparto",e),this.messaggioErrore="Errore durante l'aggiunta del reparto",this.nascondiMessaggioDopoTimeout()}})}avviaModificaReparto(t){this.editingDepartment=P({},t)}salvaModificaReparto(){this.editingDepartment&&this.departmentsService.updateDepartment(this.editingDepartment.id,{name:this.editingDepartment.name,description:this.editingDepartment.description}).subscribe({next:t=>{let e=this.departments.findIndex(i=>i.id===t.id);e!==-1&&(this.departments[e]=t),this.editingDepartment=null,this.messaggioSuccesso="Reparto aggiornato con successo",this.nascondiMessaggioDopoTimeout()},error:t=>{console.error("[Impostazioni] errore modifica reparto",t),this.messaggioErrore="Errore durante la modifica del reparto",this.nascondiMessaggioDopoTimeout()}})}annullaModificaReparto(){this.editingDepartment=null}toggleManagerDepartment(t,e){let i=e.target.checked;this.managerConfig.department_ids||(this.managerConfig.department_ids=[]);let r=this.managerConfig.department_ids.indexOf(t);i&&r===-1?this.managerConfig.department_ids.push(t):!i&&r!==-1&&this.managerConfig.department_ids.splice(r,1)}eliminaReparto(t){this.departmentsService.canDeleteDepartment(t.id).subscribe({next:e=>{if(!e.canDelete){this.messaggioErrore=`Impossibile eliminare il reparto "${t.name}". Ci sono ${e.employeeCount} dipendenti assegnati.`,this.nascondiMessaggioDopoTimeout();return}confirm(`Sei sicuro di voler eliminare il reparto "${t.name}"?`)&&this.departmentsService.deleteDepartment(t.id).subscribe({next:()=>{this.departments=this.departments.filter(i=>i.id!==t.id),this.messaggioSuccesso="Reparto eliminato con successo",this.nascondiMessaggioDopoTimeout()},error:i=>{console.error("[Impostazioni] errore eliminazione reparto",i),this.messaggioErrore="Errore durante l'eliminazione del reparto",this.nascondiMessaggioDopoTimeout()}})},error:e=>{console.error("[Impostazioni] errore controllo eliminazione reparto",e),this.messaggioErrore="Errore durante il controllo del reparto",this.nascondiMessaggioDopoTimeout()}})}toggleAddPointForm(){this.showAddPointForm=!this.showAddPointForm,this.showAddPointForm?this.aziendaCorrente&&(this.newPoint.city=this.aziendaCorrente.city??this.newPoint.city,this.newPoint.province=this.aziendaCorrente.province??this.newPoint.province):this.newPoint={name:"",address:"",civic_number:"",city:this.aziendaCorrente?.city||null,province:this.aziendaCorrente?.province||null,lat:null,lng:null,radius_m:50}}toggleOpeningHours(){this.showOpeningHours=!this.showOpeningHours}toggleProfilo(){this.showProfilo=!this.showProfilo}toggleAzienda(){this.showAzienda=!this.showAzienda}toggleReparti(){this.showReparti=!this.showReparti}toggleGestioneReparti(){this.showGestioneReparti=!this.showGestioneReparti}toggleVisibilitaResponsabili(){this.showVisibilitaResponsabili=!this.showVisibilitaResponsabili}toggleClosedDays(){this.showClosedDays=!this.showClosedDays}autoSaveOpeningHours(){if(this.aziendaCorrente?.id)try{let t=this.aziendaForm.get("opening_hours"),e={};this.giorniSettimana.forEach(i=>{let r=t.get(i.key);e[i.key]={open:r.get("open")?.value||null,close:r.get("close")?.value||null,closed:!!r.get("closed")?.value}}),this.salvataggioAzienda=!0,this.companyService.aggiornaAzienda(this.aziendaCorrente.id,{opening_hours:e}).subscribe({next:i=>{this.salvataggioAzienda=!1,i&&(this.aziendaCorrente=i,console.debug("[Impostazioni] opening_hours autosaved",e))},error:i=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] autosave opening_hours failed",i)}})}catch(t){console.error("[Impostazioni] autoSaveOpeningHours unexpected",t)}}resetOrariDefault(){let t=this.openingHoursGroup,e={monday:{open:"09:00",close:"18:00",closed:!1},tuesday:{open:"09:00",close:"18:00",closed:!1},wednesday:{open:"09:00",close:"18:00",closed:!1},thursday:{open:"09:00",close:"18:00",closed:!1},friday:{open:"09:00",close:"18:00",closed:!1},saturday:{open:"09:00",close:"13:00",closed:!1},sunday:{open:"",close:"",closed:!0}};this.giorniSettimana.forEach(i=>{let r=t.get(i.key);r&&r.patchValue(e[i.key])}),this.messaggioSuccesso="Orari reimpostati ai valori predefiniti",this.nascondiMessaggioDopoTimeout()}get managerUsers(){return(this.companyEmployees||[]).filter(t=>(t?.role??"").toString().trim().toLowerCase()==="manager")}loadJobTitles(t){if(!t){this.jobTitles=[];return}this.isLoadingJobTitles=!0,this.jobtitleService.getJobTitles(t).subscribe({next:e=>{this.jobTitles=Array.isArray(e)?e:[],this.isLoadingJobTitles=!1},error:e=>{console.error("[Impostazioni] loadJobTitles error",e),this.jobTitles=[],this.isLoadingJobTitles=!1}})}createJobTitle(t){if(!t){alert("Company non impostata");return}let e=(this.newJobTitleName??"").trim();if(!e)return alert("Inserisci il nome della mansione");this.isLoadingJobTitles=!0,this.jobtitleService.createJobTitle(t,{name:e,description:this.newJobTitleDescription??null}).then(i=>{this.jobTitles.unshift(i),this.newJobTitleName=null,this.newJobTitleDescription=null,this.isLoadingJobTitles=!1}).catch(i=>{console.error("[Impostazioni] createJobTitle error",i),alert("Errore creazione mansione"),this.isLoadingJobTitles=!1})}beginEditJobTitle(t){this.editingJobTitle=P({},t)}saveEditJobTitle(){if(!this.editingJobTitle?.id)return;let t=this.editingJobTitle.id,e={name:this.editingJobTitle.name,description:this.editingJobTitle.description};this.isLoadingJobTitles=!0,this.jobtitleService.updateJobTitle(t,e).then(i=>{let r=this.jobTitles.findIndex(o=>o.id===t);r>=0&&(this.jobTitles[r]=i??this.jobTitles[r]),this.editingJobTitle=null,this.isLoadingJobTitles=!1}).catch(i=>{console.error("[Impostazioni] saveEditJobTitle error",i),alert("Errore salvataggio mansione"),this.isLoadingJobTitles=!1})}cancelEditJobTitle(){this.editingJobTitle=null}deactivateJobTitle(t){confirm("Disattivare questa mansione? (non verr\xE0 cancellata, potr\xE0 essere riattivata)")&&(this.isLoadingJobTitles=!0,this.jobtitleService.deleteJobTitle(t).then(()=>{let e=this.jobTitles.findIndex(i=>i.id===t);e>=0&&(this.jobTitles[e].is_active=!1),this.isLoadingJobTitles=!1}).catch(e=>{console.error("[Impostazioni] deactivateJobTitle error",e),alert("Errore disattivazione mansione"),this.isLoadingJobTitles=!1}))}toggleMansioni(){if(this.showMansioni=!this.showMansioni,this.showMansioni)try{this.loadJobTitles(this.aziendaCorrente?.id??null)}catch(t){console.warn("[Impostazioni] toggleMansioni loadJobTitles failed",t)}}toggleJobTitleActive(t){return y(this,null,function*(){if(!t||!t.id)return;let e=!t.is_active;if(!(!e&&!confirm(`Disattivare la mansione "${t.name}"?`))){this.isLoadingJobTitles=!0;try{let i=this.jobtitleService.setJobTitleActive?yield this.jobtitleService.setJobTitleActive(t.id,e):yield this.jobtitleService.updateJobTitle(t.id,{is_active:e});if(i){let r=this.jobTitles.findIndex(o=>o.id===i.id);r>=0&&(this.jobTitles[r]=i)}}catch(i){console.error("[Impostazioni] toggleJobTitleActive error",i),alert("Errore durante l'aggiornamento dello stato mansione")}finally{this.isLoadingJobTitles=!1}}})}static \u0275fac=function(e){return new(e||n)(D(Un),D(ae),D(He),D(gt),D(jr),D(Fi))};static \u0275cmp=ve({type:n,selectors:[["app-impostazioni"]],decls:85,vars:21,consts:[["noMansioni",""],["showName",""],["showDesc",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"settings-grid"],[1,"form-section"],[1,"subsection-header",2,"display","flex","align-items","center","justify-content","space-between","cursor","pointer",3,"click"],["type","button","title","Mostra/Nascondi Profilo",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer"],[4,"ngIf"],["class","form-section",4,"ngIf"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],["type","password","formControlName","currentPassword",1,"form-control"],["type","password","formControlName","newPassword",1,"form-control"],["type","password","formControlName","confirmPassword",1,"form-control"],[1,"form-actions"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"notifications-grid"],[1,"checkbox-label","large"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"checkmark"],[1,"notification-info"],["class","checkbox-label large",4,"ngIf"],["type","button",1,"promethea-button",3,"click","disabled"],["class","status-message info",4,"ngIf"],["class","status-message error",4,"ngIf"],["type","text","formControlName","first_name",1,"form-control"],["class","error",4,"ngIf"],["type","text","formControlName","last_name",1,"form-control"],["type","email","formControlName","email","title","Email non modificabile",1,"form-control",3,"disabled"],["type","tel","formControlName","phone",1,"form-control"],["type","date","formControlName","hire_date",1,"form-control",3,"disabled"],[1,"info","small"],["type","date","formControlName","birth_date",1,"form-control"],["type","text","formControlName","birth_place",1,"form-control"],["type","text","formControlName","fiscal_code",1,"form-control"],["type","text","formControlName","job_title",1,"form-control"],["type","number","min","0","formControlName","monthly_hours",1,"form-control"],[1,"form-group","checkbox-inline"],[1,"checkbox-label"],["type","checkbox","formControlName","full_time"],["type","text","formControlName","timezone","placeholder","Europe/Rome",1,"form-control"],["type","text","disabled","",1,"form-control",3,"value"],[1,"error"],[1,"loading-spinner"],["type","button","title","Mostra/Nascondi Dati Azienda",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer"],["type","text","formControlName","name",1,"form-control"],["type","text","formControlName","vat",1,"form-control"],["type","text","formControlName","address",1,"form-control"],["type","text","formControlName","city",1,"form-control"],["type","text","formControlName","province",1,"form-control"],["type","url","formControlName","website",1,"form-control"],["type","tel","formControlName","numero_telefono",1,"form-control"],["type","email","formControlName","email",1,"form-control",3,"disabled"],[1,"radio-group"],[1,"radio-label"],["type","radio","formControlName","timbratura_type","value","libera"],[1,"radio-checkmark"],["type","radio","formControlName","timbratura_type","value","punti"],["class","form-subsection full-width",4,"ngIf"],[1,"form-subsection","full-width"],["type","button","title","Mostra/Nascondi orari",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer"],["type","button","title","Mostra/Nascondi Giorni Chiusura",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],[1,"subsection-title"],[1,"punch-points-list"],["class","team-member",4,"ngFor","ngForOf"],[1,"form-actions",2,"margin","12px 0"],["class","point-form",4,"ngIf"],[1,"team-member"],["aria-hidden","true",1,"user-avatar-small"],[1,"member-info"],[1,"member-name"],[1,"info-detail","location-chip",2,"display","flex","align-items","center","gap","8px"],["aria-hidden","true",1,"material-icons"],[2,"display","flex","flex","1","align-items","center","gap","12px","flex-wrap","wrap","min-width","0"],[2,"min-width","0","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],[2,"display","inline-block","overflow","hidden","text-overflow","ellipsis"],[2,"font-size","0.85em","color","var(--text-color)","opacity","0.8","margin-left","6px"],[1,"muted","small",2,"margin-top","4px"],[2,"margin-left","auto","text-align","right","white-space","nowrap"],[1,"muted","small"],[2,"margin-top","6px"],[1,"chip"],["type","button","title","Rimuovi",1,"icon-button",3,"click"],[1,"point-form"],["type","text","placeholder","Es. Sede Principale",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"grid-alternative",2,"display","flex","gap","var(--gutter-sm)"],[1,"form-group","wider"],["type","text","placeholder","Es. Via Roma",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-group","narrower"],["type","text","placeholder","Es. 12/A",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"grid-alternative"],["type","text","placeholder","Citt\xE0",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Provincia (es. RM)",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"inline-fields"],[1,"form-group","small"],["type","number","placeholder","50",1,"form-control","small",3,"ngModelChange","ngModel","ngModelOptions"],["formGroupName","opening_hours",1,"opening-hours-grid"],["class","day-row",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"promethea-button","ghost","small",3,"click"],[1,"day-row",3,"formGroupName"],[1,"day-label"],[1,"day-controls"],["type","time","formControlName","open","step","60",1,"form-control"],["type","time","formControlName","close","step","60",1,"form-control"],[1,"form-group","small","checkbox-inline"],["type","checkbox","formControlName","closed"],[1,"closed-days-grid"],["class","day-row feste",4,"ngFor","ngForOf"],[1,"closed-days-actions"],[1,"action-group"],[1,"input-wrap"],["type","date",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Nome festivit\xE0 (es. Chiusura estiva)",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["type","button",1,"promethea-button",3,"click"],[1,"action-group",2,"border-top","1px solid var(--smoke-color-1)","padding-top","var(--gutter-lg)"],[1,"actions-right"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"day-row","feste"],[1,"info-detail"],["type","button","title","Mostra/Nascondi Mansioni",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],[1,"form-card"],[1,"card-content",2,"gap","12px"],[2,"display","flex","gap","12px","flex-wrap","wrap"],["type","text","placeholder","Nome mansione",3,"ngModelChange","ngModel"],["type","text","placeholder","Descrizione (opzionale)",3,"ngModelChange","ngModel"],["class","loading-container","style","padding:8px;",4,"ngIf"],[1,"table-section"],["class","table-container",4,"ngIf"],[1,"loading-container",2,"padding","8px"],[1,"loading-spinner",2,"width","24px","height","24px","border-width","3px"],[1,"table-container"],["class","crm-table",4,"ngIf","ngIfElse"],[1,"crm-table"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"action-buttons"],["class","icon-button",3,"click",4,"ngIf"],[1,"icon-button",3,"click","title"],["type","text",3,"ngModelChange","ngModel"],[1,"icon-button",3,"click"],[1,"empty-state"],["type","button","title","Mostra/Nascondi Gestione Reparti",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["class","generic-form",4,"ngIf"],[1,"generic-form"],[1,"form-subsection"],["type","text","placeholder","Es. Commerciale, Amministrazione",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["placeholder","Descrizione opzionale del reparto","rows","2",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["class","empty-state",4,"ngIf"],[1,"departments-list"],["class","department-item",4,"ngFor","ngForOf"],[1,"department-item"],[1,"department-info"],["class","department-details",4,"ngIf"],["class","edit-form",4,"ngIf"],[1,"actions-container"],["style","display: flex; flex-direction: row; gap: var(--gutter-sm);",4,"ngIf"],[1,"department-details"],[1,"department-header"],[1,"employee-count"],["class","department-description",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"department-description"],[1,"edit-form"],["type","text","placeholder","Nome reparto",1,"form-control","small",3,"ngModelChange","ngModel"],["rows","2","placeholder","Descrizione",1,"form-control","small",3,"ngModelChange","ngModel"],[2,"display","flex","flex-direction","row","gap","var(--gutter-sm)"],["type","button","title","Modifica",1,"icon-button",3,"click"],["type","button","title","Elimina",1,"icon-button",3,"click","disabled"],["type","button","title","Salva",1,"icon-button","success",3,"click"],["type","button","title","Annulla",1,"icon-button",3,"click"],["type","button","title","Mostra/Nascondi Visibilit\xE0",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["name","selectedManager",1,"form-control",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","manager-config",4,"ngIf"],[1,"manager-config"],[1,"announcements-list"],["type","radio","name","mode","value","self",3,"ngModelChange","ngModel"],["type","radio","name","mode","value","selected_users",3,"ngModelChange","ngModel"],["class","form-group",4,"ngIf"],["type","radio","name","mode","value","roles",3,"ngModelChange","ngModel"],["type","radio","name","mode","value","department",3,"ngModelChange","ngModel"],["type","radio","name","mode","value","all",3,"ngModelChange","ngModel"],[1,"permissions-grid"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"users-list"],["class","checkbox-label",4,"ngFor","ngForOf"],["class","info small",4,"ngIf"],["type","checkbox",3,"change","value","checked"],[1,"roles-list"],[1,"status-message","info"],[1,"status-message","error"]],template:function(e,i){e&1&&(c(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),d(4,"settings"),l()(),c(5,"div",7)(6,"h1",8),d(7,"Impostazioni"),l(),c(8,"p",9),d(9,"Gestisci il tuo profilo e le impostazioni aziendali"),l()()(),c(10,"div",10)(11,"div",11)(12,"div",12),x("click",function(){return i.toggleProfilo()}),c(13,"h2",8)(14,"span",6),d(15,"person"),l(),d(16," Profilo Utente"),l(),c(17,"button",13)(18,"span",6),d(19),l()()(),E(20,z3,96,12,"div",14),l(),E(21,nj,10,3,"div",15)(22,gj,10,4,"div",15)(23,Dj,10,4,"div",15)(24,Lj,10,4,"div",15),c(25,"div",11)(26,"h2",8)(27,"span",6),d(28,"security"),l(),d(29," Sicurezza "),l(),c(30,"form",16),x("ngSubmit",function(){return i.cambiaPassword()}),c(31,"div",17)(32,"div",18)(33,"label",19)(34,"span",6),d(35,"lock"),l(),d(36," Password Attuale "),l(),O(37,"input",20),l(),c(38,"div",18)(39,"label",19)(40,"span",6),d(41,"lock_reset"),l(),d(42," Nuova Password "),l(),O(43,"input",21),l(),c(44,"div",18)(45,"label",19)(46,"span",6),d(47,"lock_reset"),l(),d(48," Conferma Password "),l(),O(49,"input",22),l()(),c(50,"div",23)(51,"button",24),E(52,jj,2,0,"span",25)(53,Vj,1,0,"span",26),d(54),l()()()(),c(55,"div",11)(56,"h2",8)(57,"span",6),d(58,"notifications"),l(),d(59," Notifiche "),l(),c(60,"div",27)(61,"label",28)(62,"input",29),W("ngModelChange",function(o){return q(i.impostazioniNotifiche.emailNotifiche,o)||(i.impostazioniNotifiche.emailNotifiche=o),o}),l(),O(63,"span",30),c(64,"div",31)(65,"strong"),d(66,"Notifiche Email"),l(),c(67,"span"),d(68,"Ricevi notifiche via email per le tue timbrature"),l()()(),c(69,"label",28)(70,"input",29),W("ngModelChange",function(o){return q(i.impostazioniNotifiche.riepilogoGiornaliero,o)||(i.impostazioniNotifiche.riepilogoGiornaliero=o),o}),l(),O(71,"span",30),c(72,"div",31)(73,"strong"),d(74,"Riepilogo Giornaliero"),l(),c(75,"span"),d(76,"Ricevi un riepilogo giornaliero delle tue ore"),l()()(),E(77,Uj,8,1,"label",32),l(),c(78,"div",23)(79,"button",33),x("click",function(){return i.salvaNotifiche()}),E(80,zj,2,0,"span",25)(81,Bj,1,0,"span",26),d(82),l()()()(),E(83,$j,4,1,"div",34)(84,Hj,4,1,"div",35),l()),e&2&&(p(17),Ci("aria-expanded",i.showProfilo),p(2),T(i.showProfilo?"expand_less":"expand_more"),p(),v("ngIf",i.showProfilo),p(),v("ngIf",i.hasRole("admin")),p(),v("ngIf",i.hasRole("admin")||i.hasRole("manager")&&i.canManageJobTitles()),p(),v("ngIf",i.hasRole("admin")||i.hasRole("manager")&&i.canManageDepartments()),p(),v("ngIf",i.hasRole("admin")),p(6),v("formGroup",i.sicurezzaForm),p(21),v("disabled",i.sicurezzaForm.invalid||i.salvataggioPassword),p(),v("ngIf",!i.salvataggioPassword),p(),v("ngIf",i.salvataggioPassword),p(),R(" ",i.salvataggioPassword?"Salvando...":"Cambia Password"," "),p(8),H("ngModel",i.impostazioniNotifiche.emailNotifiche),p(8),H("ngModel",i.impostazioniNotifiche.riepilogoGiornaliero),p(7),v("ngIf",i.hasRole("admin")),p(2),v("disabled",i.salvataggioNotifiche),p(),v("ngIf",!i.salvataggioNotifiche),p(),v("ngIf",i.salvataggioNotifiche),p(),R(" ",i.salvataggioNotifiche?"Salvando...":"Salva Notifiche"," "),p(),v("ngIf",i.messaggioSuccesso),p(),v("ngIf",i.messaggioErrore))},dependencies:[be,Le,Se,zn,mn,kt,Ft,Me,To,xo,mt,dv,Oe,hn,hv,gn,Mn,Js,Lt,Et,fl,tn],styles:[".closed-days-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--gutter-sm)}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:var(--gutter-sm);justify-content:flex-start}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{flex:1 1 auto;min-width:0;overflow:hidden}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;overflow:hidden;text-overflow:ellipsis}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   .info-detail[_ngcontent-%COMP%]{font-size:.85rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);margin-top:4px;overflow:hidden}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child, .closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:8px}.closed-days-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm, 12px);align-items:center;flex-wrap:wrap;width:100%;box-sizing:border-box}.closed-days-actions[_ngcontent-%COMP%]   .action-group[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);margin-top:var(--gutter-sm);align-items:center;flex:1 1 auto;min-width:0;flex-wrap:wrap}.closed-days-actions[_ngcontent-%COMP%]   .input-wrap[_ngcontent-%COMP%]{flex:1 1 160px;min-width:0}.closed-days-actions[_ngcontent-%COMP%]   .input-wrap[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;min-width:0}.closed-days-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{flex:0 0 auto;min-inline-size:88px}.closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{margin-left:auto}.closed-days-actions[_ngcontent-%COMP%]   .form-control[type=date][_ngcontent-%COMP%]{max-width:220px}@media (max-width: 600px){.closed-days-actions[_ngcontent-%COMP%]{flex-wrap:wrap;gap:10px}.closed-days-actions[_ngcontent-%COMP%]   .action-group[_ngcontent-%COMP%], .closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{flex:1 1 100%;display:flex;justify-content:flex-start}.closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{justify-content:flex-end}}.point-form[_ngcontent-%COMP%], .inline-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.form-subsection.full-width[_ngcontent-%COMP%]{grid-column:1 / -1;width:100%}.form-group.wider[_ngcontent-%COMP%]{flex:2}.form-group.narrower[_ngcontent-%COMP%]{flex:1}.departments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.department-item[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:flex-start;padding:var(--gutter-sm);border:1px solid var(--border-color);border-radius:var(--border-radius);background:var(--surface-color)}.department-info[_ngcontent-%COMP%]{flex:1}.department-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin-bottom:4px}.department-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1.1em;color:var(--text-color)}.employee-count[_ngcontent-%COMP%]{font-size:.85em;color:var(--text-muted);background:var(--primary-light);padding:2px 8px;border-radius:12px}.department-description[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.9em;color:var(--text-muted)}.department-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;width:100%}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl);color:var(--text-muted)}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:3em;margin-bottom:var(--gutter-sm);opacity:.5}.form-control[type=time][_ngcontent-%COMP%]{width:140px;min-width:120px;box-sizing:border-box;padding:6px 8px}.form-group.small[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-width:120px;max-width:260px}.checkbox-inline[_ngcontent-%COMP%]{display:flex;align-items:center;min-width:120px}.day-controls[_ngcontent-%COMP%]   .form-group.small[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.day-row[_ngcontent-%COMP%]:focus-within{border-color:#0000000f;background:color-mix(in srgb,var(--primary-light) 6%,transparent)}.grid-alternative[_ngcontent-%COMP%]{display:grid!important;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))!important;gap:var(--gutter-sm)!important;align-items:start}.grid-alternative[_ngcontent-%COMP%] > *[_ngcontent-%COMP%], .settings-grid[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%], .card-content[_ngcontent-%COMP%], .generic-form[_ngcontent-%COMP%], .form-subsection[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%], .day-row[_ngcontent-%COMP%], .department-item[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}.form-group[_ngcontent-%COMP%], .member-info[_ngcontent-%COMP%], .info-value[_ngcontent-%COMP%], .info-detail[_ngcontent-%COMP%], .day-label[_ngcontent-%COMP%], .day-controls[_ngcontent-%COMP%], .closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{overflow-wrap:anywhere;word-break:break-word;white-space:normal}.checkbox-label.large[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:var(--gutter-sm);width:100%;box-sizing:border-box}.notification-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1 1 auto;min-width:0;margin-left:6px}.notification-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;white-space:normal;overflow-wrap:anywhere}"]})};var Wj=()=>[1,2,3,4,5,6,7,8,9,10,11,12];function Gj(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),R(" ",("0"+e).slice(-2)," ")}}function qj(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function Jj(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Mese"),l(),c(3,"div",30)(4,"select",11),W("ngModelChange",function(r){C(e);let o=g();return q(o.monthNumber,r)||(o.monthNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onMonthChange())}),E(5,Gj,2,2,"option",18),l(),c(6,"select",11),W("ngModelChange",function(r){C(e);let o=g();return q(o.yearNumber,r)||(o.yearNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onMonthChange())}),E(7,qj,2,2,"option",18),l()()()}if(n&2){let e=g();p(4),H("ngModel",e.monthNumber),p(),v("ngForOf",$e(4,Wj)),p(),H("ngModel",e.yearNumber),p(),v("ngForOf",e.years)}}function Kj(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function Yj(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Anno"),l(),c(3,"select",11),W("ngModelChange",function(r){C(e);let o=g();return q(o.yearNumber,r)||(o.yearNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onYearChange())}),E(4,Kj,2,2,"option",18),l()()}if(n&2){let e=g();p(3),H("ngModel",e.yearNumber),p(),v("ngForOf",e.years)}}function Zj(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Data Inizio"),l(),c(3,"input",32),W("ngModelChange",function(r){C(e);let o=g();return q(o.dataInizio,r)||(o.dataInizio=r),S(r)}),l()()}if(n&2){let e=g();p(3),H("ngModel",e.dataInizio)}}function Qj(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Data Fine"),l(),c(3,"input",32),W("ngModelChange",function(r){C(e);let o=g();return q(o.dataFine,r)||(o.dataFine=r),S(r)}),l()()}if(n&2){let e=g();p(3),H("ngModel",e.dataFine)}}function Xj(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),_e("",e.first_name," ",e.last_name)}}function eV(n,t){if(n&1&&O(0,"input",33),n&2){let e=g();v("value",(e.currentUser==null?null:e.currentUser.first_name)+" "+(e.currentUser==null?null:e.currentUser.last_name))}}function tV(n,t){n&1&&(c(0,"span",3),d(1,"refresh"),l())}function nV(n,t){n&1&&O(0,"span",34)}function iV(n,t){if(n&1&&(c(0,"div",35)(1,"h2",5)(2,"span",3),d(3,"insights"),l(),d(4," Statistiche "),l(),c(5,"div",36)(6,"div",37)(7,"h3",38),d(8,"Ore Totali"),l(),c(9,"div",39),d(10),Z(11,"number"),l(),c(12,"p",6),d(13,"Periodo selezionato"),l()(),c(14,"div",37)(15,"h3",38),d(16,"Media Giornaliera"),l(),c(17,"div",39),d(18),Z(19,"number"),l(),c(20,"p",6),d(21,"Per giorno lavorativo"),l()(),c(22,"div",37)(23,"h3",38),d(24,"Giorni Lavorati"),l(),c(25,"div",39),d(26),l(),c(27,"p",6),d(28),l()(),c(29,"div",37)(30,"h3",38),d(31,"Ore di Pause"),l(),c(32,"div",39),d(33),Z(34,"number"),l(),c(35,"p",6),d(36,"Totale pause"),l()()()()),n&2){let e=g();p(10),R("",X(11,5,e.datiReport.oreTotali,"1.1-1"),"h"),p(8),R("",X(19,8,e.datiReport.mediaGiornaliera,"1.1-1"),"h"),p(8),T(e.datiReport.giorniLavorati),p(2),R("Su ",e.datiReport.giorniTotali," giorni"),p(5),R("",X(34,11,e.datiReport.orePause,"1.1-1"),"h")}}function rV(n,t){if(n&1&&(c(0,"span",46),d(1),l()),n&2){let e=g().$implicit,i=g(2);v("title",e.note),p(),R(" ",i.troncaTesto(e.note,20)," ")}}function oV(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function sV(n,t){if(n&1&&(c(0,"tr")(1,"td"),d(2),Z(3,"date"),l(),c(4,"td"),d(5),l(),c(6,"td"),d(7),l(),c(8,"td"),d(9),l(),c(10,"td"),d(11),Z(12,"number"),l(),c(13,"td"),d(14),Z(15,"number"),l(),c(16,"td"),d(17),Z(18,"number"),l(),c(19,"td"),E(20,rV,2,2,"span",44)(21,oV,2,0,"span",45),l()()),n&2){let e=t.$implicit;p(2),T(X(3,9,e.data,"dd/MM/yyyy")),p(3),T(e.dipendente),p(2),T(e.oraInizio),p(2),T(e.oraFine),p(2),R("",X(12,12,e.oreLavorate,"1.1-1"),"h"),p(3),R("",X(15,15,e.pause,"1.1-1"),"h"),p(3),R("",X(18,18,e.oreEffettive,"1.1-1"),"h"),p(3),v("ngIf",e.note),p(),v("ngIf",!e.note)}}function aV(n,t){if(n&1&&(c(0,"div",40)(1,"h2",5)(2,"span",3),d(3,"view_list"),l(),d(4," Dettaglio Timbrature "),l(),c(5,"div",41)(6,"table",42)(7,"thead")(8,"tr")(9,"th"),d(10,"Data"),l(),c(11,"th"),d(12,"Dipendente"),l(),c(13,"th"),d(14,"Ora Inizio"),l(),c(15,"th"),d(16,"Ora Fine"),l(),c(17,"th"),d(18,"Ore Lavorate"),l(),c(19,"th"),d(20,"Pause"),l(),c(21,"th"),d(22,"Ore Effettive"),l(),c(23,"th"),d(24,"Note"),l()()(),c(25,"tbody"),E(26,sV,22,21,"tr",43),l()()()()),n&2){let e=g();p(26),v("ngForOf",e.datiReport.dettaglio)}}function lV(n,t){if(n&1&&(c(0,"div",51)(1,"div",52),d(2),l(),c(3,"div",53),O(4,"div",54),l(),c(5,"div",55),d(6),Z(7,"number"),l()()),n&2){let e=t.$implicit,i=g(2);p(2),T(e.giorno),p(2),Si("height",e.ore/i.datiReport.maxOreGiornaliere*100+"%"),p(2),R("",X(7,4,e.ore,"1.1-1"),"h")}}function cV(n,t){if(n&1&&(c(0,"div",7)(1,"h2",5)(2,"span",3),d(3,"bar_chart"),l(),d(4," Andamento Ore Lavorative "),l(),c(5,"div",47)(6,"div",48)(7,"p",6),d(8,"Grafico delle ore lavorative per giorno"),l(),c(9,"div",49),E(10,lV,8,7,"div",50),l()()()()),n&2){let e=g();p(10),v("ngForOf",e.datiReport.graficoOre)}}function uV(n,t){n&1&&(c(0,"div",56)(1,"span",3),d(2,"analytics"),l(),c(3,"h3"),d(4,"Nessun report generato"),l(),c(5,"p"),d(6,"Seleziona i filtri e genera un report per visualizzare i dati."),l()())}var Dp=class n{constructor(t,e,i,r){this.authService=t;this.companyService=e;this.timbratureService=i;this.reportsService=r}tipoReport="settimanale";dataInizio="";dataFine="";dipendenteSelezionato="tutti";monthSelected="";supportsMonthInput=!1;monthNumber=1;yearNumber=new Date().getFullYear();years=[];currentUser=null;dipendenti=[];datiReport=null;isLoading=!1;ngOnInit(){try{let i=document.createElement("input");i.setAttribute("type","month"),this.supportsMonthInput=i.type==="month"}catch{this.supportsMonthInput=!1}let t=new Date().getFullYear(),e=t-5;this.years=Array.from({length:8},(i,r)=>e+r),this.monthSelected||(this.monthNumber=new Date().getMonth()+1),this.yearNumber||(this.yearNumber=t),this.authService.currentUser$.subscribe(i=>{this.currentUser=i,i&&(this.impostaDatePredefinite(),(this.hasRole("admin")||this.hasRole("manager"))&&this.caricaDipendenti(i.company_id))})}onFiltroChange(){this.isLoading||(this.datiReport=null,this.generaReport().catch(t=>console.error("[Report] onFiltroChange error",t)))}impostaDatePredefinite(){let t=new Date;switch(this.tipoReport){case"settimanale":{if(!this.dataInizio||!this.dataFine){let e=new Date(t),i=t.getDay(),r=i===0?-6:1-i;e.setDate(t.getDate()+r),this.dataInizio=e.toISOString().split("T")[0],this.dataFine=t.toISOString().split("T")[0]}break}case"mensile":{if(this.monthSelected)this.applyMonthToDates();else{let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");this.monthSelected=`${e}-${i}`,this.monthNumber=Number(i),this.yearNumber=e,this.applyMonthToDates()}break}case"annuale":{this.yearNumber||(this.yearNumber=t.getFullYear()),(!this.dataInizio||!this.dataFine)&&this.applyYearToDates();break}case"personalizzato":break}}applyMonthToDates(){if(!this.monthSelected)return;let[t,e]=this.monthSelected.split("-").map(o=>Number(o)),i=new Date(t,e-1,1),r=new Date(t,e,0);this.dataInizio=i.toISOString().split("T")[0],this.dataFine=r.toISOString().split("T")[0]}onYearChange(){this.yearNumber&&(this.applyYearToDates(),this.onFiltroChange())}applyYearToDates(){let t=Number(this.yearNumber)||new Date().getFullYear(),e=new Date(t,0,1),i=new Date(t,11,31);this.dataInizio=e.toISOString().split("T")[0],this.dataFine=i.toISOString().split("T")[0]}onTipoReportChange(){this.impostaDatePredefinite(),this.onFiltroChange()}caricaDipendenti(t){this.companyService.getDipendenti(t).subscribe({next:e=>{this.dipendenti=e},error:e=>{console.error("Errore nel caricamento dipendenti:",e)}})}hasRole(t){return this.authService.hasRole(t)}downloadBlob(t,e){let i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=e,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(i)}onMonthChange(){this.monthNumber=Number(this.monthNumber)||1,this.yearNumber=Number(this.yearNumber)||new Date().getFullYear();let t=String(this.monthNumber).padStart(2,"0");this.monthSelected=`${this.yearNumber}-${t}`,this.applyMonthToDates(),this.onFiltroChange()}generaReport(){return y(this,null,function*(){if(this.tipoReport==="mensile"&&(this.monthSelected||this.impostaDatePredefinite(),this.applyMonthToDates()),console.debug("[Report] generaReport - dataInizio,dataFine,tipoReport,dipendente:",this.dataInizio,this.dataFine,this.tipoReport,this.dipendenteSelezionato),!this.dataInizio||!this.dataFine){alert("Seleziona le date (o il mese) per il report");return}if(!this.currentUser?.company_id){alert("Azienda non definita");return}this.isLoading=!0,this.datiReport=null;let t={company_id:this.currentUser.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};try{yield this.buildDatiReportClientSide(t)}catch(e){console.error("Errore generazione report client-side",e),confirm("Errore nella generazione client-side. Vuoi provare a scaricare il report dal server (se disponibile)?")&&this.reportsService.generaReportTimbrature(t,"xlsx").subscribe({next:i=>{let r=`report_timbrature_${this.dataInizio}_${this.dataFine}.xlsx`;this.downloadBlob(i,r)},error:i=>{console.error("Errore generazione server report",i),alert("Impossibile generare il report sul server.")}})}finally{this.isLoading=!1}})}buildDatiReportClientSide(t){return y(this,null,function*(){let e=t.company_id,i=new Date(t.start_date).getTime(),r=new Date(t.end_date).getTime()+24*3600*1e3,o=yield this.timbratureService.getTimbratureAzienda(e),a=(Array.isArray(o)?o:[]).filter(L=>{let $=new Date(L.start_ts).getTime();return!($<i||$>=r||t.dipendente&&t.dipendente!=="tutti"&&L.user_id!==t.dipendente)}),u=a.map(L=>{let $=new Date(L.start_ts),j=L.user?`${L.user.first_name} ${L.user.last_name}`:L.user_id??"",se=L.start_ts?new Date(L.start_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",je=L.end_ts?new Date(L.end_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",F=(Number(L.total_minutes)||0)/60,Q=0;if(Array.isArray(L.breaks))try{Q=L.breaks.reduce((qn,di)=>{let Bo=di.start_ts?new Date(di.start_ts).getTime():0,$o=di.end_ts?new Date(di.end_ts).getTime():0;return Bo&&$o&&$o>Bo?qn+Math.round(($o-Bo)/(1e3*60)):qn},0)}catch{Q=0}let Ie=Q/60,ot=Math.max(0,F-Ie);return{data:$,dipendente:j,oraInizio:se,oraFine:je,oreLavorate:Math.round(F*10)/10,pause:Math.round(Ie*10)/10,oreEffettive:Math.round(ot*10)/10,note:L.notes??""}}),f=new Date(t.start_date),h=new Date(t.end_date),m=[],b=Math.ceil((h.getTime()-f.getTime())/(24*3600*1e3))+1;for(let L=0;L<b;L++){let $=new Date(f);$.setDate(f.getDate()+L);let j=new Date($);j.setHours(0,0,0,0);let se=new Date(j);se.setDate(j.getDate()+1);let je=a.reduce((F,Q)=>{let Ie=new Date(Q.start_ts);return Ie>=j&&Ie<se?F+(Number(Q.total_minutes)||0):F},0);m.push({giorno:$.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"2-digit"}),ore:Math.round(je/60*10)/10})}let _=u.reduce((L,$)=>L+$.oreEffettive,0),w=u.reduce((L,$)=>L+$.pause,0),M=u.length,I=m.length,A=m.length?Math.max(...m.map(L=>L.ore)):0;this.datiReport={oreTotali:_,mediaGiornaliera:I?Math.round(_/I*10)/10:0,giorniLavorati:M,giorniTotali:I,orePause:w,maxOreGiornaliere:A,dettaglio:u,graficoOre:m}})}esportaCSVDaDatiReport(){if(!this.datiReport){alert("Genera prima il report per poterlo esportare.");return}let t="Data;Dipendente;Ora Inizio;Ora Fine;Ore Lavorate;Pause;Ore Effettive;Note",e=this.datiReport.dettaglio.map(s=>{let a=s.data.toISOString().split("T")[0],u=(s.note||"").replace(/\r?\n|\r/g," ").replace(/;/g,",");return`${a};${s.dipendente};${s.oraInizio};${s.oraFine};${s.oreLavorate};${s.pause};${s.oreEffettive};${u}`}),i=[t,...e].join(`\r
`),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),o=`report_timbrature_${this.dataInizio}_${this.dataFine}.csv`;this.downloadBlob(r,o)}generaReportCsvClientSide(t){return y(this,null,function*(){try{this.isLoading=!0;let e=t.company_id,i=yield this.timbratureService.getTimbratureAzienda(e);i=Array.isArray(i)?i:[];let r=new Date(t.start_date).getTime(),o=new Date(t.end_date).getTime()+24*3600*1e3,f=["Data;Dipendente;Ora Inizio;Ora Fine;Ore;Note",...i.filter(b=>{let _=new Date(b.start_ts).getTime();return!(_<r||_>=o||t.dipendente&&t.dipendente!=="tutti"&&b.user_id!==t.dipendente)}).map(b=>{let _=new Date(b.start_ts).toLocaleDateString(),w=b.user_name??b.user_id??"",M=b.start_ts?new Date(b.start_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",I=b.end_ts?new Date(b.end_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",A=((Number(b.total_minutes)||0)/60).toFixed(2),L=(b.notes||"").replace(/\r?\n|\r/g," ").replace(/;/g,",");return`${_};${w};${M};${I};${A};${L}`})].join(`\r
`),h=new Blob([f],{type:"text/csv;charset=utf-8;"}),m=`report_timbrature_${t.start_date}_${t.end_date}.csv`;this.downloadBlob(h,m)}catch(e){console.error("Errore generazione CSV client-side",e),alert("Impossibile generare report client-side")}finally{this.isLoading=!1}})}generaReportMock(){let t=[{data:new Date("2024-01-15"),dipendente:"Mario Rossi",oraInizio:"08:00",oraFine:"17:00",oreLavorate:9,pause:1,oreEffettive:8,note:"Giornata standard"},{data:new Date("2024-01-16"),dipendente:"Mario Rossi",oraInizio:"09:00",oraFine:"18:00",oreLavorate:9,pause:1,oreEffettive:8,note:"Riunione mattutina"},{data:new Date("2024-01-17"),dipendente:"Mario Rossi",oraInizio:"08:30",oraFine:"17:30",oreLavorate:9,pause:.5,oreEffettive:8.5}],e=[{giorno:"Lun",ore:8},{giorno:"Mar",ore:8},{giorno:"Mer",ore:8.5},{giorno:"Gio",ore:7.5},{giorno:"Ven",ore:8},{giorno:"Sab",ore:4},{giorno:"Dom",ore:0}],i=t.reduce((s,a)=>s+a.oreEffettive,0),r=t.reduce((s,a)=>s+a.pause,0),o=Math.max(...e.map(s=>s.ore));return{oreTotali:i,mediaGiornaliera:i/t.length,giorniLavorati:t.length,giorniTotali:7,orePause:r,maxOreGiornaliere:o,dettaglio:t,graficoOre:e}}esportaPDF(){if(!this.datiReport){alert("Genera il report prima di esportare");return}let t={company_id:this.currentUser?.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};this.reportsService.generaReportTimbrature(t,"pdf").subscribe({next:e=>this.downloadBlob(e,`report_${this.dataInizio}_${this.dataFine}.pdf`),error:()=>{alert("Errore esportazione PDF via server")}})}esportaExcel(){if(!this.datiReport){alert("Genera il report prima di esportare");return}let t={company_id:this.currentUser?.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};this.reportsService.generaReportTimbrature(t,"xlsx").subscribe({next:e=>this.downloadBlob(e,`report_${this.dataInizio}_${this.dataFine}.xlsx`),error:()=>{alert("Errore esportazione Excel via server")}})}troncaTesto(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}static \u0275fac=function(e){return new(e||n)(D(ae),D(He),D(vt),D(ua))};static \u0275cmp=ve({type:n,selectors:[["app-report"]],decls:61,vars:19,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"form-section"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value","settimanale"],["value","mensile"],["value","annuale"],["value","personalizzato"],["class","form-group",4,"ngIf"],["value","tutti"],[3,"value",4,"ngFor","ngForOf"],["type","text","class","form-control","disabled","",3,"value",4,"ngIf"],[1,"form-actions"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"promethea-button","outline",3,"click","disabled"],[1,"promethea-button","secondary",3,"click","disabled"],["class","kpi-section",4,"ngIf"],["class","table-section",4,"ngIf"],["class","form-section",4,"ngIf"],["class","empty-state",4,"ngIf"],[2,"display","flex","gap","8px","align-items","center"],[3,"value"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["type","text","disabled","",1,"form-control",3,"value"],[1,"loading-spinner"],[1,"kpi-section"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","notes-preview",3,"title",4,"ngIf"],[4,"ngIf"],[1,"notes-preview",3,"title"],[1,"chart-placeholder"],[1,"chart-container"],[1,"chart-bars"],["class","chart-bar",4,"ngFor","ngForOf"],[1,"chart-bar"],[1,"bar-label"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"empty-state"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),d(4,"assessment"),l()(),c(5,"div",4)(6,"h1",5),d(7,"Report Timbrature"),l(),c(8,"p",6),d(9,"Analizza e esporta i dati delle timbrature"),l()()(),c(10,"div",7)(11,"h2",5)(12,"span",3),d(13,"filter_alt"),l(),d(14," Filtri Report "),l(),c(15,"div",8)(16,"div",9)(17,"label",10),d(18,"Tipo Report"),l(),c(19,"select",11),W("ngModelChange",function(o){return q(i.tipoReport,o)||(i.tipoReport=o),o}),x("change",function(){return i.onTipoReportChange()}),c(20,"option",12),d(21,"Settimanale"),l(),c(22,"option",13),d(23,"Mensile"),l(),c(24,"option",14),d(25,"Annuale"),l(),c(26,"option",15),d(27,"Personalizzato"),l()()(),E(28,Jj,8,5,"div",16)(29,Yj,5,2,"div",16)(30,Zj,4,1,"div",16)(31,Qj,4,1,"div",16),c(32,"div",9)(33,"label",10),d(34,"Dipendente"),l(),c(35,"select",11),W("ngModelChange",function(o){return q(i.dipendenteSelezionato,o)||(i.dipendenteSelezionato=o),o}),x("change",function(){return i.onFiltroChange()}),c(36,"option",17),d(37,"Tutti"),l(),E(38,Xj,2,3,"option",18),l(),E(39,eV,1,1,"input",19),l()(),c(40,"div",20)(41,"button",21),x("click",function(){return i.generaReport()}),E(42,tV,2,0,"span",22)(43,nV,1,0,"span",23),d(44),l(),c(45,"button",24),x("click",function(){return i.esportaPDF()}),c(46,"span",3),d(47,"picture_as_pdf"),l(),d(48," Esporta PDF "),l(),c(49,"button",25),x("click",function(){return i.esportaExcel()}),c(50,"span",3),d(51,"table_chart"),l(),d(52," Esporta Excel "),l(),c(53,"button",21),x("click",function(){return i.esportaCSVDaDatiReport()}),c(54,"span",3),d(55,"download"),l(),d(56," Esporta CSV "),l()()(),E(57,iV,37,14,"div",26)(58,aV,27,1,"div",27)(59,cV,11,1,"div",28)(60,uV,7,0,"div",29),l()),e&2&&(p(19),H("ngModel",i.tipoReport),p(9),v("ngIf",i.tipoReport==="mensile"),p(),v("ngIf",i.tipoReport==="annuale"),p(),v("ngIf",i.tipoReport!=="mensile"&&i.tipoReport!=="annuale"),p(),v("ngIf",i.tipoReport!=="mensile"&&i.tipoReport!=="annuale"),p(4),H("ngModel",i.dipendenteSelezionato),p(3),v("ngForOf",i.dipendenti),p(),v("ngIf",!i.hasRole("admin")&&!i.hasRole("manager")),p(2),v("disabled",i.isLoading),p(),v("ngIf",!i.isLoading),p(),v("ngIf",i.isLoading),p(),R(" ",i.isLoading?"Generando...":"Genera Report"," "),p(),v("disabled",!i.datiReport),p(4),v("disabled",!i.datiReport),p(4),v("disabled",!i.datiReport),p(4),v("ngIf",i.datiReport),p(),v("ngIf",i.datiReport),p(),v("ngIf",i.datiReport),p(),v("ngIf",!i.datiReport&&!i.isLoading))},dependencies:[be,Le,Se,Lt,kt,Ft,Me,mt,Oe,Et,tn,dt],styles:[".kpi-section[_ngcontent-%COMP%]{margin-bottom:var(--gutter-lg)}.chart-placeholder[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);margin-top:var(--gutter-md)}.chart-container[_ngcontent-%COMP%]{text-align:center}.chart-bars[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:var(--gutter-sm);height:200px;margin-top:var(--gutter-lg);padding:0 var(--gutter-md)}.chart-bar[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1;gap:var(--gutter-sm)}.bar-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-color);opacity:.7}.bar-container[_ngcontent-%COMP%]{height:120px;width:30px;background:color-mix(in srgb,var(--smoke-color-1) 50%,transparent);border-radius:4px 4px 0 0;position:relative;display:flex;align-items:flex-end}.bar-fill[_ngcontent-%COMP%]{width:100%;background:var(--gradiente);border-radius:4px 4px 0 0;transition:height .3s ease;min-height:4px}.bar-value[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:var(--text-color)}@media (max-width: 768px){.chart-bars[_ngcontent-%COMP%]{gap:4px;padding:0 var(--gutter-sm)}.bar-container[_ngcontent-%COMP%]{width:20px}.bar-label[_ngcontent-%COMP%], .bar-value[_ngcontent-%COMP%]{font-size:.7rem}}@media (max-width: 480px){.chart-bars[_ngcontent-%COMP%]{flex-wrap:wrap;height:auto;gap:var(--gutter-md)}.chart-bar[_ngcontent-%COMP%]{flex:0 0 calc(33.333% - var(--gutter-md))}}"]})};var Ip=class n{constructor(t){this.supabaseService=t}BUCKET_NAME="buste-paga";getBustePagaAzienda(t){let i=this.supabaseService.getClient().from("payroll_files").select(`
        *,
        users:user_id (first_name, last_name, email)
      `).eq("company_id",t).order("period",{ascending:!1}).then(r=>{if(r.error)throw r.error;return r.data});return B(i)}getBustePagaDipendente(t){let i=this.supabaseService.getClient().from("payroll_files").select("*").eq("user_id",t).eq("visible_to_user",!0).order("period",{ascending:!1}).then(r=>{if(r.error)throw r.error;return r.data});return B(i)}uploadBustaPaga(t,e,i,r,o){return y(this,null,function*(){let s=this.supabaseService.getClient(),a=t.name.split(".").pop(),u=`${e}_${r}_${Date.now()}.${a}`,f=`${i}/${u}`,{error:h}=yield s.storage.from(this.BUCKET_NAME).upload(f,t);if(h)throw h;let{error:m}=yield s.from("payroll_files").insert({user_id:e,company_id:i,filename:u,original_name:t.name,file_size_bytes:t.size,mime_type:t.type,storage_path:f,period:r,uploaded_by:o,visible_to_user:!0});if(m)throw m;return{success:!0,fileName:u}})}downloadBustaPaga(t,e){let r=this.supabaseService.getClient().storage.from(this.BUCKET_NAME).download(t).then(o=>{if(o.error)throw o.error;let s=URL.createObjectURL(o.data),a=document.createElement("a");return a.href=s,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),{success:!0}});return B(r)}eliminaBustaPaga(t,e){let i=this.supabaseService.getClient(),r=Promise.all([i.from("payroll_files").delete().eq("id",t),i.storage.from(this.BUCKET_NAME).remove([e])]).then(([o,s])=>{if(o.error)throw o.error;if(s.error)throw s.error;return{success:!0}});return B(r)}static \u0275fac=function(e){return new(e||n)(U(it))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var t_=(n,t)=>t.id;function fV(n,t){if(n&1){let e=k();c(0,"div",8)(1,"button",16),x("click",function(){C(e);let r=g();return S(r.mostraUpload=!r.mostraUpload)}),c(2,"span",4),d(3,"upload"),l(),d(4," Carica Buste Paga "),l()()}}function pV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),_e("",e.first_name," ",e.last_name)}}function hV(n,t){if(n&1){let e=k();c(0,"div",32)(1,"span",4),d(2,"cloud_upload"),l(),c(3,"h3"),d(4,"Trascina i file PDF qui"),l(),c(5,"p",33),d(6,"oppure"),l(),c(7,"button",34),x("click",function(){C(e);let r=en(12);return S(r.click())}),c(8,"span",4),d(9,"attach_file"),l(),d(10," Seleziona File "),l(),c(11,"input",35,0),x("change",function(r){C(e);let o=g(2);return S(o.onFileSelected(r))}),l()()}}function mV(n,t){if(n&1){let e=k();c(0,"div",38)(1,"span",4),d(2,"picture_as_pdf"),l(),c(3,"div",39)(4,"span",40),d(5),l(),c(6,"span",41),d(7),l()(),c(8,"button",42),x("click",function(){let r=C(e).index,o=g(3);return S(o.rimuoviFile(r))}),c(9,"span",4),d(10,"close"),l()()()}if(n&2){let e=t.$implicit;p(5),T(e.name),p(2),R("",(e.size/1024/1024).toFixed(2)," MB")}}function gV(n,t){if(n&1&&(c(0,"div",36)(1,"h4"),d(2),l(),E(3,mV,11,2,"div",37),l()),n&2){let e=g(2);p(2),R("File selezionati (",e.selectedFiles.length,")"),p(),v("ngForOf",e.selectedFiles)}}function vV(n,t){if(n&1&&(c(0,"div",26)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g(2);p(3),R(" ",e.errorMessage," ")}}function _V(n,t){if(n&1&&(c(0,"div",27)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g(2);p(3),R(" ",e.successMessage," ")}}function yV(n,t){n&1&&(c(0,"span",4),d(1,"upload"),l())}function bV(n,t){n&1&&O(0,"span",31)}function wV(n,t){if(n&1){let e=k();c(0,"div",9)(1,"h2",6)(2,"span",4),d(3,"cloud_upload"),l(),d(4," Carica Nuove Buste Paga "),l(),c(5,"div",17)(6,"div",12)(7,"label",18)(8,"span",4),d(9,"person"),l(),d(10," Dipendente * "),l(),c(11,"select",19),W("ngModelChange",function(r){C(e);let o=g();return q(o.selectedUserId,r)||(o.selectedUserId=r),S(r)}),c(12,"option",20),d(13,"Seleziona dipendente"),l(),At(14,pV,2,3,"option",21,t_),l()(),c(16,"div",12)(17,"label",18)(18,"span",4),d(19,"event"),l(),d(20," Periodo * "),l(),c(21,"input",22),W("ngModelChange",function(r){C(e);let o=g();return q(o.selectedPeriod,r)||(o.selectedPeriod=r),S(r)}),l()()(),c(22,"div",23),x("drop",function(r){C(e);let o=g();return S(o.onDrop(r))})("dragover",function(r){C(e);let o=g();return S(o.onDragOver(r))})("dragleave",function(r){C(e);let o=g();return S(o.onDragLeave(r))}),E(23,hV,13,0,"div",24)(24,gV,4,2,"div",25),l(),te(25,vV,4,1,"div",26),te(26,_V,4,1,"div",27),c(27,"div",28)(28,"button",29),x("click",function(){C(e);let r=g();return S(r.resetUpload())}),d(29," Annulla "),l(),c(30,"button",30),x("click",function(){C(e);let r=g();return S(r.onUpload())}),te(31,yV,2,0,"span",4),te(32,bV,1,0,"span",31),d(33),l()()()}if(n&2){let e=g();p(11),H("ngModel",e.selectedUserId),v("disabled",e.isLoading),p(3),Rt(e.dipendenti),p(7),H("ngModel",e.selectedPeriod),v("disabled",e.isLoading),p(),Ce("drag-over",e.isDragOver)("has-files",e.selectedFiles.length>0),p(),v("ngIf",e.selectedFiles.length===0),p(),v("ngIf",e.selectedFiles.length>0),p(),ne(e.errorMessage?25:-1),p(),ne(e.successMessage?26:-1),p(2),v("disabled",e.isLoading),p(2),v("disabled",!e.canUpload()||e.isLoading),p(),ne(e.isLoading?-1:31),p(),ne(e.isLoading?32:-1),p(),R(" ",e.isLoading?"Caricamento...":"Carica Buste Paga"," ")}}function EV(n,t){if(n&1&&(c(0,"div",10)(1,"div",43)(2,"h3",44),d(3,"Buste Paga Totali"),l(),c(4,"div",45),d(5),l()(),c(6,"div",43)(7,"h3",44),d(8,"Ultima Busta Paga"),l(),c(9,"div",45),d(10),l()()()),n&2){let e=g();p(5),T(e.bustePaga.length),p(5),R(" ",(e.ultimaBustaPaga==null?null:e.ultimaBustaPaga.period)||"N/A"," ")}}function CV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function SV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),_e("",e.first_name," ",e.last_name)}}function xV(n,t){if(n&1){let e=k();c(0,"div",12)(1,"label",18),d(2,"Filtra per periodo"),l(),c(3,"select",46),W("ngModelChange",function(r){C(e);let o=g();return q(o.filtroPeriodo,r)||(o.filtroPeriodo=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(4,"option",20),d(5,"Tutti i periodi"),l(),At(6,CV,2,2,"option",21,Er),l()(),c(8,"div",12)(9,"label",18),d(10,"Filtra per dipendente"),l(),c(11,"select",46),W("ngModelChange",function(r){C(e);let o=g();return q(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(12,"option",20),d(13,"Tutti i dipendenti"),l(),At(14,SV,2,3,"option",21,t_),l()()}if(n&2){let e=g();p(3),H("ngModel",e.filtroPeriodo),p(3),Rt(e.periodiUnici),p(5),H("ngModel",e.filtroDipendente),p(3),Rt(e.dipendenti)}}function DV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;v("value",e),p(),T(e)}}function IV(n,t){if(n&1){let e=k();c(0,"div",12)(1,"label",18),d(2,"Anno"),l(),c(3,"select",46),W("ngModelChange",function(r){C(e);let o=g();return q(o.filtroAnno,r)||(o.filtroAnno=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(4,"option",20),d(5,"Tutti gli anni"),l(),At(6,DV,2,2,"option",21,Er),l()()}if(n&2){let e=g();p(3),H("ngModel",e.filtroAnno),p(3),Rt(e.anniDisponibili)}}function TV(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function MV(n,t){if(n&1&&(c(0,"td")(1,"div",50)(2,"div",51),d(3),l(),c(4,"div",52)(5,"strong"),d(6),l(),c(7,"span",7),d(8),l()()()()),n&2){let e=g().$implicit;p(3),_e(" ",e.user==null||e.user.first_name==null?null:e.user.first_name.charAt(0),"",e.user==null||e.user.last_name==null?null:e.user.last_name.charAt(0)," "),p(3),_e("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name),p(2),T(e.user==null?null:e.user.email)}}function AV(n,t){if(n&1){let e=k();c(0,"button",48),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaBustaPaga(r))}),c(1,"span",4),d(2,"delete"),l()()}}function RV(n,t){if(n&1){let e=k();c(0,"tr"),te(1,MV,9,5,"td"),c(2,"td"),d(3),l(),c(4,"td")(5,"div",39)(6,"span",4),d(7,"picture_as_pdf"),l(),d(8),l()(),c(9,"td"),d(10),Z(11,"date"),l(),c(12,"td"),d(13),l(),c(14,"td")(15,"div",47)(16,"button",48),x("click",function(){let r=C(e).$implicit,o=g();return S(o.downloadBustaPaga(r))}),c(17,"span",4),d(18,"download"),l()(),te(19,AV,3,0,"button",49),l()()()}if(n&2){let e=t.$implicit,i=g();p(),ne(i.isAdmin?1:-1),p(2),T(e.period),p(5),R(" ",e.original_name," "),p(2),T(X(11,6,e.uploaded_at,"dd/MM/yyyy")),p(3),R("",(e.file_size_bytes/1024/1024).toFixed(2)," MB"),p(6),ne(i.isAdmin?19:-1)}}function OV(n,t){if(n&1&&(c(0,"div",15)(1,"span",4),d(2,"description"),l(),c(3,"h3"),d(4,"Nessuna busta paga"),l(),c(5,"p"),d(6),l()()),n&2){let e=g();p(6),R(" ",e.isAdmin?"Non sono state caricate buste paga per i filtri selezionati.":"Non sono presenti buste paga per i filtri selezionati."," ")}}var Tp=class n{constructor(t,e,i){this.bustePagaService=t;this.dipendentiService=e;this.authService=i}destroy$=new We;isAdmin=!1;isLoading=!1;bustePaga=[];bustePagaFiltrate=[];mostraUpload=!1;selectedFiles=[];isDragOver=!1;selectedUserId="";selectedPeriod="";filtroPeriodo="";filtroDipendente="";filtroAnno="";dipendenti=[];periodiUnici=[];anniDisponibili=[];errorMessage="";successMessage="";ngOnInit(){return y(this,null,function*(){this.verificaRuolo(),yield this.caricaDati()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}verificaRuolo(){return y(this,null,function*(){try{let t=yield ze(this.authService.currentUser$);this.isAdmin=t?.role==="admin"||t?.role==="manager",console.log("Ruolo utente:",this.isAdmin?"Admin":"Dipendente")}catch(t){console.error("Errore nel verificare il ruolo:",t),this.isAdmin=!1}})}caricaDati(){return y(this,null,function*(){this.isLoading=!0;try{let t=localStorage.getItem("companyId");if(!t)throw new Error("Company ID non trovato");if(this.isAdmin)yield Promise.all([this.caricaBustePagaAzienda(t),this.caricaDipendenti(t)]);else{let e=yield this.getCurrentUserId();yield this.caricaBustePagaDipendente(e)}this.inizializzaFiltri()}catch(t){console.error("Errore nel caricamento dei dati:",t),this.errorMessage="Errore nel caricamento dei dati"}finally{this.isLoading=!1}})}caricaBustePagaAzienda(t){return new Promise((e,i)=>{this.bustePagaService.getBustePagaAzienda(t).pipe(Kn(this.destroy$)).subscribe({next:r=>{this.bustePaga=r,this.bustePagaFiltrate=r,e()},error:r=>{console.error("Errore nel caricamento buste paga azienda:",r),i(r)}})})}caricaBustePagaDipendente(t){return new Promise((e,i)=>{this.bustePagaService.getBustePagaDipendente(t).pipe(Kn(this.destroy$)).subscribe({next:r=>{this.bustePaga=r,this.bustePagaFiltrate=r,e()},error:r=>{console.error("Errore nel caricamento buste paga dipendente:",r),i(r)}})})}caricaDipendenti(t){return new Promise((e,i)=>{this.dipendentiService.getDipendenti(t).pipe(Kn(this.destroy$)).subscribe({next:r=>{this.dipendenti=r,e()},error:r=>{console.error("Errore nel caricamento dipendenti:",r),i(r)}})})}inizializzaFiltri(){this.isAdmin?this.periodiUnici=[...new Set(this.bustePaga.map(t=>t.period))].sort().reverse():this.anniDisponibili=[...new Set(this.bustePaga.map(t=>t.period.split("-")[0]))].sort().reverse()}getCurrentUserId(){return y(this,null,function*(){return(yield ze(this.authService.currentUser$))?.id||""})}applicaFiltri(){let t=this.bustePaga;this.isAdmin?(this.filtroPeriodo&&(t=t.filter(e=>e.period===this.filtroPeriodo)),this.filtroDipendente&&(t=t.filter(e=>e.user_id===this.filtroDipendente))):this.filtroAnno&&(t=t.filter(e=>e.period.startsWith(this.filtroAnno))),this.bustePagaFiltrate=t}onDragOver(t){t.preventDefault(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),this.isDragOver=!1}onDrop(t){t.preventDefault(),this.isDragOver=!1;let e=t.dataTransfer?.files;e&&this.processFiles(e)}onFileSelected(t){let e=t.target;e.files&&this.processFiles(e.files)}processFiles(t){let e=Array.from(t).filter(i=>i.type==="application/pdf");if(e.length===0){this.errorMessage="Seleziona solo file PDF";return}this.selectedFiles=[...this.selectedFiles,...e],this.errorMessage=""}rimuoviFile(t){this.selectedFiles.splice(t,1)}canUpload(){return!!this.selectedUserId&&!!this.selectedPeriod&&this.selectedFiles.length>0}onUpload(){return y(this,null,function*(){if(this.canUpload()){this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=localStorage.getItem("companyId");if(!t)throw new Error("Company ID non trovato");let e=yield ze(this.authService.currentUser$);if(!e?.id)throw new Error("Utente non autenticato");let i=e.id;for(let r of this.selectedFiles)yield this.bustePagaService.uploadBustaPaga(r,this.selectedUserId,t,this.selectedPeriod,i);this.successMessage=`Caricamento completato! ${this.selectedFiles.length} file caricati.`,this.resetUpload(),yield this.caricaDati()}catch(t){console.error("Errore durante l'upload:",t),this.errorMessage=t.message||"Errore durante l'upload"}finally{this.isLoading=!1}}})}resetUpload(){this.selectedFiles=[],this.selectedUserId="",this.selectedPeriod="",this.mostraUpload=!1}downloadBustaPaga(t){this.bustePagaService.downloadBustaPaga(t.storage_path,t.original_name).pipe(Kn(this.destroy$)).subscribe({error:e=>{console.error("Errore nel download:",e),this.errorMessage="Errore durante il download"}})}eliminaBustaPaga(t){confirm("Sei sicuro di voler eliminare questa busta paga?")&&this.bustePagaService.eliminaBustaPaga(t.id,t.storage_path).pipe(Kn(this.destroy$)).subscribe({next:()=>{this.successMessage="Busta paga eliminata con successo",this.caricaDati()},error:e=>{console.error("Errore nell'eliminazione:",e),this.errorMessage="Errore durante l'eliminazione"}})}get ultimaBustaPaga(){return this.bustePaga.length>0?this.bustePaga[0]:null}static \u0275fac=function(e){return new(e||n)(D(Ip),D(gt),D(ae))};static \u0275cmp=ve({type:n,selectors:[["app-buste-paga"]],decls:41,vars:9,consts:[["fileInput",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"actions-container"],[1,"form-section"],[1,"grid-cards"],[1,"filters-container"],[1,"filter-group"],[1,"table-container"],[1,"crm-table"],[1,"empty-state"],[1,"promethea-button",3,"click"],[1,"grid-form",2,"margin-bottom","var(--gutter-lg)"],[1,"form-label"],[3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value"],["type","month",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"drop-zone",3,"drop","dragover","dragleave"],["class","drop-content",4,"ngIf"],["class","files-list",4,"ngIf"],[1,"status-message","error"],[1,"status-message","info"],[1,"form-actions"],["type","button",1,"promethea-button","ghost",3,"click","disabled"],["type","button",1,"promethea-button",3,"click","disabled"],[1,"loading-spinner"],[1,"drop-content"],[1,"text-muted",2,"margin-bottom","var(--gutter-lg)"],["type","button",1,"promethea-button","outline",3,"click"],["type","file","accept",".pdf","multiple","","hidden","",3,"change"],[1,"files-list"],["class","file-item",4,"ngFor","ngForOf"],[1,"file-item"],[1,"file-info"],[1,"file-name"],[1,"file-size"],["type","button",1,"icon-button",3,"click"],[1,"card"],[1,"card-title"],[1,"card-number"],[3,"ngModelChange","change","ngModel"],[1,"action-buttons"],[1,"icon-button",3,"click"],[1,"icon-button"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"]],template:function(e,i){e&1&&(c(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),d(4,"payments"),l()(),c(5,"div",5)(6,"h1",6),d(7),l(),c(8,"p",7),d(9),l()(),te(10,fV,5,0,"div",8),l(),te(11,wV,34,17,"div",9),te(12,EV,11,2,"div",10),c(13,"div",9)(14,"div",2)(15,"h2",6)(16,"span",4),d(17,"list_alt"),l(),d(18),l(),c(19,"div",11),te(20,xV,16,2)(21,IV,8,1,"div",12),l()(),c(22,"div",13)(23,"table",14)(24,"thead")(25,"tr"),te(26,TV,2,0,"th"),c(27,"th"),d(28,"Periodo"),l(),c(29,"th"),d(30,"File"),l(),c(31,"th"),d(32,"Data Caricamento"),l(),c(33,"th"),d(34,"Dimensione"),l(),c(35,"th"),d(36,"Azioni"),l()()(),c(37,"tbody"),At(38,RV,20,9,"tr",null,t_),l()()(),te(40,OV,7,1,"div",15),l()()),e&2&&(p(7),R(" ",i.isAdmin?"Gestione Buste Paga":"Le mie Buste Paga"," "),p(2),R(" ",i.isAdmin?"Carica e gestisci le buste paga dei dipendenti":"Consulta e scarica le tue buste paga"," "),p(),ne(i.isAdmin?10:-1),p(),ne(i.isAdmin&&i.mostraUpload?11:-1),p(),ne(i.isAdmin?-1:12),p(6),R(" ",i.isAdmin?"Buste Paga Caricate":"Storico Buste Paga"," "),p(2),ne(i.isAdmin?20:21),p(6),ne(i.isAdmin?26:-1),p(12),Rt(i.bustePagaFiltrate),p(2),ne(i.bustePagaFiltrate.length===0?40:-1))},dependencies:[be,Le,Se,Lt,kt,Ft,Me,mt,Oe,Et,Ut,dt],styles:[".drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--smoke-color-1);border-radius:16px;padding:var(--gutter-xl);text-align:center;transition:all .3s ease;background:color-mix(in srgb,var(--background) 95%,transparent)}.drop-zone.drag-over[_ngcontent-%COMP%]{border-color:var(--primary);background:color-mix(in srgb,var(--primary) 5%,transparent)}.drop-zone.has-files[_ngcontent-%COMP%]{border-style:solid;border-color:var(--primary);background:color-mix(in srgb,var(--primary) 2%,transparent)}.drop-content[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--smoke-color-1)}.drop-zone.drag-over[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--primary)}.files-list[_ngcontent-%COMP%]{text-align:left}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm);border:1px solid var(--smoke-color-1);border-radius:8px;margin-bottom:var(--gutter-sm);background:var(--background)}.file-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.file-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.file-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.file-size[_ngcontent-%COMP%]{font-size:.8rem;color:color-mix(in srgb,var(--text-color) 60%,transparent)}@media (max-width: 768px){.drop-zone[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.file-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gutter-sm)}.action-buttons[_ngcontent-%COMP%]{align-self:flex-end}}"]})};var PV=()=>({month:"long",year:"numeric"}),NV=(n,t)=>t.id;function kV(n,t){n&1&&(c(0,"div",10),O(1,"div",18),c(2,"p"),d(3,"Caricamento calendario..."),l()())}function FV(n,t){if(n&1&&(c(0,"div",13),d(1),l()),n&2){let e=t.$implicit;p(),T(e)}}function LV(n,t){if(n&1&&(c(0,"div",25)(1,"span",26),d(2),l()()),n&2){let e=t.$implicit;Si("background-color",e.color),p(2),T(e.title)}}function jV(n,t){if(n&1&&(c(0,"div",22),At(1,LV,3,3,"div",24,NV),l()),n&2){let e=g().$implicit,i=g(2);p(),Rt(i.getEventsForDay(e))}}function VV(n,t){if(n&1&&(c(0,"div",23),d(1),l()),n&2){let e=g(2).$implicit,i=g(2);p(),R(" ",i.getTimbratureCounterForDay(e)," ")}}function UV(n,t){if(n&1&&E(0,VV,2,1,"div",27),n&2){let e=g().$implicit,i=g(2);v("ngIf",i.getTimbratureCounterForDay(e))}}function zV(n,t){if(n&1){let e=k();c(0,"div",20),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.onDayClick(r))}),c(1,"div",21),d(2),l(),te(3,jV,3,0,"div",22),te(4,UV,1,1,"div",23),l()}if(n&2){let e=t.$implicit,i=g(2);Ce("current-month",i.isCurrentMonth(e))("other-month",!i.isCurrentMonth(e))("today",i.isToday(e)),p(2),R(" ",e.getDate()," "),p(),ne(i.getRuoloCorrente()==="employee"?3:-1),p(),ne(i.getRuoloCorrente()==="admin"||i.getRuoloCorrente()==="manager"?4:-1)}}function BV(n,t){if(n&1&&(c(0,"div",15),At(1,zV,5,9,"div",19,Er),l()),n&2){let e=t.$implicit;p(),Rt(e)}}function $V(n,t){n&1&&(c(0,"div",17),O(1,"div",28),c(2,"span"),d(3,"Timbratura completata"),l()(),c(4,"div",17),O(5,"div",29),c(6,"span"),d(7,"Timbratura in corso"),l()())}function HV(n,t){n&1&&(c(0,"div",17)(1,"span"),d(2,"Counter: Timbrature effettuate / Dipendenti totali"),l()())}var Mp=class n{currentDate=Ze(new Date);weeks=Ze([]);events=Ze([]);timbrature=Ze([]);dipendenti=Ze([]);isLoading=Ze(!0);daysOfWeek=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];authService=N(ae);timbratureService=N(vt);dipendentiService=N(gt);ngOnInit(){return y(this,null,function*(){yield this.caricaDipendenti(),yield this.caricaTimbrature(),this.generateCalendar()})}caricaDipendenti(){return y(this,null,function*(){let t=this.authService.currentUserSubject.value;if((t?.role==="admin"||t?.role==="manager")&&t.company_id)try{this.dipendentiService.getDipendenti(t.company_id).subscribe({next:e=>{let i=e.filter(r=>r.is_active);this.dipendenti.set(i)},error:e=>{console.error("Errore caricamento dipendenti:",e)}})}catch(e){console.error("Errore caricamento dipendenti:",e)}})}caricaTimbrature(){return y(this,null,function*(){this.isLoading.set(!0);try{let t=this.authService.currentUserSubject.value;if(!t)return;let e=[];t.role==="admin"?e=yield this.timbratureService.getTimbratureAzienda(t.company_id):t.role==="manager"?e=yield this.timbratureService.getTimbraturePerCalendario():e=yield this.timbratureService.getTimbratureUtente(t.id),this.timbrature.set(e),this.creaEventiDaTimbrature(e)}catch(t){console.error("Errore nel caricamento timbrature:",t)}finally{this.isLoading.set(!1)}})}creaEventiDaTimbrature(t){if(this.authService.currentUserSubject.value?.role==="employee"){let i=t.map(r=>({id:r.id||"",title:`${this.formattaOrario(r.start_ts)} - ${r.end_ts?this.formattaOrario(r.end_ts):"In corso"}`,date:new Date(r.start_ts),color:r.end_ts?"#22c55e":"#f59e0b",type:"timbratura",data:r}));this.events.set(i)}else this.events.set([])}getTimbratureCounterForDay(t){if(this.authService.currentUserSubject.value?.role==="employee")return"";let i=this.dipendenti().length;if(i===0)return"";let r=this.timbrature().filter(s=>{let a=new Date(s.start_ts);return this.isSameDay(a,t)});return`${new Set(r.map(s=>s.user_id)).size}/${i}`}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}formattaOrario(t){return new Date(t).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}generateCalendar(){let t=this.currentDate().getFullYear(),e=this.currentDate().getMonth(),i=new Date(t,e,1),r=new Date(t,e+1,0),o=new Date(i),s=(i.getDay()+6)%7;o.setDate(i.getDate()-s);let a=[],u=[];for(let f=0;f<42;f++){let h=new Date(o);h.setDate(o.getDate()+f),u.push(h),u.length===7&&(a.push(u),u=[])}this.weeks.set(a)}getEventsForDay(t){return this.authService.currentUserSubject.value?.role!=="employee"?[]:this.events().filter(i=>this.isSameDay(i.date,t))}isCurrentMonth(t){return t.getMonth()===this.currentDate().getMonth()}isToday(t){let e=new Date;return this.isSameDay(t,e)}previousMonth(){return y(this,null,function*(){let t=new Date(this.currentDate());t.setMonth(t.getMonth()-1),this.currentDate.set(t),this.generateCalendar(),yield this.caricaTimbrature()})}nextMonth(){return y(this,null,function*(){let t=new Date(this.currentDate());t.setMonth(t.getMonth()+1),this.currentDate.set(t),this.generateCalendar(),yield this.caricaTimbrature()})}goToToday(){return y(this,null,function*(){this.currentDate.set(new Date),this.generateCalendar(),yield this.caricaTimbrature()})}onDayClick(t){console.log("Giorno cliccato:",t)}getRuoloCorrente(){return this.authService.currentUserSubject.value?.role||""}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=ve({type:n,selectors:[["app-calendario"]],decls:31,vars:4,consts:[[1,"page-container"],[1,"card-header"],[1,"material-icons"],[1,"card-title"],[1,"calendar-controls"],["title","Mese precedente",1,"icon-button",3,"click"],[1,"promethea-button","ghost",3,"click"],[1,"calendar-month-title"],["title","Mese successivo",1,"icon-button",3,"click"],[1,"card-content"],[1,"loading-container"],[1,"calendar-container"],[1,"calendar-header"],[1,"calendar-day-header"],[1,"calendar-grid"],[1,"calendar-week"],[1,"calendar-legend"],[1,"legend-item"],[1,"loading-spinner"],[1,"calendar-day",3,"current-month","other-month","today"],[1,"calendar-day",3,"click"],[1,"day-number"],[1,"day-events"],[1,"timbrature-counter"],[1,"calendar-event","timbratura-event",3,"background-color"],[1,"calendar-event","timbratura-event"],[1,"event-time"],["class","timbrature-counter",4,"ngIf"],[1,"legend-color",2,"background-color","#22c55e"],[1,"legend-color",2,"background-color","#f59e0b"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"span",2),d(3,"calendar_today"),l(),c(4,"h2",3),d(5,"Calendario Timbrature"),l(),c(6,"div",4)(7,"button",5),x("click",function(){return i.previousMonth()}),c(8,"span",2),d(9,"chevron_left"),l()(),c(10,"button",6),x("click",function(){return i.goToToday()}),c(11,"span",2),d(12,"today"),l(),d(13," Oggi "),l(),c(14,"h3",7),d(15),l(),c(16,"button",8),x("click",function(){return i.nextMonth()}),c(17,"span",2),d(18,"chevron_right"),l()()()(),c(19,"div",9),te(20,kV,4,0,"div",10),c(21,"div",11)(22,"div",12),At(23,FV,2,1,"div",13,Er),l(),c(25,"div",14),At(26,BV,3,0,"div",15,Er),l()(),c(28,"div",16),te(29,$V,8,0)(30,HV,3,0,"div",17),l()()()),e&2&&(p(15),R(" ",i.currentDate().toLocaleDateString("it-IT",$e(3,PV))," "),p(5),ne(i.isLoading()?20:-1),p(3),Rt(i.daysOfWeek),p(3),Rt(i.weeks()),p(3),ne(i.getRuoloCorrente()==="employee"?29:30))},dependencies:[be,Se],styles:[".calendar-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-md);margin-left:auto}.calendar-month-title[_ngcontent-%COMP%]{margin:0;font-size:var(--fs-md);font-weight:600;color:var(--text-color);min-width:200px;text-align:center}.calendar-container[_ngcontent-%COMP%]{background:var(--background);border-radius:16px;overflow:hidden}.calendar-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);background:var(--smoke-color-2);border-bottom:1px solid var(--smoke-color-1)}.calendar-day-header[_ngcontent-%COMP%]{padding:var(--gutter-md);text-align:center;font-weight:600;color:var(--text-color);font-size:var(--fs-sm);border-right:1px solid var(--smoke-color-1)}.calendar-day-header[_ngcontent-%COMP%]:last-child{border-right:none}.calendar-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column}.calendar-week[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);min-height:120px}.calendar-day[_ngcontent-%COMP%]{padding:var(--gutter-sm);border-right:1px solid var(--smoke-color-1);border-bottom:1px solid var(--smoke-color-1);cursor:pointer;transition:all .2s ease;background:var(--background);position:relative}.calendar-day[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 5%,transparent);transform:translateY(-1px)}.calendar-day.other-month[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--background) 60%,transparent);color:color-mix(in srgb,var(--text-color) 40%,transparent)}.calendar-day.other-month[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 3%,transparent)}.calendar-day.today[_ngcontent-%COMP%]{background:var(--gradiente-light);border:2px solid var(--primary)}.calendar-day.today[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{font-weight:800;color:var(--primary)}.day-number[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;margin-bottom:var(--gutter-sm);text-align:center;color:var(--text-color)}.other-month[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 40%,transparent);font-weight:400}.day-events[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;max-height:80px;overflow-y:auto}.day-events[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.day-events[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--smoke-color-1);border-radius:2px}@media (max-width: 768px){.calendar-controls[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}.calendar-month-title[_ngcontent-%COMP%]{min-width:150px;order:-1;width:100%;text-align:center}.calendar-week[_ngcontent-%COMP%]{min-height:100px}.calendar-day[_ngcontent-%COMP%]{padding:4px}.day-number[_ngcontent-%COMP%]{font-size:.8rem;margin-bottom:2px}}@media (max-width: 480px){.calendar-day-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);font-size:.7rem}}.timbrature-counter[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary);font-weight:600;text-align:center;margin-top:4px;padding:2px 6px;background:color-mix(in srgb,var(--primary) 10%,transparent);border-radius:4px;border:1px solid color-mix(in srgb,var(--primary) 20%,transparent);min-height:20px;display:flex;align-items:center;justify-content:center}.calendar-day.other-month[_ngcontent-%COMP%]   .timbrature-counter[_ngcontent-%COMP%]{opacity:.5}@media (max-width: 768px){.timbrature-counter[_ngcontent-%COMP%]{font-size:.65rem;padding:1px 4px;min-height:16px}}"]})};var Ap=class n{constructor(t){this.supabaseService=t}getJobPosts(t){if(!t)return B(Promise.resolve([]));let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("job_posts").select("*").eq("company_id",t).order("created_at",{ascending:!1});if(o)throw o;return Array.isArray(r)?r:[]});return B(i)}getJobPostById(t){let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("job_posts").select("*").eq("id",t).maybeSingle();if(o)throw o;return r??null});return B(i)}createJobPost(t){let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("job_posts").insert([t]).select().maybeSingle();if(o)throw o;return r});return B(i)}updateJobPost(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){let{data:o,error:s}=yield i.from("job_posts").update(J(P({},e),{updated_at:new Date().toISOString()})).eq("id",t).select().maybeSingle();if(s)throw s;return o??null});return B(r)}deleteJobPost(t){let e=this.supabaseService.getClient();return B(e.from("job_posts").delete().eq("id",t))}static \u0275fac=function(e){return new(e||n)(U(it))};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};function GV(n,t){if(n&1&&(c(0,"option",22),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),T(e.name)}}function qV(n,t){if(n&1&&(c(0,"option",22),d(1),l()),n&2){let e=t.$implicit;v("value",e.id),p(),T(e.name)}}var Rp=class n{constructor(t,e,i,r,o){this.fb=t;this.jobPosts=e;this.jobTitleService=i;this.departmentsService=r;this.auth=o;this.form=this.fb.group({title:["",ee.required],job_title_id:[null],department_id:[null],location:[""],contract_type:["Full-time"],description:["",ee.required],requirements:[""],salary_min:[null],salary_max:[null],expires_at:[null]})}form;jobTitles=[];departments=[];companyId;currentUser=null;ngOnInit(){this.auth.currentUser$.subscribe(t=>{this.currentUser=t,this.companyId=t?.company_id??null;let e=this.companyId??void 0;e&&(this.jobTitleService.getJobTitles(e).subscribe(i=>this.jobTitles=i||[]),this.departmentsService.getDepartments(e).subscribe(i=>this.departments=i||[]))})}submit(){if(this.form.invalid)return;let t=J(P({},this.form.value),{company_id:this.companyId??void 0,created_by:this.currentUser?.id,status:"open"});this.jobPosts.createJobPost(t).subscribe(()=>{alert("Annuncio creato"),this.form.reset({contract_type:"Full-time"})},e=>{console.error(e),alert("Errore creazione annuncio")})}static \u0275fac=function(e){return new(e||n)(D(Un),D(Ap),D(jr),D(Fi),D(ae))};static \u0275cmp=ve({type:n,selectors:[["app-ricerca-personale"]],decls:58,vars:5,consts:[[1,"page-container"],[1,"section-header"],[1,"section-title"],[1,"text-muted"],[1,"form-section"],[3,"ngSubmit","formGroup"],[1,"form-label"],["type","text","formControlName","title",1,"form-control"],["formControlName","job_title_id",1,"form-control"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["formControlName","department_id",1,"form-control"],["formControlName","contract_type",1,"form-control"],["type","text","formControlName","location",1,"form-control"],["rows","6","formControlName","description",1,"form-control"],["rows","3","formControlName","requirements",1,"form-control"],[2,"display","flex","gap","1rem"],["type","number","formControlName","salary_min",1,"form-control"],["type","number","formControlName","salary_max",1,"form-control"],["type","date","formControlName","expires_at",1,"form-control"],[2,"margin-top","1rem"],["type","submit",1,"promethea-button"],[3,"value"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Ricerca Personale"),l(),c(4,"p",3),d(5,"Crea un annuncio di ricerca personale (admin)"),l()(),c(6,"div",4)(7,"form",5),x("ngSubmit",function(){return i.submit()}),c(8,"label",6),d(9,"Titolo"),l(),O(10,"input",7),c(11,"label",6),d(12,"Mansione"),l(),c(13,"select",8)(14,"option",9),d(15,"\u2014"),l(),E(16,GV,2,2,"option",10),l(),c(17,"label",6),d(18,"Reparto"),l(),c(19,"select",11)(20,"option",9),d(21,"\u2014"),l(),E(22,qV,2,2,"option",10),l(),c(23,"label",6),d(24,"Tipo contratto"),l(),c(25,"select",12)(26,"option"),d(27,"Full-time"),l(),c(28,"option"),d(29,"Part-time"),l(),c(30,"option"),d(31,"Contratto a progetto"),l(),c(32,"option"),d(33,"Tempo determinato"),l()(),c(34,"label",6),d(35,"Luogo"),l(),O(36,"input",13),c(37,"label",6),d(38,"Descrizione"),l(),O(39,"textarea",14),c(40,"label",6),d(41,"Requisiti"),l(),O(42,"textarea",15),c(43,"div",16)(44,"div")(45,"label",6),d(46,"Salario minimo"),l(),O(47,"input",17),l(),c(48,"div")(49,"label",6),d(50,"Salario massimo"),l(),O(51,"input",18),l()(),c(52,"label",6),d(53,"Scadenza annuncio"),l(),O(54,"input",19),c(55,"div",20)(56,"button",21),d(57,"Crea annuncio"),l()()()()()),e&2&&(p(7),v("formGroup",i.form),p(7),v("ngValue",null),p(2),v("ngForOf",i.jobTitles),p(4),v("ngValue",null),p(2),v("ngForOf",i.departments))},dependencies:[be,Le,zn,mn,kt,Ft,Me,To,mt,Oe,hn,gn,Mn],encapsulation:2})};var Tx=[{path:"",redirectTo:"/login",pathMatch:"full"},{path:"login",component:hp},{path:"register",component:mp},{path:"forgot-password",component:gp},{path:"home",component:vp},{path:"timbrature",component:_p},{path:"crea-timbratura",component:yp},{path:"profilo-aziendale",component:bp},{path:"calendario",component:Mp},{path:"dipendenti",component:wp},{path:"dipendenti/:id",component:Cp},{path:"inviti-dipendenti",component:ca},{path:"report",component:Dp},{path:"buste-paga",component:Tp},{path:"kpi",component:Sp},{path:"impostazioni",component:xp},{path:"ricerca-personale",component:Rp},{path:"loading-spinner",component:Gn},{path:"**",redirectTo:"/home"}];var n_={providers:[nm(),w0(),zg({eventCoalescing:!0}),Y0(Tx)]};var Op=class n{THEME_KEY="app-theme";darkThemeClass="dark-theme";currentTheme=Ze("light");constructor(){this.loadTheme()}loadTheme(){let t=localStorage.getItem(this.THEME_KEY),e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=t||(e?"dark":"light");this.setTheme(i)}toggleTheme(){let t=this.currentTheme()==="light"?"dark":"light";this.setTheme(t)}setTheme(t){this.currentTheme.set(t),localStorage.setItem(this.THEME_KEY,t),t==="dark"?(document.documentElement.setAttribute("data-theme","dark"),document.documentElement.classList.add(this.darkThemeClass)):(document.documentElement.removeAttribute("data-theme"),document.documentElement.classList.remove(this.darkThemeClass))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var JV=["sidebar"];function KV(n,t){if(n&1){let e=k();c(0,"button",41),x("click",function(){C(e);let r=g(2);return S(r.toggleSidebar())}),c(1,"span",10),d(2,"chevron_left"),l()()}}function YV(n,t){n&1&&(c(0,"div",42),d(1,"Dashboard"),l())}function ZV(n,t){n&1&&(c(0,"div",42),d(1,"Gestione"),l())}function QV(n,t){n&1&&(c(0,"span",16),d(1,"Dipendenti"),l())}function XV(n,t){if(n&1){let e=k();c(0,"a",43),x("click",function(){C(e);let r=g(2);return S(r.onNavItemClicked())}),c(1,"span",10),d(2,"people"),l(),E(3,QV,2,0,"span",44),l()}if(n&2){let e=g(2);p(3),v("ngIf",!e.isSidebarCollapsed)}}function e4(n,t){if(n&1&&(c(0,"span",45),d(1),l()),n&2){let e=g(2);p(),T(e.unreadAnnouncementsCount)}}function t4(n,t){n&1&&(c(0,"div",42),d(1,"Timbrature"),l())}function n4(n,t){if(n&1&&(c(0,"span",46),d(1),l()),n&2){let e=g(2);p(),T(e.pendingModificationRequests)}}function i4(n,t){n&1&&(c(0,"div",42),d(1,"Report"),l())}function r4(n,t){if(n&1){let e=k();c(0,"div",13),E(1,i4,2,0,"div",14),c(2,"a",47),x("click",function(){C(e);let r=g(2);return S(r.onNavItemClicked())}),c(3,"span",10),d(4,"assessment"),l(),c(5,"span",16),d(6,"Report"),l()()()}if(n&2){let e=g(2);p(),v("ngIf",!e.isSidebarCollapsed)}}function o4(n,t){n&1&&(c(0,"div",42),d(1,"Analisi"),l())}function s4(n,t){n&1&&(c(0,"div",42),d(1,"Ricerca"),l())}function a4(n,t){if(n&1){let e=k();c(0,"div",13),E(1,s4,2,0,"div",14),c(2,"a",48),x("click",function(){C(e);let r=g(2);return S(r.onNavItemClicked())}),c(3,"span",10),d(4,"search"),l(),c(5,"span",16),d(6,"Ricerca Personale"),l()()()}if(n&2){let e=g(2);p(),v("ngIf",!e.isSidebarCollapsed)}}function l4(n,t){if(n&1&&(c(0,"div",49)(1,"div",50)(2,"div",51),d(3),l(),c(4,"div",52),d(5),l()()()),n&2){let e=g(2);p(3),_e("",e.currentUser==null?null:e.currentUser.first_name," ",e.currentUser==null?null:e.currentUser.last_name),p(2),T(e.currentUser==null?null:e.currentUser.role)}}function c4(n,t){if(n&1){let e=k();et(0),c(1,"div",3)(2,"aside",4,1)(4,"div",5)(5,"div",6),O(6,"img",7),l(),c(7,"div",8)(8,"button",9),x("click",function(){C(e);let r=g();return S(r.toggleTheme())}),c(9,"span",10),d(10),l()(),E(11,KV,3,0,"button",11),l()(),c(12,"nav",12)(13,"div",13),E(14,YV,2,0,"div",14),c(15,"a",15),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(16,"span",10),d(17,"dashboard"),l(),c(18,"span",16),d(19,"Dashboard"),l()()(),c(20,"div",13),E(21,ZV,2,0,"div",14)(22,XV,4,1,"a",17),c(23,"a",18),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(24,"span",10),d(25,"business"),l(),c(26,"span",16),d(27,"Azienda"),l(),E(28,e4,2,1,"span",19),l()(),c(29,"div",13),E(30,t4,2,0,"div",14),c(31,"a",20),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(32,"span",10),d(33,"schedule"),l(),c(34,"span",16),d(35,"Timbrature"),l(),E(36,n4,2,1,"span",21),l(),c(37,"a",22),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(38,"span",10),d(39,"add_circle"),l(),c(40,"span",16),d(41,"Nuova Timbratura"),l()(),c(42,"a",23),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(43,"span",10),d(44,"calendar_today"),l(),c(45,"span",16),d(46,"Calendario"),l()()(),E(47,r4,7,1,"div",24),c(48,"div",13),E(49,o4,2,0,"div",14),c(50,"a",25),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(51,"span",10),d(52,"insights"),l(),c(53,"span",16),d(54,"KPI"),l()()(),E(55,a4,7,1,"div",24),l(),c(56,"div",26)(57,"div",27)(58,"div",28),d(59),l(),E(60,l4,6,3,"div",29),c(61,"div",30)(62,"a",31),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(63,"span",10),d(64,"settings"),l()(),c(65,"button",32),x("click",function(){C(e);let r=g();return S(r.logout())}),c(66,"span",10),d(67,"logout"),l()()()()()(),c(68,"main",33)(69,"header",34)(70,"button",35),x("click",function(){C(e);let r=g();return S(r.toggleSidebar())}),c(71,"span",10),d(72,"menu"),l()(),c(73,"div",36)(74,"div",37),d(75),Z(76,"date"),l(),c(77,"div",38),d(78),Z(79,"date"),l()()(),c(80,"div",39),O(81,"router-outlet"),l()(),c(82,"div",40),x("click",function(){C(e);let r=g();return S(r.closeSidebar())}),l()(),tt()}if(n&2){let e=g();p(),Ce("sidebar-collapsed",e.isSidebarCollapsed)("mobile-open",e.isMobileSidebarOpen),p(),Ce("hidden",e.isSidebarCollapsed)("collapsed",e.isSidebarCollapsed&&!e.isMobileSidebarOpen),p(6),v("title",e.currentTheme()==="light"?"Attiva tema scuro":"Attiva tema chiaro"),p(2),R(" ",e.currentTheme()==="light"?"dark_mode":"light_mode"," "),p(),v("ngIf",!e.isSidebarCollapsed),p(3),v("ngIf",!e.isSidebarCollapsed),p(7),v("ngIf",!e.isSidebarCollapsed),p(),v("ngIf",e.employeesVisibilityResolved&&e.canShowEmployeesNav()),p(6),v("ngIf",e.unreadAnnouncementsCount>0),p(2),v("ngIf",!e.isSidebarCollapsed),p(6),v("ngIf",e.pendingModificationRequests>0),p(11),v("ngIf",e.hasRole("admin")||e.hasRole("manager")&&e.canViewReports),p(2),v("ngIf",!e.isSidebarCollapsed),p(6),v("ngIf",e.hasRole("admin")||e.hasRole("manager")),p(4),_e(" ",e.currentUser==null||e.currentUser.first_name==null?null:e.currentUser.first_name.charAt(0),"",e.currentUser==null||e.currentUser.last_name==null?null:e.currentUser.last_name.charAt(0)," "),p(),v("ngIf",!e.isSidebarCollapsed),p(2),v("title","Impostazioni"),p(3),v("title","Logout"),p(10),T(X(76,29,e.currentTime,"HH:mm")),p(3),T(X(79,32,e.currentTime,"EEEE, d MMMM yyyy")),p(4),Ce("active",e.isMobileSidebarOpen)}}function u4(n,t){n&1&&(c(0,"div",53),O(1,"router-outlet"),l())}var Pp=class n{constructor(t,e,i,r,o){this.authService=t;this.router=e;this.announcementsService=i;this.timbratureService=r;this.companyService=o}sidebarRef;isSidebarCollapsed=!1;isMobileSidebarOpen=!1;currentTime=new Date;currentUser=null;isAuthRoute=!1;unreadAnnouncementsCount=0;announcementsPollSub;pendingModificationRequests=0;themeService=N(Op);currentTheme=this.themeService.currentTheme;canViewEmployeesList=!1;canViewReports=!1;employeesVisibilityResolved=!1;timeInterval;userSub;routeSub;authRoutes=["/login","/register","/forgot-password"];ngOnInit(){return y(this,null,function*(){this.timeInterval=setInterval(()=>{this.currentTime=new Date},1e3),this.timbratureService.pendingRequests$.subscribe(()=>{this.updatePendingModificationBadge(this.currentUser?.company_id,this.currentUser).catch(()=>{})}),this.userSub=this.authService.currentUser$.subscribe(e=>y(this,null,function*(){this.currentUser=e,this.employeesVisibilityResolved=!1,this.canViewEmployeesList=!1,this.canViewReports=!1;try{let i=e?.company_id??null;yield this.timbratureService.updatePendingModificationCount(i)}catch(i){console.warn("[App] errore updatePendingModificationCount",i)}if(e?.company_id&&this.refreshUnreadCount(e.company_id),!e){this.employeesVisibilityResolved=!0;return}if(this.hasRole("admin")){this.canViewEmployeesList=!0,this.canViewReports=!0,this.employeesVisibilityResolved=!0;return}try{yield this.updatePendingModificationBadge(e?.company_id??void 0,e),yield this.resolveEmployeesVisibility(e)}catch(i){console.warn("[App] errore durante resolveEmployeesVisibility",i),this.canViewEmployeesList=!1,this.canViewReports=!1,this.employeesVisibilityResolved=!0}})),this.announcementsPollSub=setInterval(()=>{this.currentUser?.company_id&&this.refreshUnreadCount(this.currentUser.company_id)},3e4);let t=this.router.url.split("?")[0];this.isAuthRoute=this.authRoutes.includes(t),this.routeSub=this.router.events.pipe(at(e=>e instanceof rn)).subscribe(e=>{let i=e.urlAfterRedirects.split("?")[0];this.isAuthRoute=this.authRoutes.includes(i),this.isAuthRoute&&(this.isSidebarCollapsed=!0,this.isMobileSidebarOpen=!1)}),this.checkScreenSize()})}onResize(){this.checkScreenSize()}checkScreenSize(){window.innerWidth<768?(this.isSidebarCollapsed=!0,this.isMobileSidebarOpen=!1):this.isMobileSidebarOpen=!1}canShowEmployeesNav(){return this.hasRole("admin")||this.hasRole("manager")&&!!this.canViewEmployeesList}toggleTheme(){this.themeService.toggleTheme()}toggleSidebar(){window.innerWidth<768?(this.isMobileSidebarOpen=!this.isMobileSidebarOpen,this.isSidebarCollapsed=!this.isMobileSidebarOpen):this.isSidebarCollapsed=!this.isSidebarCollapsed}closeSidebar(){window.innerWidth<768?(this.isMobileSidebarOpen=!1,this.isSidebarCollapsed=!0):this.isSidebarCollapsed=!0}onNavItemClicked(){setTimeout(()=>this.closeSidebar(),50)}handleDocumentClick(t){let e=t.target;e&&(e.closest(".sidebar")||e.closest(".sidebar-toggle")||e.closest(".sidebar-hamburger")||(this.isMobileSidebarOpen||!this.isSidebarCollapsed&&window.innerWidth>=768)&&this.closeSidebar())}hasRole(t){return this.authService.hasRole(t)}logout(){this.authService.logout(),this.router.navigate(["/login"])}ngOnDestroy(){this.timeInterval&&clearInterval(this.timeInterval),this.userSub?.unsubscribe(),this.routeSub?.unsubscribe(),this.announcementsPollSub&&clearInterval(this.announcementsPollSub)}refreshUnreadCount(t){return y(this,null,function*(){try{this.unreadAnnouncementsCount=yield this.announcementsService.getUnreadCountForUser(t)}catch(e){console.error("Unread count error",e)}})}resolveEmployeesVisibility(t){return y(this,null,function*(){try{if(this.canViewEmployeesList=!1,this.canViewReports=!1,this.hasRole("admin")){this.canViewEmployeesList=!0,this.canViewReports=!0,this.employeesVisibilityResolved=!0;return}if(t.role!=="manager"){this.employeesVisibilityResolved=!0;return}let e=null;try{let o=this.companyService.getAziendaForUser(t.id,t.company_id);e=yield ze(o)}catch{e=null}let i=this.companyService.resolveManagerConfig(e,String(t.id)),r=typeof i.mode<"u"&&i.mode!==null;this.canViewEmployeesList=!!(i.can_view_all_employees||Array.isArray(i.user_ids)&&i.user_ids.length>0||Array.isArray(i.roles)&&i.roles.length>0||Array.isArray(i.department_ids)&&i.department_ids.length>0||r&&i.mode!=="self"),this.canViewReports=!!i.can_view_reports}catch(e){console.warn("[App] errore risoluzione visibilit\xE0 dipendenti",e),this.canViewEmployeesList=!1,this.canViewReports=!1}finally{this.employeesVisibilityResolved=!0}})}updatePendingModificationBadge(t,e){return y(this,null,function*(){try{if(!e){this.pendingModificationRequests=0;return}if(this.hasRole("admin")){let i=yield this.timbratureService.getRichiesteModifica(t??void 0,"pending");this.pendingModificationRequests=Array.isArray(i)?i.length:0;return}if(this.hasRole("manager")){let i=null;try{i=yield ze(this.companyService.getAziendaForUser(e.id,e.company_id))}catch{i=null}let r=this.companyService.resolveManagerConfig(i,String(e.id));if(!r||!r.can_modify_timbrature){this.pendingModificationRequests=0;return}let o=yield this.timbratureService.getRichiesteModifica(t??void 0,"pending");if(!Array.isArray(o)||o.length===0){this.pendingModificationRequests=0;return}let s=o.map(h=>({id:String(h.user?.id??h.timbratura?.user_id??h.user_id??""),first_name:h.user?.first_name,last_name:h.user?.last_name})),a=this.companyService.filterEmployeesByVisibility(s,i,String(e.id)),u=new Set((a||[]).map(h=>String(h.id))),f=o.filter(h=>{let m=String(h.user?.id??h.timbratura?.user_id??h.user_id??"");return u.has(m)}).length;this.pendingModificationRequests=f;return}this.pendingModificationRequests=0}catch(i){console.warn("[App] updatePendingModificationBadge error",i),this.pendingModificationRequests=0}})}static \u0275fac=function(e){return new(e||n)(D(ae),D(De),D(la),D(vt),D(He))};static \u0275cmp=ve({type:n,selectors:[["app-root"]],viewQuery:function(e,i){if(e&1&&Xa(JV,7),e&2){let r;uo(r=fo())&&(i.sidebarRef=r.first)}},hostBindings:function(e,i){e&1&&x("resize",function(){return i.onResize()},og)("click",function(o){return i.handleDocumentClick(o)},sg)},decls:3,vars:2,consts:[["authLayout",""],["sidebar",""],[4,"ngIf","ngIfElse"],[1,"app-container"],[1,"sidebar"],[1,"sidebar-header"],[1,"logo-container"],["src","/assets/logo.png","alt","Logo",1,"logo"],[1,"header-actions"],[1,"theme-toggle","icon-button",3,"click","title"],[1,"material-icons"],["class","sidebar-toggle icon-button",3,"click",4,"ngIf"],[1,"sidebar-nav"],[1,"nav-section"],["class","nav-label",4,"ngIf"],["routerLink","/home","routerLinkActive","active",1,"nav-item",3,"click"],[1,"nav-text"],["class","nav-item","routerLink","/dipendenti","routerLinkActive","active",3,"click",4,"ngIf"],["routerLink","/profilo-aziendale","routerLinkActive","active",1,"nav-item",3,"click"],["class","badge",4,"ngIf"],["routerLink","/timbrature","routerLinkActive","active",1,"nav-item",3,"click"],["class","nav-badge",4,"ngIf"],["routerLink","/crea-timbratura","routerLinkActive","active",1,"nav-item",3,"click"],["routerLink","/calendario","routerLinkActive","active",1,"nav-item",3,"click"],["class","nav-section",4,"ngIf"],["routerLink","/kpi","routerLinkActive","active",1,"nav-item",3,"click"],[1,"sidebar-footer"],[1,"user-section"],[1,"user-avatar"],["class","user-info",4,"ngIf"],[1,"user-actions"],["routerLink","/impostazioni","routerLinkActive","active",1,"nav-item","compact",3,"click","title"],[1,"nav-item","compact","logout-btn",3,"click","title"],[1,"main-content"],[1,"top-header"],[1,"sidebar-hamburger",3,"click"],[1,"header-actions",2,"background","var(--background)"],[1,"current-time"],[1,"current-date"],[1,"page-content"],[1,"mobile-overlay",3,"click"],[1,"sidebar-toggle","icon-button",3,"click"],[1,"nav-label"],["routerLink","/dipendenti","routerLinkActive","active",1,"nav-item",3,"click"],["class","nav-text",4,"ngIf"],[1,"badge"],[1,"nav-badge"],["routerLink","/report","routerLinkActive","active",1,"nav-item",3,"click"],["routerLink","/ricerca-personale","routerLinkActive","active",1,"nav-item",3,"click"],[1,"user-info"],[1,"user-details"],[1,"user-name"],[1,"user-role","chip"],[1,"auth-layout"]],template:function(e,i){if(e&1&&E(0,c4,83,35,"ng-container",2)(1,u4,2,0,"ng-template",null,0,xn),e&2){let r=en(2);v("ngIf",!i.isAuthRoute)("ngIfElse",r)}},dependencies:[be,Se,Nl,Ut,Gt,K0,dt],styles:[".app-container[_ngcontent-%COMP%]{display:block;min-height:100vh;background:var(--background)}.app-container.sidebar-collapsed[_ngcontent-%COMP%]{grid-template-columns:0px 1fr}.sidebar[_ngcontent-%COMP%]{position:fixed;inset:0 auto 0 0;width:var(--grandezzasidebar);max-width:min(90vw,320px);height:100%;max-height:100dvh;box-sizing:border-box;display:flex;flex-direction:column;gap:var(--gutter-sm);padding:0;padding-bottom:env(safe-area-inset-bottom);background:var(--sidebar-background);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-right:1px solid var(--smoke-color-1);z-index:9999;transition:transform .32s cubic-bezier(.2,.9,.2,1);overflow-y:auto;-webkit-overflow-scrolling:touch;transform:translateZ(0)}.sidebar.hidden[_ngcontent-%COMP%]{width:0;border-right:none;box-shadow:none;transition:all .4s cubic-bezier(.25,.8,.25,1);padding:0}.sidebar.collapsed[_ngcontent-%COMP%]:not(.hidden){width:0;padding:0}.sidebar-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0;border-bottom:1px solid var(--smoke-color-1);min-height:5rem;flex-shrink:0;position:relative;overflow:hidden}.sidebar-header[_ngcontent-%COMP%]   .theme-toggle[_ngcontent-%COMP%]{background:var(--smoke-color-1);border:1px solid var(--smoke-color-2);color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:50%;transition:all .3s cubic-bezier(.25,.8,.25,1);display:flex;align-items:center;justify-content:center;width:40px;height:40px;position:relative;overflow:hidden;box-shadow:0 2px 4px var(--shadow)}.logo[_ngcontent-%COMP%]{height:50px;width:auto;object-fit:contain;flex-shrink:0;transition:all .3s cubic-bezier(.25,.8,.25,1);filter:brightness(1);border-radius:50%;box-shadow:0 2px 4px var(--shadow);background:color-mix(in srgb,var(--text-color) 20%,transparent)}.logo-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex:1;min-width:0;padding:var(--gutter-sm);transition:all .3s cubic-bezier(.25,.8,.25,1)}.app-name[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-md);color:var(--primary);white-space:nowrap;opacity:1;padding:var(--gutter-sm);transition:opacity .3s ease}.sidebar.collapsed[_ngcontent-%COMP%]   .app-name[_ngcontent-%COMP%]{opacity:0;width:0}.sidebar-toggle[_ngcontent-%COMP%]{background:var(--smoke-color-1);border:1px solid var(--smoke-color-2);color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:50%;transition:all .3s cubic-bezier(.25,.8,.25,1);display:flex;align-items:center;justify-content:center;width:40px;height:40px;box-shadow:0 2px 4px var(--shadow)}.sidebar-toggle[_ngcontent-%COMP%]:hover{background:var(--text-color);color:var(--background);border-color:var(--accent);transform:translateY(-1px);box-shadow:0 4px 12px color-mix(in srgb,var(--accent) 30%,transparent)}.sidebar-nav[_ngcontent-%COMP%]{flex:1 1 auto;padding:var(--gutter-lg) 0;overflow-y:auto;-webkit-overflow-scrolling:touch}.nav-section[_ngcontent-%COMP%]{margin-bottom:var(--gutter-lg)}.nav-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;color:var(--text-color);opacity:.6;padding:0 var(--gutter-lg) var(--gutter-sm) var(--gutter-lg);text-transform:uppercase;letter-spacing:.5px;transition:opacity .3s ease}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{opacity:0;height:0;padding:0;margin:0}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) var(--gutter-lg);color:var(--text-color);text-decoration:none;transition:all .2s ease;border-left:3px solid transparent;margin:2px var(--gutter-sm);border-radius:8px;white-space:nowrap;overflow:hidden}.nav-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);border-left-color:var(--primary)}.nav-item.active[_ngcontent-%COMP%]{background:var(--smoke-color-3);border-left-color:var(--tertiary);color:var(--tertiary);font-weight:600}.nav-item.compact[_ngcontent-%COMP%]{padding:var(--gutter-sm);justify-content:center;margin:0}.nav-text[_ngcontent-%COMP%]{transition:opacity .3s ease;opacity:1}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-text[_ngcontent-%COMP%]{opacity:0;width:0}.nav-text[_ngcontent-%COMP%], .app-name[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%], .nav-label[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.25,.8,.25,1)}.nav-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:20px;min-width:24px;text-align:center}.sidebar-footer[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);position:sticky;bottom:0;z-index:2;background:transparent;padding:var(--gutter-sm) calc(var(--gutter-sm));padding-bottom:calc(var(--gutter-sm) + env(safe-area-inset-bottom));flex-shrink:0}.user-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);transition:all .3s ease}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:var(--gradiente);display:flex;align-items:center;justify-content:center;color:var(--background);font-weight:600;font-size:var(--fs-sm);flex-shrink:0}.user-info[_ngcontent-%COMP%]{flex:1;overflow:hidden;transition:opacity .3s ease;opacity:1}.sidebar.collapsed[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{opacity:0;width:0;margin:0}.user-details[_ngcontent-%COMP%]{min-width:0}.user-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-role.chip[_ngcontent-%COMP%]{font-size:.7rem;padding:2px 8px}.user-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);margin-left:auto}.logout-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;text-align:left;font-family:inherit}.main-content[_ngcontent-%COMP%]{background:var(--background);display:flex;flex-direction:column;width:calc(100% - var(--grandezzasidebar));min-height:100vh;margin-left:var(--grandezzasidebar);transition:margin-left .4s cubic-bezier(.25,.8,.25,1),width .4s cubic-bezier(.25,.8,.25,1);box-sizing:border-box;max-width:100%;transform:translateZ(0);will-change:margin-left,width}.top-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--gutter-sm);background:transparent;border-bottom:1px solid var(--smoke-color-1);position:sticky;top:0;z-index:100;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);min-height:5rem}.sidebar-hamburger[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.sidebar-hamburger[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1)}.sidebar-hamburger[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex-shrink:0;padding:var(--gutter-sm);border-radius:8px;transition:all .3s cubic-bezier(.25,.8,.25,1)}.current-time[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;color:var(--primary)}.current-date[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-color);opacity:.7}.theme-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.theme-toggle[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);color:var(--primary)}.badge[_ngcontent-%COMP%]{color:var(--tertiary);padding:.2rem .6rem;background:var(--smoke-color-1);border-radius:50%}.page-content[_ngcontent-%COMP%]{flex:1;padding:0;overflow-y:auto}.mobile-overlay[_ngcontent-%COMP%]{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:999;opacity:0;visibility:hidden;transition:all .3s cubic-bezier(.25,.8,.25,1);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.mobile-overlay.active[_ngcontent-%COMP%]{opacity:1;visibility:visible}@media (max-width: 768px){.app-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.sidebar[_ngcontent-%COMP%]{transform:translate(-105%);box-shadow:0 8px 30px #0000001f;will-change:transform;width:100%}.sidebar[_ngcontent-%COMP%]:not(.hidden){transform:translate(0)}.mobile-overlay[_ngcontent-%COMP%]{display:block;background:#0006;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.header-actions[_ngcontent-%COMP%]{gap:var(--gutter-sm);align-items:flex-end}.current-time[_ngcontent-%COMP%]{font-size:var(--fs-sm)}.current-date[_ngcontent-%COMP%]{font-size:.8rem}}@media (max-width: 480px){.page-content[_ngcontent-%COMP%]{padding:var(--gutter-md)}.sidebar-footer[_ngcontent-%COMP%]{padding:var(--gutter-sm)}.user-section[_ngcontent-%COMP%], .user-actions[_ngcontent-%COMP%]{gap:var(--gutter-sm)}}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:var(--scrollbar-radius)}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(-100%)}to{transform:translate(0)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.app-container.sidebar-collapsed[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]{width:100%;margin-left:0;max-width:100%;box-sizing:border-box}"]})};_0(Pp,J(P({},n_),{providers:[...n_.providers??[],{provide:Dn,useClass:cl}]})).catch(n=>console.error(n));
