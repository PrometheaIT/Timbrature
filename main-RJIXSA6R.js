import{a as N,b as Q,c as Ix,d as kr,e as Tx,f as Mx,g as Fr,h as y,j as e_,k as t_,n as Ax,o as n_}from"./chunk-7F6XFQYV.js";var zr={};Tx(zr,{__addDisposableResource:()=>U_,__assign:()=>Pc,__asyncDelegator:()=>P_,__asyncGenerator:()=>Lc,__asyncValues:()=>jc,__await:()=>ai,__awaiter:()=>$,__classPrivateFieldGet:()=>j_,__classPrivateFieldIn:()=>z_,__classPrivateFieldSet:()=>V_,__createBinding:()=>Fc,__decorate:()=>E_,__disposeResources:()=>B_,__esDecorate:()=>S_,__exportStar:()=>A_,__extends:()=>w_,__generator:()=>M_,__importDefault:()=>L_,__importStar:()=>F_,__makeTemplateObject:()=>k_,__metadata:()=>T_,__param:()=>C_,__propKey:()=>D_,__read:()=>Zp,__rest:()=>Ni,__rewriteRelativeImportExtension:()=>$_,__runInitializers:()=>x_,__setFunctionName:()=>I_,__spread:()=>R_,__spreadArray:()=>N_,__spreadArrays:()=>O_,__values:()=>kc,default:()=>Wx});function w_(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Kp(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ni(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e}function E_(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o}function C_(n,t){return function(e,i){t(e,i,n)}}function S_(n,t,e,i,r,o){function s(A){if(A!==void 0&&typeof A!="function")throw new TypeError("Function expected");return A}for(var a=i.kind,u=a==="getter"?"get":a==="setter"?"set":"value",f=!t&&n?i.static?n:n.prototype:null,h=t||(f?Object.getOwnPropertyDescriptor(f,i.name):{}),m,b=!1,v=e.length-1;v>=0;v--){var w={};for(var M in i)w[M]=M==="access"?{}:i[M];for(var M in i.access)w.access[M]=i.access[M];w.addInitializer=function(A){if(b)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(A||null))};var I=(0,e[v])(a==="accessor"?{get:h.get,set:h.set}:h[u],w);if(a==="accessor"){if(I===void 0)continue;if(I===null||typeof I!="object")throw new TypeError("Object expected");(m=s(I.get))&&(h.get=m),(m=s(I.set))&&(h.set=m),(m=s(I.init))&&r.unshift(m)}else(m=s(I))&&(a==="field"?r.unshift(m):h[u]=m)}f&&Object.defineProperty(f,i.name,h),b=!0}function x_(n,t,e){for(var i=arguments.length>2,r=0;r<t.length;r++)e=i?t[r].call(n,e):t[r].call(n);return i?e:void 0}function D_(n){return typeof n=="symbol"?n:"".concat(n)}function I_(n,t,e){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:e?"".concat(e," ",t):t})}function T_(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function $(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(h){try{f(i.next(h))}catch(m){s(m)}}function u(h){try{f(i.throw(h))}catch(m){s(m)}}function f(h){h.done?o(h.value):r(h.value).then(a,u)}f((i=i.apply(n,t||[])).next())})}function M_(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(h){return u([f,h])}}function u(f){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(e=0)),e;)try{if(i=1,r&&(o=f[0]&2?r.return:f[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,f[1])).done)return o;switch(r=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,r=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){e.label=f[1];break}if(f[0]===6&&e.label<o[1]){e.label=o[1],o=f;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(f);break}o[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(n,e)}catch(h){f=[6,h],r=0}finally{i=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function A_(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&Fc(t,n,e)}function kc(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zp(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),r,o=[],s;try{for(;(t===void 0||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(s)throw s.error}}return o}function R_(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(Zp(arguments[t]));return n}function O_(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var i=Array(n),r=0,t=0;t<e;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}function N_(n,t,e){if(e||arguments.length===2)for(var i=0,r=t.length,o;i<r;i++)(o||!(i in t))&&(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return n.concat(o||Array.prototype.slice.call(t))}function ai(n){return this instanceof ai?(this.v=n,this):new ai(n)}function Lc(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(n,t||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(v){return function(w){return Promise.resolve(w).then(v,m)}}function a(v,w){i[v]&&(r[v]=function(M){return new Promise(function(I,A){o.push([v,M,I,A])>1||u(v,M)})},w&&(r[v]=w(r[v])))}function u(v,w){try{f(i[v](w))}catch(M){b(o[0][3],M)}}function f(v){v.value instanceof ai?Promise.resolve(v.value.v).then(h,m):b(o[0][2],v)}function h(v){u("next",v)}function m(v){u("throw",v)}function b(v,w){v(w),o.shift(),o.length&&u(o[0][0],o[0][1])}}function P_(n){var t,e;return t={},i("next"),i("throw",function(r){throw r}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(r,o){t[r]=n[r]?function(s){return(e=!e)?{value:ai(n[r](s)),done:!1}:o?o(s):s}:o}}function jc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof kc=="function"?kc(n):n[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(o){e[o]=n[o]&&function(s){return new Promise(function(a,u){s=n[o](s),r(a,u,s.done,s.value)})}}function r(o,s,a,u){Promise.resolve(u).then(function(f){o({value:f,done:a})},s)}}function k_(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function F_(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e=Yp(n),i=0;i<e.length;i++)e[i]!=="default"&&Fc(t,n,e[i]);return $x(t,n),t}function L_(n){return n&&n.__esModule?n:{default:n}}function j_(n,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(n):i?i.value:t.get(n)}function V_(n,t,e,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(n,e):r?r.value=e:t.set(n,e),e}function z_(n,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?t===n:n.has(t)}function U_(n,t,e){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var i,r;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],e&&(r=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");r&&(i=function(){try{r.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:i,async:e})}else e&&n.stack.push({async:!0});return t}function B_(n){function t(o){n.error=n.hasError?new Hx(o,n.error,"An error was suppressed during disposal."):o,n.hasError=!0}var e,i=0;function r(){for(;e=n.stack.pop();)try{if(!e.async&&i===1)return i=0,n.stack.push(e),Promise.resolve().then(r);if(e.dispose){var o=e.dispose.call(e.value);if(e.async)return i|=2,Promise.resolve(o).then(r,function(s){return t(s),r()})}else i|=1}catch(s){t(s)}if(i===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return r()}function $_(n,t){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,i,r,o,s){return i?t?".jsx":".js":r&&(!o||!s)?e:r+o+"."+s.toLowerCase()+"js"}):n}var Kp,Pc,Fc,$x,Yp,Hx,Wx,Le=Ix(()=>{"use strict";Kp=function(n,t){return Kp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},Kp(n,t)};Pc=function(){return Pc=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Pc.apply(this,arguments)};Fc=Object.create?function(n,t,e,i){i===void 0&&(i=e);var r=Object.getOwnPropertyDescriptor(t,e);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,i,r)}:function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]};$x=Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t},Yp=function(n){return Yp=Object.getOwnPropertyNames||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[e.length]=i);return e},Yp(n)};Hx=typeof SuppressedError=="function"?SuppressedError:function(n,t,e){var i=new Error(e);return i.name="SuppressedError",i.error=n,i.suppressed=t,i};Wx={__extends:w_,__assign:Pc,__rest:Ni,__decorate:E_,__param:C_,__esDecorate:S_,__runInitializers:x_,__propKey:D_,__setFunctionName:I_,__metadata:T_,__awaiter:$,__generator:M_,__createBinding:Fc,__exportStar:A_,__values:kc,__read:Zp,__spread:R_,__spreadArrays:O_,__spreadArray:N_,__await:ai,__asyncGenerator:Lc,__asyncDelegator:P_,__asyncValues:jc,__makeTemplateObject:k_,__importStar:F_,__importDefault:L_,__classPrivateFieldGet:j_,__classPrivateFieldSet:V_,__classPrivateFieldIn:z_,__addDisposableResource:U_,__disposeResources:B_,__rewriteRelativeImportExtension:$_}});var mv=kr(hv=>{"use strict";Object.defineProperty(hv,"__esModule",{value:!0});var pv=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};hv.default=pv});var _v=kr(vv=>{"use strict";Object.defineProperty(vv,"__esModule",{value:!0});var rS=(Le(),Fr(zr)),UN=rS.__importDefault((n_(),Fr(Ax))),BN=rS.__importDefault(mv()),gv=class{constructor(t){var e,i;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(i=t.isMaybeSingle)!==null&&i!==void 0?i:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=UN.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let i=this.fetch,r=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(o=>y(this,null,function*(){var s,a,u,f;let h=null,m=null,b=null,v=o.status,w=o.statusText;if(o.ok){if(this.method!=="HEAD"){let j=yield o.text();j===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((s=this.headers.get("Accept"))===null||s===void 0)&&s.includes("application/vnd.pgrst.plan+text"))?m=j:m=JSON.parse(j))}let I=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),A=(u=o.headers.get("content-range"))===null||u===void 0?void 0:u.split("/");I&&A&&A.length>1&&(b=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(h={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,b=null,v=406,w="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{let I=yield o.text();try{h=JSON.parse(I),Array.isArray(h)&&o.status===404&&(m=[],h=null,v=200,w="OK")}catch{o.status===404&&I===""?(v=204,w="No Content"):h={message:I}}if(h&&this.isMaybeSingle&&(!((f=h?.details)===null||f===void 0)&&f.includes("0 rows"))&&(h=null,v=200,w="OK"),h&&this.shouldThrowOnError)throw new BN.default(h)}return{error:h,data:m,count:b,status:v,statusText:w}}));return this.shouldThrowOnError||(r=r.catch(o=>{var s,a,u;return{error:{message:`${(s=o?.name)!==null&&s!==void 0?s:"FetchError"}: ${o?.message}`,details:`${(a=o?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(u=o?.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}};vv.default=gv});var wv=kr(bv=>{"use strict";Object.defineProperty(bv,"__esModule",{value:!0});var $N=(Le(),Fr(zr)),HN=$N.__importDefault(_v()),yv=class extends HN.default{select(t){let e=!1,i=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:i,foreignTable:r,referencedTable:o=r}={}){let s=o?`${o}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${t}.${e?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:i=e}={}){let r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:i,referencedTable:r=i}={}){let o=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(s,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:i=!1,buffers:r=!1,wal:o=!1,format:s="text"}={}){var a;let u=[t?"analyze":null,e?"verbose":null,i?"settings":null,r?"buffers":null,o?"wal":null].filter(Boolean).join("|"),f=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${f}"; options=${u};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};bv.default=yv});var Of=kr(Cv=>{"use strict";Object.defineProperty(Cv,"__esModule",{value:!0});var WN=(Le(),Fr(zr)),GN=WN.__importDefault(wv()),qN=new RegExp("[,()]"),Ev=class extends GN.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){let i=Array.from(new Set(e)).map(r=>typeof r=="string"&&qN.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:i,type:r}={}){let o="";r==="plain"?o="pl":r==="phrase"?o="ph":r==="websearch"&&(o="w");let s=i===void 0?"":`(${i})`;return this.url.searchParams.append(t,`${o}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach(([e,i])=>{this.url.searchParams.append(e,`eq.${i}`)}),this}not(t,e,i){return this.url.searchParams.append(t,`not.${e}.${i}`),this}or(t,{foreignTable:e,referencedTable:i=e}={}){let r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,i){return this.url.searchParams.append(t,`${e}.${i}`),this}};Cv.default=Ev});var Dv=kr(xv=>{"use strict";Object.defineProperty(xv,"__esModule",{value:!0});var JN=(Le(),Fr(zr)),Zl=JN.__importDefault(Of()),Sv=class{constructor(t,{headers:e={},schema:i,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=i,this.fetch=r}select(t,e){let{head:i=!1,count:r}=e??{},o=i?"HEAD":"GET",s=!1,a=(t??"*").split("").map(u=>/\s/.test(u)&&!s?"":(u==='"'&&(s=!s),u)).join("");return this.url.searchParams.set("select",a),r&&this.headers.append("Prefer",`count=${r}`),new Zl.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:i=!0}={}){var r;let o="POST";if(e&&this.headers.append("Prefer",`count=${e}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){let s=t.reduce((a,u)=>a.concat(Object.keys(u)),[]);if(s.length>0){let a=[...new Set(s)].map(u=>`"${u}"`);this.url.searchParams.set("columns",a.join(","))}}return new Zl.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:i=!1,count:r,defaultToNull:o=!0}={}){var s;let a="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){let u=t.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(u.length>0){let f=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new Zl.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}update(t,{count:e}={}){var i;let r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Zl.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:t}={}){var e;let i="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Zl.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}};xv.default=Sv});var sS=kr(Tv=>{"use strict";Object.defineProperty(Tv,"__esModule",{value:!0});var oS=(Le(),Fr(zr)),KN=oS.__importDefault(Dv()),YN=oS.__importDefault(Of()),Iv=class n{constructor(t,{headers:e={},schema:i,fetch:r}={}){this.url=t,this.headers=new Headers(e),this.schemaName=i,this.fetch=r}from(t){let e=new URL(`${this.url}/${t}`);return new KN.default(e,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new n(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,e={},{head:i=!1,get:r=!1,count:o}={}){var s;let a,u=new URL(`${this.url}/rpc/${t}`),f;i||r?(a=i?"HEAD":"GET",Object.entries(e).filter(([m,b])=>b!==void 0).map(([m,b])=>[m,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([m,b])=>{u.searchParams.append(m,b)})):(a="POST",f=e);let h=new Headers(this.headers);return o&&h.set("Prefer",`count=${o}`),new YN.default({method:a,url:u,headers:h,schema:this.schemaName,body:f,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};Tv.default=Iv});var pS=kr(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.PostgrestError=sn.PostgrestBuilder=sn.PostgrestTransformBuilder=sn.PostgrestFilterBuilder=sn.PostgrestQueryBuilder=sn.PostgrestClient=void 0;var Ws=(Le(),Fr(zr)),aS=Ws.__importDefault(sS());sn.PostgrestClient=aS.default;var lS=Ws.__importDefault(Dv());sn.PostgrestQueryBuilder=lS.default;var cS=Ws.__importDefault(Of());sn.PostgrestFilterBuilder=cS.default;var uS=Ws.__importDefault(wv());sn.PostgrestTransformBuilder=uS.default;var dS=Ws.__importDefault(_v());sn.PostgrestBuilder=dS.default;var fS=Ws.__importDefault(mv());sn.PostgrestError=fS.default;sn.default={PostgrestClient:aS.default,PostgrestQueryBuilder:lS.default,PostgrestFilterBuilder:cS.default,PostgrestTransformBuilder:uS.default,PostgrestBuilder:dS.default,PostgrestError:fS.default}});var Rp;function hc(){return Rp}function si(n){let t=Rp;return Rp=n,t}var i_=Symbol("NotFound");function Vo(n){return n===i_||n?.name==="\u0275NotFound"}var Vt=null,mc=!1,Op=1,Rx=null,zt=Symbol("SIGNAL");function ce(n){let t=Vt;return Vt=n,t}function yc(){return Vt}var zo={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Uo(n){if(mc)throw new Error("");if(Vt===null)return;Vt.consumerOnSignalRead(n);let t=Vt.producersTail;if(t!==void 0&&t.producer===n)return;let e,i=Vt.recomputing;if(i&&(e=t!==void 0?t.nextProducer:Vt.producers,e!==void 0&&e.producer===n)){Vt.producersTail=e,e.lastReadVersion=n.version;return}let r=n.consumersTail;if(r!==void 0&&r.consumer===Vt&&(!i||Nx(r,Vt)))return;let o=$o(Vt),s={producer:n,consumer:Vt,nextProducer:e,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};Vt.producersTail=s,t!==void 0?t.nextProducer=s:Vt.producers=s,o&&a_(n,s)}function r_(){Op++}function bc(n){if(!($o(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===Op)){if(!n.producerMustRecompute(n)&&!ua(n)){_c(n);return}n.producerRecomputeValue(n),_c(n)}}function Np(n){if(n.consumers===void 0)return;let t=mc;mc=!0;try{for(let e=n.consumers;e!==void 0;e=e.nextConsumer){let i=e.consumer;i.dirty||Ox(i)}}finally{mc=t}}function Pp(){return Vt?.consumerAllowSignalWrites!==!1}function Ox(n){n.dirty=!0,Np(n),n.consumerMarkedDirty?.(n)}function _c(n){n.dirty=!1,n.lastCleanEpoch=Op}function Bo(n){return n&&o_(n),ce(n)}function o_(n){n.producersTail=void 0,n.recomputing=!0}function ca(n,t){ce(t),n&&s_(n)}function s_(n){n.recomputing=!1;let t=n.producersTail,e=t!==void 0?t.nextProducer:n.producers;if(e!==void 0){if($o(n))do e=kp(e);while(e!==void 0);t!==void 0?t.nextProducer=void 0:n.producers=void 0}}function ua(n){for(let t=n.producers;t!==void 0;t=t.nextProducer){let e=t.producer,i=t.lastReadVersion;if(i!==e.version||(bc(e),i!==e.version))return!0}return!1}function da(n){if($o(n)){let t=n.producers;for(;t!==void 0;)t=kp(t)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function a_(n,t){let e=n.consumersTail,i=$o(n);if(e!==void 0?(t.nextConsumer=e.nextConsumer,e.nextConsumer=t):(t.nextConsumer=void 0,n.consumers=t),t.prevConsumer=e,n.consumersTail=t,!i)for(let r=n.producers;r!==void 0;r=r.nextProducer)a_(r.producer,r)}function kp(n){let t=n.producer,e=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,i!==void 0?i.prevConsumer=r:t.consumersTail=r,r!==void 0)r.nextConsumer=i;else if(t.consumers=i,!$o(t)){let o=t.producers;for(;o!==void 0;)o=kp(o)}return e}function $o(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function wc(n){Rx?.(n)}function Nx(n,t){let e=t.producersTail;if(e!==void 0){let i=t.producers;do{if(i===n)return!0;if(i===e)break;i=i.nextProducer}while(i!==void 0)}return!1}function Ec(n,t){return Object.is(n,t)}function Cc(n,t){let e=Object.create(Px);e.computation=n,t!==void 0&&(e.equal=t);let i=()=>{if(bc(e),Uo(e),e.value===la)throw e.error;return e.value};return i[zt]=e,wc(e),i}var gc=Symbol("UNSET"),vc=Symbol("COMPUTING"),la=Symbol("ERRORED"),Px=Q(N({},zo),{value:gc,dirty:!0,error:null,equal:Ec,kind:"computed",producerMustRecompute(n){return n.value===gc||n.value===vc},producerRecomputeValue(n){if(n.value===vc)throw new Error("");let t=n.value;n.value=vc;let e=Bo(n),i,r=!1;try{i=n.computation(),ce(null),r=t!==gc&&t!==la&&i!==la&&n.equal(t,i)}catch(o){i=la,n.error=o}finally{ca(n,e)}if(r){n.value=t;return}n.value=i,n.version++}});function kx(){throw new Error}var l_=kx;function c_(n){l_(n)}function Fp(n){l_=n}var Fx=null;function Lp(n,t){let e=Object.create(Sc);e.value=n,t!==void 0&&(e.equal=t);let i=()=>u_(e);return i[zt]=e,wc(e),[i,s=>Ho(e,s),s=>jp(e,s)]}function u_(n){return Uo(n),n.value}function Ho(n,t){Pp()||c_(n),n.equal(n.value,t)||(n.value=t,Lx(n))}function jp(n,t){Pp()||c_(n),Ho(n,t(n.value))}var Sc=Q(N({},zo),{equal:Ec,value:void 0,kind:"signal"});function Lx(n){n.version++,r_(),Np(n),Fx?.(n)}function de(n){return typeof n=="function"}function Wo(n){let e=n(i=>{Error.call(i),i.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var xc=Wo(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function Lr(n,t){if(n){let e=n.indexOf(t);0<=e&&n.splice(e,1)}}var Ye=class n{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let o of e)o.remove(this);else e.remove(this);let{initialTeardown:i}=this;if(de(i))try{i()}catch(o){t=o instanceof xc?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{d_(o)}catch(s){t=t??[],s instanceof xc?t=[...t,...s.errors]:t.push(s)}}if(t)throw new xc(t)}}add(t){var e;if(t&&t!==this)if(this.closed)d_(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}}_hasParent(t){let{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){let{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&Lr(e,t)}remove(t){let{_finalizers:e}=this;e&&Lr(e,t),t instanceof n&&t._removeParent(this)}};Ye.EMPTY=(()=>{let n=new Ye;return n.closed=!0,n})();var Vp=Ye.EMPTY;function Dc(n){return n instanceof Ye||n&&"closed"in n&&de(n.remove)&&de(n.add)&&de(n.unsubscribe)}function d_(n){de(n)?n():n.unsubscribe()}var Hn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Go={setTimeout(n,t,...e){let{delegate:i}=Go;return i?.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){let{delegate:t}=Go;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Ic(n){Go.setTimeout(()=>{let{onUnhandledError:t}=Hn;if(t)t(n);else throw n})}function fa(){}var f_=zp("C",void 0,void 0);function p_(n){return zp("E",void 0,n)}function h_(n){return zp("N",n,void 0)}function zp(n,t,e){return{kind:n,value:t,error:e}}var jr=null;function qo(n){if(Hn.useDeprecatedSynchronousErrorHandling){let t=!jr;if(t&&(jr={errorThrown:!1,error:null}),n(),t){let{errorThrown:e,error:i}=jr;if(jr=null,e)throw i}}else n()}function m_(n){Hn.useDeprecatedSynchronousErrorHandling&&jr&&(jr.errorThrown=!0,jr.error=n)}var Vr=class extends Ye{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Dc(t)&&t.add(this)):this.destination=zx}static create(t,e,i){return new or(t,e,i)}next(t){this.isStopped?Bp(h_(t),this):this._next(t)}error(t){this.isStopped?Bp(p_(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Bp(f_,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},jx=Function.prototype.bind;function Up(n,t){return jx.call(n,t)}var $p=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Tc(i)}}error(t){let{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Tc(i)}else Tc(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Tc(e)}}},or=class extends Vr{constructor(t,e,i){super();let r;if(de(t)||!t)r={next:t??void 0,error:e??void 0,complete:i??void 0};else{let o;this&&Hn.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Up(t.next,o),error:t.error&&Up(t.error,o),complete:t.complete&&Up(t.complete,o)}):r=t}this.destination=new $p(r)}};function Tc(n){Hn.useDeprecatedSynchronousErrorHandling?m_(n):Ic(n)}function Vx(n){throw n}function Bp(n,t){let{onStoppedNotification:e}=Hn;e&&Go.setTimeout(()=>e(n,t))}var zx={closed:!0,next:fa,error:Vx,complete:fa};var Jo=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Kt(n){return n}function Hp(...n){return Wp(n)}function Wp(n){return n.length===0?Kt:n.length===1?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}var be=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){let i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){let o=Bx(e)?e:new or(e,i,r);return qo(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return i=g_(i),new i((r,o)=>{let s=new or({next:a=>{try{e(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(e){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(e)}[Jo](){return this}pipe(...e){return Wp(e)(this)}toPromise(e){return e=g_(e),new e((i,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>i(o))})}}return n.create=t=>new n(t),n})();function g_(n){var t;return(t=n??Hn.Promise)!==null&&t!==void 0?t:Promise}function Ux(n){return n&&de(n.next)&&de(n.error)&&de(n.complete)}function Bx(n){return n&&n instanceof Vr||Ux(n)&&Dc(n)}function Gp(n){return de(n?.lift)}function _e(n){return t=>{if(Gp(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function me(n,t,e,i,r){return new qp(n,t,e,i,r)}var qp=class extends Vr{constructor(t,e,i,r,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(u){t.error(u)}}:super._next,this._error=r?function(a){try{r(a)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function Ko(){return _e((n,t)=>{let e=null;n._refCount++;let i=me(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){e=null;return}let r=n._connection,o=e;e=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}var Yo=class extends be{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Gp(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Ye;let e=this.getSubject();t.add(this.source.subscribe(me(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Ye.EMPTY)}return t}refCount(){return Ko()(this)}};var v_=Wo(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var $e=(()=>{class n extends be{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let i=new Mc(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new v_}next(e){qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(e)}})}error(e){qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){qo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:i,isStopped:r,observers:o}=this;return i||r?Vp:(this.currentObservers=null,o.push(e),new Ye(()=>{this.currentObservers=null,Lr(o,e)}))}_checkFinalizedStatuses(e){let{hasError:i,thrownError:r,isStopped:o}=this;i?e.error(r):o&&e.complete()}asObservable(){let e=new be;return e.source=this,e}}return n.create=(t,e)=>new Mc(t,e),n})(),Mc=class extends $e{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.next)===null||i===void 0||i.call(e,t)}error(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.error)===null||i===void 0||i.call(e,t)}complete(){var t,e;(e=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||e===void 0||e.call(t)}_subscribe(t){var e,i;return(i=(e=this.source)===null||e===void 0?void 0:e.subscribe(t))!==null&&i!==void 0?i:Vp}};var tt=class extends $e{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){let{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}};var Jp={now(){return(Jp.delegate||Date).now()},delegate:void 0};var Ac=class extends Ye{constructor(t,e){super()}schedule(t,e=0){return this}};var pa={setInterval(n,t,...e){let{delegate:i}=pa;return i?.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){let{delegate:t}=pa;return(t?.clearInterval||clearInterval)(n)},delegate:void 0};var Rc=class extends Ac{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;let r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,e)),this.pending=!0,this.delay=e,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,e),this}requestAsyncId(t,e,i=0){return pa.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(i!=null&&this.delay===i&&this.pending===!1)return e;e!=null&&pa.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let i=this._execute(t,e);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i=!1,r;try{this.work(t)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,Lr(i,this),t!=null&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}};var Zo=class n{constructor(t,e=n.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}};Zo.now=Jp.now;var Oc=class extends Zo{constructor(t,e=Zo.now){super(t,e),this.actions=[],this._active=!1}flush(t){let{actions:e}=this;if(this._active){e.push(t);return}let i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}};var __=new Oc(Rc);var Pt=new be(n=>n.complete());function y_(n){return n&&de(n.schedule)}function b_(n){return n[n.length-1]}function Nc(n){return de(b_(n))?n.pop():void 0}function sr(n){return y_(b_(n))?n.pop():void 0}Le();var Vc=n=>n&&typeof n.length=="number"&&typeof n!="function";function zc(n){return de(n?.then)}function Uc(n){return de(n[Jo])}function Bc(n){return Symbol.asyncIterator&&de(n?.[Symbol.asyncIterator])}function $c(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Gx(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Hc=Gx();function Wc(n){return de(n?.[Hc])}Le();function Gc(n){return Lc(this,arguments,function*(){let e=n.getReader();try{for(;;){let{value:i,done:r}=yield ai(e.read());if(r)return yield ai(void 0);yield yield ai(i)}}finally{e.releaseLock()}})}function qc(n){return de(n?.getReader)}function ut(n){if(n instanceof be)return n;if(n!=null){if(Uc(n))return qx(n);if(Vc(n))return Jx(n);if(zc(n))return Kx(n);if(Bc(n))return H_(n);if(Wc(n))return Yx(n);if(qc(n))return Zx(n)}throw $c(n)}function qx(n){return new be(t=>{let e=n[Jo]();if(de(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Jx(n){return new be(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}function Kx(n){return new be(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ic)})}function Yx(n){return new be(t=>{for(let e of n)if(t.next(e),t.closed)return;t.complete()})}function H_(n){return new be(t=>{Qx(n,t).catch(e=>t.error(e))})}function Zx(n){return H_(Gc(n))}function Qx(n,t){var e,i,r,o;return $(this,void 0,void 0,function*(){try{for(e=jc(n);i=yield e.next(),!i.done;){let s=i.value;if(t.next(s),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=e.return)&&(yield o.call(e))}finally{if(r)throw r.error}}t.complete()})}function cn(n,t,e,i=0,r=!1){let o=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function Jc(n,t=0){return _e((e,i)=>{e.subscribe(me(i,r=>cn(i,n,()=>i.next(r),t),()=>cn(i,n,()=>i.complete(),t),r=>cn(i,n,()=>i.error(r),t)))})}function Kc(n,t=0){return _e((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function W_(n,t){return ut(n).pipe(Kc(t),Jc(t))}function G_(n,t){return ut(n).pipe(Kc(t),Jc(t))}function q_(n,t){return new be(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}function J_(n,t){return new be(e=>{let i;return cn(e,t,()=>{i=n[Hc](),cn(e,t,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(s){e.error(s);return}o?e.complete():e.next(r)},0,!0)}),()=>de(i?.return)&&i.return()})}function Yc(n,t){if(!n)throw new Error("Iterable cannot be null");return new be(e=>{cn(e,t,()=>{let i=n[Symbol.asyncIterator]();cn(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function K_(n,t){return Yc(Gc(n),t)}function Y_(n,t){if(n!=null){if(Uc(n))return W_(n,t);if(Vc(n))return q_(n,t);if(zc(n))return G_(n,t);if(Bc(n))return Yc(n,t);if(Wc(n))return J_(n,t);if(qc(n))return K_(n,t)}throw $c(n)}function J(n,t){return t?Y_(n,t):ut(n)}function K(...n){let t=sr(n);return J(n,t)}function Qo(n,t){let e=de(n)?n:()=>n,i=r=>r.error(e());return new be(t?r=>t.schedule(i,0,r):i)}function Qp(n){return!!n&&(n instanceof be||de(n.lift)&&de(n.subscribe))}var gn=Wo(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Zc(n,t){let e=typeof t=="object";return new Promise((i,r)=>{let o=!1,s;n.subscribe({next:a=>{s=a,o=!0},error:r,complete:()=>{o?i(s):e?i(t.defaultValue):r(new gn)}})})}function nt(n,t){let e=typeof t=="object";return new Promise((i,r)=>{let o=new or({next:s=>{i(s),o.unsubscribe()},error:r,complete:()=>{e?i(t.defaultValue):r(new gn)}});n.subscribe(o)})}function fe(n,t){return _e((e,i)=>{let r=0;e.subscribe(me(i,o=>{i.next(n.call(t,o,r++))}))})}var{isArray:Xx}=Array;function eD(n,t){return Xx(t)?n(...t):n(t)}function Qc(n){return fe(t=>eD(n,t))}var{isArray:tD}=Array,{getPrototypeOf:nD,prototype:iD,keys:rD}=Object;function Xc(n){if(n.length===1){let t=n[0];if(tD(t))return{args:t,keys:null};if(oD(t)){let e=rD(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}function oD(n){return n&&typeof n=="object"&&nD(n)===iD}function eu(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function ha(...n){let t=sr(n),e=Nc(n),{args:i,keys:r}=Xc(n);if(i.length===0)return J([],t);let o=new be(sD(i,t,r?s=>eu(r,s):Kt));return e?o.pipe(Qc(e)):o}function sD(n,t,e=Kt){return i=>{Z_(t,()=>{let{length:r}=n,o=new Array(r),s=r,a=r;for(let u=0;u<r;u++)Z_(t,()=>{let f=J(n[u],t),h=!1;f.subscribe(me(i,m=>{o[u]=m,h||(h=!0,a--),a||i.next(e(o.slice()))},()=>{--s||i.complete()}))},i)},i)}}function Z_(n,t,e){n?cn(e,n,t):t()}function Q_(n,t,e,i,r,o,s,a){let u=[],f=0,h=0,m=!1,b=()=>{m&&!u.length&&!f&&t.complete()},v=M=>f<i?w(M):u.push(M),w=M=>{o&&t.next(M),f++;let I=!1;ut(e(M,h++)).subscribe(me(t,A=>{r?.(A),o?v(A):t.next(A)},()=>{I=!0},void 0,()=>{if(I)try{for(f--;u.length&&f<i;){let A=u.shift();s?cn(t,s,()=>w(A)):w(A)}b()}catch(A){t.error(A)}}))};return n.subscribe(me(t,v,()=>{m=!0,b()})),()=>{a?.()}}function it(n,t,e=1/0){return de(t)?it((i,r)=>fe((o,s)=>t(i,o,r,s))(ut(n(i,r))),e):(typeof t=="number"&&(e=t),_e((i,r)=>Q_(i,r,n,e)))}function ar(n=1/0){return it(Kt,n)}function X_(){return ar(1)}function Xo(...n){return X_()(J(n,sr(n)))}function ma(n){return new be(t=>{ut(n()).subscribe(t)})}function Xp(...n){let t=Nc(n),{args:e,keys:i}=Xc(n),r=new be(o=>{let{length:s}=e;if(!s){o.complete();return}let a=new Array(s),u=s,f=s;for(let h=0;h<s;h++){let m=!1;ut(e[h]).subscribe(me(o,b=>{m||(m=!0,f--),a[h]=b},()=>u--,void 0,()=>{(!u||!m)&&(f||o.next(i?eu(i,a):a),o.complete())}))}});return t?r.pipe(Qc(t)):r}function rt(n,t){return _e((e,i)=>{let r=0;e.subscribe(me(i,o=>n.call(t,o,r++)&&i.next(o)))})}function Pi(n){return _e((t,e)=>{let i=null,r=!1,o;i=t.subscribe(me(e,void 0,void 0,s=>{o=ut(n(s,Pi(n)(t))),i?(i.unsubscribe(),i=null,o.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(e))})}function ey(n,t,e,i,r){return(o,s)=>{let a=e,u=t,f=0;o.subscribe(me(s,h=>{let m=f++;u=a?n(u,h,m):(a=!0,h),i&&s.next(u)},r&&(()=>{a&&s.next(u),s.complete()})))}}function li(n,t){return de(t)?it(n,t,1):it(n,1)}function eh(n,t=__){return _e((e,i)=>{let r=null,o=null,s=null,a=()=>{if(r){r.unsubscribe(),r=null;let f=o;o=null,i.next(f)}};function u(){let f=s+n,h=t.now();if(h<f){r=this.schedule(void 0,f-h),i.add(r);return}a()}e.subscribe(me(i,f=>{o=f,s=t.now(),r||(r=t.schedule(u,n),i.add(r))},()=>{a(),i.complete()},void 0,()=>{o=r=null}))})}function lr(n){return _e((t,e)=>{let i=!1;t.subscribe(me(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function wt(n){return n<=0?()=>Pt:_e((t,e)=>{let i=0;t.subscribe(me(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function th(n,t=Kt){return n=n??aD,_e((e,i)=>{let r,o=!0;e.subscribe(me(i,s=>{let a=t(s);(o||!n(r,a))&&(o=!1,r=a,i.next(s))}))})}function aD(n,t){return n===t}function tu(n=lD){return _e((t,e)=>{let i=!1;t.subscribe(me(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function lD(){return new gn}function Ur(n){return _e((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function ki(n,t){let e=arguments.length>=2;return i=>i.pipe(n?rt((r,o)=>n(r,o,i)):Kt,wt(1),e?lr(t):tu(()=>new gn))}function es(n){return n<=0?()=>Pt:_e((t,e)=>{let i=[];t.subscribe(me(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function nh(n,t){let e=arguments.length>=2;return i=>i.pipe(n?rt((r,o)=>n(r,o,i)):Kt,es(1),e?lr(t):tu(()=>new gn))}function ih(n,t){return _e(ey(n,t,arguments.length>=2,!0))}function rh(...n){let t=sr(n);return _e((e,i)=>{(t?Xo(n,e,t):Xo(n,e)).subscribe(i)})}function He(n,t){return _e((e,i)=>{let r=null,o=0,s=!1,a=()=>s&&!r&&i.complete();e.subscribe(me(i,u=>{r?.unsubscribe();let f=0,h=o++;ut(n(u,h)).subscribe(r=me(i,m=>i.next(t?t(u,m,h,f++):m),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function Wn(n){return _e((t,e)=>{ut(n).subscribe(me(e,()=>e.complete(),fa)),!e.closed&&t.subscribe(e)})}function Et(n,t,e){let i=de(n)||t||e?{next:n,error:t,complete:e}:n;return i?_e((r,o)=>{var s;(s=i.subscribe)===null||s===void 0||s.call(i);let a=!0;r.subscribe(me(o,u=>{var f;(f=i.next)===null||f===void 0||f.call(i,u),o.next(u)},()=>{var u;a=!1,(u=i.complete)===null||u===void 0||u.call(i),o.complete()},u=>{var f;a=!1,(f=i.error)===null||f===void 0||f.call(i,u),o.error(u)},()=>{var u,f;a&&((u=i.unsubscribe)===null||u===void 0||u.call(i)),(f=i.finalize)===null||f===void 0||f.call(i)}))}):Kt}function ty(n){let t=ce(null);try{return n()}finally{ce(t)}}var ou="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",U=class extends Error{code;constructor(t,e){super(Vi(t,e)),this.code=t}};function cD(n){return`NG0${Math.abs(n)}`}function Vi(n,t){return`${cD(n)}${t?": "+t:""}`}var zi=globalThis;function Te(n){for(let t in n)if(n[t]===Te)return t;throw Error("")}function ry(n,t){for(let e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Li(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(Li).join(", ")}]`;if(n==null)return""+n;let t=n.overriddenName||n.name;if(t)return`${t}`;let e=n.toString();if(e==null)return""+e;let i=e.indexOf(`
`);return i>=0?e.slice(0,i):e}function su(n,t){return n?t?`${n} ${t}`:n:t||""}var uD=Te({__forward_ref__:Te});function gt(n){return n.__forward_ref__=gt,n.toString=function(){return Li(this())},n}function kt(n){return gh(n)?n():n}function gh(n){return typeof n=="function"&&n.hasOwnProperty(uD)&&n.__forward_ref__===gt}function F(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function vn(n){return{providers:n.providers||[],imports:n.imports||[]}}function ya(n){return dD(n,au)}function vh(n){return ya(n)!==null}function dD(n,t){return n.hasOwnProperty(t)&&n[t]||null}function fD(n){let t=n?.[au]??null;return t||null}function sh(n){return n&&n.hasOwnProperty(iu)?n[iu]:null}var au=Te({\u0275prov:Te}),iu=Te({\u0275inj:Te}),Y=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=F({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function _h(n){return n&&!!n.\u0275providers}var yh=Te({\u0275cmp:Te}),bh=Te({\u0275dir:Te}),wh=Te({\u0275pipe:Te}),Eh=Te({\u0275mod:Te}),va=Te({\u0275fac:Te}),Gr=Te({__NG_ELEMENT_ID__:Te}),ny=Te({__NG_ENV_ID__:Te});function qn(n){return typeof n=="string"?n:n==null?"":String(n)}function oy(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():qn(n)}var sy=Te({ngErrorCode:Te}),pD=Te({ngErrorMessage:Te}),hD=Te({ngTokenPath:Te});function Ch(n,t){return ay("",-200,t)}function lu(n,t){throw new U(-201,!1)}function ay(n,t,e){let i=new U(t,n);return i[sy]=t,i[pD]=n,e&&(i[hD]=e),i}function mD(n){return n[sy]}var ah;function ly(){return ah}function Yt(n){let t=ah;return ah=n,t}function Sh(n,t,e){let i=ya(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(e&8)return null;if(t!==void 0)return t;lu(n,"Injector")}var gD={},Br=gD,vD="__NG_DI_FLAG__",lh=class{injector;constructor(t){this.injector=t}retrieve(t,e){let i=$r(e)||0;try{return this.injector.get(t,i&8?null:Br,i)}catch(r){if(Vo(r))return r;throw r}}};function _D(n,t=0){let e=hc();if(e===void 0)throw new U(-203,!1);if(e===null)return Sh(n,void 0,t);{let i=yD(t),r=e.retrieve(n,i);if(Vo(r)){if(i.optional)return null;throw r}return r}}function z(n,t=0){return(ly()||_D)(kt(n),t)}function O(n,t){return z(n,$r(t))}function $r(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function yD(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function ch(n){let t=[];for(let e=0;e<n.length;e++){let i=kt(n[e]);if(Array.isArray(i)){if(i.length===0)throw new U(900,!1);let r,o=0;for(let s=0;s<i.length;s++){let a=i[s],u=bD(a);typeof u=="number"?u===-1?r=a.token:o|=u:r=a}t.push(z(r,o))}else t.push(z(i))}return t}function bD(n){return n[vD]}function cr(n,t){let e=n.hasOwnProperty(va);return e?n[va]:null}function cy(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=t[i];if(e&&(r=e(r),o=e(o)),o!==r)return!1}return!0}function uy(n){return n.flat(Number.POSITIVE_INFINITY)}function cu(n,t){n.forEach(e=>Array.isArray(e)?cu(e,t):t(e))}function xh(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function ba(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function dy(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(r===1)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;){let o=r-2;n[r]=n[o],r--}n[t]=e,n[t+1]=i}}function uu(n,t,e){let i=ns(n,t);return i>=0?n[i|1]=e:(i=~i,dy(n,i,t,e)),i}function du(n,t){let e=ns(n,t);if(e>=0)return n[e|1]}function ns(n,t){return wD(n,t,1)}function wD(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){let o=i+(r-i>>1),s=n[o<<e];if(t===s)return o<<e;s>t?r=o:i=o+1}return~(r<<e)}var dr={},Zt=[],Ui=new Y(""),Dh=new Y("",-1),Ih=new Y(""),_a=class{get(t,e=Br){if(e===Br){let r=ay("",-201);throw r.name="\u0275NotFound",r}return e}};function Th(n){return n[Eh]||null}function Bi(n){return n[yh]||null}function Mh(n){return n[bh]||null}function fy(n){return n[wh]||null}function ci(n){return{\u0275providers:n}}function py(n){return ci([{provide:Ui,multi:!0,useValue:n}])}function hy(...n){return{\u0275providers:Ah(!0,n),\u0275fromNgModule:!0}}function Ah(n,...t){let e=[],i=new Set,r,o=s=>{e.push(s)};return cu(t,s=>{let a=s;ru(a,o,[],i)&&(r||=[],r.push(a))}),r!==void 0&&my(r,o),e}function my(n,t){for(let e=0;e<n.length;e++){let{ngModule:i,providers:r}=n[e];Rh(r,o=>{t(o,i)})}}function ru(n,t,e,i){if(n=kt(n),!n)return!1;let r=null,o=sh(n),s=!o&&Bi(n);if(!o&&!s){let u=n.ngModule;if(o=sh(u),o)r=u;else return!1}else{if(s&&!s.standalone)return!1;r=n}let a=i.has(r);if(s){if(a)return!1;if(i.add(r),s.dependencies){let u=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let f of u)ru(f,t,e,i)}}else if(o){if(o.imports!=null&&!a){i.add(r);let f;try{cu(o.imports,h=>{ru(h,t,e,i)&&(f||=[],f.push(h))})}finally{}f!==void 0&&my(f,t)}if(!a){let f=cr(r)||(()=>new r);t({provide:r,useFactory:f,deps:Zt},r),t({provide:Ih,useValue:r,multi:!0},r),t({provide:Ui,useValue:()=>z(r),multi:!0},r)}let u=o.providers;if(u!=null&&!a){let f=n;Rh(u,h=>{t(h,f)})}}else return!1;return r!==n&&n.providers!==void 0}function Rh(n,t){for(let e of n)_h(e)&&(e=e.\u0275providers),Array.isArray(e)?Rh(e,t):t(e)}var ED=Te({provide:String,useValue:Te});function gy(n){return n!==null&&typeof n=="object"&&ED in n}function CD(n){return!!(n&&n.useExisting)}function SD(n){return!!(n&&n.useFactory)}function Hr(n){return typeof n=="function"}function vy(n){return!!n.useClass}var wa=new Y(""),nu={},iy={},oh;function Ea(){return oh===void 0&&(oh=new _a),oh}var ot=class{},Wr=class extends ot{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,dh(t,s=>this.processProvider(s)),this.records.set(Dh,ts(void 0,this)),r.has("environment")&&this.records.set(ot,ts(void 0,this));let o=this.records.get(wa);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(Ih,Zt,{self:!0}))}retrieve(t,e){let i=$r(e)||0;try{return this.get(t,Br,i)}catch(r){if(Vo(r))return r;throw r}}destroy(){ga(this),this._destroyed=!0;let t=ce(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of e)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ce(t)}}onDestroy(t){return ga(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){ga(this);let e=si(this),i=Yt(void 0),r;try{return t()}finally{si(e),Yt(i)}}get(t,e=Br,i){if(ga(this),t.hasOwnProperty(ny))return t[ny](this);let r=$r(i),o,s=si(this),a=Yt(void 0);try{if(!(r&4)){let f=this.records.get(t);if(f===void 0){let h=MD(t)&&ya(t);h&&this.injectableDefInScope(h)?f=ts(uh(t),nu):f=null,this.records.set(t,f)}if(f!=null)return this.hydrate(t,f,r)}let u=r&2?Ea():this.parent;return e=r&8&&e===Br?null:e,u.get(t,e)}catch(u){let f=mD(u);throw f===-200||f===-201?new U(f,null):u}finally{Yt(a),si(s)}}resolveInjectorInitializers(){let t=ce(null),e=si(this),i=Yt(void 0),r;try{let o=this.get(Ui,Zt,{self:!0});for(let s of o)s()}finally{si(e),Yt(i),ce(t)}}toString(){let t=[],e=this.records;for(let i of e.keys())t.push(Li(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=kt(t);let e=Hr(t)?t:kt(t&&t.provide),i=DD(t);if(!Hr(t)&&t.multi===!0){let r=this.records.get(e);r||(r=ts(void 0,nu,!0),r.factory=()=>ch(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e,i){let r=ce(null);try{if(e.value===iy)throw Ch(Li(t));return e.value===nu&&(e.value=iy,e.value=e.factory(void 0,i)),typeof e.value=="object"&&e.value&&TD(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{ce(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let e=kt(t.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){let e=this._onDestroyHooks.indexOf(t);e!==-1&&this._onDestroyHooks.splice(e,1)}};function uh(n){let t=ya(n),e=t!==null?t.factory:cr(n);if(e!==null)return e;if(n instanceof Y)throw new U(204,!1);if(n instanceof Function)return xD(n);throw new U(204,!1)}function xD(n){if(n.length>0)throw new U(204,!1);let e=fD(n);return e!==null?()=>e.factory(n):()=>new n}function DD(n){if(gy(n))return ts(void 0,n.useValue);{let t=Oh(n);return ts(t,nu)}}function Oh(n,t,e){let i;if(Hr(n)){let r=kt(n);return cr(r)||uh(r)}else if(gy(n))i=()=>kt(n.useValue);else if(SD(n))i=()=>n.useFactory(...ch(n.deps||[]));else if(CD(n))i=(r,o)=>z(kt(n.useExisting),o!==void 0&&o&8?8:void 0);else{let r=kt(n&&(n.useClass||n.provide));if(ID(n))i=()=>new r(...ch(n.deps));else return cr(r)||uh(r)}return i}function ga(n){if(n.destroyed)throw new U(205,!1)}function ts(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function ID(n){return!!n.deps}function TD(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function MD(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function dh(n,t){for(let e of n)Array.isArray(e)?dh(e,t):e&&_h(e)?dh(e.\u0275providers,t):t(e)}function Ct(n,t){let e;n instanceof Wr?(ga(n),e=n):e=new lh(n);let i,r=si(e),o=Yt(void 0);try{return t()}finally{si(r),Yt(o)}}function _y(){return ly()!==void 0||hc()!=null}var Jn=0,re=1,ue=2,mt=3,Dn=4,In=5,is=6,rs=7,st=8,fr=9,ui=10,Ne=11,os=12,Nh=13,qr=14,_n=15,pr=16,Jr=17,di=18,Ca=19,Ph=20,Fi=21,fu=22,Sa=23,yn=24,Kr=25,Yr=26,We=27,yy=1,kh=6,hr=7,xa=8,Zr=9,dt=10;function fi(n){return Array.isArray(n)&&typeof n[yy]=="object"}function Kn(n){return Array.isArray(n)&&n[yy]===!0}function Fh(n){return(n.flags&4)!==0}function $i(n){return n.componentOffset>-1}function ss(n){return(n.flags&1)===1}function pi(n){return!!n.template}function as(n){return(n[ue]&512)!==0}function Qr(n){return(n[ue]&256)===256}var by="svg",wy="math";function Tn(n){for(;Array.isArray(n);)n=n[Jn];return n}function Lh(n,t){return Tn(t[n])}function Mn(n,t){return Tn(t[n.index])}function Da(n,t){return n.data[t]}function Ia(n,t){return n[t]}function jh(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}function An(n,t){let e=t[n];return fi(e)?e:e[Jn]}function Ey(n){return(n[ue]&4)===4}function pu(n){return(n[ue]&128)===128}function Cy(n){return Kn(n[mt])}function hi(n,t){return t==null?null:n[t]}function Vh(n){n[Jr]=0}function zh(n){n[ue]&1024||(n[ue]|=1024,pu(n)&&ls(n))}function Sy(n,t){for(;n>0;)t=t[qr],n--;return t}function Ta(n){return!!(n[ue]&9216||n[yn]?.dirty)}function hu(n){n[ui].changeDetectionScheduler?.notify(8),n[ue]&64&&(n[ue]|=1024),Ta(n)&&ls(n)}function ls(n){n[ui].changeDetectionScheduler?.notify(0);let t=ur(n);for(;t!==null&&!(t[ue]&8192||(t[ue]|=8192,!pu(t)));)t=ur(t)}function Uh(n,t){if(Qr(n))throw new U(911,!1);n[Fi]===null&&(n[Fi]=[]),n[Fi].push(t)}function xy(n,t){if(n[Fi]===null)return;let e=n[Fi].indexOf(t);e!==-1&&n[Fi].splice(e,1)}function ur(n){let t=n[mt];return Kn(t)?t[mt]:t}function Bh(n){return n[rs]??=[]}function $h(n){return n.cleanup??=[]}function Dy(n,t,e,i){let r=Bh(t);r.push(e),n.firstCreatePass&&$h(n).push(i,r.length-1)}var ge={lFrame:By(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var fh=!1;function Iy(){return ge.lFrame.elementDepthCount}function Ty(){ge.lFrame.elementDepthCount++}function My(){ge.lFrame.elementDepthCount--}function mu(){return ge.bindingsEnabled}function Ay(){return ge.skipHydrationRootTNode!==null}function Ry(n){return ge.skipHydrationRootTNode===n}function Oy(){ge.skipHydrationRootTNode=null}function oe(){return ge.lFrame.lView}function Ge(){return ge.lFrame.tView}function C(n){return ge.lFrame.contextLView=n,n[st]}function S(n){return ge.lFrame.contextLView=null,n}function St(){let n=Hh();for(;n!==null&&n.type===64;)n=n.parent;return n}function Hh(){return ge.lFrame.currentTNode}function Ny(){let n=ge.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}function cs(n,t){let e=ge.lFrame;e.currentTNode=n,e.isParent=t}function Wh(){return ge.lFrame.isParent}function Py(){ge.lFrame.isParent=!1}function ky(){return ge.lFrame.contextLView}function Gh(){return fh}function qh(n){let t=fh;return fh=n,t}function us(){let n=ge.lFrame,t=n.bindingRootIndex;return t===-1&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Jh(){return ge.lFrame.bindingIndex}function Fy(n){return ge.lFrame.bindingIndex=n}function Hi(){return ge.lFrame.bindingIndex++}function Ma(n){let t=ge.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function Ly(){return ge.lFrame.inI18n}function jy(n,t){let e=ge.lFrame;e.bindingIndex=e.bindingRootIndex=n,gu(t)}function Vy(){return ge.lFrame.currentDirectiveIndex}function gu(n){ge.lFrame.currentDirectiveIndex=n}function zy(n){let t=ge.lFrame.currentDirectiveIndex;return t===-1?null:n[t]}function Kh(){return ge.lFrame.currentQueryIndex}function vu(n){ge.lFrame.currentQueryIndex=n}function AD(n){let t=n[re];return t.type===2?t.declTNode:t.type===1?n[In]:null}function Yh(n,t,e){if(e&4){let r=t,o=n;for(;r=r.parent,r===null&&!(e&1);)if(r=AD(o),r===null||(o=o[qr],r.type&10))break;if(r===null)return!1;t=r,n=o}let i=ge.lFrame=Uy();return i.currentTNode=t,i.lView=n,!0}function _u(n){let t=Uy(),e=n[re];ge.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Uy(){let n=ge.lFrame,t=n===null?null:n.child;return t===null?By(n):t}function By(n){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=t),t}function $y(){let n=ge.lFrame;return ge.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var Zh=$y;function yu(){let n=$y();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Hy(n){return(ge.lFrame.contextLView=Sy(n,ge.lFrame.contextLView))[st]}function Yn(){return ge.lFrame.selectedIndex}function mr(n){ge.lFrame.selectedIndex=n}function Aa(){let n=ge.lFrame;return Da(n.tView,n.selectedIndex)}function Wy(){return ge.lFrame.currentNamespace}var Gy=!0;function bu(){return Gy}function Ra(n){Gy=n}function ph(n,t=null,e=null,i){let r=Qh(n,t,e,i);return r.resolveInjectorInitializers(),r}function Qh(n,t=null,e=null,i,r=new Set){let o=[e||Zt,hy(n)];return i=i||(typeof n=="object"?void 0:Li(n)),new Wr(o,t||Ea(),i||null,r)}var Qt=class n{static THROW_IF_NOT_FOUND=Br;static NULL=new _a;static create(t,e){if(Array.isArray(t))return ph({name:""},e,t,"");{let i=t.name??"";return ph({name:i},t.parent,t.providers,i)}}static \u0275prov=F({token:n,providedIn:"any",factory:()=>z(Dh)});static __NG_ELEMENT_ID__=-1},qe=new Y(""),Zn=(()=>{class n{static __NG_ELEMENT_ID__=RD;static __NG_ENV_ID__=e=>e}return n})(),hh=class extends Zn{_lView;constructor(t){super(),this._lView=t}get destroyed(){return Qr(this._lView)}onDestroy(t){let e=this._lView;return Uh(e,t),()=>xy(e,t)}};function RD(){return new hh(oe())}var Gn=class{_console=console;handleError(t){this._console.error("ERROR",t)}},Xt=new Y("",{providedIn:"root",factory:()=>{let n=O(ot),t;return e=>{n.destroyed&&!t?setTimeout(()=>{throw e}):(t??=n.get(Gn),t.handleError(e))}}}),qy={provide:Ui,useValue:()=>void O(Gn),multi:!0},OD=new Y("",{providedIn:"root",factory:()=>{let n=O(qe).defaultView;if(!n)return;let t=O(Xt),e=o=>{t(o.reason),o.preventDefault()},i=o=>{o.error?t(o.error):t(new Error(o.message,{cause:o})),o.preventDefault()},r=()=>{n.addEventListener("unhandledrejection",e),n.addEventListener("error",i)};typeof Zone<"u"?Zone.root.run(r):r(),O(Zn).onDestroy(()=>{n.removeEventListener("error",i),n.removeEventListener("unhandledrejection",e)})}});function Xh(){return ci([py(()=>void O(OD))])}function em(n){return typeof n=="function"&&n[zt]!==void 0}function Je(n,t){let[e,i,r]=Lp(n,t?.equal),o=e,s=o[zt];return o.set=i,o.update=r,o.asReadonly=Jy.bind(o),o}function Jy(){let n=this[zt];if(n.readonlyFn===void 0){let t=()=>this();t[zt]=n,n.readonlyFn=t}return n.readonlyFn}function tm(n){return em(n)&&typeof n.set=="function"}var wu=(()=>{class n{view;node;constructor(e,i){this.view=e,this.node=i}static __NG_ELEMENT_ID__=ND}return n})();function ND(){return new wu(oe(),St())}var ji=class{},Oa=new Y("",{providedIn:"root",factory:()=>!1});var nm=new Y(""),im=new Y(""),mi=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new tt(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new be(e=>{e.next(!1),e.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=F({token:n,providedIn:"root",factory:()=>new n})}return n})(),Eu=(()=>{class n{internalPendingTasks=O(mi);scheduler=O(ji);errorHandler=O(Xt);add(){let e=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(e)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(e))}}run(e){let i=this.add();e().catch(this.errorHandler).finally(i)}static \u0275prov=F({token:n,providedIn:"root",factory:()=>new n})}return n})();function Na(...n){}var rm=(()=>{class n{static \u0275prov=F({token:n,providedIn:"root",factory:()=>new mh})}return n})(),mh=class{dirtyEffectCount=0;queues=new Map;add(t){this.enqueue(t),this.schedule(t)}schedule(t){t.dirty&&this.dirtyEffectCount++}remove(t){let e=t.zone,i=this.queues.get(e);i.has(t)&&(i.delete(t),t.dirty&&this.dirtyEffectCount--)}enqueue(t){let e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);let i=this.queues.get(e);i.has(t)||i.add(t)}flush(){for(;this.dirtyEffectCount>0;){let t=!1;for(let[e,i]of this.queues)e===null?t||=this.flushQueue(i):t||=e.run(()=>this.flushQueue(i));t||(this.dirtyEffectCount=0)}}flushQueue(t){let e=!1;for(let i of t)i.dirty&&(this.dirtyEffectCount--,e=!0,i.run());return e}};function $a(n){return{toString:n}.toString()}function UD(n){return typeof n=="function"}var Au=class{previousValue;currentValue;firstChange;constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}};function Db(n,t,e,i){t!==null?t.applyValueToInputSignal(t,i):n[e]=i}var bn=(()=>{let n=()=>Ib;return n.ngInherit=!0,n})();function Ib(n){return n.type.prototype.ngOnChanges&&(n.setInput=$D),BD}function BD(){let n=Mb(this),t=n?.current;if(t){let e=n.previous;if(e===dr)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function $D(n,t,e,i,r){let o=this.declaredInputs[i],s=Mb(n)||HD(n,{previous:dr,current:null}),a=s.current||(s.current={}),u=s.previous,f=u[o];a[o]=new Au(f&&f.currentValue,e,u===dr),Db(n,t,r,e)}var Tb="__ngSimpleChanges__";function Mb(n){return n[Tb]||null}function HD(n,t){return n[Tb]=t}var Ky=[];var Me=function(n,t=null,e){for(let i=0;i<Ky.length;i++){let r=Ky[i];r(n,t,e)}};function WD(n,t,e){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(i){let s=Ib(t);(e.preOrderHooks??=[]).push(n,s),(e.preOrderCheckHooks??=[]).push(n,s)}r&&(e.preOrderHooks??=[]).push(0-n,r),o&&((e.preOrderHooks??=[]).push(n,o),(e.preOrderCheckHooks??=[]).push(n,o))}function Ab(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){let o=n.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:f,ngOnDestroy:h}=o;s&&(n.contentHooks??=[]).push(-e,s),a&&((n.contentHooks??=[]).push(e,a),(n.contentCheckHooks??=[]).push(e,a)),u&&(n.viewHooks??=[]).push(-e,u),f&&((n.viewHooks??=[]).push(e,f),(n.viewCheckHooks??=[]).push(e,f)),h!=null&&(n.destroyHooks??=[]).push(e,h)}}function Du(n,t,e){Rb(n,t,3,e)}function Iu(n,t,e,i){(n[ue]&3)===e&&Rb(n,t,e,i)}function om(n,t){let e=n[ue];(e&3)===t&&(e&=16383,e+=1,n[ue]=e)}function Rb(n,t,e,i){let r=i!==void 0?n[Jr]&65535:0,o=i??-1,s=t.length-1,a=0;for(let u=r;u<s;u++)if(typeof t[u+1]=="number"){if(a=t[u],i!=null&&a>=i)break}else t[u]<0&&(n[Jr]+=65536),(a<o||o==-1)&&(GD(n,e,t,u),n[Jr]=(n[Jr]&4294901760)+u+2),u++}function Yy(n,t){Me(4,n,t);let e=ce(null);try{t.call(n)}finally{ce(e),Me(5,n,t)}}function GD(n,t,e,i){let r=e[i]<0,o=e[i+1],s=r?-e[i]:e[i],a=n[s];r?n[ue]>>14<n[Jr]>>16&&(n[ue]&3)===t&&(n[ue]+=16384,Yy(a,o)):Yy(a,o)}var fs=-1,eo=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,i,r){this.factory=t,this.name=r,this.canSeeViewProviders=e,this.injectImpl=i}};function qD(n){return(n.flags&8)!==0}function JD(n){return(n.flags&16)!==0}function KD(n,t,e){let i=0;for(;i<e.length;){let r=e[i];if(typeof r=="number"){if(r!==0)break;i++;let o=e[i++],s=e[i++],a=e[i++];n.setAttribute(t,s,a,o)}else{let o=r,s=e[++i];YD(o)?n.setProperty(t,o,s):n.setAttribute(t,o,s),i++}}return i}function Ob(n){return n===3||n===4||n===6}function YD(n){return n.charCodeAt(0)===64}function Fa(n,t){if(!(t===null||t.length===0))if(n===null||n.length===0)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){let r=t[i];typeof r=="number"?e=r:e===0||(e===-1||e===2?Zy(n,e,r,null,t[++i]):Zy(n,e,r,null,null))}}return n}function Zy(n,t,e,i,r){let o=0,s=n.length;if(t===-1)s=-1;else for(;o<n.length;){let a=n[o++];if(typeof a=="number"){if(a===t){s=-1;break}else if(a>t){s=o-1;break}}}for(;o<n.length;){let a=n[o];if(typeof a=="number")break;if(a===e){r!==null&&(n[o+1]=r);return}o++,r!==null&&o++}s!==-1&&(n.splice(s,0,t),o=s+1),n.splice(o++,0,e),r!==null&&n.splice(o++,0,r)}function Nb(n){return n!==fs}function Ru(n){return n&32767}function ZD(n){return n>>16}function Ou(n,t){let e=ZD(n),i=t;for(;e>0;)i=i[qr],e--;return i}var vm=!0;function Nu(n){let t=vm;return vm=n,t}var QD=256,Pb=QD-1,kb=5,XD=0,gi={};function eI(n,t,e){let i;typeof e=="string"?i=e.charCodeAt(0)||0:e.hasOwnProperty(Gr)&&(i=e[Gr]),i==null&&(i=e[Gr]=XD++);let r=i&Pb,o=1<<r;t.data[n+(r>>kb)]|=o}function Pu(n,t){let e=Fb(n,t);if(e!==-1)return e;let i=t[re];i.firstCreatePass&&(n.injectorIndex=t.length,sm(i.data,n),sm(t,null),sm(i.blueprint,null));let r=Jm(n,t),o=n.injectorIndex;if(Nb(r)){let s=Ru(r),a=Ou(r,t),u=a[re].data;for(let f=0;f<8;f++)t[o+f]=a[s+f]|u[s+f]}return t[o+8]=r,o}function sm(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Fb(n,t){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||t[n.injectorIndex+8]===null?-1:n.injectorIndex}function Jm(n,t){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;r!==null;){if(i=Ub(r),i===null)return fs;if(e++,r=r[qr],i.injectorIndex!==-1)return i.injectorIndex|e<<16}return fs}function _m(n,t,e){eI(n,t,e)}function tI(n,t){if(t==="class")return n.classes;if(t==="style")return n.styles;let e=n.attrs;if(e){let i=e.length,r=0;for(;r<i;){let o=e[r];if(Ob(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<i&&typeof e[r]=="string";)r++;else{if(o===t)return e[r+1];r=r+2}}}return null}function Lb(n,t,e){if(e&8||n!==void 0)return n;lu(t,"NodeInjector")}function jb(n,t,e,i){if(e&8&&i===void 0&&(i=null),(e&3)===0){let r=n[fr],o=Yt(void 0);try{return r?r.get(t,i,e&8):Sh(t,i,e&8)}finally{Yt(o)}}return Lb(i,t,e)}function Vb(n,t,e,i=0,r){if(n!==null){if(t[ue]&2048&&!(i&2)){let s=oI(n,t,e,i,gi);if(s!==gi)return s}let o=zb(n,t,e,i,gi);if(o!==gi)return o}return jb(t,e,i,r)}function zb(n,t,e,i,r){let o=iI(e);if(typeof o=="function"){if(!Yh(t,n,i))return i&1?Lb(r,e,i):jb(t,e,i,r);try{let s;if(s=o(i),s==null&&!(i&8))lu(e);else return s}finally{Zh()}}else if(typeof o=="number"){let s=null,a=Fb(n,t),u=fs,f=i&1?t[_n][In]:null;for((a===-1||i&4)&&(u=a===-1?Jm(n,t):t[a+8],u===fs||!Xy(i,!1)?a=-1:(s=t[re],a=Ru(u),t=Ou(u,t)));a!==-1;){let h=t[re];if(Qy(o,a,h.data)){let m=nI(a,t,e,s,i,f);if(m!==gi)return m}u=t[a+8],u!==fs&&Xy(i,t[re].data[a+8]===f)&&Qy(o,a,t)?(s=h,a=Ru(u),t=Ou(u,t)):a=-1}}return r}function nI(n,t,e,i,r,o){let s=t[re],a=s.data[n+8],u=i==null?$i(a)&&vm:i!=s&&(a.type&3)!==0,f=r&1&&o===a,h=Tu(a,s,e,u,f);return h!==null?La(t,s,h,a,r):gi}function Tu(n,t,e,i,r){let o=n.providerIndexes,s=t.data,a=o&1048575,u=n.directiveStart,f=n.directiveEnd,h=o>>20,m=i?a:a+h,b=r?a+h:f;for(let v=m;v<b;v++){let w=s[v];if(v<u&&e===w||v>=u&&w.type===e)return v}if(r){let v=s[u];if(v&&pi(v)&&v.type===e)return u}return null}function La(n,t,e,i,r){let o=n[e],s=t.data;if(o instanceof eo){let a=o;if(a.resolving){let v=oy(s[e]);throw Ch(v)}let u=Nu(a.canSeeViewProviders);a.resolving=!0;let f=s[e].type||s[e],h,m=a.injectImpl?Yt(a.injectImpl):null,b=Yh(n,i,0);try{o=n[e]=a.factory(void 0,r,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&WD(e,s[e],t)}finally{m!==null&&Yt(m),Nu(u),a.resolving=!1,Zh()}}return o}function iI(n){if(typeof n=="string")return n.charCodeAt(0)||0;let t=n.hasOwnProperty(Gr)?n[Gr]:void 0;return typeof t=="number"?t>=0?t&Pb:rI:t}function Qy(n,t,e){let i=1<<n;return!!(e[t+(n>>kb)]&i)}function Xy(n,t){return!(n&2)&&!(n&1&&t)}var Xr=class{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Vb(this._tNode,this._lView,t,$r(i),e)}};function rI(){return new Xr(St(),oe())}function Rn(n){return $a(()=>{let t=n.prototype.constructor,e=t[va]||ym(t),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let o=r[va]||ym(r);if(o&&o!==e)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function ym(n){return gh(n)?()=>{let t=ym(kt(n));return t&&t()}:cr(n)}function oI(n,t,e,i,r){let o=n,s=t;for(;o!==null&&s!==null&&s[ue]&2048&&!as(s);){let a=zb(o,s,e,i|2,gi);if(a!==gi)return a;let u=o.parent;if(!u){let f=s[Ph];if(f){let h=f.get(e,gi,i);if(h!==gi)return h}u=Ub(s),s=s[qr]}o=u}return r}function Ub(n){let t=n[re],e=t.type;return e===2?t.declTNode:e===1?n[In]:null}function Ha(n){return tI(St(),n)}function sI(){return gs(St(),oe())}function gs(n,t){return new xt(Mn(n,t))}var xt=(()=>{class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=sI}return n})();function aI(n){return n instanceof xt?n.nativeElement:n}function lI(){return this._results[Symbol.iterator]()}var ku=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new $e}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;let i=uy(t);(this._changesDetected=!cy(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=lI};function Bb(n){return(n.flags&128)===128}var Km=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(Km||{}),$b=new Map,cI=0;function uI(){return cI++}function dI(n){$b.set(n[Ca],n)}function bm(n){$b.delete(n[Ca])}var eb="__ngContext__";function ps(n,t){fi(t)?(n[eb]=t[Ca],dI(t)):n[eb]=t}function Hb(n){return Gb(n[os])}function Wb(n){return Gb(n[Dn])}function Gb(n){for(;n!==null&&!Kn(n);)n=n[Dn];return n}var wm;function Ym(n){wm=n}function qb(){if(wm!==void 0)return wm;if(typeof document<"u")return document;throw new U(210,!1)}var Zu=new Y("",{providedIn:"root",factory:()=>fI}),fI="ng",Qu=new Y(""),vs=new Y("",{providedIn:"platform",factory:()=>"unknown"});var Xu=new Y("",{providedIn:"root",factory:()=>qb().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var pI="h",hI="b";var Jb="r";var Kb="di";var Yb=!1,Zb=new Y("",{providedIn:"root",factory:()=>Yb});var Zm=new Y("");var mI=(n,t,e,i)=>{};function gI(n,t,e,i){mI(n,t,e,i)}function Qm(n){return(n.flags&32)===32}var vI=()=>null;function Qb(n,t,e=!1){return vI(n,t,e)}function Xb(n,t){let e=n.contentQueries;if(e!==null){let i=ce(null);try{for(let r=0;r<e.length;r+=2){let o=e[r],s=e[r+1];if(s!==-1){let a=n.data[s];vu(o),a.contentQueries(2,t[s],s)}}}finally{ce(i)}}}function Em(n,t,e){vu(0);let i=ce(null);try{t(n,e)}finally{ce(i)}}function Xm(n,t,e){if(Fh(t)){let i=ce(null);try{let r=t.directiveStart,o=t.directiveEnd;for(let s=r;s<o;s++){let a=n.data[s];if(a.contentQueries){let u=e[s];a.contentQueries(1,u,s)}}}finally{ce(i)}}}var Wi=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n})(Wi||{});var Cu;function _I(){if(Cu===void 0&&(Cu=null,zi.trustedTypes))try{Cu=zi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Cu}function tb(n){return _I()?.createScriptURL(n)||n}var Fu=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ou})`}};function _s(n){return n instanceof Fu?n.changingThisBreaksApplicationSecurity:n}function eg(n,t){let e=ew(n);if(e!=null&&e!==t){if(e==="ResourceURL"&&t==="URL")return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${ou})`)}return e===t}function ew(n){return n instanceof Fu&&n.getTypeName()||null}var yI=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function tw(n){return n=String(n),n.match(yI)?n:"unsafe:"+n}var ed=(function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n})(ed||{});function Wa(n){let t=iw();return t?t.sanitize(ed.URL,n)||"":eg(n,"URL")?_s(n):tw(qn(n))}function nw(n){let t=iw();if(t)return tb(t.sanitize(ed.RESOURCE_URL,n)||"");if(eg(n,"ResourceURL"))return tb(_s(n));throw new U(904,!1)}function bI(n,t){return t==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||t==="href"&&(n==="base"||n==="link")?nw:Wa}function tg(n,t,e){return bI(t,e)(n)}function iw(){let n=oe();return n&&n[ui].sanitizer}var wI=/^>|^->|<!--|-->|--!>|<!-$/g,EI=/(<|>)/g,CI="\u200B$1\u200B";function SI(n){return n.replace(wI,t=>t.replace(EI,CI))}function ng(n){return n.ownerDocument.defaultView}function ig(n){return n.ownerDocument}function rw(n){return n instanceof Function?n():n}function xI(n,t,e){let i=n.length;for(;;){let r=n.indexOf(t,e);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let o=t.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}e=r+1}}var ow="ng-template";function DI(n,t,e,i){let r=0;if(i){for(;r<t.length&&typeof t[r]=="string";r+=2)if(t[r]==="class"&&xI(t[r+1].toLowerCase(),e,0)!==-1)return!0}else if(rg(n))return!1;if(r=t.indexOf(1,r),r>-1){let o;for(;++r<t.length&&typeof(o=t[r])=="string";)if(o.toLowerCase()===e)return!0}return!1}function rg(n){return n.type===4&&n.value!==ow}function II(n,t,e){let i=n.type===4&&!e?ow:n.value;return t===i}function TI(n,t,e){let i=4,r=n.attrs,o=r!==null?RI(r):0,s=!1;for(let a=0;a<t.length;a++){let u=t[a];if(typeof u=="number"){if(!s&&!Qn(i)&&!Qn(u))return!1;if(s&&Qn(u))continue;s=!1,i=u|i&1;continue}if(!s)if(i&4){if(i=2|i&1,u!==""&&!II(n,u,e)||u===""&&t.length===1){if(Qn(i))return!1;s=!0}}else if(i&8){if(r===null||!DI(n,r,u,e)){if(Qn(i))return!1;s=!0}}else{let f=t[++a],h=MI(u,r,rg(n),e);if(h===-1){if(Qn(i))return!1;s=!0;continue}if(f!==""){let m;if(h>o?m="":m=r[h+1].toLowerCase(),i&2&&f!==m){if(Qn(i))return!1;s=!0}}}}return Qn(i)||s}function Qn(n){return(n&1)===0}function MI(n,t,e,i){if(t===null)return-1;let r=0;if(i||!e){let o=!1;for(;r<t.length;){let s=t[r];if(s===n)return r;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=t[++r];for(;typeof a=="string";)a=t[++r];continue}else{if(s===4)break;if(s===0){r+=4;continue}}r+=o?1:2}return-1}else return OI(t,n)}function AI(n,t,e=!1){for(let i=0;i<t.length;i++)if(TI(n,t[i],e))return!0;return!1}function RI(n){for(let t=0;t<n.length;t++){let e=n[t];if(Ob(e))return t}return n.length}function OI(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){let i=n[e];if(typeof i=="number")return-1;if(i===t)return e;e++}return-1}function nb(n,t){return n?":not("+t.trim()+")":t}function NI(n){let t=n[0],e=1,i=2,r="",o=!1;for(;e<n.length;){let s=n[e];if(typeof s=="string")if(i&2){let a=n[++e];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else i&8?r+="."+s:i&4&&(r+=" "+s);else r!==""&&!Qn(s)&&(t+=nb(o,r),r=""),i=s,o=o||!Qn(i);e++}return r!==""&&(t+=nb(o,r)),t}function PI(n){return n.map(NI).join(",")}function kI(n){let t=[],e=[],i=1,r=2;for(;i<n.length;){let o=n[i];if(typeof o=="string")r===2?o!==""&&t.push(o,n[++i]):r===8&&e.push(o);else{if(!Qn(r))break;r=o}i++}return e.length&&t.push(1,...e),t}var Dt={};function FI(n,t){return n.createText(t)}function LI(n,t,e){n.setValue(t,e)}function jI(n,t){return n.createComment(SI(t))}function sw(n,t,e){return n.createElement(t,e)}function Lu(n,t,e,i,r){n.insertBefore(t,e,i,r)}function aw(n,t,e){n.appendChild(t,e)}function ib(n,t,e,i,r){i!==null?Lu(n,t,e,i,r):aw(n,t,e)}function lw(n,t,e,i){n.removeChild(null,t,e,i)}function VI(n,t,e){n.setAttribute(t,"style",e)}function zI(n,t,e){e===""?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function cw(n,t,e){let{mergedAttrs:i,classes:r,styles:o}=e;i!==null&&KD(n,t,i),r!==null&&zI(n,t,r),o!==null&&VI(n,t,o)}function og(n,t,e,i,r,o,s,a,u,f,h){let m=We+i,b=m+r,v=UI(m,b),w=typeof f=="function"?f():f;return v[re]={type:n,blueprint:v,template:e,queries:null,viewQuery:a,declTNode:t,data:v.slice().fill(null,m),bindingStartIndex:m,expandoStartIndex:b,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:u,consts:w,incompleteFirstPass:!1,ssrId:h}}function UI(n,t){let e=[];for(let i=0;i<t;i++)e.push(i<n?null:Dt);return e}function BI(n){let t=n.tView;return t===null||t.incompleteFirstPass?n.tView=og(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function sg(n,t,e,i,r,o,s,a,u,f,h){let m=t.blueprint.slice();return m[Jn]=r,m[ue]=i|4|128|8|64|1024,(f!==null||n&&n[ue]&2048)&&(m[ue]|=2048),Vh(m),m[mt]=m[qr]=n,m[st]=e,m[ui]=s||n&&n[ui],m[Ne]=a||n&&n[Ne],m[fr]=u||n&&n[fr]||null,m[In]=o,m[Ca]=uI(),m[is]=h,m[Ph]=f,m[_n]=t.type==2?n[_n]:m,m}function $I(n,t,e){let i=Mn(t,n),r=BI(e),o=n[ui].rendererFactory,s=ag(n,sg(n,r,null,uw(e),i,t,null,o.createRenderer(i,e),null,null,null));return n[t.index]=s}function uw(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function dw(n,t,e,i){if(e===0)return-1;let r=t.length;for(let o=0;o<e;o++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function ag(n,t){return n[os]?n[Nh][Dn]=t:n[os]=t,n[Nh]=t,t}function p(n=1){fw(Ge(),oe(),Yn()+n,!1)}function fw(n,t,e,i){if(!i)if((t[ue]&3)===3){let o=n.preOrderCheckHooks;o!==null&&Du(t,o,e)}else{let o=n.preOrderHooks;o!==null&&Iu(t,o,0,e)}mr(e)}var td=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(td||{});function Cm(n,t,e,i){let r=ce(null);try{let[o,s,a]=n.inputs[e],u=null;(s&td.SignalBased)!==0&&(u=t[o][zt]),u!==null&&u.transformFn!==void 0?i=u.transformFn(i):a!==null&&(i=a.call(t,i)),n.setInput!==null?n.setInput(t,u,i,e,o):Db(t,u,o,i)}finally{ce(r)}}var ei=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(ei||{}),HI;function lg(n,t){return HI(n,t)}var hs=new Set,nd=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(nd||{}),oo=new Y(""),rb=new Set;function ti(n){rb.has(n)||(rb.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var pw=!1,Sm=class extends $e{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,_y()&&(this.destroyRef=O(Zn,{optional:!0})??void 0,this.pendingTasks=O(mi,{optional:!0})??void 0)}emit(t){let e=ce(null);try{super.next(t)}finally{ce(e)}}subscribe(t,e,i){let r=t,o=e||(()=>null),s=i;if(t&&typeof t=="object"){let u=t;r=u.next?.bind(u),o=u.error?.bind(u),s=u.complete?.bind(u)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:r,error:o,complete:s});return t instanceof Ye&&t.add(a),a}wrapInTimeout(t){return e=>{let i=this.pendingTasks?.add();setTimeout(()=>{try{t(e)}finally{i!==void 0&&this.pendingTasks?.remove(i)}})}}},Pe=Sm;function hw(n){let t,e;function i(){n=Na;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{n(),i()})),()=>i()}function ob(n){return queueMicrotask(()=>n()),()=>{n=Na}}var cg="isAngularZone",ju=cg+"_ID",WI=0,ze=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Pe(!1);onMicrotaskEmpty=new Pe(!1);onStable=new Pe(!1);onError=new Pe(!1);constructor(t){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=pw}=t;if(typeof Zone>"u")throw new U(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&i,s.shouldCoalesceRunChangeDetection=r,s.callbackScheduled=!1,s.scheduleInRootZone=o,JI(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(cg)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new U(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new U(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,t,GI,Na,Na);try{return o.runTask(s,e,i)}finally{o.cancelTask(s)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}},GI={};function ug(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function qI(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function t(){hw(()=>{n.callbackScheduled=!1,xm(n),n.isCheckStableRunning=!0,ug(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),xm(n)}function JI(n){let t=()=>{qI(n)},e=WI++;n._inner=n._inner.fork({name:"angular",properties:{[cg]:!0,[ju]:e,[ju+e]:!0},onInvokeTask:(i,r,o,s,a,u)=>{if(KI(u))return i.invokeTask(o,s,a,u);try{return sb(n),i.invokeTask(o,s,a,u)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&t(),ab(n)}},onInvoke:(i,r,o,s,a,u,f)=>{try{return sb(n),i.invoke(o,s,a,u,f)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!YI(u)&&t(),ab(n)}},onHasTask:(i,r,o,s)=>{i.hasTask(o,s),r===o&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,xm(n),ug(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,r,o,s)=>(i.handleError(o,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function xm(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function sb(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function ab(n){n._nesting--,ug(n)}var Vu=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Pe;onMicrotaskEmpty=new Pe;onStable=new Pe;onError=new Pe;run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}};function KI(n){return mw(n,"__ignore_ng_zone__")}function YI(n){return mw(n,"__scheduler_tick__")}function mw(n,t){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[t]===!0}var dg=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=F({token:n,providedIn:"root",factory:()=>new n})}return n})(),gw=[0,1,2,3],vw=(()=>{class n{ngZone=O(ze);scheduler=O(ji);errorHandler=O(Gn,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){O(oo,{optional:!0})}execute(){let e=this.sequences.size>0;e&&Me(16),this.executing=!0;for(let i of gw)for(let r of this.sequences)if(!(r.erroredOrDestroyed||!r.hooks[i]))try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let o=r.hooks[i];return o(r.pipelinedValue)},r.snapshot))}catch(o){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(let i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&Me(17)}register(e){let{view:i}=e;i!==void 0?((i[Kr]??=[]).push(e),ls(i),i[ue]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,i){return i?i.run(nd.AFTER_NEXT_RENDER,e):e()}static \u0275prov=F({token:n,providedIn:"root",factory:()=>new n})}return n})(),zu=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,i,r,o,s=null){this.impl=t,this.hooks=e,this.view=i,this.once=r,this.snapshot=s,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let t=this.view?.[Kr];t&&(this.view[Kr]=t.filter(e=>e!==this))}};function Ga(n,t){let e=t?.injector??O(Qt);return ti("NgAfterNextRender"),QI(n,e,t,!0)}function ZI(n){return n instanceof Function?[void 0,void 0,n,void 0]:[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function QI(n,t,e,i){let r=t.get(dg);r.impl??=t.get(vw);let o=t.get(oo,null,{optional:!0}),s=e?.manualCleanup!==!0?t.get(Zn):null,a=t.get(wu,null,{optional:!0}),u=new zu(r.impl,ZI(n),a?.view,i,s,o?.snapshot(null));return r.impl.register(u),u}var XI=new Y("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function _w(n,t){let e=n.get(XI);if(Array.isArray(t))for(let i of t)e.queue.add(i);else e.queue.add(t);e.scheduler&&e.scheduler(n)}function eT(n,t){for(let[e,i]of t)_w(n,i.animateFns)}function lb(n,t,e,i){let r=n?.[Yr]?.enter;t!==null&&r&&r.has(e.index)&&eT(i,r)}function ds(n,t,e,i,r,o,s,a){if(r!=null){let u,f=!1;Kn(r)?u=r:fi(r)&&(f=!0,r=r[Jn]);let h=Tn(r);n===0&&i!==null?(lb(a,i,o,e),s==null?aw(t,i,h):Lu(t,i,h,s||null,!0)):n===1&&i!==null?(lb(a,i,o,e),Lu(t,i,h,s||null,!0)):n===2?cb(a,o,e,m=>{lw(t,h,f,m)}):n===3&&cb(a,o,e,()=>{t.destroyNode(h)}),u!=null&&pT(t,n,e,u,o,i,s)}}function tT(n,t){yw(n,t),t[Jn]=null,t[In]=null}function nT(n,t,e,i,r,o){i[Jn]=r,i[In]=t,rd(n,i,e,1,r,o)}function yw(n,t){t[ui].changeDetectionScheduler?.notify(9),rd(n,t,t[Ne],2,null,null)}function iT(n){let t=n[os];if(!t)return am(n[re],n);for(;t;){let e=null;if(fi(t))e=t[os];else{let i=t[dt];i&&(e=i)}if(!e){for(;t&&!t[Dn]&&t!==n;)fi(t)&&am(t[re],t),t=t[mt];t===null&&(t=n),fi(t)&&am(t[re],t),e=t&&t[Dn]}t=e}}function fg(n,t){let e=n[Zr],i=e.indexOf(t);e.splice(i,1)}function id(n,t){if(Qr(t))return;let e=t[Ne];e.destroyNode&&rd(n,t,e,3,null,null),iT(t)}function am(n,t){if(Qr(t))return;let e=ce(null);try{t[ue]&=-129,t[ue]|=256,t[yn]&&da(t[yn]),sT(n,t),oT(n,t),t[re].type===1&&t[Ne].destroy();let i=t[pr];if(i!==null&&Kn(t[mt])){i!==t[mt]&&fg(i,t);let r=t[di];r!==null&&r.detachView(n)}bm(t)}finally{ce(e)}}function cb(n,t,e,i){let r=n?.[Yr];if(r==null||r.leave==null||!r.leave.has(t.index))return i(!1);if(r.skipLeaveAnimations)return r.skipLeaveAnimations=!1,i(!1);n&&hs.add(n),_w(e,()=>{if(r.leave&&r.leave.has(t.index)){let s=r.leave.get(t.index),a=[];if(s)for(let u=0;u<s.animateFns.length;u++){let f=s.animateFns[u],{promise:h}=f();a.push(h)}r.running=Promise.allSettled(a),rT(n,i)}else n&&hs.delete(n),i(!1)})}function rT(n,t){let e=n[Yr]?.running;if(e){e.then(()=>{n[Yr].running=void 0,hs.delete(n),t(!0)});return}t(!1)}function oT(n,t){let e=n.cleanup,i=t[rs];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?i[a]():i[-a].unsubscribe(),s+=2}else{let a=i[e[s+1]];e[s].call(a)}i!==null&&(t[rs]=null);let r=t[Fi];if(r!==null){t[Fi]=null;for(let s=0;s<r.length;s++){let a=r[s];a()}}let o=t[Sa];if(o!==null){t[Sa]=null;for(let s of o)s.destroy()}}function sT(n,t){let e;if(n!=null&&(e=n.destroyHooks)!=null)for(let i=0;i<e.length;i+=2){let r=t[e[i]];if(!(r instanceof eo)){let o=e[i+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=r[o[s]],u=o[s+1];Me(4,a,u);try{u.call(a)}finally{Me(5,a,u)}}else{Me(4,r,o);try{o.call(r)}finally{Me(5,r,o)}}}}}function aT(n,t,e){return lT(n,t.parent,e)}function lT(n,t,e){let i=t;for(;i!==null&&i.type&168;)t=i,i=t.parent;if(i===null)return e[Jn];if($i(i)){let{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===Wi.None||r===Wi.Emulated)return null}return Mn(i,e)}function cT(n,t,e){return dT(n,t,e)}function uT(n,t,e){return n.type&40?Mn(n,e):null}var dT=uT,ub;function pg(n,t,e,i){let r=aT(n,i,t),o=t[Ne],s=i.parent||t[In],a=cT(s,i,t);if(r!=null)if(Array.isArray(e))for(let u=0;u<e.length;u++)ib(o,r,e[u],a,!1);else ib(o,r,e,a,!1);ub!==void 0&&ub(o,i,t,e,r)}function Pa(n,t){if(t!==null){let e=t.type;if(e&3)return Mn(t,n);if(e&4)return Dm(-1,n[t.index]);if(e&8){let i=t.child;if(i!==null)return Pa(n,i);{let r=n[t.index];return Kn(r)?Dm(-1,r):Tn(r)}}else{if(e&128)return Pa(n,t.next);if(e&32)return lg(t,n)()||Tn(n[t.index]);{let i=bw(n,t);if(i!==null){if(Array.isArray(i))return i[0];let r=ur(n[_n]);return Pa(r,i)}else return Pa(n,t.next)}}}return null}function bw(n,t){if(t!==null){let i=n[_n][In],r=t.projection;return i.projection[r]}return null}function Dm(n,t){let e=dt+n+1;if(e<t.length){let i=t[e],r=i[re].firstChild;if(r!==null)return Pa(i,r)}return t[hr]}function hg(n,t,e,i,r,o,s){for(;e!=null;){let a=i[fr];if(e.type===128){e=e.next;continue}let u=i[e.index],f=e.type;if(s&&t===0&&(u&&ps(Tn(u),i),e.flags|=2),!Qm(e))if(f&8)hg(n,t,e.child,i,r,o,!1),ds(t,n,a,r,u,e,o,i);else if(f&32){let h=lg(e,i),m;for(;m=h();)ds(t,n,a,r,m,e,o,i);ds(t,n,a,r,u,e,o,i)}else f&16?fT(n,t,i,e,r,o):ds(t,n,a,r,u,e,o,i);e=s?e.projectionNext:e.next}}function rd(n,t,e,i,r,o){hg(e,i,n.firstChild,t,r,o,!1)}function fT(n,t,e,i,r,o){let s=e[_n],u=s[In].projection[i.projection];if(Array.isArray(u))for(let f=0;f<u.length;f++){let h=u[f];ds(t,n,e[fr],r,h,i,o,e)}else{let f=u,h=s[mt];Bb(i)&&(f.flags|=128),hg(n,t,f,h,r,o,!0)}}function pT(n,t,e,i,r,o,s){let a=i[hr],u=Tn(i);a!==u&&ds(t,n,e,o,a,r,s);for(let f=dt;f<i.length;f++){let h=i[f];rd(h[re],h,n,t,o,a)}}function hT(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let o=i.indexOf("-")===-1?void 0:ei.DashCase;r==null?n.removeStyle(e,i,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=ei.Important),n.setStyle(e,i,r,o))}}function ww(n,t,e,i,r){let o=Yn(),s=i&2;try{mr(-1),s&&t.length>We&&fw(n,t,We,!1),Me(s?2:0,r,e),e(i,r)}finally{mr(o),Me(s?3:1,r,e)}}function od(n,t,e){bT(n,t,e),(e.flags&64)===64&&wT(n,t,e)}function sd(n,t,e=Mn){let i=t.localNames;if(i!==null){let r=t.index+1;for(let o=0;o<i.length;o+=2){let s=i[o+1],a=s===-1?e(t,n):n[s];n[r++]=a}}}function mT(n,t,e,i){let o=i.get(Zb,Yb)||e===Wi.ShadowDom,s=n.selectRootElement(t,o);return gT(s),s}function gT(n){vT(n)}var vT=()=>null;function _T(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function Ew(n,t,e,i,r,o){let s=t[re];if(ad(n,s,t,e,i)){$i(n)&&Cw(t,n.index);return}n.type&3&&(e=_T(e)),yT(n,t,e,i,r,o)}function yT(n,t,e,i,r,o){if(n.type&3){let s=Mn(n,t);i=o!=null?o(i,n.value||"",e):i,r.setProperty(s,e,i)}else n.type&12}function Cw(n,t){let e=An(t,n);e[ue]&16||(e[ue]|=64)}function bT(n,t,e){let i=e.directiveStart,r=e.directiveEnd;$i(e)&&$I(t,e,n.data[i+e.componentOffset]),n.firstCreatePass||Pu(e,t);let o=e.initialInputs;for(let s=i;s<r;s++){let a=n.data[s],u=La(t,n,s,e);if(ps(u,t),o!==null&&ST(t,s-i,u,a,e,o),pi(a)){let f=An(e.index,t);f[st]=La(t,n,s,e)}}}function wT(n,t,e){let i=e.directiveStart,r=e.directiveEnd,o=e.index,s=Vy();try{mr(o);for(let a=i;a<r;a++){let u=n.data[a],f=t[a];gu(a),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&ET(u,f)}}finally{mr(-1),gu(s)}}function ET(n,t){n.hostBindings!==null&&n.hostBindings(1,t)}function mg(n,t){let e=n.directiveRegistry,i=null;if(e)for(let r=0;r<e.length;r++){let o=e[r];AI(t,o.selectors,!1)&&(i??=[],pi(o)?i.unshift(o):i.push(o))}return i}function CT(n,t,e,i,r,o){let s=Mn(n,t);Sw(t[Ne],s,o,n.value,e,i,r)}function Sw(n,t,e,i,r,o,s){if(o==null)n.removeAttribute(t,r,e);else{let a=s==null?qn(o):s(o,i||"",r);n.setAttribute(t,r,a,e)}}function ST(n,t,e,i,r,o){let s=o[t];if(s!==null)for(let a=0;a<s.length;a+=2){let u=s[a],f=s[a+1];Cm(i,e,u,f)}}function xw(n,t,e,i,r){let o=We+e,s=t[re],a=r(s,t,n,i,e);t[o]=a,cs(n,!0);let u=n.type===2;return u?(cw(t[Ne],a,n),(Iy()===0||ss(n))&&ps(a,t),Ty()):ps(a,t),bu()&&(!u||!Qm(n))&&pg(s,t,a,n),n}function Dw(n){let t=n;return Wh()?Py():(t=t.parent,cs(t,!1)),t}function xT(n,t){let e=n[fr];if(!e)return;let i;try{i=e.get(Xt,null)}catch{i=null}i?.(t)}function ad(n,t,e,i,r){let o=n.inputs?.[i],s=n.hostDirectiveInputs?.[i],a=!1;if(s)for(let u=0;u<s.length;u+=2){let f=s[u],h=s[u+1],m=t.data[f];Cm(m,e[f],h,r),a=!0}if(o)for(let u of o){let f=e[u],h=t.data[u];Cm(h,f,i,r),a=!0}return a}function DT(n,t){let e=An(t,n),i=e[re];IT(i,e);let r=e[Jn];r!==null&&e[is]===null&&(e[is]=Qb(r,e[fr])),Me(18),gg(i,e,e[st]),Me(19,e[st])}function IT(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}function gg(n,t,e){_u(t);try{let i=n.viewQuery;i!==null&&Em(1,i,e);let r=n.template;r!==null&&ww(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[di]?.finishViewCreation(n),n.staticContentQueries&&Xb(n,t),n.staticViewQueries&&Em(2,n.viewQuery,e);let o=n.components;o!==null&&TT(t,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[ue]&=-5,yu()}}function TT(n,t){for(let e=0;e<t.length;e++)DT(n,t[e])}function ld(n,t,e,i){let r=ce(null);try{let o=t.tView,a=n[ue]&4096?4096:16,u=sg(n,o,e,a,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),f=n[t.index];u[pr]=f;let h=n[di];return h!==null&&(u[di]=h.createEmbeddedView(o)),gg(o,u,e),u}finally{ce(r)}}function ja(n,t){return!t||t.firstChild===null||Bb(n)}function Va(n,t,e,i,r=!1){for(;e!==null;){if(e.type===128){e=r?e.projectionNext:e.next;continue}let o=t[e.index];o!==null&&i.push(Tn(o)),Kn(o)&&Iw(o,i);let s=e.type;if(s&8)Va(n,t,e.child,i);else if(s&32){let a=lg(e,t),u;for(;u=a();)i.push(u)}else if(s&16){let a=bw(t,e);if(Array.isArray(a))i.push(...a);else{let u=ur(t[_n]);Va(u[re],u,a,i,!0)}}e=r?e.projectionNext:e.next}return i}function Iw(n,t){for(let e=dt;e<n.length;e++){let i=n[e],r=i[re].firstChild;r!==null&&Va(i[re],i,r,t)}n[hr]!==n[Jn]&&t.push(n[hr])}function Tw(n){if(n[Kr]!==null){for(let t of n[Kr])t.impl.addSequence(t);n[Kr].length=0}}var Mw=[];function MT(n){return n[yn]??AT(n)}function AT(n){let t=Mw.pop()??Object.create(OT);return t.lView=n,t}function RT(n){n.lView[yn]!==n&&(n.lView=null,Mw.push(n))}var OT=Q(N({},zo),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{ls(n.lView)},consumerOnSignalRead(){this.lView[yn]=this}});function NT(n){let t=n[yn]??Object.create(PT);return t.lView=n,t}var PT=Q(N({},zo),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=ur(n.lView);for(;t&&!Aw(t[re]);)t=ur(t);t&&zh(t)},consumerOnSignalRead(){this.lView[yn]=this}});function Aw(n){return n.type!==2}function Rw(n){if(n[Sa]===null)return;let t=!0;for(;t;){let e=!1;for(let i of n[Sa])i.dirty&&(e=!0,i.zone===null||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=e&&!!(n[ue]&8192)}}var kT=100;function Ow(n,t=0){let i=n[ui].rendererFactory,r=!1;r||i.begin?.();try{FT(n,t)}finally{r||i.end?.()}}function FT(n,t){let e=Gh();try{qh(!0),Im(n,t);let i=0;for(;Ta(n);){if(i===kT)throw new U(103,!1);i++,Im(n,1)}}finally{qh(e)}}function LT(n,t,e,i){if(Qr(t))return;let r=t[ue],o=!1,s=!1;_u(t);let a=!0,u=null,f=null;o||(Aw(n)?(f=MT(t),u=Bo(f)):yc()===null?(a=!1,f=NT(t),u=Bo(f)):t[yn]&&(da(t[yn]),t[yn]=null));try{Vh(t),Fy(n.bindingStartIndex),e!==null&&ww(n,t,e,2,i);let h=(r&3)===3;if(!o)if(h){let v=n.preOrderCheckHooks;v!==null&&Du(t,v,null)}else{let v=n.preOrderHooks;v!==null&&Iu(t,v,0,null),om(t,0)}if(s||jT(t),Rw(t),Nw(t,0),n.contentQueries!==null&&Xb(n,t),!o)if(h){let v=n.contentCheckHooks;v!==null&&Du(t,v)}else{let v=n.contentHooks;v!==null&&Iu(t,v,1),om(t,1)}zT(n,t);let m=n.components;m!==null&&kw(t,m,0);let b=n.viewQuery;if(b!==null&&Em(2,b,i),!o)if(h){let v=n.viewCheckHooks;v!==null&&Du(t,v)}else{let v=n.viewHooks;v!==null&&Iu(t,v,2),om(t,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),t[fu]){for(let v of t[fu])v();t[fu]=null}o||(Tw(t),t[ue]&=-73)}catch(h){throw o||ls(t),h}finally{f!==null&&(ca(f,u),a&&RT(f)),yu()}}function Nw(n,t){for(let e=Hb(n);e!==null;e=Wb(e))for(let i=dt;i<e.length;i++){let r=e[i];Pw(r,t)}}function jT(n){for(let t=Hb(n);t!==null;t=Wb(t)){if(!(t[ue]&2))continue;let e=t[Zr];for(let i=0;i<e.length;i++){let r=e[i];zh(r)}}}function VT(n,t,e){Me(18);let i=An(t,n);Pw(i,e),Me(19,i[st])}function Pw(n,t){pu(n)&&Im(n,t)}function Im(n,t){let i=n[re],r=n[ue],o=n[yn],s=!!(t===0&&r&16);if(s||=!!(r&64&&t===0),s||=!!(r&1024),s||=!!(o?.dirty&&ua(o)),s||=!1,o&&(o.dirty=!1),n[ue]&=-9217,s)LT(i,n,i.template,n[st]);else if(r&8192){let a=ce(null);try{Rw(n),Nw(n,1);let u=i.components;u!==null&&kw(n,u,1),Tw(n)}finally{ce(a)}}}function kw(n,t,e){for(let i=0;i<t.length;i++)VT(n,t[i],e)}function zT(n,t){let e=n.hostBindingOpCodes;if(e!==null)try{for(let i=0;i<e.length;i++){let r=e[i];if(r<0)mr(~r);else{let o=r,s=e[++i],a=e[++i];jy(s,o);let u=t[o];Me(24,u),a(2,u),Me(25,u)}}}finally{mr(-1)}}function vg(n,t){let e=Gh()?64:1088;for(n[ui].changeDetectionScheduler?.notify(t);n;){n[ue]|=e;let i=ur(n);if(as(n)&&!i)return n;n=i}return null}function Fw(n,t,e,i){return[n,!0,0,t,null,i,null,e,null,null]}function Lw(n,t){let e=dt+t;if(e<n.length)return n[e]}function cd(n,t,e,i=!0){let r=t[re];if(UT(r,t,n,e),i){let s=Dm(e,n),a=t[Ne],u=a.parentNode(n[hr]);u!==null&&nT(r,n[In],a,t,u,s)}let o=t[is];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function jw(n,t){let e=za(n,t);return e!==void 0&&id(e[re],e),e}function za(n,t){if(n.length<=dt)return;let e=dt+t,i=n[e];if(i){let r=i[pr];r!==null&&r!==n&&fg(r,i),t>0&&(n[e-1][Dn]=i[Dn]);let o=ba(n,dt+t);tT(i[re],i);let s=o[di];s!==null&&s.detachView(o[re]),i[mt]=null,i[Dn]=null,i[ue]&=-129}return i}function UT(n,t,e,i){let r=dt+i,o=e.length;i>0&&(e[r-1][Dn]=t),i<o-dt?(t[Dn]=e[r],xh(e,dt+i,t)):(e.push(t),t[Dn]=null),t[mt]=e;let s=t[pr];s!==null&&e!==s&&Vw(s,t);let a=t[di];a!==null&&a.insertView(n),hu(t),t[ue]|=128}function Vw(n,t){let e=n[Zr],i=t[mt];if(fi(i))n[ue]|=2;else{let r=i[mt][_n];t[_n]!==r&&(n[ue]|=2)}e===null?n[Zr]=[t]:e.push(t)}var gr=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let t=this._lView,e=t[re];return Va(e,t,e.firstChild,[])}constructor(t,e){this._lView=t,this._cdRefInjectingView=e}get context(){return this._lView[st]}set context(t){this._lView[st]=t}get destroyed(){return Qr(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[mt];if(Kn(t)){let e=t[xa],i=e?e.indexOf(this):-1;i>-1&&(za(t,i),ba(e,i))}this._attachedToViewContainer=!1}id(this._lView[re],this._lView)}onDestroy(t){Uh(this._lView,t)}markForCheck(){vg(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ue]&=-129}reattach(){hu(this._lView),this._lView[ue]|=128}detectChanges(){this._lView[ue]|=1024,Ow(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new U(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=as(this._lView),e=this._lView[pr];e!==null&&!t&&fg(e,this._lView),yw(this._lView[re],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new U(902,!1);this._appRef=t;let e=as(this._lView),i=this._lView[pr];i!==null&&!e&&Vw(i,this._lView),hu(this._lView)}};var vr=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=BT;constructor(e,i,r){this._declarationLView=e,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,i){return this.createEmbeddedViewImpl(e,i)}createEmbeddedViewImpl(e,i,r){let o=ld(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:i,dehydratedView:r});return new gr(o)}}return n})();function BT(){return ud(St(),oe())}function ud(n,t){return n.type&4?new vr(t,n,gs(n,t)):null}function dd(n,t,e,i,r){let o=n.data[t];if(o===null)o=$T(n,t,e,i,r),Ly()&&(o.flags|=32);else if(o.type&64){o.type=e,o.value=i,o.attrs=r;let s=Ny();o.injectorIndex=s===null?-1:s.injectorIndex}return cs(o,!0),o}function $T(n,t,e,i,r){let o=Hh(),s=Wh(),a=s?o:o&&o.parent,u=n.data[t]=WT(n,a,e,t,i,r);return HT(n,u,o,s),u}function HT(n,t,e,i){n.firstChild===null&&(n.firstChild=t),e!==null&&(i?e.child==null&&t.parent!==null&&(e.child=t):e.next===null&&(e.next=t,t.prev=e))}function WT(n,t,e,i,r,o){let s=t?t.injectorIndex:-1,a=0;return Ay()&&(a|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var K6=new RegExp(`^(\\d+)*(${hI}|${pI})*(.*)`);function GT(n){let t=n[kh]??[],i=n[mt][Ne],r=[];for(let o of t)o.data[Kb]!==void 0?r.push(o):qT(o,i);n[kh]=r}function qT(n,t){let e=0,i=n.firstChild;if(i){let r=n.data[Jb];for(;e<r;){let o=i.nextSibling;lw(t,i,!1),i=o,e++}}}var JT=()=>null,KT=()=>null;function Tm(n,t){return JT(n,t)}function zw(n,t,e){return KT(n,t,e)}var Uw=class{},fd=class{},Mm=class{resolveComponentFactory(t){throw new U(917,!1)}},qa=class{static NULL=new Mm},to=class{},dn=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>YT()}return n})();function YT(){let n=oe(),t=St(),e=An(t.index,n);return(fi(e)?e:n)[Ne]}var Bw=(()=>{class n{static \u0275prov=F({token:n,providedIn:"root",factory:()=>null})}return n})();var Mu={},Am=class{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){let r=this.injector.get(t,Mu,i);return r!==Mu||e===Mu?r:this.parentInjector.get(t,e,i)}};function db(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,o=0;if(t!==null)for(let s=0;s<t.length;s++){let a=t[s];if(typeof a=="number")o=a;else if(o==1)r=su(r,a);else if(o==2){let u=a,f=t[++s];i=su(i,u+": "+f+";")}}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function D(n,t=0){let e=oe();if(e===null)return z(n,t);let i=St();return Vb(i,e,kt(n),t)}function _g(){let n="invalid";throw new Error(n)}function $w(n,t,e,i,r){let o=i===null?null:{"":-1},s=r(n,e);if(s!==null){let a=s,u=null,f=null;for(let h of s)if(h.resolveHostDirectives!==null){[a,u,f]=h.resolveHostDirectives(s);break}XT(n,t,e,a,o,u,f)}o!==null&&i!==null&&ZT(e,i,o)}function ZT(n,t,e){let i=n.localNames=[];for(let r=0;r<t.length;r+=2){let o=e[t[r+1]];if(o==null)throw new U(-301,!1);i.push(t[r],o)}}function QT(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function XT(n,t,e,i,r,o,s){let a=i.length,u=!1;for(let b=0;b<a;b++){let v=i[b];!u&&pi(v)&&(u=!0,QT(n,e,b)),_m(Pu(e,t),n,v.type)}oM(e,n.data.length,a);for(let b=0;b<a;b++){let v=i[b];v.providersResolver&&v.providersResolver(v)}let f=!1,h=!1,m=dw(n,t,a,null);a>0&&(e.directiveToIndex=new Map);for(let b=0;b<a;b++){let v=i[b];if(e.mergedAttrs=Fa(e.mergedAttrs,v.hostAttrs),tM(n,e,t,m,v),rM(m,v,r),s!==null&&s.has(v)){let[M,I]=s.get(v);e.directiveToIndex.set(v.type,[m,M+e.directiveStart,I+e.directiveStart])}else(o===null||!o.has(v))&&e.directiveToIndex.set(v.type,m);v.contentQueries!==null&&(e.flags|=4),(v.hostBindings!==null||v.hostAttrs!==null||v.hostVars!==0)&&(e.flags|=64);let w=v.type.prototype;!f&&(w.ngOnChanges||w.ngOnInit||w.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),f=!0),!h&&(w.ngOnChanges||w.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),h=!0),m++}eM(n,e,o)}function eM(n,t,e){for(let i=t.directiveStart;i<t.directiveEnd;i++){let r=n.data[i];if(e===null||!e.has(r))fb(0,t,r,i),fb(1,t,r,i),hb(t,i,!1);else{let o=e.get(r);pb(0,t,o,i),pb(1,t,o,i),hb(t,i,!0)}}}function fb(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s;n===0?s=t.inputs??={}:s=t.outputs??={},s[o]??=[],s[o].push(i),Hw(t,o)}}function pb(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s=r[o],a;n===0?a=t.hostDirectiveInputs??={}:a=t.hostDirectiveOutputs??={},a[s]??=[],a[s].push(i,o),Hw(t,s)}}function Hw(n,t){t==="class"?n.flags|=8:t==="style"&&(n.flags|=16)}function hb(n,t,e){let{attrs:i,inputs:r,hostDirectiveInputs:o}=n;if(i===null||!e&&r===null||e&&o===null||rg(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let s=null,a=0;for(;a<i.length;){let u=i[a];if(u===0){a+=4;continue}else if(u===5){a+=2;continue}else if(typeof u=="number")break;if(!e&&r.hasOwnProperty(u)){let f=r[u];for(let h of f)if(h===t){s??=[],s.push(u,i[a+1]);break}}else if(e&&o.hasOwnProperty(u)){let f=o[u];for(let h=0;h<f.length;h+=2)if(f[h]===t){s??=[],s.push(f[h+1],i[a+1]);break}}a+=2}n.initialInputs??=[],n.initialInputs.push(s)}function tM(n,t,e,i,r){n.data[i]=r;let o=r.factory||(r.factory=cr(r.type,!0)),s=new eo(o,pi(r),D,null);n.blueprint[i]=s,e[i]=s,nM(n,t,i,dw(n,e,r.hostVars,Dt),r)}function nM(n,t,e,i,r){let o=r.hostBindings;if(o){let s=n.hostBindingOpCodes;s===null&&(s=n.hostBindingOpCodes=[]);let a=~t.index;iM(s)!=a&&s.push(a),s.push(e,i,o)}}function iM(n){let t=n.length;for(;t>0;){let e=n[--t];if(typeof e=="number"&&e<0)return e}return 0}function rM(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;pi(t)&&(e[""]=n)}}function oM(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function yg(n,t,e,i,r,o,s,a){let u=t[re],f=u.consts,h=hi(f,s),m=dd(u,n,e,i,h);return o&&$w(u,t,m,hi(f,a),r),m.mergedAttrs=Fa(m.mergedAttrs,m.attrs),m.attrs!==null&&db(m,m.attrs,!1),m.mergedAttrs!==null&&db(m,m.mergedAttrs,!0),u.queries!==null&&u.queries.elementStart(u,m),m}function bg(n,t){Ab(n,t),Fh(t)&&n.queries.elementEnd(t)}function wg(n){return pd(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function Ww(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{let e=n[Symbol.iterator](),i;for(;!(i=e.next()).done;)t(i.value)}}function pd(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function hd(n,t,e){return n[t]=e}function sM(n,t){return n[t]}function un(n,t,e){if(e===Dt)return!1;let i=n[t];return Object.is(i,e)?!1:(n[t]=e,!0)}function Eg(n,t,e,i){let r=un(n,t,e);return un(n,t+1,i)||r}function Gw(n,t,e,i,r){let o=Eg(n,t,e,i);return un(n,t+2,r)||o}function lm(n,t,e){return function i(r){let o=$i(n)?An(n.index,t):t;vg(o,5);let s=t[st],a=mb(t,s,e,r),u=i.__ngNextListenerFn__;for(;u;)a=mb(t,s,u,r)&&a,u=u.__ngNextListenerFn__;return a}}function mb(n,t,e,i){let r=ce(null);try{return Me(6,t,e),e(i)!==!1}catch(o){return xT(n,o),!1}finally{Me(7,t,e),ce(r)}}function aM(n,t,e,i,r,o,s,a){let u=ss(n),f=!1,h=null;if(!i&&u&&(h=cM(t,e,o,n.index)),h!==null){let m=h.__ngLastListenerFn__||h;m.__ngNextListenerFn__=s,h.__ngLastListenerFn__=s,f=!0}else{let m=Mn(n,e),b=i?i(m):m;gI(e,b,o,a);let v=r.listen(b,o,a);if(!lM(o)){let w=i?M=>i(Tn(M[n.index])):n.index;qw(w,t,e,o,a,v,!1)}}return f}function lM(n){return n.startsWith("animation")||n.startsWith("transition")}function cM(n,t,e,i){let r=n.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let s=r[o];if(s===e&&r[o+1]===i){let a=t[rs],u=r[o+2];return a&&a.length>u?a[u]:null}typeof s=="string"&&(o+=2)}return null}function qw(n,t,e,i,r,o,s){let a=t.firstCreatePass?$h(t):null,u=Bh(e),f=u.length;u.push(r,o),a&&a.push(i,n,f,(f+1)*(s?-1:1))}function gb(n,t,e,i,r,o){let s=t[e],a=t[re],f=a.data[e].outputs[i],m=s[f].subscribe(o);qw(n.index,a,t,r,o,m,!0)}var Rm=Symbol("BINDING");var Uu=class extends qa{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let e=Bi(t);return new no(e,this.ngModule)}};function uM(n){return Object.keys(n).map(t=>{let[e,i,r]=n[t],o={propName:e,templateName:t,isSignal:(i&td.SignalBased)!==0};return r&&(o.transform=r),o})}function dM(n){return Object.keys(n).map(t=>({propName:n[t],templateName:t}))}function fM(n,t,e){let i=t instanceof ot?t:t?.injector;return i&&n.getStandaloneInjector!==null&&(i=n.getStandaloneInjector(i)||i),i?new Am(e,i):e}function pM(n){let t=n.get(to,null);if(t===null)throw new U(407,!1);let e=n.get(Bw,null),i=n.get(ji,null);return{rendererFactory:t,sanitizer:e,changeDetectionScheduler:i,ngReflect:!1}}function hM(n,t){let e=Jw(n);return sw(t,e,e==="svg"?by:e==="math"?wy:null)}function Jw(n){return(n.selectors[0][0]||"div").toLowerCase()}var no=class extends fd{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=uM(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=dM(this.componentDef.outputs),this.cachedOutputs}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=PI(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,i,r,o,s){Me(22);let a=ce(null);try{let u=this.componentDef,f=mM(i,u,s,o),h=fM(u,r||this.ngModule,t),m=pM(h),b=m.rendererFactory.createRenderer(null,u),v=i?mT(b,i,u.encapsulation,h):hM(u,b),w=s?.some(vb)||o?.some(A=>typeof A!="function"&&A.bindings.some(vb)),M=sg(null,f,null,512|uw(u),null,null,m,b,h,null,Qb(v,h,!0));M[We]=v,_u(M);let I=null;try{let A=yg(We,M,2,"#host",()=>f.directiveRegistry,!0,0);cw(b,v,A),ps(v,M),od(f,M,A),Xm(f,A,M),bg(f,A),e!==void 0&&vM(A,this.ngContentSelectors,e),I=An(A.index,M),M[st]=I[st],gg(f,M,null)}catch(A){throw I!==null&&bm(I),bm(M),A}finally{Me(23),yu()}return new Bu(this.componentType,M,!!w)}finally{ce(a)}}};function mM(n,t,e,i){let r=n?["ng-version","20.3.7"]:kI(t.selectors[0]),o=null,s=null,a=0;if(e)for(let h of e)a+=h[Rm].requiredVars,h.create&&(h.targetIdx=0,(o??=[]).push(h)),h.update&&(h.targetIdx=0,(s??=[]).push(h));if(i)for(let h=0;h<i.length;h++){let m=i[h];if(typeof m!="function")for(let b of m.bindings){a+=b[Rm].requiredVars;let v=h+1;b.create&&(b.targetIdx=v,(o??=[]).push(b)),b.update&&(b.targetIdx=v,(s??=[]).push(b))}}let u=[t];if(i)for(let h of i){let m=typeof h=="function"?h:h.type,b=Mh(m);u.push(b)}return og(0,null,gM(o,s),1,a,u,null,null,null,[r],null)}function gM(n,t){return!n&&!t?null:e=>{if(e&1&&n)for(let i of n)i.create();if(e&2&&t)for(let i of t)i.update()}}function vb(n){let t=n[Rm].kind;return t==="input"||t==="twoWay"}var Bu=class extends Uw{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e,i){super(),this._rootLView=e,this._hasInputBindings=i,this._tNode=Da(e[re],We),this.location=gs(this._tNode,e),this.instance=An(this._tNode.index,e)[st],this.hostView=this.changeDetectorRef=new gr(e,void 0),this.componentType=t}setInput(t,e){this._hasInputBindings;let i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;let r=this._rootLView,o=ad(i,r[re],r,t,e);this.previousInputValues.set(t,e);let s=An(i.index,r);vg(s,1)}get injector(){return new Xr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function vM(n,t,e){let i=n.projection=[];for(let r=0;r<t.length;r++){let o=e[r];i.push(o!=null&&o.length?Array.from(o):null)}}var Gi=(()=>{class n{static __NG_ELEMENT_ID__=_M}return n})();function _M(){let n=St();return Yw(n,oe())}var yM=Gi,Kw=class extends yM{_lContainer;_hostTNode;_hostLView;constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return gs(this._hostTNode,this._hostLView)}get injector(){return new Xr(this._hostTNode,this._hostLView)}get parentInjector(){let t=Jm(this._hostTNode,this._hostLView);if(Nb(t)){let e=Ou(t,this._hostLView),i=Ru(t),r=e[re].data[i+8];return new Xr(r,e)}else return new Xr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let e=_b(this._lContainer);return e!==null&&e[t]||null}get length(){return this._lContainer.length-dt}createEmbeddedView(t,e,i){let r,o;typeof i=="number"?r=i:i!=null&&(r=i.index,o=i.injector);let s=Tm(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(e||{},o,s);return this.insertImpl(a,r,ja(this._hostTNode,s)),a}createComponent(t,e,i,r,o,s,a){let u=t&&!UD(t),f;if(u)f=e;else{let I=e||{};f=I.index,i=I.injector,r=I.projectableNodes,o=I.environmentInjector||I.ngModuleRef,s=I.directives,a=I.bindings}let h=u?t:new no(Bi(t)),m=i||this.parentInjector;if(!o&&h.ngModule==null){let A=(u?m:this.parentInjector).get(ot,null);A&&(o=A)}let b=Bi(h.componentType??{}),v=Tm(this._lContainer,b?.id??null),w=v?.firstChild??null,M=h.create(m,r,w,o,s,a);return this.insertImpl(M.hostView,f,ja(this._hostTNode,v)),M}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,i){let r=t._lView;if(Cy(r)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let u=r[mt],f=new Kw(u,u[In],u[mt]);f.detach(f.indexOf(t))}}let o=this._adjustIndex(e),s=this._lContainer;return cd(s,r,o,i),t.attachToViewContainerRef(),xh(cm(s),o,t),t}move(t,e){return this.insert(t,e)}indexOf(t){let e=_b(this._lContainer);return e!==null?e.indexOf(t):-1}remove(t){let e=this._adjustIndex(t,-1),i=za(this._lContainer,e);i&&(ba(cm(this._lContainer),e),id(i[re],i))}detach(t){let e=this._adjustIndex(t,-1),i=za(this._lContainer,e);return i&&ba(cm(this._lContainer),e)!=null?new gr(i):null}_adjustIndex(t,e=0){return t??this.length+e}};function _b(n){return n[xa]}function cm(n){return n[xa]||(n[xa]=[])}function Yw(n,t){let e,i=t[n.index];return Kn(i)?e=i:(e=Fw(i,t,null,n),t[n.index]=e,ag(t,e)),wM(e,t,n,i),new Kw(e,n,t)}function bM(n,t){let e=n[Ne],i=e.createComment(""),r=Mn(t,n),o=e.parentNode(r);return Lu(e,o,i,e.nextSibling(r),!1),i}var wM=SM,EM=()=>!1;function CM(n,t,e){return EM(n,t,e)}function SM(n,t,e,i){if(n[hr])return;let r;e.type&8?r=Tn(i):r=bM(t,e),n[hr]=r}var Om=class n{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},Nm=class n{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let e=t.queries;if(e!==null){let i=t.contentQueries!==null?t.contentQueries[0]:e.length,r=[];for(let o=0;o<i;o++){let s=e.getByIndex(o),a=this.queries[s.indexInDeclarationView];r.push(a.clone())}return new n(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)Cg(t,e).matches!==null&&this.queries[e].setDirty()}},$u=class{flags;read;predicate;constructor(t,e,i=null){this.flags=e,this.read=i,typeof t=="string"?this.predicate=OM(t):this.predicate=t}},Pm=class n{queries;constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){let r=e!==null?e.length:0,o=this.getByIndex(i).embeddedTView(t,r);o&&(o.indexInDeclarationView=i,e!==null?e.push(o):e=[o])}return e!==null?new n(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},km=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,e=-1){this.metadata=t,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new n(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,i=t.parent;for(;i!==null&&i.type&8&&i.index!==e;)i=i.parent;return e===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];this.matchTNodeWithReadOption(t,e,xM(e,o)),this.matchTNodeWithReadOption(t,e,Tu(e,t,o,!1,!1))}else i===vr?e.type&4&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Tu(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===xt||r===Gi||r===vr&&e.type&4)this.addMatch(e.index,-2);else{let o=Tu(e,t,r,!1,!1);o!==null&&this.addMatch(e.index,o)}else this.addMatch(e.index,i)}}addMatch(t,e){this.matches===null?this.matches=[t,e]:this.matches.push(t,e)}};function xM(n,t){let e=n.localNames;if(e!==null){for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1]}return null}function DM(n,t){return n.type&11?gs(n,t):n.type&4?ud(n,t):null}function IM(n,t,e,i){return e===-1?DM(t,n):e===-2?TM(n,t,i):La(n,n[re],e,t)}function TM(n,t,e){if(e===xt)return gs(t,n);if(e===vr)return ud(t,n);if(e===Gi)return Yw(t,n)}function Zw(n,t,e,i){let r=t[di].queries[i];if(r.matches===null){let o=n.data,s=e.matches,a=[];for(let u=0;s!==null&&u<s.length;u+=2){let f=s[u];if(f<0)a.push(null);else{let h=o[f];a.push(IM(t,h,s[u+1],e.metadata.read))}}r.matches=a}return r.matches}function Fm(n,t,e,i){let r=n.queries.getByIndex(e),o=r.matches;if(o!==null){let s=Zw(n,t,r,e);for(let a=0;a<o.length;a+=2){let u=o[a];if(u>0)i.push(s[a/2]);else{let f=o[a+1],h=t[-u];for(let m=dt;m<h.length;m++){let b=h[m];b[pr]===b[mt]&&Fm(b[re],b,f,i)}if(h[Zr]!==null){let m=h[Zr];for(let b=0;b<m.length;b++){let v=m[b];Fm(v[re],v,f,i)}}}}}return i}function MM(n,t){return n[di].queries[t].queryList}function Qw(n,t,e){let i=new ku((e&4)===4);return Dy(n,t,i,i.destroy),(t[di]??=new Nm).queries.push(new Om(i))-1}function AM(n,t,e){let i=Ge();return i.firstCreatePass&&(Xw(i,new $u(n,t,e),-1),(t&2)===2&&(i.staticViewQueries=!0)),Qw(i,oe(),t)}function RM(n,t,e,i){let r=Ge();if(r.firstCreatePass){let o=St();Xw(r,new $u(t,e,i),o.index),NM(r,n),(e&2)===2&&(r.staticContentQueries=!0)}return Qw(r,oe(),e)}function OM(n){return n.split(",").map(t=>t.trim())}function Xw(n,t,e){n.queries===null&&(n.queries=new Pm),n.queries.track(new km(t,e))}function NM(n,t){let e=n.contentQueries||(n.contentQueries=[]),i=e.length?e[e.length-1]:-1;t!==i&&e.push(n.queries.length-1,t)}function Cg(n,t){return n.queries.getByIndex(t)}function PM(n,t){let e=n[re],i=Cg(e,t);return i.crossesNgTemplate?Fm(e,n,t,[]):Zw(e,n,i,t)}var io=class{},md=class{};var Hu=class extends io{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Uu(this);constructor(t,e,i,r=!0){super(),this.ngModuleType=t,this._parent=e;let o=Th(t);this._bootstrapComponents=rw(o.bootstrap),this._r3Injector=Qh(t,e,[{provide:io,useValue:this},{provide:qa,useValue:this.componentFactoryResolver},...i],Li(t),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},Wu=class extends md{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new Hu(this.moduleType,t,[])}};var Ua=class extends io{injector;componentFactoryResolver=new Uu(this);instance=null;constructor(t){super();let e=new Wr([...t.providers,{provide:io,useValue:this},{provide:qa,useValue:this.componentFactoryResolver}],t.parent||Ea(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function ys(n,t,e=null){return new Ua({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}var kM=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let i=Ah(!1,e.type),r=i.length>0?ys([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=F({token:n,providedIn:"environment",factory:()=>new n(z(ot))})}return n})();function we(n){return $a(()=>{let t=eE(n),e=Q(N({},t),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Km.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?r=>r.get(kM).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Wi.Emulated,styles:n.styles||Zt,_:null,schemas:n.schemas||null,tView:null,id:""});t.standalone&&ti("NgStandalone"),tE(e);let i=n.dependencies;return e.directiveDefs=yb(i,FM),e.pipeDefs=yb(i,fy),e.id=VM(e),e})}function FM(n){return Bi(n)||Mh(n)}function On(n){return $a(()=>({type:n.type,bootstrap:n.bootstrap||Zt,declarations:n.declarations||Zt,imports:n.imports||Zt,exports:n.exports||Zt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function LM(n,t){if(n==null)return dr;let e={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],o,s,a,u;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o,u=r[3]||null):(o=r,s=r,a=td.None,u=null),e[o]=[i,a,u],t[o]=s}return e}function jM(n){if(n==null)return dr;let t={};for(let e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);return t}function Ce(n){return $a(()=>{let t=eE(n);return tE(t),t})}function bs(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function eE(n){let t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputConfig:n.inputs||dr,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||Zt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:LM(n.inputs,t),outputs:jM(n.outputs),debugInfo:null}}function tE(n){n.features?.forEach(t=>t(n))}function yb(n,t){return n?()=>{let e=typeof n=="function"?n():n,i=[];for(let r of e){let o=t(r);o!==null&&i.push(o)}return i}:null}function VM(n){let t=0,e=typeof n.consts=="function"?"":n.consts,i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,e,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of i.join("|"))t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function zM(n){return Object.getPrototypeOf(n.prototype).constructor}function at(n){let t=zM(n.type),e=!0,i=[n];for(;t;){let r;if(pi(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new U(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);let s=n;s.inputs=um(n.inputs),s.declaredInputs=um(n.declaredInputs),s.outputs=um(n.outputs);let a=r.hostBindings;a&&WM(n,a);let u=r.viewQuery,f=r.contentQueries;if(u&&$M(n,u),f&&HM(n,f),UM(n,r),ry(n.outputs,r.outputs),pi(r)&&r.data.animation){let h=n.data;h.animation=(h.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let s=0;s<o.length;s++){let a=o[s];a&&a.ngInherit&&a(n),a===at&&(e=!1)}}t=Object.getPrototypeOf(t)}BM(i)}function UM(n,t){for(let e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;let i=t.inputs[e];i!==void 0&&(n.inputs[e]=i,n.declaredInputs[e]=t.declaredInputs[e])}}function BM(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Fa(r.hostAttrs,e=Fa(e,r.hostAttrs))}}function um(n){return n===dr?{}:n===Zt?[]:n}function $M(n,t){let e=n.viewQuery;e?n.viewQuery=(i,r)=>{t(i,r),e(i,r)}:n.viewQuery=t}function HM(n,t){let e=n.contentQueries;e?n.contentQueries=(i,r,o)=>{t(i,r,o),e(i,r,o)}:n.contentQueries=t}function WM(n,t){let e=n.hostBindings;e?n.hostBindings=(i,r)=>{t(i,r),e(i,r)}:n.hostBindings=t}function nE(n,t,e,i,r,o,s,a){if(e.firstCreatePass){n.mergedAttrs=Fa(n.mergedAttrs,n.attrs);let h=n.tView=og(2,n,r,o,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,e.consts,null);e.queries!==null&&(e.queries.template(e,n),h.queries=e.queries.embeddedTView(n))}a&&(n.flags|=a),cs(n,!1);let u=qM(e,t,n,i);bu()&&pg(e,t,u,n),ps(u,t);let f=Fw(u,t,u,n);t[i+We]=f,ag(t,f),CM(f,n,t)}function GM(n,t,e,i,r,o,s,a,u,f,h){let m=e+We,b;return t.firstCreatePass?(b=dd(t,m,4,s||null,a||null),mu()&&$w(t,n,b,hi(t.consts,f),mg),Ab(t,b)):b=t.data[m],nE(b,n,t,e,i,r,o,u),ss(b)&&od(t,n,b),f!=null&&sd(n,b,h),b}function Gu(n,t,e,i,r,o,s,a,u,f,h){let m=e+We,b;if(t.firstCreatePass){if(b=dd(t,m,4,s||null,a||null),f!=null){let v=hi(t.consts,f);b.localNames=[];for(let w=0;w<v.length;w+=2)b.localNames.push(v[w],-1)}}else b=t.data[m];return nE(b,n,t,e,i,r,o,u),f!=null&&sd(n,b,h),b}function E(n,t,e,i,r,o,s,a){let u=oe(),f=Ge(),h=hi(f.consts,o);return GM(u,f,n,t,e,i,r,h,void 0,s,a),E}var qM=JM;function JM(n,t,e,i){return Ra(!0),t[Ne].createComment("")}var Sg=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var xg=new Y("");function _r(n){return!!n&&typeof n.then=="function"}function Dg(n){return!!n&&typeof n.subscribe=="function"}var Ig=new Y("");function gd(n){return ci([{provide:Ig,multi:!0,useValue:n}])}var Tg=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i});appInits=O(Ig,{optional:!0})??[];injector=O(Qt);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let r of this.appInits){let o=Ct(this.injector,r);if(_r(o))e.push(o);else if(Dg(o)){let s=new Promise((a,u)=>{o.subscribe({complete:a,error:u})});e.push(s)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),e.length===0&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ja=new Y("");function iE(){Fp(()=>{let n="";throw new U(600,n)})}function rE(n){return n.isBoundToModule}var KM=10;var qi=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=O(Xt);afterRenderManager=O(dg);zonelessEnabled=O(Oa);rootEffectScheduler=O(rm);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new $e;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=O(mi);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(fe(e=>!e))}constructor(){O(oo,{optional:!0})}whenStable(){let e;return new Promise(i=>{e=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{e.unsubscribe()})}_injector=O(ot);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,i){return this.bootstrapImpl(e,i)}bootstrapImpl(e,i,r=Qt.NULL){return this._injector.get(ze).run(()=>{Me(10);let s=e instanceof fd;if(!this._injector.get(Tg).done){let w="";throw new U(405,w)}let u;s?u=e:u=this._injector.get(qa).resolveComponentFactory(e),this.componentTypes.push(u.componentType);let f=rE(u)?void 0:this._injector.get(io),h=i||u.selector,m=u.create(r,[],h,f),b=m.location.nativeElement,v=m.injector.get(xg,null);return v?.registerApplication(b),m.onDestroy(()=>{this.detachView(m.hostView),ka(this.components,m),v?.unregisterApplication(b)}),this._loadComponent(m),Me(11,m),m})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Me(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(nd.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new U(101,!1);let e=ce(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,ce(e),this.afterTick.next(),Me(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(to,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<KM;)Me(14),this.synchronizeOnce(),Me(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let e=!1;if(this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!i&&!Ta(r))continue;let o=i&&!this.zonelessEnabled?0:1;Ow(r,o),e=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}e||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Ta(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){let i=e;ka(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(e),this._injector.get(Ja,[]).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ka(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new U(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ka(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function fn(n,t){let e=oe(),i=Hi();if(un(e,i,t)){let r=Ge(),o=Aa();if(ad(o,r,e,n,t))$i(o)&&Cw(e,o.index);else{let a=Mn(o,e);Sw(e[Ne],a,null,o.value,n,t,null)}}return fn}function ws(n,t,e,i){let r=oe(),o=Hi();if(un(r,o,t)){let s=Ge(),a=Aa();CT(a,r,n,t,e,i)}return ws}var nH=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var Lm=class{destroy(t){}updateValue(t,e){}swap(t,e){let i=Math.min(t,e),r=Math.max(t,e),o=this.detach(r);if(r-i>1){let s=this.detach(i);this.attach(i,o),this.attach(r,s)}else this.attach(i,o)}move(t,e){this.attach(e,this.detach(t,!0))}};function dm(n,t,e,i,r){return n===e&&Object.is(t,i)?1:Object.is(r(n,t),r(e,i))?-1:0}function YM(n,t,e){let i,r,o=0,s=n.length-1,a=void 0;if(Array.isArray(t)){let u=t.length-1;for(;o<=s&&o<=u;){let f=n.at(o),h=t[o],m=dm(o,f,o,h,e);if(m!==0){m<0&&n.updateValue(o,h),o++;continue}let b=n.at(s),v=t[u],w=dm(s,b,u,v,e);if(w!==0){w<0&&n.updateValue(s,v),s--,u--;continue}let M=e(o,f),I=e(s,b),A=e(o,h);if(Object.is(A,I)){let j=e(u,v);Object.is(j,M)?(n.swap(o,s),n.updateValue(s,v),u--,s--):n.move(s,o),n.updateValue(o,h),o++;continue}if(i??=new qu,r??=wb(n,o,s,e),jm(n,i,o,A))n.updateValue(o,h),o++,s++;else if(r.has(A))i.set(M,n.detach(o)),s--;else{let j=n.create(o,t[o]);n.attach(o,j),o++,s++}}for(;o<=u;)bb(n,i,e,o,t[o]),o++}else if(t!=null){let u=t[Symbol.iterator](),f=u.next();for(;!f.done&&o<=s;){let h=n.at(o),m=f.value,b=dm(o,h,o,m,e);if(b!==0)b<0&&n.updateValue(o,m),o++,f=u.next();else{i??=new qu,r??=wb(n,o,s,e);let v=e(o,m);if(jm(n,i,o,v))n.updateValue(o,m),o++,s++,f=u.next();else if(!r.has(v))n.attach(o,n.create(o,m)),o++,s++,f=u.next();else{let w=e(o,h);i.set(w,n.detach(o)),s--}}}for(;!f.done;)bb(n,i,e,n.length,f.value),f=u.next()}for(;o<=s;)n.destroy(n.detach(s--));i?.forEach(u=>{n.destroy(u)})}function jm(n,t,e,i){return t!==void 0&&t.has(i)?(n.attach(e,t.get(i)),t.delete(i),!0):!1}function bb(n,t,e,i,r){if(jm(n,t,i,e(i,r)))n.updateValue(i,r);else{let o=n.create(i,r);n.attach(i,o)}}function wb(n,t,e,i){let r=new Set;for(let o=t;o<=e;o++)r.add(i(o,n.at(o)));return r}var qu=class{kvMap=new Map;_vMap=void 0;has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;let e=this.kvMap.get(t);return this._vMap!==void 0&&this._vMap.has(e)?(this.kvMap.set(t,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,e){if(this.kvMap.has(t)){let i=this.kvMap.get(t);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,e)}else this.kvMap.set(t,e)}forEach(t){for(let[e,i]of this.kvMap)if(t(i,e),this._vMap!==void 0){let r=this._vMap;for(;r.has(i);)i=r.get(i),t(i,e)}}};function ee(n,t,e,i,r,o,s,a){ti("NgControlFlow");let u=oe(),f=Ge(),h=hi(f.consts,o);return Gu(u,f,n,t,e,i,r,h,256,s,a),Mg}function Mg(n,t,e,i,r,o,s,a){ti("NgControlFlow");let u=oe(),f=Ge(),h=hi(f.consts,o);return Gu(u,f,n,t,e,i,r,h,512,s,a),Mg}function te(n,t){ti("NgControlFlow");let e=oe(),i=Hi(),r=e[i]!==Dt?e[i]:-1,o=r!==-1?Ju(e,We+r):void 0,s=0;if(un(e,i,n)){let a=ce(null);try{if(o!==void 0&&jw(o,s),n!==-1){let u=We+n,f=Ju(e,u),h=Bm(e[re],u),m=zw(f,h,e),b=ld(e,h,t,{dehydratedView:m});cd(f,b,s,ja(h,m))}}finally{ce(a)}}else if(o!==void 0){let a=Lw(o,s);a!==void 0&&(a[st]=t)}}var Vm=class{lContainer;$implicit;$index;constructor(t,e,i){this.lContainer=t,this.$implicit=e,this.$index=i}get $count(){return this.lContainer.length-dt}};function Ag(n){return n}function yr(n,t){return t}var zm=class{hasEmptyBlock;trackByFn;liveCollection;constructor(t,e,i){this.hasEmptyBlock=t,this.trackByFn=e,this.liveCollection=i}};function It(n,t,e,i,r,o,s,a,u,f,h,m,b){ti("NgControlFlow");let v=oe(),w=Ge(),M=u!==void 0,I=oe(),A=a?s.bind(I[_n][st]):s,j=new zm(M,A);I[We+n]=j,Gu(v,w,n+1,t,e,i,r,hi(w.consts,o),256),M&&Gu(v,w,n+2,u,f,h,m,hi(w.consts,b),512)}var Um=class extends Lm{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(t,e,i){super(),this.lContainer=t,this.hostLView=e,this.templateTNode=i}get length(){return this.lContainer.length-dt}at(t){return this.getLView(t)[st].$implicit}attach(t,e){let i=e[is];this.needsIndexUpdate||=t!==this.length,cd(this.lContainer,e,t,ja(this.templateTNode,i))}detach(t,e){return this.needsIndexUpdate||=t!==this.length-1,e&&ZM(this.lContainer,t),QM(this.lContainer,t)}create(t,e){let i=Tm(this.lContainer,this.templateTNode.tView.ssrId),r=ld(this.hostLView,this.templateTNode,new Vm(this.lContainer,e,t),{dehydratedView:i});return this.operationsCounter?.recordCreate(),r}destroy(t){id(t[re],t),this.operationsCounter?.recordDestroy()}updateValue(t,e){this.getLView(t)[st].$implicit=e}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[st].$index=t}getLView(t){return XM(this.lContainer,t)}};function Tt(n){let t=ce(null),e=Yn();try{let i=oe(),r=i[re],o=i[e],s=e+1,a=Ju(i,s);if(o.liveCollection===void 0){let f=Bm(r,s);o.liveCollection=new Um(a,i,f)}else o.liveCollection.reset();let u=o.liveCollection;if(YM(u,n,o.trackByFn),u.updateIndexes(),o.hasEmptyBlock){let f=Hi(),h=u.length===0;if(un(i,f,h)){let m=e+2,b=Ju(i,m);if(h){let v=Bm(r,m),w=zw(b,v,i),M=ld(i,v,void 0,{dehydratedView:w});cd(b,M,0,ja(v,w))}else r.firstUpdatePass&&GT(b),jw(b,0)}}}finally{ce(t)}}function Ju(n,t){return n[t]}function ZM(n,t){if(n.length<=dt)return;let e=dt+t,i=n[e];i&&i[Yr]&&(i[Yr].skipLeaveAnimations=!0)}function QM(n,t){return za(n,t)}function XM(n,t){return Lw(n,t)}function Bm(n,t){return Da(n,t)}function _(n,t,e){let i=oe(),r=Hi();if(un(i,r,t)){let o=Ge(),s=Aa();Ew(s,i,n,t,i[Ne],e)}return _}function $m(n,t,e,i,r){ad(t,n,e,r?"class":"style",i)}function c(n,t,e,i){let r=oe(),o=r[re],s=n+We,a=o.firstCreatePass?yg(s,r,2,t,mg,mu(),e,i):o.data[s];if(xw(a,r,n,t,eA),ss(a)){let u=r[re];od(u,r,a),Xm(u,a,r)}return i!=null&&sd(r,a),c}function l(){let n=Ge(),t=St(),e=Dw(t);return n.firstCreatePass&&bg(n,e),Ry(e)&&Oy(),My(),e.classesWithoutHost!=null&&qD(e)&&$m(n,e,oe(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&JD(e)&&$m(n,e,oe(),e.stylesWithoutHost,!1),l}function P(n,t,e,i){return c(n,t,e,i),l(),P}var eA=(n,t,e,i,r)=>(Ra(!0),sw(t[Ne],i,Wy()));function Ze(n,t,e){let i=oe(),r=i[re],o=n+We,s=r.firstCreatePass?yg(o,i,8,"ng-container",mg,mu(),t,e):r.data[o];if(xw(s,i,n,"ng-container",tA),ss(s)){let a=i[re];od(a,i,s),Xm(a,s,i)}return e!=null&&sd(i,s),Ze}function Qe(){let n=Ge(),t=St(),e=Dw(t);return n.firstCreatePass&&bg(n,e),Qe}var tA=(n,t,e,i,r)=>(Ra(!0),jI(t[Ne],""));function k(){return oe()}var Su=void 0;function nA(n){let t=Math.floor(Math.abs(n)),e=n.toString().replace(/^[^.]*\.?/,"").length;return t===1&&e===0?1:5}var iA=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Su,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Su,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Su,"{1} 'at' {0}",Su],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",nA],fm={};function pn(n){let t=rA(n),e=Eb(t);if(e)return e;let i=t.split("-")[0];if(e=Eb(i),e)return e;if(i==="en")return iA;throw new U(701,!1)}function Eb(n){return n in fm||(fm[n]=zi.ng&&zi.ng.common&&zi.ng.common.locales&&zi.ng.common.locales[n]),fm[n]}var Xe=(function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n})(Xe||{});function rA(n){return n.toLowerCase().replace(/_/g,"-")}var Ka="en-US";var oA=Ka;function oE(n){typeof n=="string"&&(oA=n.toLowerCase().replace(/_/g,"-"))}function x(n,t,e){let i=oe(),r=Ge(),o=St();return sE(r,i,i[Ne],o,n,t,e),x}function sE(n,t,e,i,r,o,s){let a=!0,u=null;if((i.type&3||s)&&(u??=lm(i,t,o),aM(i,n,t,s,e,r,o,u)&&(a=!1)),a){let f=i.outputs?.[r],h=i.hostDirectiveOutputs?.[r];if(h&&h.length)for(let m=0;m<h.length;m+=2){let b=h[m],v=h[m+1];u??=lm(i,t,o),gb(i,t,b,v,r,u)}if(f&&f.length)for(let m of f)u??=lm(i,t,o),gb(i,t,m,r,r,u)}}function g(n=1){return Hy(n)}function Rg(n,t,e,i){RM(n,t,e,i)}function Ya(n,t,e){AM(n,t,e)}function so(n){let t=oe(),e=Ge(),i=Kh();vu(i+1);let r=Cg(e,i);if(n.dirty&&Ey(t)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let o=PM(t,i);n.reset(o,aI),n.notifyOnChanges()}return!0}return!1}function ao(){return MM(oe(),Kh())}function en(n){let t=ky();return Ia(t,We+n)}function xu(n,t){return n<<17|t<<2}function ro(n){return n>>17&32767}function sA(n){return(n&2)==2}function aA(n,t){return n&131071|t<<17}function Hm(n){return n|2}function ms(n){return(n&131068)>>2}function pm(n,t){return n&-131069|t<<2}function lA(n){return(n&1)===1}function Wm(n){return n|1}function cA(n,t,e,i,r,o){let s=o?t.classBindings:t.styleBindings,a=ro(s),u=ms(s);n[i]=e;let f=!1,h;if(Array.isArray(e)){let m=e;h=m[1],(h===null||ns(m,h)>0)&&(f=!0)}else h=e;if(r)if(u!==0){let b=ro(n[a+1]);n[i+1]=xu(b,a),b!==0&&(n[b+1]=pm(n[b+1],i)),n[a+1]=aA(n[a+1],i)}else n[i+1]=xu(a,0),a!==0&&(n[a+1]=pm(n[a+1],i)),a=i;else n[i+1]=xu(u,0),a===0?a=i:n[u+1]=pm(n[u+1],i),u=i;f&&(n[i+1]=Hm(n[i+1])),Cb(n,h,i,!0),Cb(n,h,i,!1),uA(t,h,n,i,o),s=xu(a,u),o?t.classBindings=s:t.styleBindings=s}function uA(n,t,e,i,r){let o=r?n.residualClasses:n.residualStyles;o!=null&&typeof t=="string"&&ns(o,t)>=0&&(e[i+1]=Wm(e[i+1]))}function Cb(n,t,e,i){let r=n[e+1],o=t===null,s=i?ro(r):ms(r),a=!1;for(;s!==0&&(a===!1||o);){let u=n[s],f=n[s+1];dA(u,t)&&(a=!0,n[s+1]=i?Wm(f):Hm(f)),s=i?ro(f):ms(f)}a&&(n[e+1]=i?Hm(r):Wm(r))}function dA(n,t){return n===null||t==null||(Array.isArray(n)?n[1]:n)===t?!0:Array.isArray(n)&&typeof t=="string"?ns(n,t)>=0:!1}var Xn={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function fA(n){return n.substring(Xn.key,Xn.keyEnd)}function pA(n){return hA(n),aE(n,lE(n,0,Xn.textEnd))}function aE(n,t){let e=Xn.textEnd;return e===t?-1:(t=Xn.keyEnd=mA(n,Xn.key=t,e),lE(n,t,e))}function hA(n){Xn.key=0,Xn.keyEnd=0,Xn.value=0,Xn.valueEnd=0,Xn.textEnd=n.length}function lE(n,t,e){for(;t<e&&n.charCodeAt(t)<=32;)t++;return t}function mA(n,t,e){for(;t<e&&n.charCodeAt(t)>32;)t++;return t}function vi(n,t,e){return cE(n,t,e,!1),vi}function Se(n,t){return cE(n,t,null,!0),Se}function br(n){vA(CA,gA,n,!0)}function gA(n,t){for(let e=pA(t);e>=0;e=aE(t,e))uu(n,fA(t),!0)}function cE(n,t,e,i){let r=oe(),o=Ge(),s=Ma(2);if(o.firstUpdatePass&&dE(o,n,s,i),t!==Dt&&un(r,s,t)){let a=o.data[Yn()];fE(o,a,r,r[Ne],n,r[s+1]=xA(t,e),i,s)}}function vA(n,t,e,i){let r=Ge(),o=Ma(2);r.firstUpdatePass&&dE(r,null,o,i);let s=oe();if(e!==Dt&&un(s,o,e)){let a=r.data[Yn()];if(pE(a,i)&&!uE(r,o)){let u=i?a.classesWithoutHost:a.stylesWithoutHost;u!==null&&(e=su(u,e||"")),$m(r,a,s,e,i)}else SA(r,a,s,s[Ne],s[o+1],s[o+1]=EA(n,t,e),i,o)}}function uE(n,t){return t>=n.expandoStartIndex}function dE(n,t,e,i){let r=n.data;if(r[e+1]===null){let o=r[Yn()],s=uE(n,e);pE(o,i)&&t===null&&!s&&(t=!1),t=_A(r,o,t,i),cA(r,o,t,e,s,i)}}function _A(n,t,e,i){let r=zy(n),o=i?t.residualClasses:t.residualStyles;if(r===null)(i?t.classBindings:t.styleBindings)===0&&(e=hm(null,n,t,e,i),e=Ba(e,t.attrs,i),o=null);else{let s=t.directiveStylingLast;if(s===-1||n[s]!==r)if(e=hm(r,n,t,e,i),o===null){let u=yA(n,t,i);u!==void 0&&Array.isArray(u)&&(u=hm(null,n,t,u[1],i),u=Ba(u,t.attrs,i),bA(n,t,i,u))}else o=wA(n,t,i)}return o!==void 0&&(i?t.residualClasses=o:t.residualStyles=o),e}function yA(n,t,e){let i=e?t.classBindings:t.styleBindings;if(ms(i)!==0)return n[ro(i)]}function bA(n,t,e,i){let r=e?t.classBindings:t.styleBindings;n[ro(r)]=i}function wA(n,t,e){let i,r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++){let s=n[o].hostAttrs;i=Ba(i,s,e)}return Ba(i,t.attrs,e)}function hm(n,t,e,i,r){let o=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(o=t[a],i=Ba(i,o.hostAttrs,r),o!==n);)a++;return n!==null&&(e.directiveStylingLast=a),i}function Ba(n,t,e){let i=e?1:2,r=-1;if(t!==null)for(let o=0;o<t.length;o++){let s=t[o];typeof s=="number"?r=s:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),uu(n,s,e?!0:t[++o]))}return n===void 0?null:n}function EA(n,t,e){if(e==null||e==="")return Zt;let i=[],r=_s(e);if(Array.isArray(r))for(let o=0;o<r.length;o++)n(i,r[o],!0);else if(typeof r=="object")for(let o in r)r.hasOwnProperty(o)&&n(i,o,r[o]);else typeof r=="string"&&t(i,r);return i}function CA(n,t,e){let i=String(t);i!==""&&!i.includes(" ")&&uu(n,i,e)}function SA(n,t,e,i,r,o,s,a){r===Dt&&(r=Zt);let u=0,f=0,h=0<r.length?r[0]:null,m=0<o.length?o[0]:null;for(;h!==null||m!==null;){let b=u<r.length?r[u+1]:void 0,v=f<o.length?o[f+1]:void 0,w=null,M;h===m?(u+=2,f+=2,b!==v&&(w=m,M=v)):m===null||h!==null&&h<m?(u+=2,w=h):(f+=2,w=m,M=v),w!==null&&fE(n,t,e,i,w,M,s,a),h=u<r.length?r[u]:null,m=f<o.length?o[f]:null}}function fE(n,t,e,i,r,o,s,a){if(!(t.type&3))return;let u=n.data,f=u[a+1],h=lA(f)?Sb(u,t,e,r,ms(f),s):void 0;if(!Ku(h)){Ku(o)||sA(f)&&(o=Sb(u,null,e,r,a,s));let m=Lh(Yn(),e);hT(i,s,m,r,o)}}function Sb(n,t,e,i,r,o){let s=t===null,a;for(;r>0;){let u=n[r],f=Array.isArray(u),h=f?u[1]:u,m=h===null,b=e[r+1];b===Dt&&(b=m?Zt:void 0);let v=m?du(b,i):h===i?b:void 0;if(f&&!Ku(v)&&(v=du(u,i)),Ku(v)&&(a=v,s))return a;let w=n[r+1];r=s?ro(w):ms(w)}if(t!==null){let u=o?t.residualClasses:t.residualStyles;u!=null&&(a=du(u,i))}return a}function Ku(n){return n!==void 0}function xA(n,t){return n==null||n===""||(typeof t=="string"?n=n+t:typeof n=="object"&&(n=Li(_s(n)))),n}function pE(n,t){return(n.flags&(t?8:16))!==0}function d(n,t=""){let e=oe(),i=Ge(),r=n+We,o=i.firstCreatePass?dd(i,r,1,t,null):i.data[r],s=DA(i,e,o,t,n);e[r]=s,bu()&&pg(i,e,s,o),cs(o,!1)}var DA=(n,t,e,i,r)=>(Ra(!0),FI(t[Ne],i));function hE(n,t,e,i=""){return un(n,Hi(),e)?t+qn(e)+i:Dt}function IA(n,t,e,i,r,o=""){let s=Jh(),a=Eg(n,s,e,r);return Ma(2),a?t+qn(e)+i+qn(r)+o:Dt}function TA(n,t,e,i,r,o,s,a=""){let u=Jh(),f=Gw(n,u,e,r,s);return Ma(3),f?t+qn(e)+i+qn(r)+o+qn(s)+a:Dt}function T(n){return R("",n),T}function R(n,t,e){let i=oe(),r=hE(i,n,t,e);return r!==Dt&&Og(i,Yn(),r),R}function ve(n,t,e,i,r){let o=oe(),s=IA(o,n,t,e,i,r);return s!==Dt&&Og(o,Yn(),s),ve}function vd(n,t,e,i,r,o,s){let a=oe(),u=TA(a,n,t,e,i,r,o,s);return u!==Dt&&Og(a,Yn(),u),vd}function Og(n,t,e){let i=Lh(t,n);LI(n[Ne],i,e)}function H(n,t,e){tm(t)&&(t=t());let i=oe(),r=Hi();if(un(i,r,t)){let o=Ge(),s=Aa();Ew(s,i,n,t,i[Ne],e)}return H}function G(n,t){let e=tm(n);return e&&n.set(t),e}function W(n,t){let e=oe(),i=Ge(),r=St();return sE(i,e,e[Ne],r,n,t),W}function _i(n){return un(oe(),Hi(),n)?qn(n):Dt}function Za(n,t,e=""){return hE(oe(),n,t,e)}function MA(n,t,e){let i=Ge();if(i.firstCreatePass){let r=pi(n);Gm(e,i.data,i.blueprint,r,!0),Gm(t,i.data,i.blueprint,r,!1)}}function Gm(n,t,e,i,r){if(n=kt(n),Array.isArray(n))for(let o=0;o<n.length;o++)Gm(n[o],t,e,i,r);else{let o=Ge(),s=oe(),a=St(),u=Hr(n)?n:kt(n.provide),f=Oh(n),h=a.providerIndexes&1048575,m=a.directiveStart,b=a.providerIndexes>>20;if(Hr(n)||!n.multi){let v=new eo(f,r,D,null),w=gm(u,t,r?h:h+b,m);w===-1?(_m(Pu(a,s),o,u),mm(o,n,t.length),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(v),s.push(v)):(e[w]=v,s[w]=v)}else{let v=gm(u,t,h+b,m),w=gm(u,t,h,h+b),M=v>=0&&e[v],I=w>=0&&e[w];if(r&&!I||!r&&!M){_m(Pu(a,s),o,u);let A=OA(r?RA:AA,e.length,r,i,f,n);!r&&I&&(e[w].providerFactory=A),mm(o,n,t.length,0),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),e.push(A),s.push(A)}else{let A=mE(e[r?w:v],f,!r&&i);mm(o,n,v>-1?v:w,A)}!r&&i&&I&&e[w].componentProviders++}}}function mm(n,t,e,i){let r=Hr(t),o=vy(t);if(r||o){let u=(o?kt(t.useClass):t).prototype.ngOnDestroy;if(u){let f=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){let h=f.indexOf(e);h===-1?f.push(e,[i,u]):f[h+1].push(i,u)}else f.push(e,u)}}}function mE(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function gm(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function AA(n,t,e,i,r){return qm(this.multi,[])}function RA(n,t,e,i,r){let o=this.multi,s;if(this.providerFactory){let a=this.providerFactory.componentProviders,u=La(i,i[re],this.providerFactory.index,r);s=u.slice(0,a),qm(o,s);for(let f=a;f<u.length;f++)s.push(u[f])}else s=[],qm(o,s);return s}function qm(n,t){for(let e=0;e<n.length;e++){let i=n[e];t.push(i())}return t}function OA(n,t,e,i,r,o){let s=new eo(n,e,D,null);return s.multi=[],s.index=t,s.componentProviders=0,mE(s,r,i&&!e),s}function Ut(n,t=[]){return e=>{e.providersResolver=(i,r)=>MA(i,r?r(n):n,t)}}function Ue(n,t,e){let i=us()+n,r=oe();return r[i]===Dt?hd(r,i,e?t.call(e):t()):sM(r,i)}function Ng(n,t,e,i){return gE(oe(),us(),n,t,e,i)}function Pg(n,t){let e=n[t];return e===Dt?void 0:e}function gE(n,t,e,i,r,o){let s=t+e;return un(n,s,r)?hd(n,s+1,o?i.call(o,r):i(r)):Pg(n,s+1)}function NA(n,t,e,i,r,o,s){let a=t+e;return Eg(n,a,r,o)?hd(n,a+2,s?i.call(s,r,o):i(r,o)):Pg(n,a+2)}function PA(n,t,e,i,r,o,s,a){let u=t+e;return Gw(n,u,r,o,s)?hd(n,u+3,a?i.call(a,r,o,s):i(r,o,s)):Pg(n,u+3)}function Z(n,t){let e=Ge(),i,r=n+We;e.firstCreatePass?(i=kA(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];let o=i.factory||(i.factory=cr(i.type,!0)),s,a=Yt(D);try{let u=Nu(!1),f=o();return Nu(u),jh(e,oe(),r,f),f}finally{Yt(a)}}function kA(n,t){if(t)for(let e=t.length-1;e>=0;e--){let i=t[e];if(n===i.name)return i}}function Ji(n,t,e){let i=n+We,r=oe(),o=Ia(r,i);return kg(r,i)?gE(r,us(),t,o.transform,e,o):o.transform(e)}function X(n,t,e,i){let r=n+We,o=oe(),s=Ia(o,r);return kg(o,r)?NA(o,us(),t,s.transform,e,i,s):s.transform(e,i)}function Qa(n,t,e,i,r){let o=n+We,s=oe(),a=Ia(s,o);return kg(s,o)?PA(s,us(),t,a.transform,e,i,r,a):a.transform(e,i,r)}function kg(n,t){return n[re].data[t].pure}function wn(n,t){return ud(n,t)}var Yu=class{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}},Fg=(()=>{class n{compileModuleSync(e){return new Wu(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let i=this.compileModuleSync(e),r=Th(e),o=rw(r.declarations).reduce((s,a)=>{let u=Bi(a);return u&&s.push(new no(u)),s},[]);return new Yu(i,o)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var FA=(()=>{class n{zone=O(ze);changeDetectionScheduler=O(ji);applicationRef=O(qi);applicationErrorHandler=O(Xt);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(e){this.applicationErrorHandler(e)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),vE=new Y("",{factory:()=>!1});function Lg({ngZoneFactory:n,ignoreChangesOutsideZone:t,scheduleInRootZone:e}){return n??=()=>new ze(Q(N({},Vg()),{scheduleInRootZone:e})),[{provide:ze,useFactory:n},{provide:Ui,multi:!0,useFactory:()=>{let i=O(FA,{optional:!0});return()=>i.initialize()}},{provide:Ui,multi:!0,useFactory:()=>{let i=O(LA);return()=>{i.initialize()}}},t===!0?{provide:nm,useValue:!0}:[],{provide:im,useValue:e??pw},{provide:Xt,useFactory:()=>{let i=O(ze),r=O(ot),o;return s=>{i.runOutsideAngular(()=>{r.destroyed&&!o?setTimeout(()=>{throw s}):(o??=r.get(Gn),o.handleError(s))})}}}]}function jg(n){let t=n?.ignoreChangesOutsideZone,e=n?.scheduleInRootZone,i=Lg({ngZoneFactory:()=>{let r=Vg(n);return r.scheduleInRootZone=e,r.shouldCoalesceEventChangeDetection&&ti("NgZone_CoalesceEvent"),new ze(r)},ignoreChangesOutsideZone:t,scheduleInRootZone:e});return ci([{provide:vE,useValue:!0},{provide:Oa,useValue:!1},i])}function Vg(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var LA=(()=>{class n{subscription=new Ye;initialized=!1;zone=O(ze);pendingTasks=O(mi);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ze.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ze.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var _E=(()=>{class n{applicationErrorHandler=O(Xt);appRef=O(qi);taskService=O(mi);ngZone=O(ze);zonelessEnabled=O(Oa);tracing=O(oo,{optional:!0});disableScheduling=O(nm,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Ye;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(ju):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(O(im,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Vu||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let i=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,i=!0;break}case 12:{this.appRef.dirtyFlags|=16,i=!0;break}case 13:{this.appRef.dirtyFlags|=2,i=!0;break}case 11:{i=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;let r=this.useMicrotaskScheduler?ob:hw;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(ju+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(e),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,ob(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function jA(){return typeof $localize<"u"&&$localize.locale||Ka}var lo=new Y("",{providedIn:"root",factory:()=>O(lo,{optional:!0,skipSelf:!0})||jA()});function vt(n){return ty(n)}function co(n,t){return Cc(n,t?.equal)}var yE=class{[zt];constructor(t){this[zt]=t}destroy(){this[zt].destroy()}};var DE=Symbol("InputSignalNode#UNSET"),YA=Q(N({},Sc),{transformFn:void 0,applyValueToInputSignal(n,t){Ho(n,t)}});function IE(n,t){let e=Object.create(YA);e.value=n,e.transformFn=t?.transform;function i(){if(Uo(e),e.value===DE){let r=null;throw new U(-950,r)}return e.value}return i[zt]=e,i}var yd=class{attributeName;constructor(t){this.attributeName=t}__NG_ELEMENT_ID__=()=>Ha(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},ZA=new Y("");ZA.__NG_ELEMENT_ID__=n=>{let t=St();if(t===null)throw new U(204,!1);if(t.type&2)return t.value;if(n&8)return null;throw new U(204,!1)};function bE(n,t){return IE(n,t)}function QA(n){return IE(DE,n)}var TE=(bE.required=QA,bE);var zg=new Y(""),XA=new Y("");function Xa(n){return!n.moduleRef}function eR(n){let t=Xa(n)?n.r3Injector:n.moduleRef.injector,e=t.get(ze);return e.run(()=>{Xa(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=t.get(Xt),r;if(e.runOutsideAngular(()=>{r=e.onError.subscribe({next:i})}),Xa(n)){let o=()=>t.destroy(),s=n.platformInjector.get(zg);s.add(o),t.onDestroy(()=>{r.unsubscribe(),s.delete(o)})}else{let o=()=>n.moduleRef.destroy(),s=n.platformInjector.get(zg);s.add(o),n.moduleRef.onDestroy(()=>{ka(n.allPlatformModules,n.moduleRef),r.unsubscribe(),s.delete(o)})}return nR(i,e,()=>{let o=t.get(mi),s=o.add(),a=t.get(Tg);return a.runInitializers(),a.donePromise.then(()=>{let u=t.get(lo,Ka);if(oE(u||Ka),!t.get(XA,!0))return Xa(n)?t.get(qi):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Xa(n)){let h=t.get(qi);return n.rootComponent!==void 0&&h.bootstrap(n.rootComponent),h}else return tR?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>void o.remove(s))})})}var tR;function nR(n,t,e){try{let i=e();return _r(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n(i)),i}}var _d=null;function iR(n=[],t){return Qt.create({name:t,providers:[{provide:wa,useValue:"platform"},{provide:zg,useValue:new Set([()=>_d=null])},...n]})}function rR(n=[]){if(_d)return _d;let t=iR(n);return _d=t,iE(),oR(t),t}function oR(n){let t=n.get(Qu,null);Ct(n,()=>{t?.forEach(e=>e())})}var Ki=(()=>{class n{static __NG_ELEMENT_ID__=sR}return n})();function sR(n){return aR(St(),oe(),(n&16)===16)}function aR(n,t,e){if($i(n)&&!e){let i=An(n.index,t);return new gr(i,i)}else if(n.type&175){let i=t[_n];return new gr(i,t)}return null}var Ug=class{constructor(){}supports(t){return wg(t)}create(t){return new Bg(t)}},lR=(n,t)=>t,Bg=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||lR}forEachItem(t){let e;for(e=this._itHead;e!==null;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,o=null;for(;e||i;){let s=!i||e&&e.currentIndex<wE(i,r,o)?e:i,a=wE(s,r,o),u=s.currentIndex;if(s===i)r--,i=i._nextRemoved;else if(e=e._next,s.previousIndex==null)r++;else{o||(o=[]);let f=a-r,h=u-r;if(f!=h){for(let b=0;b<f;b++){let v=b<o.length?o[b]:o[b]=0,w=v+b;h<=w&&w<f&&(o[b]=v+1)}let m=s.previousIndex;o[m]=h-f}}a!==u&&t(s,a,u)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)t(e)}diff(t){if(t==null&&(t=[]),!wg(t))throw new U(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._itHead,i=!1,r,o,s;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,o,s,a),i=!0):(i&&(e=this._verifyReinsertion(e,o,s,a)),Object.is(e.item,o)||this._addIdentityChange(e,o)),e=e._next}else r=0,Ww(t,a=>{s=this._trackByFn(r,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,r),i=!0):(i&&(e=this._verifyReinsertion(e,a,s,r)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let o;return t===null?o=this._itTail:(o=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,r)):(t=this._linkedRecords===null?null:this._linkedRecords.get(i,r),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,r)):t=this._addAfter(new $g(e,i),o,r)),t}_verifyReinsertion(t,e,i,r){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null);return o!==null?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;t!==null;){let e=t._next;this._addToRemovals(this._unlink(t)),t=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let r=t._prevRemoved,o=t._nextRemoved;return r===null?this._removalsHead=o:r._nextRemoved=o,o===null?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){let r=e===null?this._itHead:e._next;return t._next=r,t._prev=e,r===null?this._itTail=t:r._prev=t,e===null?this._itHead=t:e._next=t,this._linkedRecords===null&&(this._linkedRecords=new bd),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let e=t._prev,i=t._next;return e===null?this._itHead=i:e._next=i,i===null?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new bd),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},$g=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,e){this.item=t,this.trackById=e}},Hg=class{_head=null;_tail=null;add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;i!==null;i=i._nextDup)if((e===null||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){let e=t._prevDup,i=t._nextDup;return e===null?this._head=i:e._nextDup=i,i===null?this._tail=e:i._prevDup=e,this._head===null}},bd=class{map=new Map;put(t){let e=t.trackById,i=this.map.get(e);i||(i=new Hg,this.map.set(e,i)),i.add(t)}get(t,e){let i=t,r=this.map.get(i);return r?r.get(t,e):null}remove(t){let e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function wE(n,t,e){let i=n.previousIndex;if(i===null)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}var Wg=class{constructor(){}supports(t){return t instanceof Map||pd(t)}create(){return new Gg}},Gg=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(t){let e;for(e=this._mapHead;e!==null;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;e!==null;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;e!==null;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)t(e)}diff(t){if(!t)t=new Map;else if(!(t instanceof Map||pd(t)))throw new U(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{let o=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,o)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;i!==null;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){let i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){let r=this._records.get(t);this._maybeAddToChanges(r,e);let o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}let i=new qg(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;t!==null;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;t!=null;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){this._additionsHead===null?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){this._changesHead===null?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}},qg=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(t){this.key=t}};function EE(){return new Jg([new Ug])}var Jg=(()=>{class n{factories;static \u0275prov=F({token:n,providedIn:"root",factory:EE});constructor(e){this.factories=e}static create(e,i){if(i!=null){let r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:()=>{let i=O(n,{optional:!0,skipSelf:!0});return n.create(e,i||EE())}}}find(e){let i=this.factories.find(r=>r.supports(e));if(i!=null)return i;throw new U(901,!1)}}return n})();function CE(){return new Kg([new Wg])}var Kg=(()=>{class n{static \u0275prov=F({token:n,providedIn:"root",factory:CE});factories;constructor(e){this.factories=e}static create(e,i){if(i){let r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:()=>{let i=O(n,{optional:!0,skipSelf:!0});return n.create(e,i||CE())}}}find(e){let i=this.factories.find(r=>r.supports(e));if(i)return i;throw new U(901,!1)}}return n})();function ME(n){let{rootComponent:t,appProviders:e,platformProviders:i,platformRef:r}=n;Me(8);try{let o=r?.injector??rR(i),s=[Lg({}),{provide:ji,useExisting:_E},qy,...e||[]],a=new Ua({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return eR({r3Injector:a.injector,platformInjector:o,rootComponent:t})}catch(o){return Promise.reject(o)}finally{Me(9)}}function uo(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function AE(n){let t=Bi(n);if(!t)return null;let e=new no(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var NE=null;function Nn(){return NE}function Yg(n){NE??=n}var el=class{},tl=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(PE),providedIn:"platform"})}return n})(),Zg=new Y(""),PE=(()=>{class n extends tl{_location;_history;_doc=O(qe);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Nn().getBaseHref(this._doc)}onPopState(e){let i=Nn().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){let i=Nn().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function wd(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function RE(n){let t=n.search(/#|\?|$/);return n[t-1]==="/"?n.slice(0,t-1)+n.slice(t):n}function ni(n){return n&&n[0]!=="?"?`?${n}`:n}var En=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(Cd),providedIn:"root"})}return n})(),Ed=new Y(""),Cd=(()=>{class n extends En{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??O(qe).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return wd(this._baseHref,e)}path(e=!1){let i=this._platformLocation.pathname+ni(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,o){let s=this.prepareExternalUrl(r+ni(o));this._platformLocation.pushState(e,i,s)}replaceState(e,i,r,o){let s=this.prepareExternalUrl(r+ni(o));this._platformLocation.replaceState(e,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(z(tl),z(Ed,8))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wr=(()=>{class n{_subject=new $e;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let i=this._locationStrategy.getBaseHref();this._basePath=dR(RE(OE(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+ni(i))}normalize(e){return n.stripTrailingSlash(uR(this._basePath,OE(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ni(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ni(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=ni;static joinWithSlash=wd;static stripTrailingSlash=RE;static \u0275fac=function(i){return new(i||n)(z(En))};static \u0275prov=F({token:n,factory:()=>cR(),providedIn:"root"})}return n})();function cR(){return new wr(z(En))}function uR(n,t){if(!n||!t.startsWith(n))return t;let e=t.substring(n.length);return e===""||["/",";","?","#"].includes(e[0])?e:t}function OE(n){return n.replace(/\/index.html$/,"")}function dR(n){if(new RegExp("^(https?:)?//").test(n)){let[,e]=n.split(/\/\/[^\/]+/);return e}return n}var sl=(()=>{class n extends En{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(e){let i=wd(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,o){let s=this.prepareExternalUrl(r+ni(o))||this._platformLocation.pathname;this._platformLocation.pushState(e,i,s)}replaceState(e,i,r,o){let s=this.prepareExternalUrl(r+ni(o))||this._platformLocation.pathname;this._platformLocation.replaceState(e,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(z(tl),z(Ed,8))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();var Nd=(function(n){return n[n.Decimal=0]="Decimal",n[n.Percent=1]="Percent",n[n.Currency=2]="Currency",n[n.Scientific=3]="Scientific",n})(Nd||{});var Bt=(function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n})(Bt||{}),Ae=(function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n})(Ae||{}),hn=(function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n})(hn||{}),Mt={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function zE(n){return pn(n)[Xe.LocaleId]}function UE(n,t,e){let i=pn(n),r=[i[Xe.DayPeriodsFormat],i[Xe.DayPeriodsStandalone]],o=kn(r,t);return kn(o,e)}function BE(n,t,e){let i=pn(n),r=[i[Xe.DaysFormat],i[Xe.DaysStandalone]],o=kn(r,t);return kn(o,e)}function $E(n,t,e){let i=pn(n),r=[i[Xe.MonthsFormat],i[Xe.MonthsStandalone]],o=kn(r,t);return kn(o,e)}function HE(n,t){let i=pn(n)[Xe.Eras];return kn(i,t)}function nl(n,t){let e=pn(n);return kn(e[Xe.DateFormat],t)}function il(n,t){let e=pn(n);return kn(e[Xe.TimeFormat],t)}function rl(n,t){let i=pn(n)[Xe.DateTimeFormat];return kn(i,t)}function Pn(n,t){let e=pn(n),i=e[Xe.NumberSymbols][t];if(typeof i>"u"){if(t===Mt.CurrencyDecimal)return e[Xe.NumberSymbols][Mt.Decimal];if(t===Mt.CurrencyGroup)return e[Xe.NumberSymbols][Mt.Group]}return i}function r0(n,t){return pn(n)[Xe.NumberFormats][t]}function WE(n){if(!n[Xe.ExtraData])throw new U(2303,!1)}function GE(n){let t=pn(n);return WE(t),(t[Xe.ExtraData][2]||[]).map(i=>typeof i=="string"?Qg(i):[Qg(i[0]),Qg(i[1])])}function qE(n,t,e){let i=pn(n);WE(i);let r=[i[Xe.ExtraData][0],i[Xe.ExtraData][1]],o=kn(r,t)||[];return kn(o,e)||[]}function kn(n,t){for(let e=t;e>-1;e--)if(typeof n[e]<"u")return n[e];throw new U(2304,!1)}function Qg(n){let[t,e]=n.split(":");return{hours:+t,minutes:+e}}var fR=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Sd={},pR=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function JE(n,t,e,i){let r=ER(n);t=Yi(e,t)||t;let s=[],a;for(;t;)if(a=pR.exec(t),a){s=s.concat(a.slice(1));let h=s.pop();if(!h)break;t=h}else{s.push(t);break}let u=r.getTimezoneOffset();i&&(u=YE(i,u),r=wR(r,i));let f="";return s.forEach(h=>{let m=yR(h);f+=m?m(r,e,u):h==="''"?"'":h.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),f}function Md(n,t,e){let i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Yi(n,t){let e=zE(n);if(Sd[e]??={},Sd[e][t])return Sd[e][t];let i="";switch(t){case"shortDate":i=nl(n,hn.Short);break;case"mediumDate":i=nl(n,hn.Medium);break;case"longDate":i=nl(n,hn.Long);break;case"fullDate":i=nl(n,hn.Full);break;case"shortTime":i=il(n,hn.Short);break;case"mediumTime":i=il(n,hn.Medium);break;case"longTime":i=il(n,hn.Long);break;case"fullTime":i=il(n,hn.Full);break;case"short":let r=Yi(n,"shortTime"),o=Yi(n,"shortDate");i=xd(rl(n,hn.Short),[r,o]);break;case"medium":let s=Yi(n,"mediumTime"),a=Yi(n,"mediumDate");i=xd(rl(n,hn.Medium),[s,a]);break;case"long":let u=Yi(n,"longTime"),f=Yi(n,"longDate");i=xd(rl(n,hn.Long),[u,f]);break;case"full":let h=Yi(n,"fullTime"),m=Yi(n,"fullDate");i=xd(rl(n,hn.Full),[h,m]);break}return i&&(Sd[e][t]=i),i}function xd(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return t!=null&&i in t?t[i]:e})),n}function ii(n,t,e="-",i,r){let o="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,o=e));let s=String(n);for(;s.length<t;)s="0"+s;return i&&(s=s.slice(s.length-t)),o+s}function hR(n,t){return ii(n,3).substring(0,t)}function ft(n,t,e=0,i=!1,r=!1){return function(o,s){let a=mR(n,o);if((e>0||a>-e)&&(a+=e),n===3)a===0&&e===-12&&(a=12);else if(n===6)return hR(a,t);let u=Pn(s,Mt.MinusSign);return ii(a,t,u,i,r)}}function mR(n,t){switch(n){case 0:return t.getFullYear();case 1:return t.getMonth();case 2:return t.getDate();case 3:return t.getHours();case 4:return t.getMinutes();case 5:return t.getSeconds();case 6:return t.getMilliseconds();case 7:return t.getDay();default:throw new U(2301,!1)}}function ke(n,t,e=Bt.Format,i=!1){return function(r,o){return gR(r,o,n,t,e,i)}}function gR(n,t,e,i,r,o){switch(e){case 2:return $E(t,r,i)[n.getMonth()];case 1:return BE(t,r,i)[n.getDay()];case 0:let s=n.getHours(),a=n.getMinutes();if(o){let f=GE(t),h=qE(t,r,i),m=f.findIndex(b=>{if(Array.isArray(b)){let[v,w]=b,M=s>=v.hours&&a>=v.minutes,I=s<w.hours||s===w.hours&&a<w.minutes;if(v.hours<w.hours){if(M&&I)return!0}else if(M||I)return!0}else if(b.hours===s&&b.minutes===a)return!0;return!1});if(m!==-1)return h[m]}return UE(t,r,i)[s<12?0:1];case 3:return HE(t,i)[n.getFullYear()<=0?0:1];default:let u=e;throw new U(2302,!1)}}function Dd(n){return function(t,e,i){let r=-1*i,o=Pn(e,Mt.MinusSign),s=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case 0:return(r>=0?"+":"")+ii(s,2,o)+ii(Math.abs(r%60),2,o);case 1:return"GMT"+(r>=0?"+":"")+ii(s,1,o);case 2:return"GMT"+(r>=0?"+":"")+ii(s,2,o)+":"+ii(Math.abs(r%60),2,o);case 3:return i===0?"Z":(r>=0?"+":"")+ii(s,2,o)+":"+ii(Math.abs(r%60),2,o);default:throw new U(2310,!1)}}}var vR=0,Td=4;function _R(n){let t=Md(n,vR,1).getDay();return Md(n,0,1+(t<=Td?Td:Td+7)-t)}function KE(n){let t=n.getDay(),e=t===0?-3:Td-t;return Md(n.getFullYear(),n.getMonth(),n.getDate()+e)}function Xg(n,t=!1){return function(e,i){let r;if(t){let o=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();r=1+Math.floor((s+o)/7)}else{let o=KE(e),s=_R(o.getFullYear()),a=o.getTime()-s.getTime();r=1+Math.round(a/6048e5)}return ii(r,n,Pn(i,Mt.MinusSign))}}function Id(n,t=!1){return function(e,i){let o=KE(e).getFullYear();return ii(o,n,Pn(i,Mt.MinusSign),t)}}var e0={};function yR(n){if(e0[n])return e0[n];let t;switch(n){case"G":case"GG":case"GGG":t=ke(3,Ae.Abbreviated);break;case"GGGG":t=ke(3,Ae.Wide);break;case"GGGGG":t=ke(3,Ae.Narrow);break;case"y":t=ft(0,1,0,!1,!0);break;case"yy":t=ft(0,2,0,!0,!0);break;case"yyy":t=ft(0,3,0,!1,!0);break;case"yyyy":t=ft(0,4,0,!1,!0);break;case"Y":t=Id(1);break;case"YY":t=Id(2,!0);break;case"YYY":t=Id(3);break;case"YYYY":t=Id(4);break;case"M":case"L":t=ft(1,1,1);break;case"MM":case"LL":t=ft(1,2,1);break;case"MMM":t=ke(2,Ae.Abbreviated);break;case"MMMM":t=ke(2,Ae.Wide);break;case"MMMMM":t=ke(2,Ae.Narrow);break;case"LLL":t=ke(2,Ae.Abbreviated,Bt.Standalone);break;case"LLLL":t=ke(2,Ae.Wide,Bt.Standalone);break;case"LLLLL":t=ke(2,Ae.Narrow,Bt.Standalone);break;case"w":t=Xg(1);break;case"ww":t=Xg(2);break;case"W":t=Xg(1,!0);break;case"d":t=ft(2,1);break;case"dd":t=ft(2,2);break;case"c":case"cc":t=ft(7,1);break;case"ccc":t=ke(1,Ae.Abbreviated,Bt.Standalone);break;case"cccc":t=ke(1,Ae.Wide,Bt.Standalone);break;case"ccccc":t=ke(1,Ae.Narrow,Bt.Standalone);break;case"cccccc":t=ke(1,Ae.Short,Bt.Standalone);break;case"E":case"EE":case"EEE":t=ke(1,Ae.Abbreviated);break;case"EEEE":t=ke(1,Ae.Wide);break;case"EEEEE":t=ke(1,Ae.Narrow);break;case"EEEEEE":t=ke(1,Ae.Short);break;case"a":case"aa":case"aaa":t=ke(0,Ae.Abbreviated);break;case"aaaa":t=ke(0,Ae.Wide);break;case"aaaaa":t=ke(0,Ae.Narrow);break;case"b":case"bb":case"bbb":t=ke(0,Ae.Abbreviated,Bt.Standalone,!0);break;case"bbbb":t=ke(0,Ae.Wide,Bt.Standalone,!0);break;case"bbbbb":t=ke(0,Ae.Narrow,Bt.Standalone,!0);break;case"B":case"BB":case"BBB":t=ke(0,Ae.Abbreviated,Bt.Format,!0);break;case"BBBB":t=ke(0,Ae.Wide,Bt.Format,!0);break;case"BBBBB":t=ke(0,Ae.Narrow,Bt.Format,!0);break;case"h":t=ft(3,1,-12);break;case"hh":t=ft(3,2,-12);break;case"H":t=ft(3,1);break;case"HH":t=ft(3,2);break;case"m":t=ft(4,1);break;case"mm":t=ft(4,2);break;case"s":t=ft(5,1);break;case"ss":t=ft(5,2);break;case"S":t=ft(6,1);break;case"SS":t=ft(6,2);break;case"SSS":t=ft(6,3);break;case"Z":case"ZZ":case"ZZZ":t=Dd(0);break;case"ZZZZZ":t=Dd(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Dd(1);break;case"OOOO":case"ZZZZ":case"zzzz":t=Dd(2);break;default:return null}return e0[n]=t,t}function YE(n,t){n=n.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function bR(n,t){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+t),n}function wR(n,t,e){let r=n.getTimezoneOffset(),o=YE(t,r);return bR(n,-1*(o-r))}function ER(n){if(kE(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,o=1,s=1]=n.split("-").map(a=>+a);return Md(r,o-1,s)}let e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(fR))return CR(i)}let t=new Date(n);if(!kE(t))throw new U(2311,!1);return t}function CR(n){let t=new Date(0),e=0,i=0,r=n[8]?t.setUTCFullYear:t.setFullYear,o=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));let s=Number(n[4]||0)-e,a=Number(n[5]||0)-i,u=Number(n[6]||0),f=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return o.call(t,s,a,u,f),t}function kE(n){return n instanceof Date&&!isNaN(n.valueOf())}var SR=/^(\d+)?\.((\d+)(-(\d+))?)?$/,FE=22,Ad=".",ol="0",xR=";",DR=",",t0="#";var IR="%";function ZE(n,t,e,i,r,o,s=!1){let a="",u=!1;if(!isFinite(n))a=Pn(e,Mt.Infinity);else{let f=MR(n);s&&(f=TR(f));let h=t.minInt,m=t.minFrac,b=t.maxFrac;if(o){let j=o.match(SR);if(j===null)throw new U(2306,!1);let V=j[1],L=j[3],se=j[5];V!=null&&(h=n0(V)),L!=null&&(m=n0(L)),se!=null?b=n0(se):L!=null&&m>b&&(b=m)}AR(f,m,b);let v=f.digits,w=f.integerLen,M=f.exponent,I=[];for(u=v.every(j=>!j);w<h;w++)v.unshift(0);for(;w<0;w++)v.unshift(0);w>0?I=v.splice(w,v.length):(I=v,v=[0]);let A=[];for(v.length>=t.lgSize&&A.unshift(v.splice(-t.lgSize,v.length).join(""));v.length>t.gSize;)A.unshift(v.splice(-t.gSize,v.length).join(""));v.length&&A.unshift(v.join("")),a=A.join(Pn(e,i)),I.length&&(a+=Pn(e,r)+I.join("")),M&&(a+=Pn(e,Mt.Exponential)+"+"+M)}return n<0&&!u?a=t.negPre+a+t.negSuf:a=t.posPre+a+t.posSuf,a}function QE(n,t,e){let i=r0(t,Nd.Percent),r=e1(i,Pn(t,Mt.MinusSign));return ZE(n,r,t,Mt.Group,Mt.Decimal,e,!0).replace(new RegExp(IR,"g"),Pn(t,Mt.PercentSign))}function XE(n,t,e){let i=r0(t,Nd.Decimal),r=e1(i,Pn(t,Mt.MinusSign));return ZE(n,r,t,Mt.Group,Mt.Decimal,e)}function e1(n,t="-"){let e={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(xR),r=i[0],o=i[1],s=r.indexOf(Ad)!==-1?r.split(Ad):[r.substring(0,r.lastIndexOf(ol)+1),r.substring(r.lastIndexOf(ol)+1)],a=s[0],u=s[1]||"";e.posPre=a.substring(0,a.indexOf(t0));for(let h=0;h<u.length;h++){let m=u.charAt(h);m===ol?e.minFrac=e.maxFrac=h+1:m===t0?e.maxFrac=h+1:e.posSuf+=m}let f=a.split(DR);if(e.gSize=f[1]?f[1].length:0,e.lgSize=f[2]||f[1]?(f[2]||f[1]).length:0,o){let h=r.length-e.posPre.length-e.posSuf.length,m=o.indexOf(t0);e.negPre=o.substring(0,m).replace(/'/g,""),e.negSuf=o.slice(m+h).replace(/'/g,"")}else e.negPre=t+e.posPre,e.negSuf=e.posSuf;return e}function TR(n){if(n.digits[0]===0)return n;let t=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(t===0?n.digits.push(0,0):t===1&&n.digits.push(0),n.integerLen+=2),n}function MR(n){let t=Math.abs(n)+"",e=0,i,r,o,s,a;for((r=t.indexOf(Ad))>-1&&(t=t.replace(Ad,"")),(o=t.search(/e/i))>0?(r<0&&(r=o),r+=+t.slice(o+1),t=t.substring(0,o)):r<0&&(r=t.length),o=0;t.charAt(o)===ol;o++);if(o===(a=t.length))i=[0],r=1;else{for(a--;t.charAt(a)===ol;)a--;for(r-=o,i=[],s=0;o<=a;o++,s++)i[s]=Number(t.charAt(o))}return r>FE&&(i=i.splice(0,FE-1),e=r-1,r=1),{digits:i,exponent:e,integerLen:r}}function AR(n,t,e){if(t>e)throw new U(2307,!1);let i=n.digits,r=i.length-n.integerLen,o=Math.min(Math.max(t,r),e),s=o+n.integerLen,a=i[s];if(s>0){i.splice(Math.max(n.integerLen,s));for(let m=s;m<i.length;m++)i[m]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,s=o+1),i[0]=0;for(let m=1;m<s;m++)i[m]=0}if(a>=5)if(s-1<0){for(let m=0;m>s;m--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[s-1]++;for(;r<Math.max(0,o);r++)i.push(0);let u=o!==0,f=t+n.integerLen,h=i.reduceRight(function(m,b,v,w){return b=b+m,w[v]=b<10?b:b-10,u&&(w[v]===0&&v>=f?w.pop():u=!1),b>=10?1:0},0);h&&(i.unshift(h),n.integerLen++)}function n0(n){let t=parseInt(n);if(isNaN(t))throw new U(2305,!1);return t}var i0=/\s+/,LE=[],o0=(()=>{class n{_ngEl;_renderer;initialClasses=LE;rawClass;stateMap=new Map;constructor(e,i){this._ngEl=e,this._renderer=i}set klass(e){this.initialClasses=e!=null?e.trim().split(i0):LE}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(i0):e}ngDoCheck(){for(let i of this.initialClasses)this._updateState(i,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let i of e)this._updateState(i,!0);else if(e!=null)for(let i of Object.keys(e))this._updateState(i,!!e[i]);this._applyStateDiff()}_updateState(e,i){let r=this.stateMap.get(e);r!==void 0?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(e,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let i=e[0],r=e[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(e,i){e=e.trim(),e.length>0&&e.split(i0).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(i){return new(i||n)(D(xt),D(dn))};static \u0275dir=Ce({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var Rd=class{$implicit;ngForOf;index;count;constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Be=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let i=this._viewContainer;e.forEachOperation((r,o,s)=>{if(r.previousIndex==null)i.createEmbeddedView(this._template,new Rd(r.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)i.remove(o===null?void 0:o);else if(o!==null){let a=i.get(o);i.move(a,s),jE(a,r)}});for(let r=0,o=i.length;r<o;r++){let a=i.get(r).context;a.index=r,a.count=o,a.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{let o=i.get(r.currentIndex);jE(o,r)})}static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(D(Gi),D(vr),D(Jg))};static \u0275dir=Ce({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function jE(n,t){n.context.$implicit=t.item}var xe=(()=>{class n{_viewContainer;_context=new Od;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,i){this._viewContainer=e,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){VE(e,!1),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){VE(e,!1),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||n)(D(Gi),D(vr))};static \u0275dir=Ce({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),Od=class{$implicit=null;ngIf=null};function VE(n,t){if(n&&!n.createEmbeddedView)throw new U(2020,!1)}var al=(()=>{class n{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){let e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){let[r,o]=e.split("."),s=r.indexOf("-")===-1?void 0:ei.DashCase;i!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,o?`${i}${o}`:i,s):this._renderer.removeStyle(this._ngEl.nativeElement,r,s)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}static \u0275fac=function(i){return new(i||n)(D(xt),D(Kg),D(dn))};static \u0275dir=Ce({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return n})();function Pd(n,t){return new U(2100,!1)}var RR="mediumDate",t1=new Y(""),n1=new Y(""),lt=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,o){if(e==null||e===""||e!==e)return null;try{let s=i??this.defaultOptions?.dateFormat??RR,a=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return JE(e,s,o||this.locale,a)}catch(s){throw Pd(n,s.message)}}static \u0275fac=function(i){return new(i||n)(D(lo,16),D(t1,24),D(n1,24))};static \u0275pipe=bs({name:"date",type:n,pure:!0})}return n})();var tn=(()=>{class n{_locale;constructor(e){this._locale=e}transform(e,i,r){if(!i1(e))return null;r||=this._locale;try{let o=r1(e);return XE(o,r,i)}catch(o){throw Pd(n,o.message)}}static \u0275fac=function(i){return new(i||n)(D(lo,16))};static \u0275pipe=bs({name:"number",type:n,pure:!0})}return n})(),ll=(()=>{class n{_locale;constructor(e){this._locale=e}transform(e,i,r){if(!i1(e))return null;r||=this._locale;try{let o=r1(e);return QE(o,r,i)}catch(o){throw Pd(n,o.message)}}static \u0275fac=function(i){return new(i||n)(D(lo,16))};static \u0275pipe=bs({name:"percent",type:n,pure:!0})}return n})();function i1(n){return!(n==null||n===""||n!==n)}function r1(n){if(typeof n=="string"&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if(typeof n!="number")throw new U(2309,!1);return n}var cl=(()=>{class n{transform(e,i,r){if(e==null)return null;if(!(typeof e=="string"||Array.isArray(e)))throw Pd(n,e);return e.slice(i,r)}static \u0275fac=function(i){return new(i||n)};static \u0275pipe=bs({name:"slice",type:n,pure:!1})}return n})();var Ee=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=On({type:n});static \u0275inj=vn({})}return n})();function ul(n,t){t=encodeURIComponent(t);for(let e of n.split(";")){let i=e.indexOf("="),[r,o]=i==-1?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}var fo=class{};var o1="browser";var s1=(()=>{class n{static \u0275prov=F({token:n,providedIn:"root",factory:()=>new s0(O(qe),window)})}return n})(),s0=class{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t,e){this.window.scrollTo(Q(N({},e),{left:t[0],top:t[1]}))}scrollToAnchor(t,e){let i=OR(this.document,t);i&&(this.scrollToElement(i,e),i.focus())}setHistoryScrollRestoration(t){try{this.window.history.scrollRestoration=t}catch{console.warn(Vi(2400,!1))}}scrollToElement(t,e){let i=t.getBoundingClientRect(),r=i.left+this.window.pageXOffset,o=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(Q(N({},e),{left:r-s[0],top:o-s[1]}))}};function OR(n,t){let e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),r=i.currentNode;for(;r;){let o=r.shadowRoot;if(o){let s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}r=i.nextNode()}}return null}var dl=class{_doc;constructor(t){this._doc=t}manager},kd=(()=>{class n extends dl{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r,o){return e.addEventListener(i,r,o),()=>this.removeEventListener(e,i,r,o)}removeEventListener(e,i,r,o){return e.removeEventListener(i,r,o)}static \u0275fac=function(i){return new(i||n)(z(qe))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),Ld=new Y(""),d0=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,i){this._zone=i,e.forEach(s=>{s.manager=this});let r=e.filter(s=>!(s instanceof kd));this._plugins=r.slice().reverse();let o=e.find(s=>s instanceof kd);o&&this._plugins.push(o)}addEventListener(e,i,r,o){return this._findPluginFor(i).addEventListener(e,i,r,o)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(o=>o.supports(e)),!i)throw new U(5101,!1);return this._eventNameToPlugin.set(e,i),i}static \u0275fac=function(i){return new(i||n)(z(Ld),z(ze))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),a0="ng-app-id";function a1(n){for(let t of n)t.remove()}function l1(n,t){let e=t.createElement("style");return e.textContent=n,e}function NR(n,t,e,i){let r=n.head?.querySelectorAll(`style[${a0}="${t}"],link[${a0}="${t}"]`);if(r)for(let o of r)o.removeAttribute(a0),o instanceof HTMLLinkElement?i.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&e.set(o.textContent,{usage:0,elements:[o]})}function c0(n,t){let e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}var f0=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(e,i,r,o={}){this.doc=e,this.appId=i,this.nonce=r,NR(e,i,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,i){for(let r of e)this.addUsage(r,this.inline,l1);i?.forEach(r=>this.addUsage(r,this.external,c0))}removeStyles(e,i){for(let r of e)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(e,i,r){let o=i.get(e);o?o.usage++:i.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,r(e,this.doc)))})}removeUsage(e,i){let r=i.get(e);r&&(r.usage--,r.usage<=0&&(a1(r.elements),i.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])a1(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[i,{elements:r}]of this.inline)r.push(this.addElement(e,l1(i,this.doc)));for(let[i,{elements:r}]of this.external)r.push(this.addElement(e,c0(i,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,i){return this.nonce&&i.setAttribute("nonce",this.nonce),e.appendChild(i)}static \u0275fac=function(i){return new(i||n)(z(qe),z(Zu),z(Xu,8),z(vs))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),l0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},p0=/%COMP%/g;var u1="%COMP%",PR=`_nghost-${u1}`,kR=`_ngcontent-${u1}`,FR=!0,LR=new Y("",{providedIn:"root",factory:()=>FR});function jR(n){return kR.replace(p0,n)}function VR(n){return PR.replace(p0,n)}function d1(n,t){return t.map(e=>e.replace(p0,n))}var h0=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,i,r,o,s,a,u,f=null,h=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=u,this.nonce=f,this.tracingService=h,this.platformIsServer=!1,this.defaultRenderer=new fl(e,s,u,this.platformIsServer,this.tracingService)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;let r=this.getOrCreateRenderer(e,i);return r instanceof Fd?r.applyToHost(e):r instanceof pl&&r.applyStyles(),r}getOrCreateRenderer(e,i){let r=this.rendererByCompId,o=r.get(i.id);if(!o){let s=this.doc,a=this.ngZone,u=this.eventManager,f=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,m=this.platformIsServer,b=this.tracingService;switch(i.encapsulation){case Wi.Emulated:o=new Fd(u,f,i,this.appId,h,s,a,m,b);break;case Wi.ShadowDom:return new u0(u,f,e,i,s,a,this.nonce,m,b);default:o=new pl(u,f,i,h,s,a,m,b);break}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(i){return new(i||n)(z(d0),z(f0),z(Zu),z(LR),z(qe),z(vs),z(ze),z(Xu),z(oo,8))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),fl=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,i,r,o){this.eventManager=t,this.doc=e,this.ngZone=i,this.platformIsServer=r,this.tracingService=o}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(l0[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(c1(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(c1(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){e.remove()}selectRootElement(t,e){let i=typeof t=="string"?this.doc.querySelector(t):t;if(!i)throw new U(-5104,!1);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;let o=l0[r];o?t.setAttributeNS(o,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){let r=l0[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(ei.DashCase|ei.Important)?t.style.setProperty(e,i,r&ei.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&ei.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t!=null&&(t[e]=i)}setValue(t,e){t.nodeValue=e}listen(t,e,i,r){if(typeof t=="string"&&(t=Nn().getGlobalEventTarget(this.doc,t),!t))throw new U(5102,!1);let o=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(t,e,o)),this.eventManager.addEventListener(t,e,o,r)}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;t(e)===!1&&e.preventDefault()}}};function c1(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var u0=class extends fl{sharedStylesHost;hostEl;shadowRoot;constructor(t,e,i,r,o,s,a,u,f){super(t,o,s,u,f),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=r.styles;h=d1(r.id,h);for(let b of h){let v=document.createElement("style");a&&v.setAttribute("nonce",a),v.textContent=b,this.shadowRoot.appendChild(v)}let m=r.getExternalStyles?.();if(m)for(let b of m){let v=c0(b,o);a&&v.setAttribute("nonce",a),this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},pl=class extends fl{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,i,r,o,s,a,u,f){super(t,o,s,a,u),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r;let h=i.styles;this.styles=f?d1(f,h):h,this.styleUrls=i.getExternalStyles?.(f)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&hs.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Fd=class extends pl{contentAttr;hostAttr;constructor(t,e,i,r,o,s,a,u,f){let h=r+"-"+i.id;super(t,e,i,o,s,a,u,f,h),this.contentAttr=jR(h),this.hostAttr=VR(h)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}};var jd=class n extends el{supportsDOMEvents=!0;static makeCurrent(){Yg(new n)}onAndCancel(t,e,i,r){return t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=zR();return e==null?null:UR(e)}resetBaseElement(){hl=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return ul(document.cookie,t)}},hl=null;function zR(){return hl=hl||document.head.querySelector("base"),hl?hl.getAttribute("href"):null}function UR(n){return new URL(n,document.baseURI).pathname}var BR=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),f1=["alt","control","meta","shift"],$R={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},HR={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},p1=(()=>{class n extends dl{constructor(e){super(e)}supports(e){return n.parseEventName(e)!=null}addEventListener(e,i,r,o){let s=n.parseEventName(i),a=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Nn().onAndCancel(e,s.domEventName,a,o))}static parseEventName(e){let i=e.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let o=n._normalizeKey(i.pop()),s="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),s="code."),f1.forEach(f=>{let h=i.indexOf(f);h>-1&&(i.splice(h,1),s+=f+".")}),s+=o,i.length!=0||o.length===0)return null;let u={};return u.domEventName=r,u.fullKey=s,u}static matchEventFullKeyCode(e,i){let r=$R[e.key]||e.key,o="";return i.indexOf("code.")>-1&&(r=e.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),f1.forEach(s=>{if(s!==r){let a=HR[s];a(e)&&(o+=s+".")}}),o+=r,o===i)}static eventCallback(e,i,r){return o=>{n.matchEventFullKeyCode(o,e)&&r.runGuarded(()=>i(o))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(i){return new(i||n)(z(qe))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();function m0(n,t,e){let i=N({rootComponent:n,platformRef:e?.platformRef},WR(t));return ME(i)}function WR(n){return{appProviders:[...YR,...n?.providers??[]],platformProviders:KR}}function GR(){jd.makeCurrent()}function qR(){return new Gn}function JR(){return Ym(document),document}var KR=[{provide:vs,useValue:o1},{provide:Qu,useValue:GR,multi:!0},{provide:qe,useFactory:JR}];var YR=[{provide:wa,useValue:"root"},{provide:Gn,useFactory:qR},{provide:Ld,useClass:kd,multi:!0,deps:[qe]},{provide:Ld,useClass:p1,multi:!0,deps:[qe]},h0,f0,d0,{provide:to,useExisting:h0},{provide:fo,useClass:BR},[]];var Ss=class{},ml=class{},yi=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(e=>{let i=e.indexOf(":");if(i>0){let r=e.slice(0,i),o=e.slice(i+1).trim();this.addHeaderEntry(r,o)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,i)=>{this.addHeaderEntry(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){let e=new n;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){let e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(t.name,e);let r=(t.op==="a"?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":let o=t.value;if(!o)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>o.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(t,e){let i=t.toLowerCase();this.maybeSetNormalizedName(t,i),this.headers.has(i)?this.headers.get(i).push(e):this.headers.set(i,[e])}setHeaderEntries(t,e){let i=(Array.isArray(e)?e:[e]).map(o=>o.toString()),r=t.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}};var zd=class{encodeKey(t){return h1(t)}encodeValue(t){return h1(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function ZR(n,t){let e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[s,a]=o==-1?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,o)),t.decodeValue(r.slice(o+1))],u=e.get(s)||[];u.push(a),e.set(s,u)}),e}var QR=/%(\d[a-f0-9])/gi,XR={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function h1(n){return encodeURIComponent(n).replace(QR,(t,e)=>XR[e]??t)}function Vd(n){return`${n}`}var Zi=class n{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new zd,t.fromString){if(t.fromObject)throw new U(2805,!1);this.map=ZR(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{let i=t.fromObject[e],r=Array.isArray(i)?i.map(Vd):[Vd(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){let e=[];return Object.keys(t).forEach(i=>{let r=t[i];Array.isArray(r)?r.forEach(o=>{e.push({param:i,value:o,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let e=new n({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let e=(t.op==="a"?this.map.get(t.param):void 0)||[];e.push(Vd(t.value)),this.map.set(t.param,e);break;case"d":if(t.value!==void 0){let i=this.map.get(t.param)||[],r=i.indexOf(Vd(t.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var Ud=class{map=new Map;set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function eO(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function m1(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function g1(n){return typeof Blob<"u"&&n instanceof Blob}function v1(n){return typeof FormData<"u"&&n instanceof FormData}function tO(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var _1="Content-Type",y1="Accept",b1="X-Request-URL",w1="text/plain",E1="application/json",nO=`${E1}, ${w1}, */*`,Es=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(t,e,i,r){this.url=e,this.method=t.toUpperCase();let o;if(eO(this.method)||r?(this.body=i!==void 0?i:null,o=r):o=i,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new U(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),this.transferCache=o.transferCache}if(this.headers??=new yi,this.context??=new Ud,!this.params)this.params=new Zi,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),u=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+u+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||m1(this.body)||g1(this.body)||v1(this.body)||tO(this.body)?this.body:this.body instanceof Zi?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||v1(this.body)?null:g1(this.body)?this.body.type||null:m1(this.body)?null:typeof this.body=="string"?w1:this.body instanceof Zi?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?E1:null}clone(t={}){let e=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,o=t.keepalive??this.keepalive,s=t.priority||this.priority,a=t.cache||this.cache,u=t.mode||this.mode,f=t.redirect||this.redirect,h=t.credentials||this.credentials,m=t.referrer||this.referrer,b=t.integrity||this.integrity,v=t.transferCache??this.transferCache,w=t.timeout??this.timeout,M=t.body!==void 0?t.body:this.body,I=t.withCredentials??this.withCredentials,A=t.reportProgress??this.reportProgress,j=t.headers||this.headers,V=t.params||this.params,L=t.context??this.context;return t.setHeaders!==void 0&&(j=Object.keys(t.setHeaders).reduce((se,B)=>se.set(B,t.setHeaders[B]),j)),t.setParams&&(V=Object.keys(t.setParams).reduce((se,B)=>se.set(B,t.setParams[B]),V)),new n(e,i,M,{params:V,headers:j,context:L,reportProgress:A,responseType:r,withCredentials:I,transferCache:v,keepalive:o,cache:a,priority:s,timeout:w,mode:u,redirect:f,credentials:h,referrer:m,integrity:b})}},po=(function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n})(po||{}),xs=class{headers;status;statusText;url;ok;type;redirected;constructor(t,e=200,i="OK"){this.headers=t.headers||new yi,this.status=t.status!==void 0?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.redirected=t.redirected,this.ok=this.status>=200&&this.status<300}},Bd=class n extends xs{constructor(t={}){super(t)}type=po.ResponseHeader;clone(t={}){return new n({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},gl=class n extends xs{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=po.Response;clone(t={}){return new n({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0,redirected:t.redirected??this.redirected})}},Cs=class extends xs{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},iO=200,rO=204;function g0(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}var bi=(()=>{class n{handler;constructor(e){this.handler=e}request(e,i,r={}){let o;if(e instanceof Es)o=e;else{let u;r.headers instanceof yi?u=r.headers:u=new yi(r.headers);let f;r.params&&(r.params instanceof Zi?f=r.params:f=new Zi({fromObject:r.params})),o=new Es(e,i,r.body!==void 0?r.body:null,{headers:u,context:r.context,params:f,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,integrity:r.integrity,timeout:r.timeout})}let s=K(o).pipe(li(u=>this.handler.handle(u)));if(e instanceof Es||r.observe==="events")return s;let a=s.pipe(rt(u=>u instanceof gl));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return a.pipe(fe(u=>{if(u.body!==null&&!(u.body instanceof ArrayBuffer))throw new U(2806,!1);return u.body}));case"blob":return a.pipe(fe(u=>{if(u.body!==null&&!(u.body instanceof Blob))throw new U(2807,!1);return u.body}));case"text":return a.pipe(fe(u=>{if(u.body!==null&&typeof u.body!="string")throw new U(2808,!1);return u.body}));case"json":default:return a.pipe(fe(u=>u.body))}case"response":return a;default:throw new U(2809,!1)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:new Zi().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,g0(r,i))}post(e,i,r={}){return this.request("POST",e,g0(r,i))}put(e,i,r={}){return this.request("PUT",e,g0(r,i))}static \u0275fac=function(i){return new(i||n)(z(Ss))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();var oO=new Y("");function sO(n,t){return t(n)}function aO(n,t,e){return(i,r)=>Ct(e,()=>t(i,o=>n(o,r)))}var C1=new Y(""),S1=new Y(""),x1=new Y("",{providedIn:"root",factory:()=>!0});var $d=(()=>{class n extends Ss{backend;injector;chain=null;pendingTasks=O(Eu);contributeToStability=O(x1);constructor(e,i){super(),this.backend=e,this.injector=i}handle(e){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(C1),...this.injector.get(S1,[])]));this.chain=i.reduceRight((r,o)=>aO(r,o,this.injector),sO)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(Ur(i))}else return this.chain(e,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(z(ml),z(ot))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();var lO=/^\)\]\}',?\n/,cO=RegExp(`^${b1}:`,"m");function uO(n){return"responseURL"in n&&n.responseURL?n.responseURL:cO.test(n.getAllResponseHeaders())?n.getResponseHeader(b1):null}var v0=(()=>{class n{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new U(-2800,!1);let i=this.xhrFactory;return K(null).pipe(He(()=>new be(o=>{let s=i.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((I,A)=>s.setRequestHeader(I,A.join(","))),e.headers.has(y1)||s.setRequestHeader(y1,nO),!e.headers.has(_1)){let I=e.detectContentTypeHeader();I!==null&&s.setRequestHeader(_1,I)}if(e.timeout&&(s.timeout=e.timeout),e.responseType){let I=e.responseType.toLowerCase();s.responseType=I!=="json"?I:"text"}let a=e.serializeBody(),u=null,f=()=>{if(u!==null)return u;let I=s.statusText||"OK",A=new yi(s.getAllResponseHeaders()),j=uO(s)||e.url;return u=new Bd({headers:A,status:s.status,statusText:I,url:j}),u},h=()=>{let{headers:I,status:A,statusText:j,url:V}=f(),L=null;A!==rO&&(L=typeof s.response>"u"?s.responseText:s.response),A===0&&(A=L?iO:0);let se=A>=200&&A<300;if(e.responseType==="json"&&typeof L=="string"){let B=L;L=L.replace(lO,"");try{L=L!==""?JSON.parse(L):null}catch(q){L=B,se&&(se=!1,L={error:q,text:L})}}se?(o.next(new gl({body:L,headers:I,status:A,statusText:j,url:V||void 0})),o.complete()):o.error(new Cs({error:L,headers:I,status:A,statusText:j,url:V||void 0}))},m=I=>{let{url:A}=f(),j=new Cs({error:I,status:s.status||0,statusText:s.statusText||"Unknown Error",url:A||void 0});o.error(j)},b=m;e.timeout&&(b=I=>{let{url:A}=f(),j=new Cs({error:new DOMException("Request timed out","TimeoutError"),status:s.status||0,statusText:s.statusText||"Request timeout",url:A||void 0});o.error(j)});let v=!1,w=I=>{v||(o.next(f()),v=!0);let A={type:po.DownloadProgress,loaded:I.loaded};I.lengthComputable&&(A.total=I.total),e.responseType==="text"&&s.responseText&&(A.partialText=s.responseText),o.next(A)},M=I=>{let A={type:po.UploadProgress,loaded:I.loaded};I.lengthComputable&&(A.total=I.total),o.next(A)};return s.addEventListener("load",h),s.addEventListener("error",m),s.addEventListener("timeout",b),s.addEventListener("abort",m),e.reportProgress&&(s.addEventListener("progress",w),a!==null&&s.upload&&s.upload.addEventListener("progress",M)),s.send(a),o.next({type:po.Sent}),()=>{s.removeEventListener("error",m),s.removeEventListener("abort",m),s.removeEventListener("load",h),s.removeEventListener("timeout",b),e.reportProgress&&(s.removeEventListener("progress",w),a!==null&&s.upload&&s.upload.removeEventListener("progress",M)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(i){return new(i||n)(z(fo))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),D1=new Y(""),dO="XSRF-TOKEN",fO=new Y("",{providedIn:"root",factory:()=>dO}),pO="X-XSRF-TOKEN",hO=new Y("",{providedIn:"root",factory:()=>pO}),vl=class{},mO=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,i){this.doc=e,this.cookieName=i}getToken(){let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=ul(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(i){return new(i||n)(z(qe),z(fO))};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();function gO(n,t){let e=n.url.toLowerCase();if(!O(D1)||n.method==="GET"||n.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return t(n);let i=O(vl).getToken(),r=O(hO);return i!=null&&!n.headers.has(r)&&(n=n.clone({headers:n.headers.set(r,i)})),t(n)}function _0(...n){let t=[bi,v0,$d,{provide:Ss,useExisting:$d},{provide:ml,useFactory:()=>O(oO,{optional:!0})??O(v0)},{provide:C1,useValue:gO,multi:!0},{provide:D1,useValue:!0},{provide:vl,useClass:mO}];for(let e of n)t.push(...e.\u0275providers);return ci(t)}var I1=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(i){return new(i||n)(z(qe))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var pe="primary",Al=Symbol("RouteTitle"),C0=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function go(n){return new C0(n)}function k1(n,t,e){let i=e.path.split("/");if(i.length>n.length||e.pathMatch==="full"&&(t.hasChildren()||i.length<n.length))return null;let r={};for(let o=0;o<i.length;o++){let s=i[o],a=n[o];if(s[0]===":")r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function _O(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!wi(n[e],t[e]))return!1;return!0}function wi(n,t){let e=n?S0(n):void 0,i=t?S0(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let o=0;o<e.length;o++)if(r=e[o],!F1(n[r],t[r]))return!1;return!0}function S0(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function F1(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;let e=[...n].sort(),i=[...t].sort();return e.every((r,o)=>i[o]===r)}else return n===t}function L1(n){return n.length>0?n[n.length-1]:null}function Qi(n){return Qp(n)?n:_r(n)?J(Promise.resolve(n)):K(n)}var yO={exact:V1,subset:z1},j1={exact:bO,subset:wO,ignored:()=>!0};function T1(n,t,e){return yO[e.paths](n.root,t.root,e.matrixParams)&&j1[e.queryParams](n.queryParams,t.queryParams)&&!(e.fragment==="exact"&&n.fragment!==t.fragment)}function bO(n,t){return wi(n,t)}function V1(n,t,e){if(!ho(n.segments,t.segments)||!qd(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(let i in t.children)if(!n.children[i]||!V1(n.children[i],t.children[i],e))return!1;return!0}function wO(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>F1(n[e],t[e]))}function z1(n,t,e){return U1(n,t,t.segments,e)}function U1(n,t,e,i){if(n.segments.length>e.length){let r=n.segments.slice(0,e.length);return!(!ho(r,e)||t.hasChildren()||!qd(r,e,i))}else if(n.segments.length===e.length){if(!ho(n.segments,e)||!qd(n.segments,e,i))return!1;for(let r in t.children)if(!n.children[r]||!z1(n.children[r],t.children[r],i))return!1;return!0}else{let r=e.slice(0,n.segments.length),o=e.slice(n.segments.length);return!ho(n.segments,r)||!qd(n.segments,r,i)||!n.children[pe]?!1:U1(n.children[pe],t,o,i)}}function qd(n,t,e){return t.every((i,r)=>j1[e](n[r].parameters,i.parameters))}var Ci=class{root;queryParams;fragment;_queryParamMap;constructor(t=new De([],{}),e={},i=null){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=go(this.queryParams),this._queryParamMap}toString(){return SO.serialize(this)}},De=class{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Jd(this)}},Er=class{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=go(this.parameters),this._parameterMap}toString(){return $1(this)}};function EO(n,t){return ho(n,t)&&n.every((e,i)=>wi(e.parameters,t[i].parameters))}function ho(n,t){return n.length!==t.length?!1:n.every((e,i)=>e.path===t[i].path)}function CO(n,t){let e=[];return Object.entries(n.children).forEach(([i,r])=>{i===pe&&(e=e.concat(t(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==pe&&(e=e.concat(t(r,i)))}),e}var vo=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>new Cr,providedIn:"root"})}return n})(),Cr=class{parse(t){let e=new D0(t);return new Ci(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${_l(t.root,!0)}`,i=IO(t.queryParams),r=typeof t.fragment=="string"?`#${xO(t.fragment)}`:"";return`${e}${i}${r}`}},SO=new Cr;function Jd(n){return n.segments.map(t=>$1(t)).join("/")}function _l(n,t){if(!n.hasChildren())return Jd(n);if(t){let e=n.children[pe]?_l(n.children[pe],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==pe&&i.push(`${r}:${_l(o,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}else{let e=CO(n,(i,r)=>r===pe?[_l(n.children[pe],!1)]:[`${r}:${_l(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[pe]!=null?`${Jd(n)}/${e[0]}`:`${Jd(n)}/(${e.join("//")})`}}function B1(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Wd(n){return B1(n).replace(/%3B/gi,";")}function xO(n){return encodeURI(n)}function x0(n){return B1(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Kd(n){return decodeURIComponent(n)}function M1(n){return Kd(n.replace(/\+/g,"%20"))}function $1(n){return`${x0(n.path)}${DO(n.parameters)}`}function DO(n){return Object.entries(n).map(([t,e])=>`;${x0(t)}=${x0(e)}`).join("")}function IO(n){let t=Object.entries(n).map(([e,i])=>Array.isArray(i)?i.map(r=>`${Wd(e)}=${Wd(r)}`).join("&"):`${Wd(e)}=${Wd(i)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var TO=/^[^\/()?;#]+/;function y0(n){let t=n.match(TO);return t?t[0]:""}var MO=/^[^\/()?;=#]+/;function AO(n){let t=n.match(MO);return t?t[0]:""}var RO=/^[^=?&#]+/;function OO(n){let t=n.match(RO);return t?t[0]:""}var NO=/^[^&#]+/;function PO(n){let t=n.match(NO);return t?t[0]:""}var D0=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new De([],{}):new De([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[pe]=new De(t,e)),i}parseSegment(){let t=y0(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new U(4009,!1);return this.capture(t),new Er(Kd(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=AO(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let r=y0(this.remaining);r&&(i=r,this.capture(i))}t[Kd(e)]=Kd(i)}parseQueryParam(t){let e=OO(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let s=PO(this.remaining);s&&(i=s,this.capture(i))}let r=M1(e),o=M1(i);if(t.hasOwnProperty(r)){let s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=y0(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new U(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=pe);let s=this.parseChildren();e[o]=Object.keys(s).length===1&&s[pe]?s[pe]:new De([],s),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new U(4011,!1)}};function H1(n){return n.segments.length>0?new De([],{[pe]:n}):n}function W1(n){let t={};for(let[i,r]of Object.entries(n.children)){let o=W1(r);if(i===pe&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))t[s]=a;else(o.segments.length>0||o.hasChildren())&&(t[i]=o)}let e=new De(n.segments,t);return kO(e)}function kO(n){if(n.numberOfChildren===1&&n.children[pe]){let t=n.children[pe];return new De(n.segments.concat(t.segments),t.children)}return n}function Sr(n){return n instanceof Ci}function G1(n,t,e=null,i=null){let r=q1(n);return J1(r,t,e,i)}function q1(n){let t;function e(o){let s={};for(let u of o.children){let f=e(u);s[u.outlet]=f}let a=new De(o.url,s);return o===n&&(t=a),a}let i=e(n.root),r=H1(i);return t??r}function J1(n,t,e,i){let r=n;for(;r.parent;)r=r.parent;if(t.length===0)return b0(r,r,r,e,i);let o=FO(t);if(o.toRoot())return b0(r,r,new De([],{}),e,i);let s=LO(o,r,n),a=s.processChildren?bl(s.segmentGroup,s.index,o.commands):Y1(s.segmentGroup,s.index,o.commands);return b0(r,s.segmentGroup,a,e,i)}function Yd(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function El(n){return typeof n=="object"&&n!=null&&n.outlets}function b0(n,t,e,i,r){let o={};i&&Object.entries(i).forEach(([u,f])=>{o[u]=Array.isArray(f)?f.map(h=>`${h}`):`${f}`});let s;n===t?s=e:s=K1(n,t,e);let a=H1(W1(s));return new Ci(a,o,r)}function K1(n,t,e){let i={};return Object.entries(n.children).forEach(([r,o])=>{o===t?i[r]=e:i[r]=K1(o,t,e)}),new De(n.segments,i)}var Zd=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&Yd(i[0]))throw new U(4003,!1);let r=i.find(El);if(r&&r!==L1(i))throw new U(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function FO(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Zd(!0,0,n);let t=0,e=!1,i=n.reduce((r,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([u,f])=>{a[u]=typeof f=="string"?f.split("/"):f}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:s===0?(o.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?e=!0:a===".."?t++:a!=""&&r.push(a))}),r):[...r,o]},[]);return new Zd(e,t,i)}var Ts=class{segmentGroup;processChildren;index;constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}};function LO(n,t,e){if(n.isAbsolute)return new Ts(t,!0,0);if(!e)return new Ts(t,!1,NaN);if(e.parent===null)return new Ts(e,!0,0);let i=Yd(n.commands[0])?0:1,r=e.segments.length-1+i;return jO(e,r,n.numberOfDoubleDots)}function jO(n,t,e){let i=n,r=t,o=e;for(;o>r;){if(o-=r,i=i.parent,!i)throw new U(4005,!1);r=i.segments.length}return new Ts(i,!1,r-o)}function VO(n){return El(n[0])?n[0].outlets:{[pe]:n}}function Y1(n,t,e){if(n??=new De([],{}),n.segments.length===0&&n.hasChildren())return bl(n,t,e);let i=zO(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let o=new De(n.segments.slice(0,i.pathIndex),{});return o.children[pe]=new De(n.segments.slice(i.pathIndex),n.children),bl(o,0,r)}else return i.match&&r.length===0?new De(n.segments,{}):i.match&&!n.hasChildren()?I0(n,t,e):i.match?bl(n,0,r):I0(n,t,e)}function bl(n,t,e){if(e.length===0)return new De(n.segments,{});{let i=VO(e),r={};if(Object.keys(i).some(o=>o!==pe)&&n.children[pe]&&n.numberOfChildren===1&&n.children[pe].segments.length===0){let o=bl(n.children[pe],t,e);return new De(n.segments,o.children)}return Object.entries(i).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(r[o]=Y1(n.children[o],t,s))}),Object.entries(n.children).forEach(([o,s])=>{i[o]===void 0&&(r[o]=s)}),new De(n.segments,r)}}function zO(n,t,e){let i=0,r=t,o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return o;let s=n.segments[r],a=e[i];if(El(a))break;let u=`${a}`,f=i<e.length-1?e[i+1]:null;if(r>0&&u===void 0)break;if(u&&f&&typeof f=="object"&&f.outlets===void 0){if(!R1(u,f,s))return o;i+=2}else{if(!R1(u,{},s))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function I0(n,t,e){let i=n.segments.slice(0,t),r=0;for(;r<e.length;){let o=e[r];if(El(o)){let u=UO(o.outlets);return new De(i,u)}if(r===0&&Yd(e[0])){let u=n.segments[t];i.push(new Er(u.path,A1(e[0]))),r++;continue}let s=El(o)?o.outlets[pe]:`${o}`,a=r<e.length-1?e[r+1]:null;s&&a&&Yd(a)?(i.push(new Er(s,A1(a))),r+=2):(i.push(new Er(s,{})),r++)}return new De(i,{})}function UO(n){let t={};return Object.entries(n).forEach(([e,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(t[e]=I0(new De([],{}),0,i))}),t}function A1(n){let t={};return Object.entries(n).forEach(([e,i])=>t[e]=`${i}`),t}function R1(n,t,e){return n==e.path&&wi(t,e.parameters)}var Ms="imperative",_t=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})(_t||{}),Sn=class{id;url;constructor(t,e){this.id=t,this.url=e}},xr=class extends Sn{type=_t.NavigationStart;navigationTrigger;restoredState;constructor(t,e,i="imperative",r=null){super(t,e),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},rn=class extends Sn{urlAfterRedirects;type=_t.NavigationEnd;constructor(t,e,i){super(t,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},nn=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(nn||{}),Rs=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(Rs||{}),Ei=class extends Sn{reason;code;type=_t.NavigationCancel;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Si=class extends Sn{reason;code;type=_t.NavigationSkipped;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}},Os=class extends Sn{error;target;type=_t.NavigationError;constructor(t,e,i,r){super(t,e),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Cl=class extends Sn{urlAfterRedirects;state;type=_t.RoutesRecognized;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Qd=class extends Sn{urlAfterRedirects;state;type=_t.GuardsCheckStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Xd=class extends Sn{urlAfterRedirects;state;shouldActivate;type=_t.GuardsCheckEnd;constructor(t,e,i,r,o){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},ef=class extends Sn{urlAfterRedirects;state;type=_t.ResolveStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},tf=class extends Sn{urlAfterRedirects;state;type=_t.ResolveEnd;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nf=class{route;type=_t.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},rf=class{route;type=_t.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},of=class{snapshot;type=_t.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},sf=class{snapshot;type=_t.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},af=class{snapshot;type=_t.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lf=class{snapshot;type=_t.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ns=class{routerEvent;position;anchor;type=_t.Scroll;constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},Sl=class{},Ps=class{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}};function BO(n){return!(n instanceof Sl)&&!(n instanceof Ps)}function $O(n,t){return n.providers&&!n._injector&&(n._injector=ys(n.providers,t,`Route: ${n.path}`)),n._injector??t}function ri(n){return n.outlet||pe}function HO(n,t){let e=n.filter(i=>ri(i)===t);return e.push(...n.filter(i=>ri(i)!==t)),e}function Ls(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){let e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var cf=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Ls(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new _o(this.rootInjector)}},_o=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,i){let r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){let i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new cf(this.rootInjector),this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(i){return new(i||n)(z(ot))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),uf=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=T0(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){let e=T0(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=M0(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return M0(t,this._root).map(e=>e.value)}};function T0(n,t){if(n===t.value)return t;for(let e of t.children){let i=T0(n,e);if(i)return i}return null}function M0(n,t){if(n===t.value)return[t];for(let e of t.children){let i=M0(n,e);if(i.length)return i.unshift(t),i}return[]}var Cn=class{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function Is(n){let t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}var xl=class extends uf{snapshot;constructor(t,e){super(t),this.snapshot=e,L0(this,t)}toString(){return this.snapshot.toString()}};function Z1(n){let t=WO(n),e=new tt([new Er("",{})]),i=new tt({}),r=new tt({}),o=new tt({}),s=new tt(""),a=new $t(e,i,o,s,r,pe,n,t.root);return a.snapshot=t.root,new xl(new Cn(a,[]),t)}function WO(n){let t={},e={},i={},o=new mo([],t,i,"",e,pe,n,null,{});return new Dl("",new Cn(o,[]))}var $t=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,i,r,o,s,a,u){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(fe(f=>f[Al]))??K(void 0),this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(fe(t=>go(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(fe(t=>go(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function df(n,t,e="emptyOnly"){let i,{routeConfig:r}=n;return t!==null&&(e==="always"||r?.path===""||!t.component&&!t.routeConfig?.loadComponent)?i={params:N(N({},t.params),n.params),data:N(N({},t.data),n.data),resolve:N(N(N(N({},n.data),t.data),r?.data),n._resolvedData)}:i={params:N({},n.params),data:N({},n.data),resolve:N(N({},n.data),n._resolvedData??{})},r&&X1(r)&&(i.resolve[Al]=r.title),i}var mo=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Al]}constructor(t,e,i,r,o,s,a,u,f){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._resolve=f}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=go(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=go(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(i=>i.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},Dl=class extends uf{url;constructor(t,e){super(e),this.url=t,L0(this,e)}toString(){return Q1(this._root)}};function L0(n,t){t.value._routerState=n,t.children.forEach(e=>L0(n,e))}function Q1(n){let t=n.children.length>0?` { ${n.children.map(Q1).join(", ")} } `:"";return`${n.value}${t}`}function w0(n){if(n.snapshot){let t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,wi(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),wi(t.params,e.params)||n.paramsSubject.next(e.params),_O(t.url,e.url)||n.urlSubject.next(e.url),wi(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function A0(n,t){let e=wi(n.params,t.params)&&EO(n.url,t.url),i=!n.parent!=!t.parent;return e&&!i&&(!n.parent||A0(n.parent,t.parent))}function X1(n){return typeof n.title=="string"||n.title===null}var eC=new Y(""),Rl=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=pe;activateEvents=new Pe;deactivateEvents=new Pe;attachEvents=new Pe;detachEvents=new Pe;routerOutletData=TE(void 0);parentContexts=O(_o);location=O(Gi);changeDetector=O(Ki);inputBinder=O(Ol,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new U(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new U(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new U(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new U(4013,!1);this._activatedRoute=e;let r=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,u=new R0(e,a,r.injector,this.routerOutletData);this.activated=r.createComponent(s,{index:r.length,injector:u,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ce({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[bn]})}return n})(),R0=class{route;childContexts;parent;outletData;constructor(t,e,i,r){this.route=t,this.childContexts=e,this.parent=i,this.outletData=r}get(t,e){return t===$t?this.route:t===_o?this.childContexts:t===eC?this.outletData:this.parent.get(t,e)}},Ol=new Y(""),j0=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:i}=e,r=ha([i.queryParams,i.params,i.data]).pipe(He(([o,s,a],u)=>(a=N(N(N({},o),s),a),u===0?K(a):Promise.resolve(a)))).subscribe(o=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(e);return}let s=AE(i.component);if(!s){this.unsubscribeFromRouteData(e);return}for(let{templateName:a}of s.inputs)e.activatedComponentRef.setInput(a,o[a])});this.outletDataSubscriptions.set(e,r)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})(),V0=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=we({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){i&1&&P(0,"router-outlet")},dependencies:[Rl],encapsulation:2})}return n})();function z0(n){let t=n.children&&n.children.map(z0),e=t?Q(N({},n),{children:t}):N({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==pe&&(e.component=V0),e}function GO(n,t,e){let i=Il(n,t._root,e?e._root:void 0);return new xl(i,t)}function Il(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){let i=e.value;i._futureSnapshot=t.value;let r=qO(n,t,e);return new Cn(i,r)}else{if(n.shouldAttach(t.value)){let o=n.retrieve(t.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>Il(n,a)),s}}let i=JO(t.value),r=t.children.map(o=>Il(n,o));return new Cn(i,r)}}function qO(n,t,e){return t.children.map(i=>{for(let r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Il(n,i,r);return Il(n,i)})}function JO(n){return new $t(new tt(n.url),new tt(n.params),new tt(n.queryParams),new tt(n.fragment),new tt(n.data),n.outlet,n.component,n)}var ks=class{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}},tC="ngNavigationCancelingError";function ff(n,t){let{redirectTo:e,navigationBehaviorOptions:i}=Sr(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=nC(!1,nn.Redirect);return r.url=e,r.navigationBehaviorOptions=i,r}function nC(n,t){let e=new Error(`NavigationCancelingError: ${n||""}`);return e[tC]=!0,e.cancellationCode=t,e}function KO(n){return iC(n)&&Sr(n.url)}function iC(n){return!!n&&n[tC]}var YO=(n,t,e,i)=>fe(r=>(new O0(t,r.targetRouterState,r.currentRouterState,e,i).activate(n),r)),O0=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,i,r,o){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(t){let e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),w0(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){let r=Is(e);t.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,r[s],i),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(r===o)if(r.component){let s=i.getContext(r.outlet);s&&this.deactivateChildRoutes(t,e,s.children)}else this.deactivateChildRoutes(t,e,i);else o&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Is(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(i&&i.outlet){let s=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Is(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,e,i){let r=Is(e);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new lf(o.value.snapshot))}),t.children.length&&this.forwardEvent(new sf(t.value.snapshot))}activateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(w0(r),r===o)if(r.component){let s=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,s.children)}else this.activateChildRoutes(t,e,i);else if(r.component){let s=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),w0(a.route.value),this.activateChildRoutes(t,null,s.children)}else s.attachRef=null,s.route=r,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(t,null,s.children)}else this.activateChildRoutes(t,null,i)}},pf=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},As=class{component;route;constructor(t,e){this.component=t,this.route=e}};function ZO(n,t,e){let i=n._root,r=t?t._root:null;return yl(i,r,e,[i.value])}function QO(n){let t=n.routeConfig?n.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:n,guards:t}}function js(n,t){let e=Symbol(),i=t.get(n,e);return i===e?typeof n=="function"&&!vh(n)?n:t.get(n):i}function yl(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=Is(t);return n.children.forEach(s=>{XO(s,o[s.value.outlet],e,i.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>wl(a,e.getContext(s),r)),r}function XO(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,s=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let u=e2(s,o,o.routeConfig.runGuardsAndResolvers);u?r.canActivateChecks.push(new pf(i)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?yl(n,t,a?a.children:null,i,r):yl(n,t,e,i,r),u&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new As(a.outlet.component,s))}else s&&wl(t,a,r),r.canActivateChecks.push(new pf(i)),o.component?yl(n,null,a?a.children:null,i,r):yl(n,null,e,i,r);return r}function e2(n,t,e){if(typeof e=="function")return e(n,t);switch(e){case"pathParamsChange":return!ho(n.url,t.url);case"pathParamsOrQueryParamsChange":return!ho(n.url,t.url)||!wi(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!A0(n,t)||!wi(n.queryParams,t.queryParams);case"paramsChange":default:return!A0(n,t)}}function wl(n,t,e){let i=Is(n),r=n.value;Object.entries(i).forEach(([o,s])=>{r.component?t?wl(s,t.children.getContext(o),e):wl(s,null,e):wl(s,t,e)}),r.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new As(t.outlet.component,r)):e.canDeactivateChecks.push(new As(null,r)):e.canDeactivateChecks.push(new As(null,r))}function Nl(n){return typeof n=="function"}function t2(n){return typeof n=="boolean"}function n2(n){return n&&Nl(n.canLoad)}function i2(n){return n&&Nl(n.canActivate)}function r2(n){return n&&Nl(n.canActivateChild)}function o2(n){return n&&Nl(n.canDeactivate)}function s2(n){return n&&Nl(n.canMatch)}function rC(n){return n instanceof gn||n?.name==="EmptyError"}var Gd=Symbol("INITIAL_VALUE");function Fs(){return He(n=>ha(n.map(t=>t.pipe(wt(1),rh(Gd)))).pipe(fe(t=>{for(let e of t)if(e!==!0){if(e===Gd)return Gd;if(e===!1||a2(e))return e}return!0}),rt(t=>t!==Gd),wt(1)))}function a2(n){return Sr(n)||n instanceof ks}function l2(n,t){return it(e=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=e;return s.length===0&&o.length===0?K(Q(N({},e),{guardsResult:!0})):c2(s,i,r,n).pipe(it(a=>a&&t2(a)?u2(i,o,n,t):K(a)),fe(a=>Q(N({},e),{guardsResult:a})))})}function c2(n,t,e,i){return J(n).pipe(it(r=>m2(r.component,r.route,e,t,i)),ki(r=>r!==!0,!0))}function u2(n,t,e,i){return J(t).pipe(li(r=>Xo(f2(r.route.parent,i),d2(r.route,i),h2(n,r.path,e),p2(n,r.route,e))),ki(r=>r!==!0,!0))}function d2(n,t){return n!==null&&t&&t(new af(n)),K(!0)}function f2(n,t){return n!==null&&t&&t(new of(n)),K(!0)}function p2(n,t,e){let i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||i.length===0)return K(!0);let r=i.map(o=>ma(()=>{let s=Ls(t)??e,a=js(o,s),u=i2(a)?a.canActivate(t,n):Ct(s,()=>a(t,n));return Qi(u).pipe(ki())}));return K(r).pipe(Fs())}function h2(n,t,e){let i=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>QO(s)).filter(s=>s!==null).map(s=>ma(()=>{let a=s.guards.map(u=>{let f=Ls(s.node)??e,h=js(u,f),m=r2(h)?h.canActivateChild(i,n):Ct(f,()=>h(i,n));return Qi(m).pipe(ki())});return K(a).pipe(Fs())}));return K(o).pipe(Fs())}function m2(n,t,e,i,r){let o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!o||o.length===0)return K(!0);let s=o.map(a=>{let u=Ls(t)??r,f=js(a,u),h=o2(f)?f.canDeactivate(n,t,e,i):Ct(u,()=>f(n,t,e,i));return Qi(h).pipe(ki())});return K(s).pipe(Fs())}function g2(n,t,e,i){let r=t.canLoad;if(r===void 0||r.length===0)return K(!0);let o=r.map(s=>{let a=js(s,n),u=n2(a)?a.canLoad(t,e):Ct(n,()=>a(t,e));return Qi(u)});return K(o).pipe(Fs(),oC(i))}function oC(n){return Hp(Et(t=>{if(typeof t!="boolean")throw ff(n,t)}),fe(t=>t===!0))}function v2(n,t,e,i){let r=t.canMatch;if(!r||r.length===0)return K(!0);let o=r.map(s=>{let a=js(s,n),u=s2(a)?a.canMatch(t,e):Ct(n,()=>a(t,e));return Qi(u)});return K(o).pipe(Fs(),oC(i))}var Tl=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},Ml=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function Ds(n){return Qo(new Tl(n))}function _2(n){return Qo(new U(4e3,!1))}function y2(n){return Qo(nC(!1,nn.GuardRejected))}var N0=class{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return K(i);if(r.numberOfChildren>1||!r.children[pe])return _2(`${t.redirectTo}`);r=r.children[pe]}}applyRedirectCommands(t,e,i,r,o){return b2(e,r,o).pipe(fe(s=>{if(s instanceof Ci)throw new Ml(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),t,i);if(s[0]==="/")throw new Ml(a);return a}))}applyRedirectCreateUrlTree(t,e,i,r){let o=this.createSegmentGroup(t,e.root,i,r);return new Ci(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let i={};return Object.entries(t).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);i[r]=e[a]}else i[r]=o}),i}createSegmentGroup(t,e,i,r){let o=this.createSegments(t,e.segments,i,r),s={};return Object.entries(e.children).forEach(([a,u])=>{s[a]=this.createSegmentGroup(t,u,i,r)}),new De(o,s)}createSegments(t,e,i,r){return e.map(o=>o.path[0]===":"?this.findPosParam(t,o,r):this.findOrReturn(o,i))}findPosParam(t,e,i){let r=i[e.path.substring(1)];if(!r)throw new U(4001,!1);return r}findOrReturn(t,e){let i=0;for(let r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}};function b2(n,t,e){if(typeof n=="string")return K(n);let i=n,{queryParams:r,fragment:o,routeConfig:s,url:a,outlet:u,params:f,data:h,title:m}=t;return Qi(Ct(e,()=>i({params:f,data:h,queryParams:r,fragment:o,routeConfig:s,url:a,outlet:u,title:m})))}var P0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function w2(n,t,e,i,r){let o=sC(n,t,e);return o.matched?(i=$O(t,i),v2(i,t,e,r).pipe(fe(s=>s===!0?o:N({},P0)))):K(o)}function sC(n,t,e){if(t.path==="**")return E2(e);if(t.path==="")return t.pathMatch==="full"&&(n.hasChildren()||e.length>0)?N({},P0):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let r=(t.matcher||k1)(e,n,t);if(!r)return N({},P0);let o={};Object.entries(r.posParams??{}).forEach(([a,u])=>{o[a]=u.path});let s=r.consumed.length>0?N(N({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function E2(n){return{matched:!0,parameters:n.length>0?L1(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function O1(n,t,e,i){return e.length>0&&x2(n,e,i)?{segmentGroup:new De(t,S2(i,new De(e,n.children))),slicedSegments:[]}:e.length===0&&D2(n,e,i)?{segmentGroup:new De(n.segments,C2(n,e,i,n.children)),slicedSegments:e}:{segmentGroup:new De(n.segments,n.children),slicedSegments:e}}function C2(n,t,e,i){let r={};for(let o of e)if(mf(n,t,o)&&!i[ri(o)]){let s=new De([],{});r[ri(o)]=s}return N(N({},i),r)}function S2(n,t){let e={};e[pe]=t;for(let i of n)if(i.path===""&&ri(i)!==pe){let r=new De([],{});e[ri(i)]=r}return e}function x2(n,t,e){return e.some(i=>mf(n,t,i)&&ri(i)!==pe)}function D2(n,t,e){return e.some(i=>mf(n,t,i))}function mf(n,t,e){return(n.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function I2(n,t,e){return t.length===0&&!n.children[e]}var k0=class{};function T2(n,t,e,i,r,o,s="emptyOnly"){return new F0(n,t,e,i,r,s,o).recognize()}var M2=31,F0=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,i,r,o,s,a){this.injector=t,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new N0(this.urlSerializer,this.urlTree)}noMatchError(t){return new U(4002,`'${t.segmentGroup}'`)}recognize(){let t=O1(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(fe(({children:e,rootSnapshot:i})=>{let r=new Cn(i,e),o=new Dl("",r),s=G1(i,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(t){let e=new mo([],Object.freeze({}),Object.freeze(N({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),pe,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,pe,e).pipe(fe(i=>({children:i,rootSnapshot:e})),Pi(i=>{if(i instanceof Ml)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof Tl?this.noMatchError(i):i}))}processSegmentGroup(t,e,i,r,o){return i.segments.length===0&&i.hasChildren()?this.processChildren(t,e,i,o):this.processSegment(t,e,i,i.segments,r,!0,o).pipe(fe(s=>s instanceof Cn?[s]:[]))}processChildren(t,e,i,r){let o=[];for(let s of Object.keys(i.children))s==="primary"?o.unshift(s):o.push(s);return J(o).pipe(li(s=>{let a=i.children[s],u=HO(e,s);return this.processSegmentGroup(t,u,a,s,r)}),ih((s,a)=>(s.push(...a),s)),lr(null),nh(),it(s=>{if(s===null)return Ds(i);let a=aC(s);return A2(a),K(a)}))}processSegment(t,e,i,r,o,s,a){return J(e).pipe(li(u=>this.processSegmentAgainstRoute(u._injector??t,e,u,i,r,o,s,a).pipe(Pi(f=>{if(f instanceof Tl)return K(null);throw f}))),ki(u=>!!u),Pi(u=>{if(rC(u))return I2(i,r,o)?K(new k0):Ds(i);throw u}))}processSegmentAgainstRoute(t,e,i,r,o,s,a,u){return ri(i)!==s&&(s===pe||!mf(r,o,i))?Ds(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(t,r,i,o,s,u):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,r,e,i,o,s,u):Ds(r)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,o,s,a){let{matched:u,parameters:f,consumedSegments:h,positionalParamSegments:m,remainingSegments:b}=sC(e,r,o);if(!u)return Ds(e);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>M2&&(this.allowRedirects=!1));let v=new mo(o,f,Object.freeze(N({},this.urlTree.queryParams)),this.urlTree.fragment,N1(r),ri(r),r.component??r._loadedComponent??null,r,P1(r)),w=df(v,a,this.paramsInheritanceStrategy);return v.params=Object.freeze(w.params),v.data=Object.freeze(w.data),this.applyRedirects.applyRedirectCommands(h,r.redirectTo,m,v,t).pipe(He(I=>this.applyRedirects.lineralizeSegments(r,I)),it(I=>this.processSegment(t,i,e,I.concat(b),s,!1,a)))}matchSegmentAgainstRoute(t,e,i,r,o,s){let a=w2(e,i,r,t,this.urlSerializer);return i.path==="**"&&(e.children={}),a.pipe(He(u=>u.matched?(t=i._injector??t,this.getChildConfig(t,i,r).pipe(He(({routes:f})=>{let h=i._loadedInjector??t,{parameters:m,consumedSegments:b,remainingSegments:v}=u,w=new mo(b,m,Object.freeze(N({},this.urlTree.queryParams)),this.urlTree.fragment,N1(i),ri(i),i.component??i._loadedComponent??null,i,P1(i)),M=df(w,s,this.paramsInheritanceStrategy);w.params=Object.freeze(M.params),w.data=Object.freeze(M.data);let{segmentGroup:I,slicedSegments:A}=O1(e,b,v,f);if(A.length===0&&I.hasChildren())return this.processChildren(h,f,I,w).pipe(fe(V=>new Cn(w,V)));if(f.length===0&&A.length===0)return K(new Cn(w,[]));let j=ri(i)===o;return this.processSegment(h,f,I,A,j?pe:o,!0,w).pipe(fe(V=>new Cn(w,V instanceof Cn?[V]:[])))}))):Ds(e)))}getChildConfig(t,e,i){return e.children?K({routes:e.children,injector:t}):e.loadChildren?e._loadedRoutes!==void 0?K({routes:e._loadedRoutes,injector:e._loadedInjector}):g2(t,e,i,this.urlSerializer).pipe(it(r=>r?this.configLoader.loadChildren(t,e).pipe(Et(o=>{e._loadedRoutes=o.routes,e._loadedInjector=o.injector})):y2(e))):K({routes:[],injector:t})}};function A2(n){n.sort((t,e)=>t.value.outlet===pe?-1:e.value.outlet===pe?1:t.value.outlet.localeCompare(e.value.outlet))}function R2(n){let t=n.value.routeConfig;return t&&t.path===""}function aC(n){let t=[],e=new Set;for(let i of n){if(!R2(i)){t.push(i);continue}let r=t.find(o=>i.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...i.children),e.add(r)):t.push(i)}for(let i of e){let r=aC(i.children);t.push(new Cn(i.value,r))}return t.filter(i=>!e.has(i))}function N1(n){return n.data||{}}function P1(n){return n.resolve||{}}function O2(n,t,e,i,r,o){return it(s=>T2(n,t,e,i,s.extractedUrl,r,o).pipe(fe(({state:a,tree:u})=>Q(N({},s),{targetSnapshot:a,urlAfterRedirects:u}))))}function N2(n,t){return it(e=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return K(e);let o=new Set(r.map(u=>u.route)),s=new Set;for(let u of o)if(!s.has(u))for(let f of lC(u))s.add(f);let a=0;return J(s).pipe(li(u=>o.has(u)?P2(u,i,n,t):(u.data=df(u,u.parent,n).resolve,K(void 0))),Et(()=>a++),es(1),it(u=>a===s.size?K(e):Pt))})}function lC(n){let t=n.children.map(e=>lC(e)).flat();return[n,...t]}function P2(n,t,e,i){let r=n.routeConfig,o=n._resolve;return r?.title!==void 0&&!X1(r)&&(o[Al]=r.title),ma(()=>(n.data=df(n,n.parent,e).resolve,k2(o,n,t,i).pipe(fe(s=>(n._resolvedData=s,n.data=N(N({},n.data),s),null)))))}function k2(n,t,e,i){let r=S0(n);if(r.length===0)return K({});let o={};return J(r).pipe(it(s=>F2(n[s],t,e,i).pipe(ki(),Et(a=>{if(a instanceof ks)throw ff(new Cr,a);o[s]=a}))),es(1),fe(()=>o),Pi(s=>rC(s)?Pt:Qo(s)))}function F2(n,t,e,i){let r=Ls(t)??i,o=js(n,r),s=o.resolve?o.resolve(t,e):Ct(r,()=>o(t,e));return Qi(s)}function E0(n){return He(t=>{let e=n(t);return e?J(e).pipe(fe(()=>t)):K(t)})}var U0=(()=>{class n{buildTitle(e){let i,r=e.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===pe);return i}getResolvedTitleForRoute(e){return e.data[Al]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(cC),providedIn:"root"})}return n})(),cC=(()=>{class n extends U0{title;constructor(e){super(),this.title=e}updateTitle(e){let i=this.buildTitle(e);i!==void 0&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(z(I1))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Dr=new Y("",{providedIn:"root",factory:()=>({})}),yo=new Y(""),gf=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=O(Fg);loadComponent(e,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return K(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=Qi(Ct(e,()=>i.loadComponent())).pipe(fe(dC),He(fC),Et(s=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=s}),Ur(()=>{this.componentLoaders.delete(i)})),o=new Yo(r,()=>new $e).pipe(Ko());return this.componentLoaders.set(i,o),o}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return K({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=uC(i,this.compiler,e,this.onLoadEndListener).pipe(Ur(()=>{this.childrenLoaders.delete(i)})),s=new Yo(o,()=>new $e).pipe(Ko());return this.childrenLoaders.set(i,s),s}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function uC(n,t,e,i){return Qi(Ct(e,()=>n.loadChildren())).pipe(fe(dC),He(fC),it(r=>r instanceof md||Array.isArray(r)?K(r):J(t.compileModuleAsync(r))),fe(r=>{i&&i(n);let o,s,a=!1;return Array.isArray(r)?(s=r,a=!0):(o=r.create(e).injector,s=o.get(yo,[],{optional:!0,self:!0}).flat()),{routes:s.map(z0),injector:o}}))}function L2(n){return n&&typeof n=="object"&&"default"in n}function dC(n){return L2(n)?n.default:n}function fC(n){return K(n)}var vf=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(j2),providedIn:"root"})}return n})(),j2=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),B0=new Y(""),$0=new Y("");function pC(n,t,e){let i=n.get($0),r=n.get(qe);if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(f=>setTimeout(f));let o,s=new Promise(f=>{o=f}),a=r.startViewTransition(()=>(o(),V2(n)));a.ready.catch(f=>{});let{onViewTransitionCreated:u}=i;return u&&Ct(n,()=>u({transition:a,from:t,to:e})),s}function V2(n){return new Promise(t=>{Ga({read:()=>setTimeout(t)},{injector:n})})}var H0=new Y(""),_f=(()=>{class n{currentNavigation=Je(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new $e;transitionAbortWithErrorSubject=new $e;configLoader=O(gf);environmentInjector=O(ot);destroyRef=O(Zn);urlSerializer=O(vo);rootContexts=O(_o);location=O(wr);inputBindingEnabled=O(Ol,{optional:!0})!==null;titleStrategy=O(U0);options=O(Dr,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=O(vf);createViewTransition=O(B0,{optional:!0});navigationErrorHandler=O(H0,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>K(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=r=>this.events.next(new nf(r)),i=r=>this.events.next(new rf(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let i=++this.navigationId;vt(()=>{this.transitions?.next(Q(N({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i}))})}setupNavigations(e){return this.transitions=new tt(null),this.transitions.pipe(rt(i=>i!==null),He(i=>{let r=!1;return K(i).pipe(He(o=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",nn.SupersededByNewNavigation),Pt;this.currentTransition=i,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?Q(N({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let s=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=o.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!s&&a!=="reload")return this.events.next(new Si(o.id,this.urlSerializer.serialize(o.rawUrl),"",Rs.IgnoredSameUrlNavigation)),o.resolve(!1),Pt;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return K(o).pipe(He(u=>(this.events.next(new xr(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),u.id!==this.navigationId?Pt:Promise.resolve(u))),O2(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Et(u=>{i.targetSnapshot=u.targetSnapshot,i.urlAfterRedirects=u.urlAfterRedirects,this.currentNavigation.update(h=>(h.finalUrl=u.urlAfterRedirects,h));let f=new Cl(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(f)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:u,extractedUrl:f,source:h,restoredState:m,extras:b}=o,v=new xr(u,this.urlSerializer.serialize(f),h,m);this.events.next(v);let w=Z1(this.rootComponentType).snapshot;return this.currentTransition=i=Q(N({},o),{targetSnapshot:w,urlAfterRedirects:f,extras:Q(N({},b),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(M=>(M.finalUrl=f,M)),K(i)}else return this.events.next(new Si(o.id,this.urlSerializer.serialize(o.extractedUrl),"",Rs.IgnoredByUrlHandlingStrategy)),o.resolve(!1),Pt}),Et(o=>{let s=new Qd(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(s)}),fe(o=>(this.currentTransition=i=Q(N({},o),{guards:ZO(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),i)),l2(this.environmentInjector,o=>this.events.next(o)),Et(o=>{if(i.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw ff(this.urlSerializer,o.guardsResult);let s=new Xd(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(s)}),rt(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",nn.GuardRejected),!1)),E0(o=>{if(o.guards.canActivateChecks.length!==0)return K(o).pipe(Et(s=>{let a=new ef(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),He(s=>{let a=!1;return K(s).pipe(N2(this.paramsInheritanceStrategy,this.environmentInjector),Et({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",nn.NoDataFromResolver)}}))}),Et(s=>{let a=new tf(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),E0(o=>{let s=a=>{let u=[];if(a.routeConfig?.loadComponent){let f=Ls(a)??this.environmentInjector;u.push(this.configLoader.loadComponent(f,a.routeConfig).pipe(Et(h=>{a.component=h}),fe(()=>{})))}for(let f of a.children)u.push(...s(f));return u};return ha(s(o.targetSnapshot.root)).pipe(lr(null),wt(1))}),E0(()=>this.afterPreactivation()),He(()=>{let{currentSnapshot:o,targetSnapshot:s}=i,a=this.createViewTransition?.(this.environmentInjector,o.root,s.root);return a?J(a).pipe(fe(()=>i)):K(i)}),fe(o=>{let s=GO(e.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=i=Q(N({},o),{targetRouterState:s}),this.currentNavigation.update(a=>(a.targetRouterState=s,a)),i}),Et(()=>{this.events.next(new Sl)}),YO(this.rootContexts,e.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),wt(1),Wn(new be(o=>{let s=i.abortController.signal,a=()=>o.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(rt(()=>!r&&!i.targetRouterState),Et(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",nn.Aborted)}))),Et({next:o=>{r=!0,this.lastSuccessfulNavigation=vt(this.currentNavigation),this.events.next(new rn(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),Wn(this.transitionAbortWithErrorSubject.pipe(Et(o=>{throw o}))),Ur(()=>{r||this.cancelNavigationTransition(i,"",nn.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Pi(o=>{if(this.destroyed)return i.resolve(!1),Pt;if(r=!0,iC(o))this.events.next(new Ei(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode)),KO(o)?this.events.next(new Ps(o.url,o.navigationBehaviorOptions)):i.resolve(!1);else{let s=new Os(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);try{let a=Ct(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof ks){let{message:u,cancellationCode:f}=ff(this.urlSerializer,a);this.events.next(new Ei(i.id,this.urlSerializer.serialize(i.extractedUrl),u,f)),this.events.next(new Ps(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),o}catch(a){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(a)}}return Pt}))}))}cancelNavigationTransition(e,i,r){let o=new Ei(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(o),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=vt(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return e.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function z2(n){return n!==Ms}var hC=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(U2),providedIn:"root"})}return n})(),hf=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}},U2=(()=>{class n extends hf{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),mC=(()=>{class n{urlSerializer=O(vo);options=O(Dr,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=O(wr);urlHandlingStrategy=O(vf);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ci;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:i,targetBrowserUrl:r}){let o=e!==void 0?this.urlHandlingStrategy.merge(e,i):i,s=r??o;return s instanceof Ci?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:e,finalUrl:i,initialUrl:r}){i&&e?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=e):this.rawUrlTree=r}routerState=Z1(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:()=>O(B2),providedIn:"root"})}return n})(),B2=(()=>{class n extends mC{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{i.type==="popstate"&&setTimeout(()=>{e(i.url,i.state,"popstate")})})}handleRouterEvent(e,i){e instanceof xr?this.updateStateMemento():e instanceof Si?this.commitTransition(i):e instanceof Cl?this.urlUpdateStrategy==="eager"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof Sl?(this.commitTransition(i),this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof Ei&&e.code!==nn.SupersededByNewNavigation&&e.code!==nn.Redirect?this.restoreHistory(i):e instanceof Os?this.restoreHistory(i,!0):e instanceof rn&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:i,id:r}){let{replaceUrl:o,state:s}=i;if(this.location.isCurrentPathEqualTo(e)||o){let a=this.browserPageId,u=N(N({},s),this.generateNgRouterState(r,a));this.location.replaceState(e,"",u)}else{let a=N(N({},s),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(e,"",a)}}restoreHistory(e,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===e.finalUrl&&o===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function yf(n,t){n.events.pipe(rt(e=>e instanceof rn||e instanceof Ei||e instanceof Os||e instanceof Si),fe(e=>e instanceof rn||e instanceof Si?0:(e instanceof Ei?e.code===nn.Redirect||e.code===nn.SupersededByNewNavigation:!1)?2:1),rt(e=>e!==2),wt(1)).subscribe(()=>{t()})}var $2={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},H2={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ie=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=O(Sg);stateManager=O(mC);options=O(Dr,{optional:!0})||{};pendingTasks=O(mi);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=O(_f);urlSerializer=O(vo);location=O(wr);urlHandlingStrategy=O(vf);injector=O(ot);_events=new $e;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=O(hC);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=O(yo,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!O(Ol,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Ye;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,o=vt(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Ei&&i.code!==nn.Redirect&&i.code!==nn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof rn)this.navigated=!0;else if(i instanceof Ps){let s=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),u=N({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||z2(r.source)},s);this.scheduleNavigation(a,Ms,null,u,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}BO(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ms,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i,r)=>{this.navigateToSyncWithBrowser(e,r,i)})}navigateToSyncWithBrowser(e,i,r){let o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){let u=N({},r);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(o.state=u)}let a=this.parseUrl(e);this.scheduleNavigation(a,i,s,o).catch(u=>{this.disposed||this.injector.get(Xt)(u)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return vt(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(z0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){let{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:u}=i,f=u?this.currentUrlTree.fragment:s,h=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":h=N(N({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let m;try{let b=r?r.snapshot:this.routerState.snapshot.root;m=q1(b)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),m=this.currentUrlTree.root}return J1(m,e,h,f??null)}navigateByUrl(e,i={skipLocationChange:!1}){let r=Sr(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Ms,null,i)}navigate(e,i={skipLocationChange:!1}){return W2(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.console.warn(Vi(4018,!1)),this.urlSerializer.parse("/")}}isActive(e,i){let r;if(i===!0?r=N({},$2):i===!1?r=N({},H2):r=i,Sr(e))return T1(this.currentUrlTree,e,r);let o=this.parseUrl(e);return T1(this.currentUrlTree,o,r)}removeEmptyProps(e){return Object.entries(e).reduce((i,[r,o])=>(o!=null&&(i[r]=o),i),{})}scheduleNavigation(e,i,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,u,f;s?(a=s.resolve,u=s.reject,f=s.promise):f=new Promise((m,b)=>{a=m,u=b});let h=this.pendingTasks.add();return yf(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:o,resolve:a,reject:u,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(m=>Promise.reject(m))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function W2(n){for(let t=0;t<n.length;t++)if(n[t]==null)throw new U(4008,!1)}var Ht=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Je(null);get href(){return vt(this.reactiveHref)}set href(e){this.reactiveHref.set(e)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new $e;applicationErrorHandler=O(Xt);options=O(Dr,{optional:!0});constructor(e,i,r,o,s,a){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=s,this.locationStrategy=a,this.reactiveHref.set(O(new yd("href"),{optional:!0}));let u=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=u==="a"||u==="area"||!!(typeof customElements=="object"&&customElements.get(u)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let e=this.preserveFragment,i=r=>r==="merge"||r==="preserve";e||=i(this.queryParamsHandling),e||=!this.queryParamsHandling&&!i(this.options?.defaultQueryParamsHandling),e&&(this.subscription=this.router.events.subscribe(r=>{r instanceof rn&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Sr(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,i,r,o,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||i||r||o||s||typeof this.target=="string"&&this.target!="_self"))return!0;let u={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,u)?.catch(f=>{this.applicationErrorHandler(f)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.reactiveHref.set(e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e))??"":null)}applyAttributeValue(e,i){let r=this.renderer,o=this.el.nativeElement;i!==null?r.setAttribute(o,e,i):r.removeAttribute(o,e)}get urlTree(){return this.routerLinkInput===null?null:Sr(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(D(Ie),D($t),Ha("tabindex"),D(dn),D(xt),D(En))};static \u0275dir=Ce({type:n,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(i,r){i&1&&x("click",function(s){return r.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),i&2&&ws("href",r.reactiveHref(),tg)("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",uo],skipLocationChange:[2,"skipLocationChange","skipLocationChange",uo],replaceUrl:[2,"replaceUrl","replaceUrl",uo],routerLink:"routerLink"},features:[bn]})}return n})(),G0=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new Pe;constructor(e,i,r,o,s){this.router=e,this.element=i,this.renderer=r,this.cdr=o,this.link=s,this.routerEventsSubscription=e.events.subscribe(a=>{a instanceof rn&&this.update()})}ngAfterContentInit(){K(this.links.changes,K(null)).pipe(ar()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let e=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=J(e).pipe(ar()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(e){let i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let e=this.hasActiveLinks();this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.isActiveChange.emit(e))})}isLinkActive(e){let i=G2(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{let o=r.urlTree;return o?e.isActive(o,i):!1}}hasActiveLinks(){let e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static \u0275fac=function(i){return new(i||n)(D(Ie),D(xt),D(dn),D(Ki),D(Ht,8))};static \u0275dir=Ce({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(i&1&&Rg(o,Ht,5),i&2){let s;so(s=ao())&&(r.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[bn]})}return n})();function G2(n){return!!n.paths}var Pl=class{};var gC=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,i,r,o){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(rt(e=>e instanceof rn),li(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){let r=[];for(let o of i){o.providers&&!o._injector&&(o._injector=ys(o.providers,e,`Route: ${o.path}`));let s=o._injector??e,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(a,o.children??o._loadedRoutes))}return J(r).pipe(ar())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;i.loadChildren&&i.canLoad===void 0?r=this.loader.loadChildren(e,i):r=K(null);let o=r.pipe(it(s=>s===null?K(void 0):(i._loadedRoutes=s.routes,i._loadedInjector=s.injector,this.processRoutes(s.injector??e,s.routes))));if(i.loadComponent&&!i._loadedComponent){let s=this.loader.loadComponent(e,i);return J([o,s]).pipe(ar())}else return o})}static \u0275fac=function(i){return new(i||n)(z(Ie),z(ot),z(Pl),z(gf))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),vC=new Y(""),q2=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=Ms;restoredId=0;store={};constructor(e,i,r,o,s={}){this.urlSerializer=e,this.transitions=i,this.viewportScroller=r,this.zone=o,this.options=s,s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof xr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof rn?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Si&&e.code===Rs.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{if(!(e instanceof Ns))return;let i={behavior:"instant"};e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],i):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position,i):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(e,i){this.zone.runOutsideAngular(()=>y(this,null,function*(){yield new Promise(r=>{setTimeout(r),typeof requestAnimationFrame<"u"&&requestAnimationFrame(r)}),this.zone.run(()=>{this.transitions.events.next(new Ns(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(i){_g()};static \u0275prov=F({token:n,factory:n.\u0275fac})}return n})();function q0(n,...t){return ci([{provide:yo,multi:!0,useValue:n},[],{provide:$t,useFactory:_C,deps:[Ie]},{provide:Ja,multi:!0,useFactory:yC},t.map(e=>e.\u0275providers)])}function _C(n){return n.routerState.root}function kl(n,t){return{\u0275kind:n,\u0275providers:t}}function yC(){let n=O(Qt);return t=>{let e=n.get(qi);if(t!==e.components[0])return;let i=n.get(Ie),r=n.get(bC);n.get(J0)===1&&i.initialNavigation(),n.get(CC,null,{optional:!0})?.setUpPreloading(),n.get(vC,null,{optional:!0})?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var bC=new Y("",{factory:()=>new $e}),J0=new Y("",{providedIn:"root",factory:()=>1});function wC(){let n=[{provide:Zm,useValue:!0},{provide:J0,useValue:0},gd(()=>{let t=O(Qt);return t.get(Zg,Promise.resolve()).then(()=>new Promise(i=>{let r=t.get(Ie),o=t.get(bC);yf(r,()=>{i(!0)}),t.get(_f).afterPreactivation=()=>(i(!0),o.closed?K(void 0):o),r.initialNavigation()}))})];return kl(2,n)}function EC(){let n=[gd(()=>{O(Ie).setUpLocationChangeListener()}),{provide:J0,useValue:2}];return kl(3,n)}var CC=new Y("");function SC(n){return kl(0,[{provide:CC,useExisting:gC},{provide:Pl,useExisting:n}])}function xC(){return kl(8,[j0,{provide:Ol,useExisting:j0}])}function DC(n){ti("NgRouterViewTransitions");let t=[{provide:B0,useValue:pC},{provide:$0,useValue:N({skipNextTransition:!!n?.skipInitialTransition},n)}];return kl(9,t)}var IC=[wr,{provide:vo,useClass:Cr},Ie,_o,{provide:$t,useFactory:_C,deps:[Ie]},gf,[]],jt=(()=>{class n{constructor(){}static forRoot(e,i){return{ngModule:n,providers:[IC,[],{provide:yo,multi:!0,useValue:e},[],i?.errorHandler?{provide:H0,useValue:i.errorHandler}:[],{provide:Dr,useValue:i||{}},i?.useHash?K2():Y2(),J2(),i?.preloadingStrategy?SC(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?Z2(i):[],i?.bindToComponentInputs?xC().\u0275providers:[],i?.enableViewTransitions?DC().\u0275providers:[],Q2()]}}static forChild(e){return{ngModule:n,providers:[{provide:yo,multi:!0,useValue:e}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=On({type:n});static \u0275inj=vn({})}return n})();function J2(){return{provide:vC,useFactory:()=>{let n=O(s1),t=O(ze),e=O(Dr),i=O(_f),r=O(vo);return e.scrollOffset&&n.setOffset(e.scrollOffset),new q2(r,i,n,t,e)}}}function K2(){return{provide:En,useClass:sl}}function Y2(){return{provide:En,useClass:Cd}}function Z2(n){return[n.initialNavigation==="disabled"?EC().\u0275providers:[],n.initialNavigation==="enabledBlocking"?wC().\u0275providers:[]]}var W0=new Y("");function Q2(){return[{provide:W0,useFactory:yC},{provide:Ja,multi:!0,useExisting:W0}]}var FC=(()=>{class n{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||n)(D(dn),D(xt))};static \u0275dir=Ce({type:n})}return n})(),$s=(()=>{class n extends FC{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,features:[at]})}return n})(),Xi=new Y(""),X2={provide:Xi,useExisting:gt(()=>bo),multi:!0},bo=(()=>{class n extends $s{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target.checked)})("blur",function(){return r.onTouched()})},standalone:!1,features:[Ut([X2]),at]})}return n})(),eN={provide:Xi,useExisting:gt(()=>Re),multi:!0};function tN(){let n=Nn()?Nn().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var nN=new Y(""),Re=(()=>{class n extends FC{_compositionMode;_composing=!1;constructor(e,i,r){super(e,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!tN())}writeValue(e){let i=e??"";this.setProperty("value",i)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||n)(D(dn),D(xt),D(nN,8))};static \u0275dir=Ce({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&x("input",function(s){return r._handleInput(s.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(s){return r._compositionEnd(s.target.value)})},standalone:!1,features:[Ut([eN]),at]})}return n})();function Q0(n){return n==null||X0(n)===0}function X0(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var Tr=new Y(""),wo=new Y(""),iN=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ne=class{static min(t){return LC(t)}static max(t){return rN(t)}static required(t){return oN(t)}static requiredTrue(t){return sN(t)}static email(t){return aN(t)}static minLength(t){return lN(t)}static maxLength(t){return cN(t)}static pattern(t){return uN(t)}static nullValidator(t){return wf()}static compose(t){return $C(t)}static composeAsync(t){return HC(t)}};function LC(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}function rN(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}function oN(n){return Q0(n.value)?{required:!0}:null}function sN(n){return n.value===!0?null:{required:!0}}function aN(n){return Q0(n.value)||iN.test(n.value)?null:{email:!0}}function lN(n){return t=>{let e=t.value?.length??X0(t.value);return e===null||e===0?null:e<n?{minlength:{requiredLength:n,actualLength:e}}:null}}function cN(n){return t=>{let e=t.value?.length??X0(t.value);return e!==null&&e>n?{maxlength:{requiredLength:n,actualLength:e}}:null}}function uN(n){if(!n)return wf;let t,e;return typeof n=="string"?(e="",n.charAt(0)!=="^"&&(e+="^"),e+=n,n.charAt(n.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Q0(i.value))return null;let r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}function wf(n){return null}function jC(n){return n!=null}function VC(n){return _r(n)?J(n):n}function zC(n){let t={};return n.forEach(e=>{t=e!=null?N(N({},t),e):t}),Object.keys(t).length===0?null:t}function UC(n,t){return t.map(e=>e(n))}function dN(n){return!n.validate}function BC(n){return n.map(t=>dN(t)?t:e=>t.validate(e))}function $C(n){if(!n)return null;let t=n.filter(jC);return t.length==0?null:function(e){return zC(UC(e,t))}}function ev(n){return n!=null?$C(BC(n)):null}function HC(n){if(!n)return null;let t=n.filter(jC);return t.length==0?null:function(e){let i=UC(e,t).map(VC);return Xp(i).pipe(fe(zC))}}function tv(n){return n!=null?HC(BC(n)):null}function TC(n,t){return n===null?[t]:Array.isArray(n)?[...n,t]:[n,t]}function WC(n){return n._rawValidators}function GC(n){return n._rawAsyncValidators}function K0(n){return n?Array.isArray(n)?n:[n]:[]}function Ef(n,t){return Array.isArray(n)?n.includes(t):n===t}function MC(n,t){let e=K0(t);return K0(n).forEach(r=>{Ef(e,r)||e.push(r)}),e}function AC(n,t){return K0(t).filter(e=>!Ef(n,e))}var Cf=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=ev(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=tv(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},on=class extends Cf{name;get formDirective(){return null}get path(){return null}},Di=class extends Cf{_parent=null;name=null;valueAccessor=null},Sf=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},fN={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},CZ=Q(N({},fN),{"[class.ng-submitted]":"isSubmitted"}),Fe=(()=>{class n extends Sf{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(D(Di,2))};static \u0275dir=Ce({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&Se("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[at]})}return n})(),Fn=(()=>{class n extends Sf{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(D(on,10))};static \u0275dir=Ce({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){i&2&&Se("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[at]})}return n})();var Fl="VALID",bf="INVALID",Vs="PENDING",Ll="DISABLED",Ir=class{},xf=class extends Ir{value;source;constructor(t,e){super(),this.value=t,this.source=e}},Vl=class extends Ir{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},zl=class extends Ir{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},zs=class extends Ir{status;source;constructor(t,e){super(),this.status=t,this.source=e}},Df=class extends Ir{source;constructor(t){super(),this.source=t}},Bl=class extends Ir{source;constructor(t){super(),this.source=t}};function nv(n){return(Af(n)?n.validators:n)||null}function pN(n){return Array.isArray(n)?ev(n):n||null}function iv(n,t){return(Af(t)?t.asyncValidators:n)||null}function hN(n){return Array.isArray(n)?tv(n):n||null}function Af(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function qC(n,t,e){let i=n.controls;if(!(t?Object.keys(i):i).length)throw new U(1e3,"");if(!i[e])throw new U(1001,"")}function JC(n,t,e){n._forEachChild((i,r)=>{if(e[r]===void 0)throw new U(1002,"")})}var Us=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return vt(this.statusReactive)}set status(t){vt(()=>this.statusReactive.set(t))}_status=co(()=>this.statusReactive());statusReactive=Je(void 0);get valid(){return this.status===Fl}get invalid(){return this.status===bf}get pending(){return this.status==Vs}get disabled(){return this.status===Ll}get enabled(){return this.status!==Ll}errors;get pristine(){return vt(this.pristineReactive)}set pristine(t){vt(()=>this.pristineReactive.set(t))}_pristine=co(()=>this.pristineReactive());pristineReactive=Je(!0);get dirty(){return!this.pristine}get touched(){return vt(this.touchedReactive)}set touched(t){vt(()=>this.touchedReactive.set(t))}_touched=co(()=>this.touchedReactive());touchedReactive=Je(!1);get untouched(){return!this.touched}_events=new $e;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(MC(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(MC(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(AC(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(AC(t,this._rawAsyncValidators))}hasValidator(t){return Ef(this._rawValidators,t)}hasAsyncValidator(t){return Ef(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(Q(N({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new zl(!0,i))}markAllAsDirty(t={}){this.markAsDirty({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(t))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),e&&t.emitEvent!==!1&&this._events.next(new zl(!1,i))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(Q(N({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new Vl(!1,i))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),e&&t.emitEvent!==!1&&this._events.next(new Vl(!0,i))}markAsPending(t={}){this.status=Vs;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new zs(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(Q(N({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ll,this.errors=null,this._forEachChild(r=>{r.disable(Q(N({},t),{onlySelf:!0}))}),this._updateValue();let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new xf(this.value,i)),this._events.next(new zs(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Q(N({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Fl,this._forEachChild(i=>{i.enable(Q(N({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Q(N({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Fl||this.status===Vs)&&this._runAsyncValidator(i,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new xf(this.value,e)),this._events.next(new zs(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(Q(N({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ll:Fl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=Vs,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:t!==!1};let i=VC(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){let i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new zs(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,i)}_initObservables(){this.valueChanges=new Pe,this.statusChanges=new Pe}_calculateStatus(){return this._allControlsDisabled()?Ll:this.errors?bf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Vs)?Vs:this._anyControlsHaveStatus(bf)?bf:Fl}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),r&&this._events.next(new Vl(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new zl(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Af(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=pN(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=hN(this._rawAsyncValidators)}},Bs=class extends Us{constructor(t,e,i){super(nv(e),iv(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){JC(this,!0,t),Object.keys(t).forEach(i=>{qC(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(i=>{let r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t?t[r]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Bl(this))}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>i._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,o)=>{i=e(i,r,o)}),i}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var Y0=class extends Bs{};var Eo=new Y("",{providedIn:"root",factory:()=>Hl}),Hl="always";function Rf(n,t){return[...t.path,n]}function $l(n,t,e=Hl){rv(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(n.disabled),gN(n,t),_N(n,t),vN(n,t),mN(n,t)}function If(n,t,e=!0){let i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Mf(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Tf(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function mN(n,t){if(t.valueAccessor.setDisabledState){let e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}function rv(n,t){let e=WC(n);t.validator!==null?n.setValidators(TC(e,t.validator)):typeof e=="function"&&n.setValidators([e]);let i=GC(n);t.asyncValidator!==null?n.setAsyncValidators(TC(i,t.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();Tf(t._rawValidators,r),Tf(t._rawAsyncValidators,r)}function Mf(n,t){let e=!1;if(n!==null){if(t.validator!==null){let r=WC(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.validator);o.length!==r.length&&(e=!0,n.setValidators(o))}}if(t.asyncValidator!==null){let r=GC(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.asyncValidator);o.length!==r.length&&(e=!0,n.setAsyncValidators(o))}}}let i=()=>{};return Tf(t._rawValidators,i),Tf(t._rawAsyncValidators,i),e}function gN(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&KC(n,t)})}function vN(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&KC(n,t),n.updateOn!=="submit"&&n.markAsTouched()})}function KC(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function _N(n,t){let e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}function YC(n,t){n==null,rv(n,t)}function yN(n,t){return Mf(n,t)}function ov(n,t){if(!n.hasOwnProperty("model"))return!1;let e=n.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function bN(n){return Object.getPrototypeOf(n.constructor)===$s}function ZC(n,t){n._syncPendingControls(),t.forEach(e=>{let i=e.control;i.updateOn==="submit"&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function sv(n,t){if(!t)return null;Array.isArray(t);let e,i,r;return t.forEach(o=>{o.constructor===Re?e=o:bN(o)?i=o:r=o}),r||i||e||null}function wN(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}var EN={provide:on,useExisting:gt(()=>av)},jl=Promise.resolve(),av=(()=>{class n extends on{callSetDisabledState;get submitted(){return vt(this.submittedReactive)}_submitted=co(()=>this.submittedReactive());submittedReactive=Je(!1);_directives=new Set;form;ngSubmit=new Pe;options;constructor(e,i,r){super(),this.callSetDisabledState=r,this.form=new Bs({},ev(e),tv(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){jl.then(()=>{let i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),$l(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){jl.then(()=>{let i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){jl.then(()=>{let i=this._findContainer(e.path),r=new Bs({});YC(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){jl.then(()=>{let i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){jl.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),ZC(this.form,this._directives),this.ngSubmit.emit(e),this.form._events.next(new Df(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(i){return new(i||n)(D(Tr,10),D(wo,10),D(Eo,8))};static \u0275dir=Ce({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){i&1&&x("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ut([EN]),at]})}return n})();function RC(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function OC(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Ul=class extends Us{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,i){super(nv(e),iv(i,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Af(e)&&(e.nonNullable||e.initialValueIsDefault)&&(OC(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new Bl(this))}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){RC(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){RC(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){OC(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var CN=n=>n instanceof Ul,SN=(()=>{class n extends on{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Rf(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,standalone:!1,features:[at]})}return n})();var xN={provide:Di,useExisting:gt(()=>yt)},NC=Promise.resolve(),yt=(()=>{class n extends Di{_changeDetectorRef;callSetDisabledState;control=new Ul;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Pe;constructor(e,i,r,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=sv(this,o)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),ov(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){$l(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){NC.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let i=e.isDisabled.currentValue,r=i!==0&&uo(i);NC.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?Rf(e,this._parent):[e]}static \u0275fac=function(i){return new(i||n)(D(on,9),D(Tr,10),D(wo,10),D(Xi,10),D(Ki,8),D(Eo,8))};static \u0275dir=Ce({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Ut([xN]),at,bn]})}return n})();var Ln=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ce({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),DN={provide:Xi,useExisting:gt(()=>Wl),multi:!0},Wl=(()=>{class n extends $s{writeValue(e){let i=e??"";this.setProperty("value",i)}registerOnChange(e){this.onChange=i=>{e(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&x("input",function(s){return r.onChange(s.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[Ut([DN]),at]})}return n})(),IN={provide:Xi,useExisting:gt(()=>lv),multi:!0};var TN=(()=>{class n{_accessors=[];add(e,i){this._accessors.push([e,i])}remove(e){for(let i=this._accessors.length-1;i>=0;--i)if(this._accessors[i][1]===e){this._accessors.splice(i,1);return}}select(e){this._accessors.forEach(i=>{this._isSameGroup(i,e)&&i[1]!==e&&i[1].fireUncheck(e.value)})}_isSameGroup(e,i){return e[0].control?e[0]._parent===i._control._parent&&e[1].name===i.name:!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),lv=(()=>{class n extends $s{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=O(Eo,{optional:!0})??Hl;constructor(e,i,r,o){super(e,i),this._registry=r,this._injector=o}ngOnInit(){this._control=this._injector.get(Di),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(i){return new(i||n)(D(dn),D(xt),D(TN),D(Qt))};static \u0275dir=Ce({type:n,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(){return r.onChange()})("blur",function(){return r.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Ut([IN]),at]})}return n})();var cv=new Y(""),MN={provide:Di,useExisting:gt(()=>uv)},uv=(()=>{class n extends Di{_ngModelWarningConfig;callSetDisabledState;viewModel;form;set isDisabled(e){}model;update=new Pe;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,o,s){super(),this._ngModelWarningConfig=o,this.callSetDisabledState=s,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=sv(this,r)}ngOnChanges(e){if(this._isControlChanged(e)){let i=e.form.previousValue;i&&If(i,this,!1),$l(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}ov(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&If(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}static \u0275fac=function(i){return new(i||n)(D(Tr,10),D(wo,10),D(Xi,10),D(cv,8),D(Eo,8))};static \u0275dir=Ce({type:n,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],standalone:!1,features:[Ut([MN]),at,bn]})}return n})(),AN={provide:on,useExisting:gt(()=>jn)},jn=(()=>{class n extends on{callSetDisabledState;get submitted(){return vt(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=co(()=>this._submittedReactive());_submittedReactive=Je(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Pe;constructor(e,i,r){super(),this.callSetDisabledState=r,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Mf(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let i=this.form.get(e.path);return $l(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){If(e.control||null,e,!1),wN(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this._submittedReactive.set(!0),ZC(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new Df(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0,i={}){this.form.reset(e,i),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(e=>{let i=e.control,r=this.form.get(e.path);i!==r&&(If(i||null,e),CN(r)&&($l(r,e,this.callSetDisabledState),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let i=this.form.get(e.path);YC(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let i=this.form.get(e.path);i&&yN(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){rv(this.form,this),this._oldForm&&Mf(this._oldForm,this)}static \u0275fac=function(i){return new(i||n)(D(Tr,10),D(wo,10),D(Eo,8))};static \u0275dir=Ce({type:n,selectors:[["","formGroup",""]],hostBindings:function(i,r){i&1&&x("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ut([AN]),at,bn]})}return n})(),RN={provide:on,useExisting:gt(()=>Hs)},Hs=(()=>{class n extends SN{name=null;constructor(e,i,r){super(),this._parent=e,this._setValidators(i),this._setAsyncValidators(r)}_checkParentType(){XC(this._parent)}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Tr,10),D(wo,10))};static \u0275dir=Ce({type:n,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Ut([RN]),at]})}return n})(),ON={provide:on,useExisting:gt(()=>QC)},QC=(()=>{class n extends on{_parent;name=null;constructor(e,i,r){super(),this._parent=e,this._setValidators(i),this._setAsyncValidators(r)}ngOnInit(){XC(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Rf(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Tr,10),D(wo,10))};static \u0275dir=Ce({type:n,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Ut([ON]),at]})}return n})();function XC(n){return!(n instanceof Hs)&&!(n instanceof jn)&&!(n instanceof QC)}var NN={provide:Di,useExisting:gt(()=>oi)},oi=(()=>{class n extends Di{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new Pe;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,o,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=sv(this,o)}ngOnChanges(e){this._added||this._setUpControl(),ov(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Rf(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||n)(D(on,13),D(Tr,10),D(wo,10),D(Xi,10),D(cv,8))};static \u0275dir=Ce({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Ut([NN]),at,bn]})}return n})();var PN={provide:Xi,useExisting:gt(()=>At),multi:!0};function eS(n,t){return n==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function kN(n){return n.split(":")[0]}var At=(()=>{class n extends $s{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;appRefInjector=O(qi).injector;destroyRef=O(Zn);cdr=O(Ki);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,Ga({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(e){this.cdr.markForCheck(),this.value=e;let i=this._getOptionId(e),r=eS(i,e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){let i=kN(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ut([PN]),at]})}return n})(),Wt=(()=>{class n{_element;_renderer;_select;id;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(eS(this.id,e)),this._select._writeValueAfterRender())}set value(e){this._setElementValue(e),this._select&&this._select._writeValueAfterRender()}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(i){return new(i||n)(D(xt),D(dn),D(At,9))};static \u0275dir=Ce({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),FN={provide:Xi,useExisting:gt(()=>tS),multi:!0};function PC(n,t){return n==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function LN(n){return n.split(":")[0]}var tS=(()=>{class n extends $s{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let i;if(Array.isArray(e)){let r=e.map(o=>this._getOptionId(o));i=(o,s)=>{o._setSelected(r.indexOf(s.toString())>-1)}}else i=(r,o)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{let r=[],o=i.selectedOptions;if(o!==void 0){let s=o;for(let a=0;a<s.length;a++){let u=s[a],f=this._getOptionValue(u.value);r.push(f)}}else{let s=i.options;for(let a=0;a<s.length;a++){let u=s[a];if(u.selected){let f=this._getOptionValue(u.value);r.push(f)}}}this.value=r,e(r)}}_registerOption(e){let i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){let i=LN(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){i&1&&x("change",function(s){return r.onChange(s.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ut([FN]),at]})}return n})(),Gt=(()=>{class n{_element;_renderer;_select;id;_value;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(PC(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(PC(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(D(xt),D(dn),D(tS,9))};static \u0275dir=Ce({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function jN(n){return typeof n=="number"?n:parseFloat(n)}var VN=(()=>{class n{_validator=wf;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):wf,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ce({type:n,features:[bn]})}return n})();var zN={provide:Tr,useExisting:gt(()=>dv),multi:!0},dv=(()=>{class n extends VN{min;inputName="min";normalizeInput=e=>jN(e);createValidator=e=>LC(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=Rn(n)))(r||n)}})();static \u0275dir=Ce({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&ws("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[Ut([zN]),at]})}return n})();var nS=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=On({type:n});static \u0275inj=vn({})}return n})(),Z0=class extends Us{constructor(t,e,i){super(nv(e),iv(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){Array.isArray(t)?t.forEach(i=>{this.controls.push(i),this._registerControl(i)}):(this.controls.push(t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,i={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,e={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,i={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){JC(this,!1,t),t.forEach((i,r)=>{qC(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Bl(this))}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,i)=>i._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};function kC(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var Ii=(()=>{class n{useNonNullable=!1;get nonNullable(){let e=new n;return e.useNonNullable=!0,e}group(e,i=null){let r=this._reduceControls(e),o={};return kC(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Bs(r,o)}record(e,i=null){let r=this._reduceControls(e);return new Y0(r,i)}control(e,i,r){let o={};return this.useNonNullable?(kC(i)?o=i:(o.validators=i,o.asyncValidators=r),new Ul(e,Q(N({},o),{nonNullable:!0}))):new Ul(e,i,r)}array(e,i,r){let o=e.map(s=>this._createControl(s));return new Z0(o,i,r)}_reduceControls(e){let i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){if(e instanceof Ul)return e;if(e instanceof Us)return e;if(Array.isArray(e)){let i=e[0],r=e.length>1?e[1]:null,o=e.length>2?e[2]:null;return this.control(i,r,o)}else return this.control(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Rt=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:Eo,useValue:e.callSetDisabledState??Hl}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=On({type:n});static \u0275inj=vn({imports:[nS]})}return n})(),Ti=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:cv,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Eo,useValue:e.callSetDisabledState??Hl}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=On({type:n});static \u0275inj=vn({imports:[nS]})}return n})();Le();var iS=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)};var Gl=class extends Error{constructor(t,e="FunctionsError",i){super(t),this.name=e,this.context=i}},ql=class extends Gl{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}},Jl=class extends Gl{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}},Kl=class extends Gl{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}},fv=(function(n){return n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2",n})(fv||{});var Yl=class{constructor(t,{headers:e={},customFetch:i,region:r=fv.Any}={}){this.url=t,this.headers=e,this.region=r,this.fetch=iS(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return $(this,arguments,void 0,function*(e,i={}){var r;try{let{headers:o,method:s,body:a,signal:u}=i,f={},{region:h}=i;h||(h=this.region);let m=new URL(`${this.url}/${e}`);h&&h!=="any"&&(f["x-region"]=h,m.searchParams.set("forceFunctionRegion",h));let b;a&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",b=a):typeof a=="string"?(f["Content-Type"]="text/plain",b=a):typeof FormData<"u"&&a instanceof FormData?b=a:(f["Content-Type"]="application/json",b=JSON.stringify(a)):b=a;let v=yield this.fetch(m.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),o),body:b,signal:u}).catch(A=>{throw A.name==="AbortError"?A:new ql(A)}),w=v.headers.get("x-relay-error");if(w&&w==="true")throw new Jl(v);if(!v.ok)throw new Kl(v);let M=((r=v.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),I;return M==="application/json"?I=yield v.json():M==="application/octet-stream"||M==="application/pdf"?I=yield v.blob():M==="text/event-stream"?I=v:M==="multipart/form-data"?I=yield v.formData():I=yield v.text(),{data:I,error:null,response:v}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new ql(o)}:{data:null,error:o,response:o instanceof Kl||o instanceof Jl?o.context:void 0}}})}};var Mv=Mx(pS(),1),{PostgrestClient:hS,PostgrestQueryBuilder:BZ,PostgrestFilterBuilder:$Z,PostgrestTransformBuilder:HZ,PostgrestBuilder:WZ,PostgrestError:ZN}=Mv.default||Mv;var Av=class{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let e=process.versions;if(e&&e.node){let i=e.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){let i=this.getWebSocketConstructor();return new i(t,e)}static isWebSocketSupported(){try{let t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}},Rv=Av;var mS="2.77.0";var gS=`realtime-js/${mS}`,vS="1.0.0";var Ql=1e4,_S=1e3,yS=100,Xl=(function(n){return n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed",n})(Xl||{}),bt=(function(n){return n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving",n})(bt||{}),Vn=(function(n){return n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token",n})(Vn||{}),Ov=(function(n){return n.websocket="websocket",n})(Ov||{}),Co=(function(n){return n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed",n})(Co||{});var Nf=class{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){let e=new DataView(t),i=new TextDecoder;return this._decodeBroadcast(t,e,i)}_decodeBroadcast(t,e,i){let r=e.getUint8(1),o=e.getUint8(2),s=this.HEADER_LENGTH+2,a=i.decode(t.slice(s,s+r));s=s+r;let u=i.decode(t.slice(s,s+o));s=s+o;let f=JSON.parse(i.decode(t.slice(s,t.byteLength)));return{ref:null,topic:a,event:u,payload:f}}};var Gs=class{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var je=(function(n){return n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange",n})(je||{}),Pv=(n,t,e={})=>{var i;let r=(i=e.skipTypes)!==null&&i!==void 0?i:[];return t?Object.keys(t).reduce((o,s)=>(o[s]=QN(s,n,t,r),o),{}):{}},QN=(n,t,e,i)=>{let r=t.find(a=>a.name===n),o=r?.type,s=e[n];return o&&!i.includes(o)?bS(o,s):Nv(s)},bS=(n,t)=>{if(n.charAt(0)==="_"){let e=n.slice(1,n.length);return nP(t,e)}switch(n){case je.bool:return XN(t);case je.float4:case je.float8:case je.int2:case je.int4:case je.int8:case je.numeric:case je.oid:return eP(t);case je.json:case je.jsonb:return tP(t);case je.timestamp:return iP(t);case je.abstime:case je.date:case je.daterange:case je.int4range:case je.int8range:case je.money:case je.reltime:case je.text:case je.time:case je.timestamptz:case je.timetz:case je.tsrange:case je.tstzrange:return Nv(t);default:return Nv(t)}},Nv=n=>n,XN=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},eP=n=>{if(typeof n=="string"){let t=parseFloat(n);if(!Number.isNaN(t))return t}return n},tP=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(t){return console.log(`JSON parse error: ${t}`),n}return n},nP=(n,t)=>{if(typeof n!="string")return n;let e=n.length-1,i=n[e];if(n[0]==="{"&&i==="}"){let o,s=n.slice(1,e);try{o=JSON.parse("["+s+"]")}catch{o=s?s.split(","):[]}return o.map(a=>bS(t,a))}return n},iP=n=>typeof n=="string"?n.replace(" ","T"):n,Pf=n=>{let t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};var qs=class{constructor(t,e,i={},r=Ql){this.channel=t,this.event=e,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var i;return this._hasReceived(t)&&e((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(i=>i.status===t).forEach(i=>i.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}};var ec=class n{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let i=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},r=>{let{onJoin:o,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=n.syncState(this.state,r,o,s),this.pendingDiffs.forEach(u=>{this.state=n.syncDiff(this.state,u,o,s)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},r=>{let{onJoin:o,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=n.syncDiff(this.state,r,o,s),a())}),this.onJoin((r,o,s)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:o,newPresences:s})}),this.onLeave((r,o,s)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:o,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,i,r){let o=this.cloneDeep(t),s=this.transformState(e),a={},u={};return this.map(o,(f,h)=>{s[f]||(u[f]=h)}),this.map(s,(f,h)=>{let m=o[f];if(m){let b=h.map(I=>I.presence_ref),v=m.map(I=>I.presence_ref),w=h.filter(I=>v.indexOf(I.presence_ref)<0),M=m.filter(I=>b.indexOf(I.presence_ref)<0);w.length>0&&(a[f]=w),M.length>0&&(u[f]=M)}else a[f]=h}),this.syncDiff(o,{joins:a,leaves:u},i,r)}static syncDiff(t,e,i,r){let{joins:o,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(o,(a,u)=>{var f;let h=(f=t[a])!==null&&f!==void 0?f:[];if(t[a]=this.cloneDeep(u),h.length>0){let m=t[a].map(v=>v.presence_ref),b=h.filter(v=>m.indexOf(v.presence_ref)<0);t[a].unshift(...b)}i(a,h,u)}),this.map(s,(a,u)=>{let f=t[a];if(!f)return;let h=u.map(m=>m.presence_ref);f=f.filter(m=>h.indexOf(m.presence_ref)<0),t[a]=f,r(a,f,u),f.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(i=>e(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,i)=>{let r=t[i];return"metas"in r?e[i]=r.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):e[i]=r,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var tc=(function(n){return n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system",n})(tc||{}),er=(function(n){return n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR",n})(er||{});var nc=class n{constructor(t,e={config:{}},i){var r,o;if(this.topic=t,this.params=e,this.socket=i,this.bindings={},this.state=bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new qs(this,Vn.join,this.params,this.timeout),this.rejoinTimer=new Gs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=bt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=bt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Vn.reply,{},(s,a)=>{this._trigger(this._replyEventName(a),s)}),this.presence=new ec(this),this.broadcastEndpointURL=Pf(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var i,r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==bt.closed){let{config:{broadcast:s,presence:a,private:u}}=this.params,f=(r=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(v=>v.filter))!==null&&r!==void 0?r:[],h=!!this.bindings[tc.PRESENCE]&&this.bindings[tc.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,m={},b={broadcast:s,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:f,private:u};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(v=>t?.(er.CHANNEL_ERROR,v)),this._onClose(()=>t?.(er.CLOSED)),this.updateJoinPayload(Object.assign({config:b},m)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",w=>y(this,[w],function*({postgres_changes:v}){var M;if(this.socket.setAuth(),v===void 0){t?.(er.SUBSCRIBED);return}else{let I=this.bindings.postgres_changes,A=(M=I?.length)!==null&&M!==void 0?M:0,j=[];for(let V=0;V<A;V++){let L=I[V],{filter:{event:se,schema:B,table:q,filter:he}}=L,Ve=v&&v[V];if(Ve&&Ve.event===se&&Ve.schema===B&&Ve.table===q&&Ve.filter===he)j.push(Object.assign(Object.assign({},L),{id:Ve.id}));else{this.unsubscribe(),this.state=bt.errored,t?.(er.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=j,t&&t(er.SUBSCRIBED);return}})).receive("error",v=>{this.state=bt.errored,t?.(er.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{t?.(er.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(i){return y(this,arguments,function*(t,e={}){return yield this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)})}untrack(){return y(this,arguments,function*(t={}){return yield this.send({type:"presence",event:"untrack"},t)})}on(t,e,i){return this.state===bt.joined&&t===tc.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,e,i)}httpSend(r,o){return y(this,arguments,function*(t,e,i={}){var s;let a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(e==null)return Promise.reject("Payload is required for httpSend()");let u={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},f=yield this._fetchWithTimeout(this.broadcastEndpointURL,u,(s=i.timeout)!==null&&s!==void 0?s:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{let m=yield f.json();h=m.error||m.message||h}catch{}return Promise.reject(new Error(h))})}send(i){return y(this,arguments,function*(t,e={}){var r,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:s,payload:a}=t,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{let h=yield this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return yield(o=h.body)===null||o===void 0?void 0:o.cancel(),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var a,u,f;let h=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(u=(a=this.params)===null||a===void 0?void 0:a.config)===null||u===void 0?void 0:u.broadcast)===null||f===void 0)&&f.ack)&&s("ok"),h.receive("ok",()=>s("ok")),h.receive("error",()=>s("error")),h.receive("timeout",()=>s("timed out"))})})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=bt.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Vn.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new qs(this,Vn.leave,{},t),i.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=bt.closed,this.bindings={}}_fetchWithTimeout(t,e,i){return y(this,null,function*(){let r=new AbortController,o=setTimeout(()=>r.abort(),i),s=yield this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(o),s})}_push(t,e,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new qs(this,t,e,i);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>yS){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,i){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,i){var r,o;let s=t.toLocaleLowerCase(),{close:a,error:u,leave:f,join:h}=Vn;if(i&&[a,u,f,h].indexOf(s)>=0&&i!==this._joinRef())return;let b=this._onMessage(s,e,i);if(e&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(v=>{var w,M,I;return((w=v.filter)===null||w===void 0?void 0:w.event)==="*"||((I=(M=v.filter)===null||M===void 0?void 0:M.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===s}).map(v=>v.callback(b,i)):(o=this.bindings[s])===null||o===void 0||o.filter(v=>{var w,M,I,A,j,V;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in v){let L=v.id,se=(w=v.filter)===null||w===void 0?void 0:w.event;return L&&((M=e.ids)===null||M===void 0?void 0:M.includes(L))&&(se==="*"||se?.toLocaleLowerCase()===((I=e.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{let L=(j=(A=v?.filter)===null||A===void 0?void 0:A.event)===null||j===void 0?void 0:j.toLocaleLowerCase();return L==="*"||L===((V=e?.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===s}).map(v=>{if(typeof b=="object"&&"ids"in b){let w=b.data,{schema:M,table:I,commit_timestamp:A,type:j,errors:V}=w;b=Object.assign(Object.assign({},{schema:M,table:I,commit_timestamp:A,eventType:j,new:{},old:{},errors:V}),this._getPayloadRecords(w))}v.callback(b,i)})}_isClosed(){return this.state===bt.closed}_isJoined(){return this.state===bt.joined}_isJoining(){return this.state===bt.joining}_isLeaving(){return this.state===bt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,i){let r=t.toLocaleLowerCase(),o={type:r,filter:e,callback:i};return this.bindings[r]?this.bindings[r].push(o):this.bindings[r]=[o],this}_off(t,e){let i=t.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(r=>{var o;return!(((o=r.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&n.isEqual(r.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let i in t)if(t[i]!==e[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Vn.close,{},t)}_onError(t){this._on(Vn.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=bt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){let e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Pv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Pv(t.columns,t.old_record)),e}};var kv=()=>{},kf={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},oP=[1e3,2e3,5e3,1e4],sP=1e4,aP=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,ic=class{constructor(t,e){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ql,this.transport=null,this.heartbeatIntervalMs=kf.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kv,this.ref=0,this.reconnectTimer=null,this.logger=kv,this.conn=null,this.sendBuffer=[],this.serializer=new Nf,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...s)=>import("./chunk-HXKWO5LS.js").then(({default:a})=>a(...s)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...s)=>o(...s)},!(!((i=e?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Ov.websocket}`,this.httpEndpoint=Pf(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Rv.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:vS}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},t?this.conn.close(t,e??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(t){return y(this,null,function*(){let e=yield t.unsubscribe();return this.channels.length===0&&this.disconnect(),e})}removeAllChannels(){return y(this,null,function*(){let t=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t})}log(t,e,i){this.logger(t,e,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Xl.connecting:return Co.Connecting;case Xl.open:return Co.Open;case Xl.closing:return Co.Closing;default:return Co.Closed}}isConnected(){return this.connectionState()===Co.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){let i=`realtime:${t}`,r=this.getChannels().find(o=>o.topic===i);if(r)return r;{let o=new nc(`realtime:${t}`,e,this);return this.channels.push(o),o}}push(t){let{topic:e,event:i,payload:r,ref:o}=t,s=()=>{this.encode(t,a=>{var u;(u=this.conn)===null||u===void 0||u.send(a)})};this.log("push",`${e} ${i} (${o})`,r),this.isConnected()?s():this.sendBuffer.push(s)}setAuth(t=null){return y(this,null,function*(){this._authPromise=this._performAuth(t);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return y(this,null,function*(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(_S,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},kf.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")})}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(i=>i.topic===t&&(i._isJoined()||i._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply")try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:i,event:r,payload:o,ref:s}=e,a=s?`(${s})`:"",u=o.status||"";this.log("receive",`${u} ${i} ${r} ${a}`.trim(),o),this.channels.filter(f=>f._isMember(i)).forEach(f=>f._trigger(r,o,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Vn.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;let i=t.match(/\?/)?"&":"?",r=new URLSearchParams(e);return`${t}${i}${r}`}_workerObjectUrl(t){let e;if(t)e=t;else{let i=new Blob([aP],{type:"application/javascript"});e=URL.createObjectURL(i)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}_performAuth(t=null){return y(this,null,function*(){let e;t?e=t:this.accessToken?e=yield this.accessToken():e=this.accessTokenValue,this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(i=>{let r={access_token:e,version:gS};e&&i.updateJoinPayload(r),i.joinedOnce&&i._isJoined()&&i._push(Vn.access_token,{access_token:e})}))})}_waitForAuthIfNeeded(){return y(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(t="general"){this.setAuth().catch(e=>{this.log("error",`error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(i=>{try{i(e)}catch(r){this.log("error",`error in ${t} callback`,r)}})}catch(i){this.log("error",`error triggering ${t} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Gs(()=>y(this,null,function*(){setTimeout(()=>y(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),kf.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(t){var e,i,r,o,s,a,u,f,h;if(this.transport=(e=t?.transport)!==null&&e!==void 0?e:null,this.timeout=(i=t?.timeout)!==null&&i!==void 0?i:Ql,this.heartbeatIntervalMs=(r=t?.heartbeatIntervalMs)!==null&&r!==void 0?r:kf.HEARTBEAT_INTERVAL,this.worker=(o=t?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(s=t?.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(a=t?.heartbeatCallback)!==null&&a!==void 0?a:kv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=t?.reconnectAfterMs)!==null&&u!==void 0?u:m=>oP[m-1]||sP,this.encode=(f=t?.encode)!==null&&f!==void 0?f:(m,b)=>b(JSON.stringify(m)),this.decode=(h=t?.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}};Le();var Js=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Oe(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Ff=class extends Js{constructor(t,e,i){super(t),this.name="StorageApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},So=class extends Js{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};Le();Le();var Ks=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)},wS=()=>$(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-HXKWO5LS.js")).Response:Response}),Lf=n=>{if(Array.isArray(n))return n.map(e=>Lf(e));if(typeof n=="function"||n!==Object(n))return n;let t={};return Object.entries(n).forEach(([e,i])=>{let r=e.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[r]=Lf(i)}),t},ES=n=>{if(typeof n!="object"||n===null)return!1;let t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Fv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),lP=(n,t,e)=>$(void 0,void 0,void 0,function*(){let i=yield wS();n instanceof i&&!e?.noResolveJson?n.json().then(r=>{let o=n.status||500,s=r?.statusCode||o+"";t(new Ff(Fv(r),o,s))}).catch(r=>{t(new So(Fv(r),r))}):t(new So(Fv(n),n))}),cP=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"||!i?r:(ES(i)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(i)):r.body=i,t?.duplex&&(r.duplex=t.duplex),Object.assign(Object.assign({},r),e))};function rc(n,t,e,i,r,o){return $(this,void 0,void 0,function*(){return new Promise((s,a)=>{n(e,cP(t,i,r,o)).then(u=>{if(!u.ok)throw u;return i?.noResolveJson?u:u.json()}).then(u=>s(u)).catch(u=>lP(u,a,i))})})}function Mr(n,t,e,i){return $(this,void 0,void 0,function*(){return rc(n,"GET",t,e,i)})}function mn(n,t,e,i,r){return $(this,void 0,void 0,function*(){return rc(n,"POST",t,i,r,e)})}function oc(n,t,e,i,r){return $(this,void 0,void 0,function*(){return rc(n,"PUT",t,i,r,e)})}function CS(n,t,e,i){return $(this,void 0,void 0,function*(){return rc(n,"HEAD",t,Object.assign(Object.assign({},e),{noResolveJson:!0}),i)})}function Ys(n,t,e,i,r){return $(this,void 0,void 0,function*(){return rc(n,"DELETE",t,i,r,e)})}Le();Le();var jf=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}execute(){return $(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Oe(t))return{data:null,error:t};throw t}})}};var SS,Lv=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[SS]="BlobDownloadBuilder",this.promise=null}asStream(){return new jf(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return $(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Oe(t))return{data:null,error:t};throw t}})}};SS=Symbol.toStringTag;var xS=Lv;var uP={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Vf=class{constructor(t,e={},i,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=i,this.fetch=Ks(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,e,i,r){return $(this,void 0,void 0,function*(){try{let o,s=Object.assign(Object.assign({},DS),r),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(s.upsert)}),u=s.metadata;typeof Blob<"u"&&i instanceof Blob?(o=new FormData,o.append("cacheControl",s.cacheControl),u&&o.append("metadata",this.encodeMetadata(u)),o.append("",i)):typeof FormData<"u"&&i instanceof FormData?(o=i,o.append("cacheControl",s.cacheControl),u&&o.append("metadata",this.encodeMetadata(u))):(o=i,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,u&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),r?.headers&&(a=Object.assign(Object.assign({},a),r.headers));let f=this._removeEmptyFolders(e),h=this._getFinalPath(f),m=yield(t=="PUT"?oc:mn)(this.fetch,`${this.url}/object/${h}`,o,Object.assign({headers:a},s?.duplex?{duplex:s.duplex}:{}));return{data:{path:f,id:m.Id,fullPath:m.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Oe(o))return{data:null,error:o};throw o}})}upload(t,e,i){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,i)})}uploadToSignedUrl(t,e,i,r){return $(this,void 0,void 0,function*(){let o=this._removeEmptyFolders(t),s=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let u,f=Object.assign({upsert:DS.upsert},r),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",f.cacheControl),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.append("cacheControl",f.cacheControl)):(u=i,h["cache-control"]=`max-age=${f.cacheControl}`,h["content-type"]=f.contentType);let m=yield oc(this.fetch,a.toString(),u,{headers:h});return{data:{path:o,fullPath:m.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Oe(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(t,e){return $(this,void 0,void 0,function*(){try{let i=this._getFinalPath(t),r=Object.assign({},this.headers);e?.upsert&&(r["x-upsert"]="true");let o=yield mn(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:r}),s=new URL(this.url+o.url),a=s.searchParams.get("token");if(!a)throw new Js("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:a},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Oe(i))return{data:null,error:i};throw i}})}update(t,e,i){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,i)})}move(t,e,i){return $(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}copy(t,e,i){return $(this,void 0,void 0,function*(){try{return{data:{path:(yield mn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}createSignedUrl(t,e,i){return $(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t),o=yield mn(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:e},i?.transform?{transform:i.transform}:{}),{headers:this.headers}),s=i?.download?`&download=${i.download===!0?"":i.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${s}`)},{data:o,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}createSignedUrls(t,e,i){return $(this,void 0,void 0,function*(){try{let r=yield mn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),o=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:r.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${o}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}download(t,e){let r=typeof e?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(e?.transform||{}),s=o?`?${o}`:"",a=this._getFinalPath(t),u=()=>Mr(this.fetch,`${this.url}/${r}/${a}${s}`,{headers:this.headers,noResolveJson:!0});return new xS(u,this.shouldThrowOnError)}info(t){return $(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{let i=yield Mr(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Lf(i),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Oe(i))return{data:null,error:i};throw i}})}exists(t){return $(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{return yield CS(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Oe(i)&&i instanceof So){let r=i.originalError;if([400,404].includes(r?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(t,e){let i=this._getFinalPath(t),r=[],o=e?.download?`download=${e.download===!0?"":e.download}`:"";o!==""&&r.push(o);let a=typeof e?.transform<"u"?"render/image":"object",u=this.transformOptsToQueryString(e?.transform||{});u!==""&&r.push(u);let f=r.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${i}${f}`)}}}remove(t){return $(this,void 0,void 0,function*(){try{return{data:yield Ys(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}list(t,e,i){return $(this,void 0,void 0,function*(){try{let r=Object.assign(Object.assign(Object.assign({},uP),e),{prefix:t||""});return{data:yield mn(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},i),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}listV2(t,e){return $(this,void 0,void 0,function*(){try{let i=Object.assign({},t);return{data:yield mn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},e),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Oe(i))return{data:null,error:i};throw i}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){let e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};Le();var zf="2.77.0";var Uf={"X-Client-Info":`storage-js/${zf}`};var Bf=class{constructor(t,e={},i,r){this.shouldThrowOnError=!1;let o=new URL(t);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Uf),e),this.fetch=Ks(i)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return $(this,void 0,void 0,function*(){try{let e=this.listBucketOptionsToQueryString(t);return{data:yield Mr(this.fetch,`${this.url}/bucket${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}getBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield Mr(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}createBucket(t){return $(this,arguments,void 0,function*(e,i={public:!1}){try{return{data:yield mn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oe(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return $(this,void 0,void 0,function*(){try{return{data:yield oc(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Oe(i))return{data:null,error:i};throw i}})}emptyBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}deleteBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield Ys(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(t){let e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}};Le();var $f=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Uf),e),this.fetch=Ks(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}listBuckets(t){return $(this,void 0,void 0,function*(){try{let e=new URLSearchParams;t?.limit!==void 0&&e.set("limit",t.limit.toString()),t?.offset!==void 0&&e.set("offset",t.offset.toString()),t?.sortColumn&&e.set("sortColumn",t.sortColumn),t?.sortOrder&&e.set("sortOrder",t.sortOrder),t?.search&&e.set("search",t.search);let i=e.toString(),r=i?`${this.url}/bucket?${i}`:`${this.url}/bucket`;return{data:yield Mr(this.fetch,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}deleteBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield Ys(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Oe(e))return{data:null,error:e};throw e}})}};Le();Le();var Zs={"X-Client-Info":`storage-js/${zf}`,"Content-Type":"application/json"};var Hf=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function qt(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var Qs=class extends Hf{constructor(t,e,i){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Wf=class extends Hf{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};Le();var Xs=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)};var IS=n=>{if(typeof n!="object"||n===null)return!1;let t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var TS=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),dP=(n,t,e)=>$(void 0,void 0,void 0,function*(){if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!e?.noResolveJson){let r=n.status||500,o=n;if(typeof o.json=="function")o.json().then(s=>{let a=s?.statusCode||s?.code||r+"";t(new Qs(TS(s),r,a))}).catch(()=>{let s=r+"",a=o.statusText||`HTTP ${r} error`;t(new Qs(a,r,s))});else{let s=r+"",a=o.statusText||`HTTP ${r} error`;t(new Qs(a,r,s))}}else t(new Wf(TS(n),n))}),fP=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"||!i?r:(IS(i)?(r.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r.body=JSON.stringify(i)):r.body=i,Object.assign(Object.assign({},r),e))};function pP(n,t,e,i,r,o){return $(this,void 0,void 0,function*(){return new Promise((s,a)=>{n(e,fP(t,i,r,o)).then(u=>{if(!u.ok)throw u;if(i?.noResolveJson)return u;let f=u.headers.get("content-type");return!f||!f.includes("application/json")?{}:u.json()}).then(u=>s(u)).catch(u=>dP(u,a,i))})})}function Jt(n,t,e,i,r){return $(this,void 0,void 0,function*(){return pP(n,"POST",t,i,r,e)})}var Gf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zs),e),this.fetch=Xs(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return $(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getIndex(t,e){return $(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(qt(i))return{data:null,error:i};throw i}})}listIndexes(t){return $(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteIndex(t,e){return $(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(qt(i))return{data:null,error:i};throw i}})}};Le();var qf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zs),e),this.fetch=Xs(i)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return $(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getVectors(t){return $(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}listVectors(t){return $(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Jt(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}queryVectors(t){return $(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteVectors(t){return $(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}};Le();var Jf=class{constructor(t,e={},i){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zs),e),this.fetch=Xs(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return $(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}getBucket(t){return $(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}listBuckets(){return $(this,arguments,void 0,function*(t={}){try{return{data:yield Jt(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}deleteBucket(t){return $(this,void 0,void 0,function*(){try{return{data:(yield Jt(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(qt(e))return{data:null,error:e};throw e}})}};var sc=class extends Jf{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new Kf(this.url,this.headers,t,this.fetch)}},Kf=class extends Gf{constructor(t,e,i,r){super(t,e,r),this.vectorBucketName=i}createIndex(t){let e=Object.create(null,{createIndex:{get:()=>super.createIndex}});return $(this,void 0,void 0,function*(){return e.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return $(this,arguments,void 0,function*(e={}){return t.listIndexes.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){let e=Object.create(null,{getIndex:{get:()=>super.getIndex}});return $(this,void 0,void 0,function*(){return e.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){let e=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return $(this,void 0,void 0,function*(){return e.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new Yf(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},Yf=class extends qf{constructor(t,e,i,r,o){super(t,e,o),this.vectorBucketName=i,this.indexName=r}putVectors(t){let e=Object.create(null,{putVectors:{get:()=>super.putVectors}});return $(this,void 0,void 0,function*(){return e.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){let e=Object.create(null,{getVectors:{get:()=>super.getVectors}});return $(this,void 0,void 0,function*(){return e.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return $(this,arguments,void 0,function*(e={}){return t.listVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){let e=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return $(this,void 0,void 0,function*(){return e.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){let e=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return $(this,void 0,void 0,function*(){return e.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}};var ac=class extends Bf{constructor(t,e={},i,r){super(t,e,i,r)}from(t){return new Vf(this.url,this.headers,t,this.fetch)}get vectors(){return new sc(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $f(this.url+"/iceberg",this.headers,this.fetch)}};var MS="2.77.0";var lc="";typeof Deno<"u"?lc="deno":typeof document<"u"?lc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?lc="react-native":lc="node";var hP={"X-Client-Info":`supabase-js-${lc}/${MS}`},AS={headers:hP},RS={schema:"public"},OS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},NS={};n_();var mP=n=>{let t;return n?t=n:typeof fetch>"u"?t=e_:t=fetch,(...e)=>t(...e)},gP=()=>typeof Headers>"u"?t_:Headers,PS=(n,t,e)=>{let i=mP(e),r=gP();return(o,s)=>y(null,null,function*(){var a;let u=(a=yield t())!==null&&a!==void 0?a:n,f=new r(s?.headers);return f.has("apikey")||f.set("apikey",n),f.has("Authorization")||f.set("Authorization",`Bearer ${u}`),i(o,Object.assign(Object.assign({},s),{headers:f}))})};function vP(n){return n.endsWith("/")?n:n+"/"}function kS(n,t){var e,i;let{db:r,auth:o,realtime:s,global:a}=n,{db:u,auth:f,realtime:h,global:m}=t,b={db:Object.assign(Object.assign({},u),r),auth:Object.assign(Object.assign({},f),o),realtime:Object.assign(Object.assign({},h),s),storage:{},global:Object.assign(Object.assign(Object.assign({},m),a),{headers:Object.assign(Object.assign({},(e=m?.headers)!==null&&e!==void 0?e:{}),(i=a?.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>y(null,null,function*(){return""})};return n.accessToken?b.accessToken=n.accessToken:delete b.accessToken,b}function FS(n){let t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(vP(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}Le();Le();var Zf="2.77.0";var xo=30*1e3,Qf=3,Xf=Qf*xo,LS="http://localhost:9999",jS="supabase.auth.token";var VS={"X-Client-Info":`gotrue-js/${Zf}`};var cc="X-Supabase-Api-Version",jv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},zS=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,US=600*1e3;var Ar=class extends Error{constructor(t,e,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=i}};function ie(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}var ep=class extends Ar{constructor(t,e,i){super(t,e,i),this.name="AuthApiError",this.status=e,this.code=i}};function BS(n){return ie(n)&&n.name==="AuthApiError"}var zn=class extends Ar{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}},Mi=class extends Ar{constructor(t,e,i,r){super(t,i,r),this.name=e,this.status=i}},Un=class extends Mi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function $S(n){return ie(n)&&n.name==="AuthSessionMissingError"}var tr=class extends Mi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Do=class extends Mi{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}},Io=class extends Mi{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function HS(n){return ie(n)&&n.name==="AuthImplicitGrantRedirectError"}var uc=class extends Mi{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},ea=class extends Mi{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}};function tp(n){return ie(n)&&n.name==="AuthRetryableFetchError"}var dc=class extends Mi{constructor(t,e,i){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=i}};var To=class extends Mi{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}};var np="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),WS=` 	
\r=`.split(""),_P=(()=>{let n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<WS.length;t+=1)n[WS[t].charCodeAt(0)]=-2;for(let t=0;t<np.length;t+=1)n[np[t].charCodeAt(0)]=t;return n})();function GS(n,t,e){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){let i=t.queue>>t.queuedBits-6&63;e(np[i]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){let i=t.queue>>t.queuedBits-6&63;e(np[i]),t.queuedBits-=6}}function qS(n,t,e){let i=_P[n];if(i>-1)for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Vv(n){let t=[],e=s=>{t.push(String.fromCodePoint(s))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},o=s=>{wP(s,i,e)};for(let s=0;s<n.length;s+=1)qS(n.charCodeAt(s),r,o);return t.join("")}function yP(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function bP(n,t){for(let e=0;e<n.length;e+=1){let i=n.charCodeAt(e);if(i>55295&&i<=56319){let r=(i-55296)*1024&65535;i=(n.charCodeAt(e+1)-56320&65535|r)+65536,e+=1}yP(i,t)}}function wP(n,t,e){if(t.utf8seq===0){if(n<=127){e(n);return}for(let i=1;i<6;i+=1)if((n>>7-i&1)===0){t.utf8seq=i;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Rr(n){let t=[],e={queue:0,queuedBits:0},i=r=>{t.push(r)};for(let r=0;r<n.length;r+=1)qS(n.charCodeAt(r),e,i);return new Uint8Array(t)}function JS(n){let t=[];return bP(n,e=>t.push(e)),new Uint8Array(t)}function nr(n){let t=[],e={queue:0,queuedBits:0},i=r=>{t.push(r)};return n.forEach(r=>GS(r,e,i)),GS(null,e,i),t.join("")}function KS(n){return Math.round(Date.now()/1e3)+n}function YS(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let t=Math.random()*16|0;return(n=="x"?t:t&3|8).toString(16)})}var an=()=>typeof window<"u"&&typeof document<"u",Mo={tested:!1,writable:!1},ip=()=>{if(!an())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mo.tested)return Mo.writable;let n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Mo.tested=!0,Mo.writable=!0}catch{Mo.tested=!0,Mo.writable=!1}return Mo.writable};function ZS(n){let t={},e=new URL(n);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((r,o)=>{t[o]=r})}catch{}return e.searchParams.forEach((i,r)=>{t[r]=i}),t}var rp=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...e)=>import("./chunk-HXKWO5LS.js").then(({default:i})=>i(...e)):t=fetch,(...e)=>t(...e)},QS=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ao=(n,t,e)=>y(null,null,function*(){yield n.setItem(t,JSON.stringify(e))}),Or=(n,t)=>y(null,null,function*(){let e=yield n.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}}),ir=(n,t)=>y(null,null,function*(){yield n.removeItem(t)}),fc=class n{constructor(){this.promise=new n.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}};fc.promiseConstructor=Promise;function op(n){let t=n.split(".");if(t.length!==3)throw new To("Invalid JWT structure");for(let i=0;i<t.length;i++)if(!zS.test(t[i]))throw new To("JWT not in base64url format");return{header:JSON.parse(Vv(t[0])),payload:JSON.parse(Vv(t[1])),signature:Rr(t[2]),raw:{header:t[0],payload:t[1]}}}function XS(n){return y(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),n)})})}function ex(n,t){return new Promise((i,r)=>{y(null,null,function*(){for(let o=0;o<1/0;o++)try{let s=yield n(o);if(!t(o,null,s)){i(s);return}}catch(s){if(!t(o,s)){r(s);return}}})})}function EP(n){return("0"+n.toString(16)).substr(-2)}function CP(){let t=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=e.length,r="";for(let o=0;o<56;o++)r+=e.charAt(Math.floor(Math.random()*i));return r}return crypto.getRandomValues(t),Array.from(t,EP).join("")}function SP(n){return y(this,null,function*(){let e=new TextEncoder().encode(n),i=yield crypto.subtle.digest("SHA-256",e),r=new Uint8Array(i);return Array.from(r).map(o=>String.fromCharCode(o)).join("")})}function xP(n){return y(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;let e=yield SP(n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function Ro(n,t,e=!1){return y(this,null,function*(){let i=CP(),r=i;e&&(r+="/PASSWORD_RECOVERY"),yield Ao(n,`${t}-code-verifier`,r);let o=yield xP(i);return[o,i===o?"plain":"s256"]})}var DP=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function tx(n){let t=n.headers.get(cc);if(!t||!t.match(DP))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function nx(n){if(!n)throw new Error("Missing exp claim");let t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function ix(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var IP=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oo(n){if(!IP.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function sp(){let n={};return new Proxy(n,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){let i=e.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function zv(n){return JSON.parse(JSON.stringify(n))}var No=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),TP=[502,503,504];function rx(n){return y(this,null,function*(){var t;if(!QS(n))throw new ea(No(n),0);if(TP.includes(n.status))throw new ea(No(n),n.status);let e;try{e=yield n.json()}catch(o){throw new zn(No(o),o)}let i,r=tx(n);if(r&&r.getTime()>=jv["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?i=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(i=e.error_code),i){if(i==="weak_password")throw new dc(No(e),n.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(i==="session_not_found")throw new Un}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((o,s)=>o&&typeof s=="string",!0))throw new dc(No(e),n.status,e.weak_password.reasons);throw new ep(No(e),n.status||500,i)})}var MP=(n,t,e,i)=>{let r={method:n,headers:t?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),e))};function ae(n,t,e,i){return y(this,null,function*(){var r;let o=Object.assign({},i?.headers);o[cc]||(o[cc]=jv["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);let s=(r=i?.query)!==null&&r!==void 0?r:{};i?.redirectTo&&(s.redirect_to=i.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",u=yield AP(n,t,e+a,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(u):{data:Object.assign({},u),error:null}})}function AP(n,t,e,i,r,o){return y(this,null,function*(){let s=MP(t,i,r,o),a;try{a=yield n(e,Object.assign({},s))}catch(u){throw console.error(u),new ea(No(u),0)}if(a.ok||(yield rx(a)),i?.noResolveJson)return a;try{return yield a.json()}catch(u){yield rx(u)}})}function Bn(n){var t;let e=null;RP(n)&&(e=Object.assign({},n),n.expires_at||(e.expires_at=KS(n.expires_in)));let i=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:e,user:i},error:null}}function Uv(n){let t=Bn(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((e,i)=>e&&typeof i=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ai(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function ox(n){return{data:n,error:null}}function sx(n){let{action_link:t,email_otp:e,hashed_token:i,redirect_to:r,verification_type:o}=n,s=Ni(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:i,redirect_to:r,verification_type:o},u=Object.assign({},s);return{data:{properties:a,user:u},error:null}}function Bv(n){return n}function RP(n){return n.access_token&&n.refresh_token&&n.expires_in}var ap=["global","local","others"];var ta=class{constructor({url:t="",headers:e={},fetch:i}){this.url=t,this.headers=e,this.fetch=rp(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(i){return y(this,arguments,function*(t,e=ap[0]){if(ap.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ap.join(", ")}`);try{return yield ae(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ie(r))return{data:null,error:r};throw r}})}inviteUserByEmail(i){return y(this,arguments,function*(t,e={}){try{return yield ae(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ai})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}})}generateLink(t){return y(this,null,function*(){try{let{options:e}=t,i=Ni(t,["options"]),r=Object.assign(Object.assign({},i),e);return"newEmail"in i&&(r.new_email=i?.newEmail,delete r.newEmail),yield ae(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:sx,redirectTo:e?.redirectTo})}catch(e){if(ie(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return y(this,null,function*(){try{return yield ae(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ai})}catch(e){if(ie(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return y(this,null,function*(){var e,i,r,o,s,a,u;try{let f={nextPage:null,lastPage:0,total:0},h=yield ae(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Bv});if(h.error)throw h.error;let m=yield h.json(),b=(s=h.headers.get("x-total-count"))!==null&&s!==void 0?s:0,v=(u=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&u!==void 0?u:[];return v.length>0&&(v.forEach(w=>{let M=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(w.split(";")[1].split("=")[1]);f[`${I}Page`]=M}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(ie(f))return{data:{users:[]},error:f};throw f}})}getUserById(t){return y(this,null,function*(){Oo(t);try{return yield ae(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ai})}catch(e){if(ie(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,e){return y(this,null,function*(){Oo(t);try{return yield ae(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ai})}catch(i){if(ie(i))return{data:{user:null},error:i};throw i}})}deleteUser(t,e=!1){return y(this,null,function*(){Oo(t);try{return yield ae(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ai})}catch(i){if(ie(i))return{data:{user:null},error:i};throw i}})}_listFactors(t){return y(this,null,function*(){Oo(t.userId);try{let{data:e,error:i}=yield ae(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:e,error:i}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_deleteFactor(t){return y(this,null,function*(){Oo(t.userId),Oo(t.id);try{return{data:yield ae(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_listOAuthClients(t){return y(this,null,function*(){var e,i,r,o,s,a,u;try{let f={nextPage:null,lastPage:0,total:0},h=yield ae(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=t?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Bv});if(h.error)throw h.error;let m=yield h.json(),b=(s=h.headers.get("x-total-count"))!==null&&s!==void 0?s:0,v=(u=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&u!==void 0?u:[];return v.length>0&&(v.forEach(w=>{let M=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(w.split(";")[1].split("=")[1]);f[`${I}Page`]=M}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(ie(f))return{data:{clients:[]},error:f};throw f}})}_createOAuthClient(t){return y(this,null,function*(){try{return yield ae(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_getOAuthClient(t){return y(this,null,function*(){try{return yield ae(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_deleteOAuthClient(t){return y(this,null,function*(){try{return yield ae(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(ie(e))return{data:null,error:e};throw e}})}_regenerateOAuthClientSecret(t){return y(this,null,function*(){try{return yield ae(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(ie(e))return{data:null,error:e};throw e}})}};function $v(n={}){return{getItem:t=>n[t]||null,setItem:(t,e)=>{n[t]=e},removeItem:t=>{delete n[t]}}}var Po={debug:!!(globalThis&&ip()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},pc=class extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}},lp=class extends pc{};function Hv(n,t,e){return y(this,null,function*(){Po.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);let i=new globalThis.AbortController;return t>0&&setTimeout(()=>{i.abort(),Po.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},r=>y(null,null,function*(){if(r){Po.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return yield e()}finally{Po.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(t===0)throw Po.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new lp(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Po.debug)try{let o=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}})))})}function ax(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Wv(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function lx(n){return parseInt(n,16)}function cx(n){let t=new TextEncoder().encode(n);return"0x"+Array.from(t,i=>i.toString(16).padStart(2,"0")).join("")}function ux(n){var t;let{chainId:e,domain:i,expirationTime:r,issuedAt:o=new Date,nonce:s,notBefore:a,requestId:u,resources:f,scheme:h,uri:m,version:b}=n;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}let v=Wv(n.address),w=h?`${h}://${i}`:i,M=n.statement?`${n.statement}
`:"",I=`${w} wants you to sign in with your Ethereum account:
${v}

${M}`,A=`URI: ${m}
Version: ${b}
Chain ID: ${e}${s?`
Nonce: ${s}`:""}
Issued At: ${o.toISOString()}`;if(r&&(A+=`
Expiration Time: ${r.toISOString()}`),a&&(A+=`
Not Before: ${a.toISOString()}`),u&&(A+=`
Request ID: ${u}`),f){let j=`
Resources:`;for(let V of f){if(!V||typeof V!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${V}`);j+=`
- ${V}`}A+=j}return`${I}
${A}`}Le();var Ke=class extends Error{constructor({message:t,code:e,cause:i,name:r}){var o;super(t,{cause:i}),this.__isWebAuthnError=!0,this.name=(o=r??(i instanceof Error?i.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=e}},ko=class extends Ke{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}};function dx({error:n,options:t}){var e,i,r;let{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ke({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((e=o.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new Ke({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Ke({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Ke({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Ke({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Ke({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return o.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Ke({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Ke({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){let s=window.location.hostname;if(Gv(s)){if(o.rp.id!==s)return new Ke({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Ke({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Ke({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Ke({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Ke({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function fx({error:n,options:t}){let{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ke({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Ke({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){let i=window.location.hostname;if(Gv(i)){if(e.rpId!==i)return new Ke({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Ke({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Ke({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Ke({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}var qv=class{createNewAbortSignal(){if(this.controller){let e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){let t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}},OP=new qv;function hx(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);let{challenge:t,user:e,excludeCredentials:i}=n,r=Ni(n,["challenge","user","excludeCredentials"]),o=Rr(t).buffer,s=Object.assign(Object.assign({},e),{id:Rr(e.id).buffer}),a=Object.assign(Object.assign({},r),{challenge:o,user:s});if(i&&i.length>0){a.excludeCredentials=new Array(i.length);for(let u=0;u<i.length;u++){let f=i[u];a.excludeCredentials[u]=Object.assign(Object.assign({},f),{id:Rr(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return a}function mx(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);let{challenge:t,allowCredentials:e}=n,i=Ni(n,["challenge","allowCredentials"]),r=Rr(t).buffer,o=Object.assign(Object.assign({},i),{challenge:r});if(e&&e.length>0){o.allowCredentials=new Array(e.length);for(let s=0;s<e.length;s++){let a=e[s];o.allowCredentials[s]=Object.assign(Object.assign({},a),{id:Rr(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return o}function gx(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let e=n;return{id:n.id,rawId:n.id,response:{attestationObject:nr(new Uint8Array(n.response.attestationObject)),clientDataJSON:nr(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function vx(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let e=n,i=n.getClientExtensionResults(),r=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:nr(new Uint8Array(r.authenticatorData)),clientDataJSON:nr(new Uint8Array(r.clientDataJSON)),signature:nr(new Uint8Array(r.signature)),userHandle:r.userHandle?nr(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Gv(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function px(){var n,t;return!!(an()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}function NP(n){return y(this,null,function*(){try{let t=yield navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ko("Browser returned unexpected credential type",t)}:{data:null,error:new ko("Empty credential response",t)}}catch(t){return{data:null,error:dx({error:t,options:n})}}})}function PP(n){return y(this,null,function*(){try{let t=yield navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ko("Browser returned unexpected credential type",t)}:{data:null,error:new ko("Empty credential response",t)}}catch(t){return{data:null,error:fx({error:t,options:n})}}})}var kP={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},FP={userVerification:"preferred",hints:["security-key"]};function cp(...n){let t=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),e=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),i={};for(let r of n)if(r)for(let o in r){let s=r[o];if(s!==void 0)if(Array.isArray(s))i[o]=s;else if(e(s))i[o]=s;else if(t(s)){let a=i[o];t(a)?i[o]=cp(a,s):i[o]=cp(s)}else i[o]=s}return i}function LP(n,t){return cp(kP,n,t||{})}function jP(n,t){return cp(FP,n,t||{})}var up=class{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(t){return y(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))})}_challenge(s,a){return y(this,arguments,function*({factorId:t,webauthn:e,friendlyName:i,signal:r},o){try{let{data:u,error:f}=yield this.client.mfa.challenge({factorId:t,webauthn:e});if(!u)return{data:null,error:f};let h=r??OP.createNewAbortSignal();if(u.webauthn.type==="create"){let{user:m}=u.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${i}`),m.displayName||(m.displayName=m.name)}switch(u.webauthn.type){case"create":{let m=LP(u.webauthn.credential_options.publicKey,o?.create),{data:b,error:v}=yield NP({publicKey:m,signal:h});return b?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:b}},error:null}:{data:null,error:v}}case"request":{let m=jP(u.webauthn.credential_options.publicKey,o?.request),{data:b,error:v}=yield PP(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:m,signal:h}));return b?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:b}},error:null}:{data:null,error:v}}}}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new zn("Unexpected error in challenge",u)}}})}_verify(r){return y(this,arguments,function*({challengeId:t,factorId:e,webauthn:i}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:i})})}_authenticate(s,a){return y(this,arguments,function*({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r}},o){if(!e)return{data:null,error:new Ar("rpId is required for WebAuthn authentication")};try{if(!px())return{data:null,error:new zn("Browser does not support WebAuthn",null)};let{data:u,error:f}=yield this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:i},signal:r},{request:o});if(!u)return{data:null,error:f};let{webauthn:h}=u;return this._verify({factorId:t,challengeId:u.challengeId,webauthn:{type:h.type,rpId:e,rpOrigins:i,credential_response:h.credential_response}})}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new zn("Unexpected error in authenticate",u)}}})}_register(s,a){return y(this,arguments,function*({friendlyName:t,rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r},o){if(!e)return{data:null,error:new Ar("rpId is required for WebAuthn registration")};try{if(!px())return{data:null,error:new zn("Browser does not support WebAuthn",null)};let{data:u,error:f}=yield this._enroll({friendlyName:t});if(!u)return yield this.client.mfa.listFactors().then(b=>{var v;return(v=b.data)===null||v===void 0?void 0:v.all.find(w=>w.factor_type==="webauthn"&&w.friendly_name===t&&w.status!=="unverified")}).then(b=>b?this.client.mfa.unenroll({factorId:b?.id}):void 0),{data:null,error:f};let{data:h,error:m}=yield this._challenge({factorId:u.id,friendlyName:u.friendly_name,webauthn:{rpId:e,rpOrigins:i},signal:r},{create:o});return h?this._verify({factorId:u.id,challengeId:h.challengeId,webauthn:{rpId:e,rpOrigins:i,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:m}}catch(u){return ie(u)?{data:null,error:u}:{data:null,error:new zn("Unexpected error in register",u)}}})}};ax();var VP={url:LS,storageKey:jS,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:VS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function _x(n,t,e){return y(this,null,function*(){return yield e()})}var na={},zP=(()=>{class n{get jwks(){var e,i;return(i=(e=na[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(e){na[this.storageKey]=Object.assign(Object.assign({},na[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,i;return(i=(e=na[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){na[this.storageKey]=Object.assign(Object.assign({},na[this.storageKey]),{cachedAt:e})}constructor(e){var i,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=n.nextInstanceID,n.nextInstanceID+=1,this.instanceID>0&&an()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let o=Object.assign(Object.assign({},VP),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new ta({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=rp(o.fetch),this.lock=o.lock||_x,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:an()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=Hv:this.lock=_x,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new up(this)},this.persistSession?(o.storage?this.storage=o.storage:ip()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$v(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=$v(this.memoryStorage)),an()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",s=>y(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Zf}) ${new Date().toISOString()}`,...e),this}initialize(){return y(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=y(this,null,function*(){return yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return y(this,null,function*(){var e;try{let i=ZS(window.location.href),r="none";if(this._isImplicitGrantCallback(i)?r="implicit":(yield this._isPKCECallback(i))&&(r="pkce"),an()&&this.detectSessionInUrl&&r!=="none"){let{data:o,error:s}=yield this._getSessionFromURL(i,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),HS(s)){let f=(e=s.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:s}}return yield this._removeSession(),{error:s}}let{session:a,redirectType:u}=o;return this._debug("#_initialize()","detected session in URL",a,"redirect type",u),yield this._saveSession(a),setTimeout(()=>y(this,null,function*(){u==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",a):yield this._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(i){return ie(i)?{error:i}:{error:new zn("Unexpected error during initialization",i)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return y(this,null,function*(){var i,r,o;try{let s=yield ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(i=e?.options)===null||i===void 0?void 0:i.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Bn}),{data:a,error:u}=s;if(u||!a)return{data:{user:null,session:null},error:u};let f=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(s){if(ie(s))return{data:{user:null,session:null},error:s};throw s}})}signUp(e){return y(this,null,function*(){var i,r,o;try{let s;if("email"in e){let{email:m,password:b,options:v}=e,w=null,M=null;this.flowType==="pkce"&&([w,M]=yield Ro(this.storage,this.storageKey)),s=yield ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v?.emailRedirectTo,body:{email:m,password:b,data:(i=v?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:w,code_challenge_method:M},xform:Bn})}else if("phone"in e){let{phone:m,password:b,options:v}=e;s=yield ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:b,data:(r=v?.data)!==null&&r!==void 0?r:{},channel:(o=v?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:v?.captchaToken}},xform:Bn})}else throw new Do("You must provide either an email or phone number and a password");let{data:a,error:u}=s;if(u||!a)return{data:{user:null,session:null},error:u};let f=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(s){if(ie(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithPassword(e){return y(this,null,function*(){try{let i;if("email"in e){let{email:s,password:a,options:u}=e;i=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Uv})}else if("phone"in e){let{phone:s,password:a,options:u}=e;i=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Uv})}else throw new Do("You must provide either an email or phone number and a password");let{data:r,error:o}=i;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new tr}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithOAuth(e){return y(this,null,function*(){var i,r,o,s;return yield this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})})}exchangeCodeForSession(e){return y(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>y(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return y(this,null,function*(){let{chain:i}=e;switch(i){case"ethereum":return yield this.signInWithEthereum(e);case"solana":return yield this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}})}signInWithEthereum(e){return y(this,null,function*(){var i,r,o,s,a,u,f,h,m,b,v;let w,M;if("message"in e)w=e.message,M=e.signature;else{let{chain:I,wallet:A,statement:j,options:V}=e,L;if(an())if(typeof A=="object")L=A;else{let ht=window;if("ethereum"in ht&&typeof ht.ethereum=="object"&&"request"in ht.ethereum&&typeof ht.ethereum.request=="function")L=ht.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!V?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=A}let se=new URL((i=V?.url)!==null&&i!==void 0?i:window.location.href),B=yield L.request({method:"eth_requestAccounts"}).then(ht=>ht).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!B||B.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let q=Wv(B[0]),he=(r=V?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!he){let ht=yield L.request({method:"eth_chainId"});he=lx(ht)}let Ve={domain:se.host,address:q,statement:j,uri:se.href,version:"1",chainId:he,nonce:(o=V?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(a=(s=V?.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(u=V?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(f=V?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(h=V?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(m=V?.signInWithEthereum)===null||m===void 0?void 0:m.resources};w=ux(Ve),M=yield L.request({method:"personal_sign",params:[cx(w),q]})}try{let{data:I,error:A}=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:M},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Bn});if(A)throw A;return!I||!I.session||!I.user?{data:{user:null,session:null},error:new tr}:(I.session&&(yield this._saveSession(I.session),yield this._notifyAllSubscribers("SIGNED_IN",I.session)),{data:Object.assign({},I),error:A})}catch(I){if(ie(I))return{data:{user:null,session:null},error:I};throw I}})}signInWithSolana(e){return y(this,null,function*(){var i,r,o,s,a,u,f,h,m,b,v,w;let M,I;if("message"in e)M=e.message,I=e.signature;else{let{chain:A,wallet:j,statement:V,options:L}=e,se;if(an())if(typeof j=="object")se=j;else{let q=window;if("solana"in q&&typeof q.solana=="object"&&("signIn"in q.solana&&typeof q.solana.signIn=="function"||"signMessage"in q.solana&&typeof q.solana.signMessage=="function"))se=q.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");se=j}let B=new URL((i=L?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in se&&se.signIn){let q=yield se.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},L?.signInWithSolana),{version:"1",domain:B.host,uri:B.href}),V?{statement:V}:null)),he;if(Array.isArray(q)&&q[0]&&typeof q[0]=="object")he=q[0];else if(q&&typeof q=="object"&&"signedMessage"in q&&"signature"in q)he=q;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in he&&"signature"in he&&(typeof he.signedMessage=="string"||he.signedMessage instanceof Uint8Array)&&he.signature instanceof Uint8Array)M=typeof he.signedMessage=="string"?he.signedMessage:new TextDecoder().decode(he.signedMessage),I=he.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in se)||typeof se.signMessage!="function"||!("publicKey"in se)||typeof se!="object"||!se.publicKey||!("toBase58"in se.publicKey)||typeof se.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");M=[`${B.host} wants you to sign in with your Solana account:`,se.publicKey.toBase58(),...V?["",V,""]:[""],"Version: 1",`URI: ${B.href}`,`Issued At: ${(o=(r=L?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=L?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${L.signInWithSolana.notBefore}`]:[],...!((a=L?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${L.signInWithSolana.expirationTime}`]:[],...!((u=L?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${L.signInWithSolana.chainId}`]:[],...!((f=L?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${L.signInWithSolana.nonce}`]:[],...!((h=L?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${L.signInWithSolana.requestId}`]:[],...!((b=(m=L?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||b===void 0)&&b.length?["Resources",...L.signInWithSolana.resources.map(he=>`- ${he}`)]:[]].join(`
`);let q=yield se.signMessage(new TextEncoder().encode(M),"utf8");if(!q||!(q instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");I=q}}try{let{data:A,error:j}=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:M,signature:nr(I)},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Bn});if(j)throw j;return!A||!A.session||!A.user?{data:{user:null,session:null},error:new tr}:(A.session&&(yield this._saveSession(A.session),yield this._notifyAllSubscribers("SIGNED_IN",A.session)),{data:Object.assign({},A),error:j})}catch(A){if(ie(A))return{data:{user:null,session:null},error:A};throw A}})}_exchangeCodeForSession(e){return y(this,null,function*(){let i=yield Or(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(i??"").split("/");try{let{data:s,error:a}=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Bn});if(yield ir(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new tr}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:a})}catch(s){if(ie(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}})}signInWithIdToken(e){return y(this,null,function*(){try{let{options:i,provider:r,token:o,access_token:s,nonce:a}=e,u=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:Bn}),{data:f,error:h}=u;return h?{data:{user:null,session:null},error:h}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new tr}:(f.session&&(yield this._saveSession(f.session),yield this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:h})}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithOtp(e){return y(this,null,function*(){var i,r,o,s,a;try{if("email"in e){let{email:u,options:f}=e,h=null,m=null;this.flowType==="pkce"&&([h,m]=yield Ro(this.storage,this.storageKey));let{error:b}=yield ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(i=f?.data)!==null&&i!==void 0?i:{},create_user:(r=f?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:h,code_challenge_method:m},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){let{phone:u,options:f}=e,{data:h,error:m}=yield ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(o=f?.data)!==null&&o!==void 0?o:{},create_user:(s=f?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(a=f?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:m}}throw new Do("You must provide either an email or phone number.")}catch(u){if(ie(u))return{data:{user:null,session:null},error:u};throw u}})}verifyOtp(e){return y(this,null,function*(){var i,r;try{let o,s;"options"in e&&(o=(i=e.options)===null||i===void 0?void 0:i.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);let{data:a,error:u}=yield ae(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:Bn});if(u)throw u;if(!a)throw new Error("An error occurred on token verification.");let f=a.session,h=a.user;return f?.access_token&&(yield this._saveSession(f),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:h,session:f},error:null}}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}})}signInWithSSO(e){return y(this,null,function*(){var i,r,o;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=yield Ro(this.storage,this.storageKey)),yield ae(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:ox})}catch(s){if(ie(s))return{data:null,error:s};throw s}})}reauthenticate(){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return y(this,null,function*(){try{return yield this._useSession(e=>y(this,null,function*(){let{data:{session:i},error:r}=e;if(r)throw r;if(!i)throw new Un;let{error:o}=yield ae(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:o}}))}catch(e){if(ie(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return y(this,null,function*(){try{let i=`${this.url}/resend`;if("email"in e){let{email:r,type:o,options:s}=e,{error:a}=yield ae(this.fetch,"POST",i,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:r,type:o,options:s}=e,{data:a,error:u}=yield ae(this.fetch,"POST",i,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:u}}throw new Do("You must provide either an email or phone number and a type")}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}getSession(){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return this._useSession(i=>y(this,null,function*(){return i}))}))})}_acquireLock(e,i){return y(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=y(this,null,function*(){return yield r,yield i()});return this.pendingInLock.push(y(this,null,function*(){try{yield o}catch{}})),o}return yield this.lock(`lock:${this.storageKey}`,e,()=>y(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let r=i();for(this.pendingInLock.push(y(this,null,function*(){try{yield r}catch{}})),yield r;this.pendingInLock.length;){let o=[...this.pendingInLock];yield Promise.all(o),this.pendingInLock.splice(0,o.length)}return yield r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return y(this,null,function*(){this._debug("#_useSession","begin");try{let i=yield this.__loadSession();return yield e(i)}finally{this._debug("#_useSession","end")}})}__loadSession(){return y(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,i=yield Or(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};let r=e.expires_at?e.expires_at*1e3-Date.now()<Xf:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){let a=yield Or(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=sp()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,h,m)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,h,m))})}return{data:{session:e},error:null}}let{data:o,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return y(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return y(this,null,function*(){try{return e?yield ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ai}):yield this._useSession(i=>y(this,null,function*(){var r,o,s;let{data:a,error:u}=i;if(u)throw u;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Un}:yield ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=a.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ai})}))}catch(i){if(ie(i))return $S(i)&&(yield this._removeSession(),yield ir(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}})}updateUser(r){return y(this,arguments,function*(e,i={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._updateUser(e,i)}))})}_updateUser(r){return y(this,arguments,function*(e,i={}){try{return yield this._useSession(o=>y(this,null,function*(){let{data:s,error:a}=o;if(a)throw a;if(!s.session)throw new Un;let u=s.session,f=null,h=null;this.flowType==="pkce"&&e.email!=null&&([f,h]=yield Ro(this.storage,this.storageKey));let{data:m,error:b}=yield ae(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:h}),jwt:u.access_token,xform:Ai});if(b)throw b;return u.user=m.user,yield this._saveSession(u),yield this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}}))}catch(o){if(ie(o))return{data:{user:null},error:o};throw o}})}setSession(e){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return y(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Un;let i=Date.now()/1e3,r=i,o=!0,s=null,{payload:a}=op(e.access_token);if(a.exp&&(r=a.exp,o=r<=i),o){let{data:u,error:f}=yield this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!u)return{data:{user:null,session:null},error:null};s=u}else{let{data:u,error:f}=yield this._getUser(e.access_token);if(f)throw f;s={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:r-i,expires_at:r},yield this._saveSession(s),yield this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(i){if(ie(i))return{data:{session:null,user:null},error:i};throw i}})}refreshSession(e){return y(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;if(!e){let{data:a,error:u}=i;if(u)throw u;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Un;let{data:o,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}}))}catch(i){if(ie(i))return{data:{user:null,session:null},error:i};throw i}})}_getSessionFromURL(e,i){return y(this,null,function*(){try{if(!an())throw new Io("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Io(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new uc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Io("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new uc("No code detected.");let{data:V,error:L}=yield this._exchangeCodeForSession(e.code);if(L)throw L;let se=new URL(window.location.href);return se.searchParams.delete("code"),window.history.replaceState(window.history.state,"",se.toString()),{data:{session:V.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:a,expires_in:u,expires_at:f,token_type:h}=e;if(!s||!u||!a||!h)throw new Io("No session defined in URL");let m=Math.round(Date.now()/1e3),b=parseInt(u),v=m+b;f&&(v=parseInt(f));let w=v-m;w*1e3<=xo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${b}s`);let M=v-b;m-M>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",M,v,m):m-M<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",M,v,m);let{data:I,error:A}=yield this._getUser(s);if(A)throw A;let j={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:b,expires_at:v,refresh_token:a,token_type:h,user:I.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:j,redirectType:e.type},error:null}}catch(r){if(ie(r))return{data:{session:null,redirectType:null},error:r};throw r}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return y(this,null,function*(){let i=yield Or(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)})}signOut(){return y(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return y(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{error:s};let a=(r=o.session)===null||r===void 0?void 0:r.access_token;if(a){let{error:u}=yield this.admin.signOut(a,e);if(u&&!(BS(u)&&(u.status===404||u.status===401||u.status===403)))return{error:u}}return e!=="others"&&(yield this._removeSession(),yield ir(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){let i=YS(),r={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,r),y(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){this._emitInitialSession(i)}))}),{data:{subscription:r}}}_emitInitialSession(e){return y(this,null,function*(){return yield this._useSession(i=>y(this,null,function*(){var r,o;try{let{data:{session:s},error:a}=i;if(a)throw a;yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}}))})}resetPasswordForEmail(r){return y(this,arguments,function*(e,i={}){let o=null,s=null;this.flowType==="pkce"&&([o,s]=yield Ro(this.storage,this.storageKey,!0));try{return yield ae(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(a){if(ie(a))return{data:null,error:a};throw a}})}getUserIdentities(){return y(this,null,function*(){var e;try{let{data:i,error:r}=yield this.getUser();if(r)throw r;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(ie(i))return{data:null,error:i};throw i}})}linkIdentity(e){return y(this,null,function*(){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)})}linkIdentityOAuth(e){return y(this,null,function*(){var i;try{let{data:r,error:o}=yield this._useSession(s=>y(this,null,function*(){var a,u,f,h,m;let{data:b,error:v}=s;if(v)throw v;let w=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return yield ae(this.fetch,"GET",w,{headers:this.headers,jwt:(m=(h=b.session)===null||h===void 0?void 0:h.access_token)!==null&&m!==void 0?m:void 0})}));if(o)throw o;return an()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ie(r))return{data:{provider:e.provider,url:null},error:r};throw r}})}linkIdentityIdToken(e){return y(this,null,function*(){return yield this._useSession(i=>y(this,null,function*(){var r;try{let{error:o,data:{session:s}}=i;if(o)throw o;let{options:a,provider:u,token:f,access_token:h,nonce:m}=e,b=yield ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=s?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:u,id_token:f,access_token:h,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Bn}),{data:v,error:w}=b;return w?{data:{user:null,session:null},error:w}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new tr}:(v.session&&(yield this._saveSession(v.session),yield this._notifyAllSubscribers("USER_UPDATED",v.session)),{data:v,error:w})}catch(o){if(ie(o))return{data:{user:null,session:null},error:o};throw o}}))})}unlinkIdentity(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r,o;let{data:s,error:a}=i;if(a)throw a;return yield ae(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return y(this,null,function*(){let i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{let r=Date.now();return yield ex(o=>y(this,null,function*(){return o>0&&(yield XS(200*Math.pow(2,o-1))),this._debug(i,"refreshing attempt",o),yield ae(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Bn})}),(o,s)=>{let a=200*Math.pow(2,o);return s&&tp(s)&&Date.now()+a-r<xo})}catch(r){if(this._debug(i,"error",r),ie(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(i,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,i){return y(this,null,function*(){let r=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",r),an()&&!i.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){return y(this,null,function*(){var e,i;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=yield Or(this.storage,this.storageKey);if(o&&this.userStorage){let a=yield Or(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:o.user},yield Ao(this.userStorage,this.storageKey+"-user",a)),o.user=(e=a?.user)!==null&&e!==void 0?e:sp()}else if(o&&!o.user&&!o.user){let a=yield Or(this.storage,this.storageKey+"-user");a&&a?.user?(o.user=a.user,yield ir(this.storage,this.storageKey+"-user"),yield Ao(this.storage,this.storageKey,o)):o.user=sp()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&(yield this._removeSession());return}let s=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<Xf;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Xf}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=yield this._callRefreshToken(o.refresh_token);a&&(console.error(a),tp(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),yield this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{let{data:a,error:u}=yield this._getUser(o.access_token);!u&&a?.user?(o.user=a.user,yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else yield this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return y(this,null,function*(){var i,r;if(!e)throw new Un;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new fc;let{data:s,error:a}=yield this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Un;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let u={data:s.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(s){if(this._debug(o,"error",s),ie(s)){let a={data:null,error:s};return tp(s)||(yield this._removeSession()),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}})}_notifyAllSubscribers(e,i,r=!0){return y(this,null,function*(){let o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",i,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:i});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(u=>y(this,null,function*(){try{yield u.callback(e,i)}catch(f){s.push(f)}}));if(yield Promise.all(a),s.length>0){for(let u=0;u<s.length;u+=1)console.error(s[u]);throw s[0]}}finally{this._debug(o,"end")}})}_saveSession(e){return y(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let i=Object.assign({},e),r=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&i.user&&(yield Ao(this.userStorage,this.storageKey+"-user",{user:i.user}));let o=Object.assign({},i);delete o.user;let s=zv(o);yield Ao(this.storage,this.storageKey,s)}else{let o=zv(i);yield Ao(this.storage,this.storageKey,o)}})}_removeSession(){return y(this,null,function*(){this._debug("#_removeSession()"),yield ir(this.storage,this.storageKey),yield ir(this.storage,this.storageKey+"-code-verifier"),yield ir(this.storage,this.storageKey+"-user"),this.userStorage&&(yield ir(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&an()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}_startAutoRefresh(){return y(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),xo);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>y(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return y(this,null,function*(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return y(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return y(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return y(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>y(this,null,function*(){try{let e=Date.now();try{return yield this._useSession(i=>y(this,null,function*(){let{data:{session:r}}=i;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let o=Math.floor((r.expires_at*1e3-e)/xo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${xo}ms, refresh threshold is ${Qf} ticks`),o<=Qf&&(yield this._callRefreshToken(r.refresh_token))}))}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof pc)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return y(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!an()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>y(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return y(this,null,function*(){let i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>y(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,i,r){return y(this,null,function*(){let o=[`provider=${encodeURIComponent(i)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){let[s,a]=yield Ro(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});o.push(u.toString())}if(r?.queryParams){let s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`})}_unenroll(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;return s?{data:null,error:s}:yield ae(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_enroll(e){return y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r,o;let{data:s,error:a}=i;if(a)return{data:null,error:a};let u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:f,error:h}=yield ae(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&f.type==="totp"&&(!((o=f?.totp)===null||o===void 0)&&o.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}})}_verify(e){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{data:null,error:s};let a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?gx(e.webauthn.credential_response):vx(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:f}=yield ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:f})}))}catch(i){if(ie(i))return{data:null,error:i};throw i}}))})}_challenge(e){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){try{return yield this._useSession(i=>y(this,null,function*(){var r;let{data:o,error:s}=i;if(s)return{data:null,error:s};let a=yield ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;let{data:u}=a;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:hx(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:mx(u.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(i){if(ie(i))return{data:null,error:i};throw i}}))})}_challengeAndVerify(e){return y(this,null,function*(){let{data:i,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})})}_listFactors(){return y(this,null,function*(){var e;let{data:{user:i},error:r}=yield this.getUser();if(r)return{data:null,error:r};let o={all:[],phone:[],totp:[],webauthn:[]};for(let s of(e=i?.factors)!==null&&e!==void 0?e:[])o.all.push(s),s.status==="verified"&&o[s.factor_type].push(s);return{data:o,error:null}})}_getAuthenticatorAssuranceLevel(){return y(this,null,function*(){return this._acquireLock(-1,()=>y(this,null,function*(){return yield this._useSession(e=>y(this,null,function*(){var i,r;let{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:a}=op(o.access_token),u=null;a.aal&&(u=a.aal);let f=u;((r=(i=o.user.factors)===null||i===void 0?void 0:i.filter(b=>b.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");let m=a.amr||[];return{data:{currentLevel:u,nextLevel:f,currentAuthenticationMethods:m},error:null}}))}))})}fetchJwk(r){return y(this,arguments,function*(e,i={keys:[]}){let o=i.keys.find(f=>f.kid===e);if(o)return o;let s=Date.now();if(o=this.jwks.keys.find(f=>f.kid===e),o&&this.jwks_cached_at+US>s)return o;let{data:a,error:u}=yield ae(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=s,o=a.keys.find(f=>f.kid===e),!o)?null:o})}getClaims(r){return y(this,arguments,function*(e,i={}){try{let o=e;if(!o){let{data:M,error:I}=yield this.getSession();if(I||!M.session)return{data:null,error:I};o=M.session.access_token}let{header:s,payload:a,signature:u,raw:{header:f,payload:h}}=op(o);i?.allowExpired||nx(a.exp);let m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(s.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!m){let{error:M}=yield this.getUser(o);if(M)throw M;return{data:{claims:a,header:s,signature:u},error:null}}let b=ix(s.alg),v=yield crypto.subtle.importKey("jwk",m,b,!0,["verify"]);if(!(yield crypto.subtle.verify(b,v,u,JS(`${f}.${h}`))))throw new To("Invalid JWT signature");return{data:{claims:a,header:s,signature:u},error:null}}catch(o){if(ie(o))return{data:null,error:o};throw o}})}}return n.nextInstanceID=0,n})(),Jv=zP;var UP=Jv,Kv=UP;var dp=class extends Kv{constructor(t){super(t)}};var fp=class{constructor(t,e,i){var r,o,s;this.supabaseUrl=t,this.supabaseKey=e;let a=FS(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let u=`sb-${a.hostname.split(".")[0]}-auth-token`,f={db:RS,realtime:NS,auth:Object.assign(Object.assign({},OS),{storageKey:u}),global:AS},h=kS(i??{},f);this.storageKey=(r=h.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,b)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=h.auth)!==null&&s!==void 0?s:{},this.headers,h.global.fetch),this.fetch=PS(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new hS(new URL("rest/v1",a).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new ac(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Yl(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,i)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return y(this,null,function*(){var t,e;if(this.accessToken)return yield this.accessToken();let{data:i}=yield this.auth.getSession();return(e=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,userStorage:o,storageKey:s,flowType:a,lock:u,debug:f},h,m){let b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new dp({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),h),storageKey:s,autoRefreshToken:t,persistSession:e,detectSessionInUrl:i,storage:r,userStorage:o,flowType:a,lock:u,debug:f,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new ic(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,i)=>{this._handleTokenChanged(e,"CLIENT",i?.access_token)})}_handleTokenChanged(t,e,i){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var yx=(n,t,e)=>new fp(n,t,e);function BP(){if(typeof window<"u"||typeof process>"u")return!1;let n=process.version;if(n==null)return!1;let t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}BP()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var Yv={production:!1,supabaseUrl:"https://qgtquamtmzqvytxwlwst.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFndHF1YW10bXpxdnl0eHdsd3N0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NTU0NzMsImV4cCI6MjA3NzIzMTQ3M30.xR4HjqI1lYoFLgbZl1zJ4eLRXjM_uraIdK2l_6t2G4A"};var pt=class n{supabase;constructor(){let t={getItem:e=>y(null,null,function*(){return localStorage.getItem(e)}),setItem:(e,i)=>y(null,null,function*(){localStorage.setItem(e,i)}),removeItem:e=>y(null,null,function*(){localStorage.removeItem(e)})};this.supabase=yx(Yv.supabaseUrl,Yv.supabaseKey,{auth:{storage:t,detectSessionInUrl:!1}})}getClient(){return this.supabase}static \u0275fac=function(e){return new(e||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var le=class n{constructor(t,e,i,r){this.http=t;this.router=e;this.supabaseService=i;this.ngZone=r;this.initializeAuth()}apiUrl="http://localhost:3000/api";currentUserSubject=new tt(null);currentUser$=this.currentUserSubject.asObservable();isInitialized=!1;initializeAuth(){return y(this,null,function*(){if(!this.isInitialized)try{let t=this.supabaseService.getClient(),{data:{session:e}}=yield t.auth.getSession();e?.user?yield this.loadAndPublishUser(e.user.id):this.checkStoredToken(),t.auth.onAuthStateChange((i,r)=>y(this,null,function*(){this.ngZone.run(()=>y(this,null,function*(){console.log("Auth state changed:",i,r),r?.user?yield this.loadAndPublishUser(r.user.id):(this.currentUserSubject.next(null),this.clearAuthData(),this.router.url.includes("/login")||this.router.navigate(["/login"]))}))})),this.isInitialized=!0}catch(t){console.error("Error initializing auth:",t),this.clearAuthData()}})}loadAndPublishUser(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("users").select("*").eq("id",t).maybeSingle();if(r){console.error("[AuthService] load user error",r),this.ngZone.run(()=>this.currentUserSubject.next(null));return}let o=i;if(o&&!o.company_id&&o.role==="admin"){let{data:s,error:a}=yield e.from("companies").select("id").eq("admin_user_id",t).maybeSingle();if(!a&&s?.id){let{error:u}=yield e.from("users").update({company_id:s.id}).eq("id",t);u||(o=Q(N({},o),{company_id:s.id}))}}o&&typeof o.company_id=="string"&&(o.company_id==="null"||o.company_id==="undefined"||o.company_id.trim()==="")&&(o=Q(N({},o),{company_id:null})),this.ngZone.run(()=>{this.currentUserSubject.next(o),this.storeAuthData({user:o})})}catch(e){console.error("[AuthService] unexpected error loadAndPublishUser",e),this.ngZone.run(()=>this.currentUserSubject.next(null))}})}clearAuthData(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}register(t){return J(this.registerWithSupabase(t))}login(t,e){return y(this,null,function*(){try{let i=this.supabaseService.getClient(),{data:r,error:o}=yield i.auth.signInWithPassword({email:t,password:e});if(o)throw o;if(!r?.user)throw new Error("Login fallito: nessun user restituito");return yield this.loadAndPublishUser(r.user.id),{auth:r,user:this.currentUserSubject.value}}catch(i){throw console.error("Login error:",i),i}})}loginWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.auth.signInWithPassword({email:t.email,password:t.password});if(r)throw r;if(i.user){let{data:o,error:s}=yield e.from("users").select("*").eq("id",i.user.id).single();if(s)throw s;this.storeAuthData({token:i.session.access_token,user:o}),this.currentUserSubject.next(o)}return i})}getAuthHeaders(){let t=this.getToken();return new yi({Authorization:`Bearer ${t}`,"Content-Type":"application/json"})}logout(){return y(this,null,function*(){try{yield this.supabaseService.getClient().auth.signOut()}catch(t){console.error("Logout error:",t)}finally{this.clearAuthData(),this.ngZone.run(()=>{this.currentUserSubject.next(null),this.router.navigate(["/login"])})}})}getToken(){return localStorage.getItem("auth_token")}isAuthenticated(){return!!this.currentUserSubject.value}hasRole(t){return this.currentUserSubject.value?.role===t}storeAuthData(t){t.token&&localStorage.setItem("auth_token",t.token),t.user&&localStorage.setItem("user_data",JSON.stringify(t.user))}checkStoredToken(){let t=this.getToken(),e=localStorage.getItem("user_data");if(t&&e)try{let i=JSON.parse(e);this.ngZone.run(()=>this.currentUserSubject.next(i))}catch{this.clearAuthData()}}retryOnLock(t,e=4,i=120){return y(this,null,function*(){let r=0;for(;;)try{return yield t()}catch(o){let s=o?.name??"",a=o?.message??"";if(!(s==="NavigatorLockAcquireTimeoutError"||a.includes("NavigatorLock")||a.includes("acquire"))||r>=e-1)throw o;let f=i*Math.pow(2,r)+Math.round(Math.random()*i);yield new Promise(h=>setTimeout(h,f)),r++}})}registerAdmin(t){return J(this.registerWithSupabase(t))}registerUser(t){return J(this.registerUserWithSupabase(t))}registerWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.auth.signUp({email:t.admin.email,password:t.admin.password,options:{data:{first_name:t.admin.first_name,last_name:t.admin.last_name,role:"admin"}}});if(r)throw r;if(!i||!i.user)throw new Error("Auth provider non ha restituito user");let o=i.user.id;console.debug("[AuthService] Admin auth creato con ID:",o);try{let{error:s}=yield e.from("users").insert([{id:o,company_id:null,first_name:t.admin.first_name,last_name:t.admin.last_name,email:t.admin.email,phone:t.admin.phone,timezone:t.admin.timezone||"Europe/Rome",is_active:!0,role:"admin"}]);if(s)throw s;let{data:a,error:u}=yield e.from("companies").insert([{name:t.company.name,vat:t.company.vat,address:t.company.address,city:t.company.city,province:t.company.province,civic_number:t.company.civic_number,website:t.company.website,legal_form:t.company.legal_form,category:t.company.category,opening_hours:t.company.opening_hours,admin_user_id:o}]).select().single();if(u)throw yield e.from("users").delete().eq("id",o),u;console.debug("[AuthService] Company creata con ID:",a.id);let{error:f}=yield e.from("users").update({company_id:a.id}).eq("id",o);if(f)throw yield e.from("companies").delete().eq("id",a.id),yield e.from("users").delete().eq("id",o),f;return{user:i.user,company:a}}catch(s){throw console.error("[AuthService] Errore durante registrazione admin:",s),s}})}registerUserWithSupabase(t){return y(this,null,function*(){let e=this.supabaseService.getClient();if(console.debug("[AuthService] registerUserWithSupabase payload:",t),!t.company_id)throw new Error("Company ID non fornito per la registrazione utente");console.debug("[AuthService] Company ID from payload:",t.company_id),console.debug("[AuthService] Saltando verifica azienda - procedo con company_id:",t.company_id);let{data:i,error:r}=yield e.auth.signUp({email:t.user.email,password:t.user.password,options:{data:{first_name:t.user.first_name,last_name:t.user.last_name,role:"employee"}}});if(r)throw console.error("[AuthService] Auth signup error:",r),r;if(!i||!i.user)throw new Error("Registrazione fallita: impossibile creare l'utente (auth returned no user)");let o=i.user.id;console.debug("[AuthService] User auth creato con ID:",o);let{error:s}=yield e.from("users").insert([{id:o,company_id:t.company_id,first_name:t.user.first_name,last_name:t.user.last_name,email:t.user.email,phone:t.user.phone,timezone:t.user.timezone||"Europe/Rome",is_active:!0,role:"employee"}]);if(s)throw console.error("[AuthService] Errore inserimento utente:",s),s.code==="23503"?new Error("Azienda non trovata nel database. Contatta l'amministratore."):s;return console.debug("[AuthService] Registrazione utente completata con successo"),{user:i.user}})}updateUserProfile(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient();try{let s=yield i.auth.getSession();console.debug("[AuthService] session user id:",s?.data?.session?.user?.id??null)}catch(s){console.debug("[AuthService] getSession failed",s)}console.debug("[AuthService] updateUserProfile patch:",e,"target userId:",t);let{data:r,error:o}=yield i.from("users").update(e).eq("id",t).select().maybeSingle();if(o)throw console.error("[AuthService] updateUserProfile error:",o),o;return r&&this.currentUserSubject.next(r),r})}hasManagerPermission(t,e){return y(this,null,function*(){let i=this.currentUserSubject.value;if(!i)return!1;if(i.role==="admin")return!0;if(i.role!=="manager")return!1;e||(e=i.company_id);try{let r=this.supabaseService.getClient(),{data:o}=yield r.from("companies").select("manager_visibility").eq("id",e).maybeSingle(),a=(o?.manager_visibility||{})[i.id]||{};switch(t){case"manage_departments":return!!a.can_manage_departments;case"view_all_employees":return!!a.can_view_all_employees;default:return!1}}catch(r){return console.error("[AuthService] hasManagerPermission error",r),!1}})}static \u0275fac=function(e){return new(e||n)(z(bi),z(Ie),z(pt),z(ze))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};function $P(n,t){if(n&1&&(c(0,"div",19),d(1),l()),n&2){let e=g();p(),R(" ",e.errorMessage," ")}}function HP(n,t){n&1&&(c(0,"span",22),d(1,"Email obbligatoria"),l())}function WP(n,t){n&1&&(c(0,"span",22),d(1,"Email non valida"),l())}function GP(n,t){if(n&1&&(c(0,"div",20),E(1,HP,2,0,"span",21)(2,WP,2,0,"span",21),l()),n&2){let e=g();p(),_("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),p(),_("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function qP(n,t){n&1&&(c(0,"span",22),d(1,"Password obbligatoria"),l())}function JP(n,t){if(n&1&&(c(0,"span",22),d(1),l()),n&2){let e=g(2);p(),R(" Minimo ",e.password==null||e.password.errors==null?null:e.password.errors.minlength.requiredLength," caratteri ")}}function KP(n,t){if(n&1&&(c(0,"div",20),E(1,qP,2,0,"span",21)(2,JP,2,1,"span",21),l()),n&2){let e=g();p(),_("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),p(),_("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}function YP(n,t){n&1&&(c(0,"span"),d(1,"Accedi"),l())}function ZP(n,t){n&1&&P(0,"div",23)}var pp=class n{constructor(t,e,i){this.fb=t;this.authService=e;this.router=i;this.loginForm=this.fb.group({email:["",[ne.required,ne.email]],password:["",[ne.required,ne.minLength(6)]]})}loginForm;isLoading=!1;errorMessage="";ngOnInit(){this.authService.isAuthenticated()&&this.router.navigate(["/home"])}onSubmit(){return y(this,null,function*(){if(this.loginForm.valid){this.isLoading=!0,this.errorMessage="";let t=this.loginForm.value;try{yield this.authService.login(t.email,t.password),this.isLoading=!1,yield this.router.navigate(["/home"])}catch(e){this.isLoading=!1,this.errorMessage=e?.message||e?.error?.message||"Errore durante il login. Riprova.",console.error("Login error:",e)}}else this.markFormGroupTouched()})}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(t=>{this.loginForm.get(t)?.markAsTouched()})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}static \u0275fac=function(e){return new(e||n)(D(Ii),D(le),D(Ie))};static \u0275cmp=we({type:n,selectors:[["app-login"]],decls:31,vars:11,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","440px"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],["class","status-message error",4,"ngIf"],[1,"form-group"],[1,"form-label"],["type","email","formControlName","email","placeholder","inserisci@email.com",1,"form-input"],["class","error-messages",4,"ngIf"],["type","password","formControlName","password","placeholder","Inserisci la password",1,"form-input"],["type","submit",1,"promethea-button","outline",3,"disabled"],[4,"ngIf"],["class","loading-spinner small",4,"ngIf"],[1,"form-footer"],["routerLink","/register",1,"link"],["routerLink","/forgot-password",1,"link","text-sm"],[1,"status-message","error"],[1,"error-messages"],["class","error",4,"ngIf"],[1,"error"],[1,"loading-spinner","small"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),d(5,"Accedi alla Piattaforma"),l(),c(6,"p",5),d(7,"Inserisci le tue credenziali per accedere"),l()()(),c(8,"form",6),x("ngSubmit",function(){return i.onSubmit()}),E(9,$P,2,1,"div",7),c(10,"div",8)(11,"label",9),d(12,"Email"),l(),P(13,"input",10),E(14,GP,3,2,"div",11),l(),c(15,"div",8)(16,"label",9),d(17,"Password"),l(),P(18,"input",12),E(19,KP,3,2,"div",11),l(),c(20,"button",13),E(21,YP,2,0,"span",14)(22,ZP,1,0,"div",15),l(),c(23,"div",16)(24,"div",5),d(25," Non hai un account? "),P(26,"br"),c(27,"a",17),d(28,"Registrati"),l()(),c(29,"a",18),d(30,"Password dimenticata?"),l()()()()()),e&2&&(p(8),_("formGroup",i.loginForm),p(),_("ngIf",i.errorMessage),p(4),Se("error",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),p(),_("ngIf",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),p(4),Se("error",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),p(),_("ngIf",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),p(),_("disabled",i.isLoading),p(),_("ngIf",!i.isLoading),p(),_("ngIf",i.isLoading))},dependencies:[Ee,xe,Ti,Ln,Re,Fe,Fn,jn,oi,Ht],styles:[".link[_ngcontent-%COMP%]{color:var(--text-color)}.form-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:var(--gutter-sm)}"]})};var ia=class n{constructor(t){this.supabaseService=t}listByCompany(t){let e=this.supabaseService.getClient();return J(e.from("employee_invitations").select("*").eq("company_id",t).order("created_at",{ascending:!0}).then(i=>{if(i.error)throw i.error;return i.data||[]}))}addInvite(t,e,i){let r=this.supabaseService.getClient(),s={company_id:t?String(t).trim().replace(/^["']+|["']+$/g,""):null,email:(e||"").toLowerCase().trim(),invited_by:i??null,accepted:!1,token:null};return J(r.from("employee_invitations").insert([s]).select().then(a=>{if(a.error)throw a.error;return a.data&&a.data[0]?a.data[0]:null}))}removeInviteById(t){let e=this.supabaseService.getClient();return J(e.from("employee_invitations").delete().eq("id",t).then(i=>{if(i.error)throw i.error;return i}))}isEmailInvited(t,e){if(!t)return J(Promise.resolve(!1));let i=this.supabaseService.getClient();return J(i.from("employee_invitations").select("id").eq("company_id",t).ilike("email",e).limit(1).then(r=>{if(r.error)throw r.error;return r.data&&r.data.length>0}))}getInviteForEmail(t){let e=this.supabaseService.getClient(),i=(t||"").toString().trim().toLowerCase(),r=e.from("employee_invitations").select("*").ilike("email",i).eq("accepted",!1).order("created_at",{ascending:!1}).limit(1).then(o=>{if(o.error)throw o.error;let s=Array.isArray(o.data)&&o.data.length?o.data[0]:null;return s&&s.company_id&&(s.company_id=String(s.company_id).trim().replace(/^["']+|["']+$/g,"")||null),s});return J(r)}markAccepted(t){let e=this.supabaseService.getClient();return J(e.from("employee_invitations").update({accepted:!0}).eq("id",t).then(i=>{if(i.error)throw i.error;return i.data}))}static \u0275fac=function(e){return new(e||n)(z(pt))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ot=class n{constructor(t,e){this.supabaseService=t;this.authService=e}refreshSubject=new tt(void 0);refresh$=this.refreshSubject.asObservable();getDipendenti(t,e=!1){if(!t||t==="null"||t==="undefined")return K([]);let r=this.supabaseService.getClient().from("users").select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").eq("company_id",t);e||(r=r.eq("is_active",!0));let o=r.then(s=>{if(s.error)throw s.error;return(Array.isArray(s.data)?s.data:[]).map(u=>{if(u&&u.job_title){let f=Array.isArray(u.job_title)?u.job_title[0]??null:u.job_title;u.job_title_id=f?.id??u.job_title_id??null,u.job_title=f?.name??(typeof u.job_title=="string"?u.job_title:null)}else u.job_title_id=u.job_title_id??null,u.job_title=typeof u.job_title=="string"?u.job_title:null;return u})});return J(o)}getDipendenteById(t){if(!t)return K(null);let i=this.supabaseService.getClient().from("users").select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").eq("id",t).maybeSingle().then(r=>{if(r.error)throw r.error;let o=r.data;if(o&&o.job_title){let s=Array.isArray(o.job_title)?o.job_title[0]??null:o.job_title;o.job_title_id=s?.id??o.job_title_id??null,o.job_title=s?.name??(typeof o.job_title=="string"?o.job_title:null)}else o.job_title_id=o.job_title_id??null,o.job_title=typeof o.job_title=="string"?o.job_title:null;return o});return J(i)}checkEmployeeDepartmentConflict(t,e){let r=this.supabaseService.getClient().from("users").select("department_id, department:departments(id, company_id, name, description)").eq("id",t).maybeSingle().then(o=>{if(o.error)throw o.error;let s=o.data;if(!s?.department_id)return{hasConflict:!1};if(s.department_id===e)return{hasConflict:!1};let a=s.department;return Array.isArray(a)&&(a=a[0]??null),{hasConflict:!0,currentDepartment:a||void 0}});return J(r)}canDeleteDepartment(t){let i=this.supabaseService.getClient().from("users").select("id",{count:"exact"}).eq("department_id",t).then(r=>{if(r.error)throw r.error;let o=r.count||0;return{canDelete:o===0,employeeCount:o}});return J(i)}updateUser(t,e){if(!t)return K(null);let r=this.supabaseService.getClient().from("users").update(Q(N({},e),{updated_at:new Date().toISOString(),last_modified_by:this.authService?.currentUserSubject?.value?.id??null})).eq("id",t).select("*, department:departments(id,name), job_title:job_titles!users_job_title_id_fkey(id,name)").maybeSingle().then(o=>{if(o.error)throw console.error("[Dipendenti.updateUser] error",o.error),o.error;let s=o.data;if(s&&s.department&&Array.isArray(s.department)&&(s.department=s.department.length?s.department[0]:null),s&&s.job_title){let a=Array.isArray(s.job_title)?s.job_title[0]??null:s.job_title;s.job_title_id=a?.id??s.job_title_id??null,s.job_title=a?.name??(typeof s.job_title=="string"?s.job_title:null)}else s.job_title_id=s.job_title_id??null,s.job_title=typeof s.job_title=="string"?s.job_title:null;console.debug("[Dipendenti.updateUser] normalized success",s);try{this.refreshSubject.next()}catch{}return s});return J(r)}createUser(t){let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{let r={first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone??null,timezone:t.timezone??"Europe/Rome",hire_date:t.hire_date??null,company_id:t.company_id??null,is_active:!0,created_at:new Date().toISOString()};t.password&&(r.password=t.password);let o=yield e.from("users").insert([r]).select().maybeSingle();if(o.error)throw o.error;return o.data}catch(r){throw console.error("[Dipendenti.createUser] error",r),r}});return J(i)}deleteUser(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=new Date().toISOString(),{data:o,error:s}=yield e.from("users").update({is_active:!1,deleted_at:r,updated_at:r}).eq("id",t).select().maybeSingle();if(s)throw console.error("[Dipendenti.deleteUser] error",s),s;try{this.refreshSubject.next()}catch{}return o});return J(i)}restoreUser(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("users").update({is_active:!0,deleted_at:null,updated_at:new Date().toISOString()}).eq("id",t).select().maybeSingle();if(o)throw console.error("[Dipendenti.restoreUser] error",o),o;try{this.refreshSubject.next()}catch{}return r});return J(i)}static \u0275fac=function(e){return new(e||n)(z(pt),z(le))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var et=class n{constructor(t,e,i,r){this.http=t;this.authService=e;this.supabaseService=i;this.dipendentiService=r}baseUrl="/api/companies";getAziendaByAdmin(t){if(!t||t==="null"||t==="undefined")return console.warn("[CompanyService] getAziendaByAdmin called with invalid adminUserId:",t),K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{let r=yield e.from("companies").select("*").eq("admin_user_id",t).maybeSingle();return console.debug("[CompanyService.getAziendaByAdmin] supabase response",{adminUserId:t,res:r}),r?.error?(console.warn("[CompanyService] getAziendaByAdmin supabase error",r.error),null):r?.data??null}catch(r){return console.error("[CompanyService] getAziendaByAdmin unexpected",r),null}});return J(i)}getAzienda(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("companies").select("*").eq("id",t).maybeSingle();if(o)throw console.error("[CompanyService] getAzienda error",o),o;return r});return J(i)}getAziendaById(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){try{console.debug("[CompanyService] getAziendaById searching for:",t);let{data:r,error:o}=yield e.from("companies").select("*").eq("id",t).maybeSingle();return console.debug("[CompanyService] getAziendaById result:",{data:r,error:o}),o?(console.error("[CompanyService] getAziendaById supabase error:",o),null):r}catch(r){return console.error("[CompanyService] getAziendaById unexpected error:",r),null}});return J(i)}getAllCompanies(){let t=this.supabaseService.getClient(),e=y(this,null,function*(){try{let i=yield t.from("companies").select("*");return i?.error?(console.error("[CompanyService] getAllCompanies error",i.error),[]):i?.data||[]}catch(i){return console.error("[CompanyService] getAllCompanies unexpected",i),[]}});return J(e)}getAziendaForUser(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){try{if(e&&e!=="null"&&e!=="undefined"){let o=yield i.from("companies").select("*").eq("id",e).maybeSingle();if(!o?.error&&o?.data)return o.data}if(t){let o=yield i.from("companies").select("*").eq("admin_user_id",t).maybeSingle();if(!o?.error&&o?.data)return o.data}return null}catch(o){return console.error("[CompanyService] getAziendaForUser unexpected",o),null}});return J(r)}aggiornaAzienda(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){try{let o=yield i.from("companies").update(e).eq("id",t).select().maybeSingle();if(!o?.error&&o?.data)return console.debug("[CompanyService] aggiornaAzienda supabase success",o.data),o.data;let s=this.authService.getAuthHeaders();try{let a=yield this.http.patch(`${this.baseUrl}/${t}`,e,{headers:s}).toPromise();return console.debug("[CompanyService] aggiornaAzienda fallback HTTP success",a),a}catch(a){throw console.error("[CompanyService] aggiornaAzienda fallback HTTP error",a),a}}catch(o){throw console.error("[CompanyService] aggiornaAzienda unexpected",o,{companyId:t,payload:e}),o}});return J(r)}getDipendenti(t,e="*"){return this.dipendentiService.getDipendenti(t)}cambiaStatoDipendente(t,e){return this.dipendentiService.updateUser(t,{is_active:!!e})}eliminaDipendente(t){return this.dipendentiService.deleteUser(t)}creaDipendente(t){return this.dipendentiService.createUser({first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone??null,timezone:t.timezone??"Europe/Rome",hire_date:t.hire_date??null,company_id:t.company_id??t.company?.id??null,password:t.password??void 0})}resolveManagerConfig(t,e){if(!t||!e)return{mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_edit_employees:!1};let r=(t.manager_visibility??{})?.[e]??{};return{mode:r.mode??"self",user_ids:Array.isArray(r.user_ids)?r.user_ids:[],roles:Array.isArray(r.roles)?r.roles:[],department_ids:Array.isArray(r.department_ids)?r.department_ids:[],can_view_all_employees:!!r.can_view_all_employees,can_manage_departments:!!r.can_manage_departments,can_manage_job_titles:!!r.can_manage_job_titles,can_view_reports:!!r.can_view_reports,can_edit_employees:!!r.can_edit_employees}}filterEmployeesByVisibility(t,e,i){if(!Array.isArray(t)||t.length===0)return[];let r=this.resolveManagerConfig(e,i);if(r.can_view_all_employees)return t;switch(r.mode){case"self":return t.filter(o=>String(o.id)===String(i));case"selected_users":return t.filter(o=>r.user_ids.includes(o.id));case"roles":return t.filter(o=>o.role&&r.roles.includes(o.role));case"department":return t.filter(o=>{let s=o.department?.id??o.department_id??null;return s&&r.department_ids.includes(s)});default:return t.filter(o=>String(o.id)===String(i))}}static \u0275fac=function(e){return new(e||n)(z(bi),z(le),z(pt),z(Ot))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};function QP(n,t){n&1&&(c(0,"span",42),d(1,"Obbligatorio"),l())}function XP(n,t){if(n&1&&(c(0,"div",40),E(1,QP,2,0,"span",41),l()),n&2){let e=g(2);p(),_("ngIf",e.company_name==null||e.company_name.errors==null?null:e.company_name.errors.required)}}function ek(n,t){n&1&&(c(0,"span",42),d(1,"Obbligatorio"),l())}function tk(n,t){n&1&&(c(0,"span",42),d(1,"Formato non valido"),l())}function nk(n,t){if(n&1&&(c(0,"div",40),E(1,ek,2,0,"span",41)(2,tk,2,0,"span",41),l()),n&2){let e=g(2);p(),_("ngIf",e.vat==null||e.vat.errors==null?null:e.vat.errors.required),p(),_("ngIf",e.vat==null||e.vat.errors==null?null:e.vat.errors.pattern)}}function ik(n,t){if(n&1&&(c(0,"option",43),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function rk(n,t){if(n&1&&(c(0,"option",43),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function ok(n,t){if(n&1&&(c(0,"div",44)(1,"div",45),d(2),l(),P(3,"input",46),c(4,"span",5),d(5,"\u2014"),l(),P(6,"input",47),c(7,"label",48),P(8,"input",49),c(9,"span",5),d(10,"Chiuso"),l()()()),n&2){let e,i,r,o=t.$implicit,s=g(2);Se("closed",(e=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:e.value),_("formGroupName",o.key),p(2),T(o.label),p(),fn("aria-label",Za("",o.label," apertura")),_("disabled",(i=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:i.value),p(3),fn("aria-label",Za("",o.label," chiusura")),_("disabled",(r=s.registerForm.get("opening_hours."+o.key+".closed"))==null?null:r.value),p(2),fn("aria-label",Za("",o.label," chiuso"))}}function sk(n,t){if(n&1&&(c(0,"div",10)(1,"h2",4)(2,"span",22),d(3,"business"),l(),d(4," Dati Azienda"),l(),c(5,"div",23)(6,"div")(7,"label",24),d(8,"Nome Azienda *"),l(),P(9,"input",25),E(10,XP,2,1,"div",15),l(),c(11,"div")(12,"label",24),d(13,"Partita IVA *"),l(),P(14,"input",26),E(15,nk,3,2,"div",15),l(),c(16,"div")(17,"label",24),d(18,"Provincia"),l(),P(19,"input",27),l(),c(20,"div")(21,"label",24),d(22,"Citt\xE0"),l(),P(23,"input",28),l(),c(24,"div")(25,"label",24),d(26,"Indirizzo"),l(),P(27,"input",29),l(),c(28,"div")(29,"label",24),d(30,"Civico"),l(),P(31,"input",30),l(),c(32,"div")(33,"label",24),d(34,"Sito web"),l(),P(35,"input",31),l(),c(36,"div")(37,"label",24),d(38,"Forma legale"),l(),c(39,"select",32)(40,"option",33),d(41,"Seleziona forma legale"),l(),E(42,ik,2,2,"option",34),l()(),c(43,"div")(44,"label",24),d(45,"Categoria"),l(),c(46,"select",35)(47,"option",33),d(48,"Seleziona categoria"),l(),E(49,rk,2,2,"option",34),l()(),c(50,"div",36)(51,"label",24),d(52,"Orari settimanali"),l(),c(53,"div",37),E(54,ok,11,12,"div",38),l(),c(55,"div",39),d(56,' Lascia vuoto open/close per i giorni chiusi oppure seleziona "Chiuso". '),l()()()()),n&2){let e=g();p(10),_("ngIf",(e.company_name==null?null:e.company_name.invalid)&&(e.company_name==null?null:e.company_name.touched)),p(5),_("ngIf",(e.vat==null?null:e.vat.invalid)&&(e.vat==null?null:e.vat.touched)),p(27),_("ngForOf",e.companyLegalForms),p(7),_("ngForOf",e.companyCategories),p(5),_("ngForOf",e.days)}}function ak(n,t){if(n&1&&(c(0,"div",10)(1,"h2",4)(2,"span",22),d(3,"person"),l(),d(4),l(),c(5,"div",23)(6,"div")(7,"label",24),d(8,"Nome *"),l(),P(9,"input",50),l(),c(10,"div")(11,"label",24),d(12,"Cognome *"),l(),P(13,"input",51),l(),c(14,"div")(15,"label",24),d(16,"Email *"),l(),P(17,"input",52),l(),c(18,"div")(19,"label",24),d(20,"Telefono *"),l(),P(21,"input",53),l(),c(22,"div")(23,"label",24),d(24,"Password *"),l(),P(25,"input",54),l(),c(26,"div")(27,"label",24),d(28,"Conferma Password *"),l(),P(29,"input",55),l()()()),n&2){let e=g();p(4),R(" ",e.mode==="admin"?"Dati Amministratore":"Dati Utente"," ")}}function lk(n,t){n&1&&(c(0,"div",40)(1,"span",42),d(2,"Devi accettare i termini"),l()())}function ck(n,t){if(n&1&&(c(0,"div",56),d(1),l()),n&2){let e=g();p(),T(e.errorMessage)}}function uk(n,t){if(n&1&&(c(0,"div",57),d(1),l()),n&2){let e=g();p(),T(e.successMessage)}}function dk(n,t){n&1&&(c(0,"span"),d(1,"Registrati"),l())}function fk(n,t){n&1&&(c(0,"span"),d(1,"Attendere\u2026"),l())}var pk=["S.r.l.","S.r.l.s.","S.p.A.","S.a.s.","S.n.c.","S.s.","Ditta Individuale","Libero Professionista"],hk=["Agricoltura","Industria","Costruzioni","Commercio","Alimentare","Trasporti","Servizi","ICT","Professioni","Altro"],hp=class n{constructor(t,e,i,r,o,s){this.fb=t;this.authService=e;this.router=i;this.route=r;this.invitiService=o;this.companyService=s;let a=this.fb.group({});this.days.forEach(u=>{a.addControl(u.key,this.fb.group({open:[""],close:[""],closed:[!1]}))}),this.registerForm=this.fb.group({company_name:["",[ne.required,ne.minLength(2)]],vat:["",[ne.required,ne.pattern(/^[0-9]{11}$/)]],address:[""],city:[""],province:[""],civic_number:[""],website:[""],legal_form:[""],category:[""],opening_hours:a,first_name:["",[ne.required,ne.minLength(2)]],last_name:["",[ne.required,ne.minLength(2)]],email:["",[ne.required,ne.email]],phone:["",[ne.required,ne.pattern(/^[0-9+\s\-()]{6,20}$/)]],birth_date:[""],birth_place:[""],fiscal_code:[""],timezone:["Europe/Rome"],is_active:[!1],hire_date:[""],password:["",[ne.required,ne.minLength(8)]],confirmPassword:["",[ne.required]],terms:[!1,[ne.requiredTrue]]},{validators:this.passwordMatchValidator})}mode="user";registerForm;isLoading=!1;errorMessage="";successMessage="";closed_days=[];weekDays=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];sub;companyLegalForms=pk;companyCategories=hk;days=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];ngOnInit(){let t=this.route.snapshot.queryParamMap.get("mode");(t==="user"||t==="admin")&&(this.mode=t),this.setMode(this.mode)}setMode(t){this.mode=t,t==="admin"?(this.registerForm.get("company_name")?.setValidators([ne.required,ne.minLength(2)]),this.registerForm.get("vat")?.setValidators([ne.required,ne.pattern(/^[0-9]{11}$/)]),this.registerForm.get("first_name")?.setValidators([ne.required,ne.minLength(2)]),this.registerForm.get("last_name")?.setValidators([ne.required,ne.minLength(2)]),this.registerForm.get("email")?.setValidators([ne.required,ne.email]),this.registerForm.get("phone")?.setValidators([ne.required,ne.pattern(/^[0-9+\s\-()]{6,20}$/)])):(this.registerForm.get("company_name")?.clearValidators(),this.registerForm.get("vat")?.clearValidators(),this.registerForm.get("first_name")?.setValidators([ne.required,ne.minLength(2)]),this.registerForm.get("last_name")?.setValidators([ne.required,ne.minLength(2)]),this.registerForm.get("email")?.setValidators([ne.required,ne.email]),this.registerForm.get("phone")?.setValidators([ne.required,ne.pattern(/^[0-9+\s\-()]{6,20}$/)])),Object.keys(this.registerForm.controls).forEach(e=>this.registerForm.get(e)?.updateValueAndValidity())}toggleClosedDay(t){let e=t.target,i=e.value;e.checked?this.closed_days.includes(i)||this.closed_days.push(i):this.closed_days=this.closed_days.filter(r=>r!==i)}passwordMatchValidator(t){let e=t.get("password")?.value,i=t.get("confirmPassword")?.value;return e&&i&&e!==i?{passwordMismatch:!0}:null}get company_name(){return this.registerForm.get("company_name")}get vat(){return this.registerForm.get("vat")}get first_name(){return this.registerForm.get("first_name")}get last_name(){return this.registerForm.get("last_name")}get email(){return this.registerForm.get("email")}get phone(){return this.registerForm.get("phone")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get terms(){return this.registerForm.get("terms")}onSubmit(){if(console.log("onSubmit invoked",{mode:this.mode,valid:this.registerForm.valid}),this.registerForm.invalid){this.registerForm.markAllAsTouched();return}this.isLoading=!0;let t=this.registerForm.value;if(this.mode==="admin"){let e={company:{name:t.company_name,vat:t.vat,address:t.address||null,city:t.city||null,province:t.province||null,civic_number:t.civic_number||null,website:t.website||null,legal_form:t.legal_form||null,category:t.category||null,opening_hours:t.opening_hours},admin:{first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone||null,birth_date:t.birth_date||null,birth_place:t.birth_place||null,fiscal_code:t.fiscal_code||null,timezone:t.timezone||"Europe/Rome",is_active:!!t.is_active,hire_date:t.hire_date||null,password:t.password}};this.sub=this.authService.registerAdmin(e).subscribe({next:i=>{this.isLoading=!1,this.successMessage="Registrazione admin completata",setTimeout(()=>this.router.navigate(["/login"]),1500)},error:i=>{this.isLoading=!1,this.errorMessage=i?.message||"Errore",console.error(i)}})}else this.isLoading=!0,this.sub=this.invitiService.getInviteForEmail(t.email).pipe(wt(1),He(e=>{if(!e)return this.isLoading=!1,this.errorMessage="La tua email non \xE8 autorizzata. Contatta l'amministratore dell'azienda.",Pt;console.debug("[Register] invite found:",e);let r=(o=>{if(!o)return null;let s=String(o).trim();return s=s.replace(/^["']+|["']+$/g,""),s||null})(e.company_id);return console.debug("[Register] companyIdFromInvite:",r),r?this.completeUserRegistration(t,e,r):(this.isLoading=!1,this.errorMessage="Invito non valido: company_id mancante.",Pt)})).subscribe({next:e=>{this.isLoading=!1,this.successMessage="Registrazione utente completata",setTimeout(()=>this.router.navigate(["/login"]),1500)},error:e=>{this.isLoading=!1,this.errorMessage=e?.message||"Errore durante la registrazione",console.error("Registration error:",e)}})}completeUserRegistration(t,e,i){let r={user:{first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone,password:t.password,timezone:t.timezone||"Europe/Rome"},company_id:i};return console.debug("[Register] Final payload:",r),this.authService.registerUser(r).pipe(wt(1),He(o=>this.invitiService.markAccepted(e.id).pipe(wt(1),fe(()=>o))))}ngOnDestroy(){this.sub?.unsubscribe()}goToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(D(Ii),D(le),D(Ie),D($t),D(ia),D(et))};static \u0275cmp=we({type:n,selectors:[["app-register"]],decls:36,vars:14,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","900px","margin","auto"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"section-header",2,"justify-content","center","padding","var(--gutter-md)"],["type","button",1,"promethea-button",3,"click"],["novalidate","",1,"generic-form",3,"ngSubmit","formGroup"],["class","form-section",4,"ngIf"],[1,"form-section"],[1,"form-group"],[1,"checkbox-label"],["type","checkbox","formControlName","terms",1,"checkbox-input"],["href","#",1,"link"],["class","error-messages",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","status-message info",4,"ngIf"],[1,"form-footer",2,"display","flex","justify-content","flex-end","gap","var(--gutter-sm)","margin-top","var(--gutter-md)"],["type","button",1,"promethea-button","ghost",3,"click","disabled"],["type","submit",1,"promethea-button",3,"disabled"],[4,"ngIf"],[1,"material-icons"],[1,"grid-form"],[1,"form-label"],["type","text","formControlName","company_name","placeholder","Nome azienda",1,"form-input"],["type","text","formControlName","vat","placeholder","12345678901",1,"form-input"],["type","text","formControlName","province","placeholder","MI",1,"form-input"],["type","text","formControlName","city","placeholder","Milano",1,"form-input"],["type","text","formControlName","address","placeholder","Via Roma 1",1,"form-input"],["type","text","formControlName","civic_number","placeholder","1/A",1,"form-input"],["type","url","formControlName","website","placeholder","https://esempio.it",1,"form-input"],["formControlName","legal_form",1,"form-input"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","category",1,"form-input"],[1,"form-group",2,"grid-column","1 / -1"],["formGroupName","opening_hours",2,"display","flex","flex-direction","column","gap","0.5rem"],["class","opening-row","style","display:flex; gap:0.5rem; align-items:center;",3,"formGroupName","closed",4,"ngFor","ngForOf"],[1,"text-muted",2,"font-size","0.9rem","margin-top","0.35rem"],[1,"error-messages"],["class","error",4,"ngIf"],[1,"error"],[3,"value"],[1,"opening-row",2,"display","flex","gap","0.5rem","align-items","center",3,"formGroupName"],[2,"width","110px","font-weight","600"],["type","time","formControlName","open",1,"form-input",2,"width","140px",3,"disabled","aria-label"],["type","time","formControlName","close",1,"form-input",2,"width","140px",3,"disabled","aria-label"],[1,"closed-label",2,"display","flex","align-items","center","gap","0.3rem","margin-left","0.5rem"],["type","checkbox","formControlName","closed",3,"aria-label"],["type","text","formControlName","first_name",1,"form-input"],["type","text","formControlName","last_name",1,"form-input"],["type","email","formControlName","email",1,"form-input"],["type","tel","formControlName","phone",1,"form-input"],["type","password","formControlName","password",1,"form-input"],["type","password","formControlName","confirmPassword",1,"form-input"],[1,"status-message","error"],[1,"status-message","info"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),d(5,"Crea il Tuo Account"),l(),c(6,"p",5),d(7,"Seleziona il tipo di registrazione"),l()()(),c(8,"div",6)(9,"button",7),x("click",function(){return i.setMode("admin")}),d(10,"Azienda / Admin"),l(),c(11,"button",7),x("click",function(){return i.setMode("user")}),d(12,"Dipendente"),l()(),c(13,"form",8),x("ngSubmit",function(){return i.onSubmit()}),E(14,sk,57,5,"div",9)(15,ak,30,1,"div",9),c(16,"div",10)(17,"div",11)(18,"label",12),P(19,"input",13),d(20," Accetto i "),c(21,"a",14),d(22,"Termini e Condizioni"),l(),d(23," e la "),c(24,"a",14),d(25,"Privacy"),l(),d(26," * "),l(),E(27,lk,3,0,"div",15),l()(),E(28,ck,2,1,"div",16)(29,uk,2,1,"div",17),c(30,"div",18)(31,"button",19),x("click",function(){return i.goToLogin()}),d(32,"Annulla"),l(),c(33,"button",20),E(34,dk,2,0,"span",21)(35,fk,2,0,"span",21),l()()()()()),e&2&&(p(9),Se("active",i.mode==="admin"),p(2),Se("active",i.mode==="user"),p(2),_("formGroup",i.registerForm),p(),_("ngIf",i.mode==="admin"),p(),_("ngIf",i.mode==="user"||i.mode==="admin"),p(12),_("ngIf",(i.terms==null?null:i.terms.invalid)&&(i.terms==null?null:i.terms.touched)),p(),_("ngIf",i.errorMessage),p(),_("ngIf",i.successMessage),p(2),_("disabled",i.isLoading),p(2),_("disabled",i.isLoading||i.registerForm.invalid),p(),_("ngIf",!i.isLoading),p(),_("ngIf",i.isLoading))},dependencies:[Ee,Be,xe,Ti,Ln,Wt,Gt,Re,bo,At,Fe,Fn,jn,oi,Hs],styles:[".opening-row[_ngcontent-%COMP%]{padding:.35rem 0;align-items:center;transition:opacity .18s ease,background-color .18s ease}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{height:40px;padding:.45rem .75rem}.opening-row.closed[_ngcontent-%COMP%]{opacity:.6;pointer-events:auto;background:color-mix(in srgb,var(--background) 92%,transparent);border-radius:8px;padding-left:.5rem}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:disabled{background:color-mix(in srgb,var(--smoke-color-1) 6%,var(--background));border-color:color-mix(in srgb,var(--smoke-color-1) 45%,transparent);color:color-mix(in srgb,var(--text-color) 60%,transparent);cursor:not-allowed;box-shadow:none}.closed-label[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{font-size:.92rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);font-weight:600}@media (max-width: 640px){.opening-row[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.4rem}.opening-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{width:100%;font-size:.95rem}.opening-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{width:48%;min-width:120px}}"]})};function mk(n,t){n&1&&d(0," Email obbligatoria ")}function gk(n,t){n&1&&d(0," Inserisci un indirizzo email valido ")}function vk(n,t){if(n&1&&(c(0,"div",14),ee(1,mk,1,0),ee(2,gk,1,0),l()),n&2){let e,i,r=g();p(),te(!((e=r.forgotPasswordForm.get("email"))==null||e.errors==null)&&e.errors.required?1:-1),p(),te(!((i=r.forgotPasswordForm.get("email"))==null||i.errors==null)&&i.errors.email?2:-1)}}function _k(n,t){if(n&1&&(c(0,"div",23)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.errorMessage," ")}}function yk(n,t){if(n&1&&(c(0,"div",24)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.successMessage," ")}}function bk(n,t){n&1&&(c(0,"span",4),d(1,"send"),l())}function wk(n,t){n&1&&P(0,"span",28)}var mp=class n{constructor(t,e,i){this.fb=t;this.authService=e;this.router=i;this.forgotPasswordForm=this.fb.group({email:["",[ne.required,ne.email]]})}forgotPasswordForm;isLoading=!1;errorMessage="";successMessage="";ngOnInit(){}onSubmit(){return y(this,null,function*(){if(this.forgotPasswordForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=this.forgotPasswordForm.get("email")?.value;yield this.simulaInvioEmailReset(t),this.successMessage="Email di recupero inviata! Controlla la tua casella di posta.",this.forgotPasswordForm.reset(),setTimeout(()=>{this.router.navigate(["/login"])},3e3)}catch(t){console.error("Errore nel recupero password:",t),this.errorMessage=this.getErrorMessage(t)}finally{this.isLoading=!1}})}markFormGroupTouched(){Object.keys(this.forgotPasswordForm.controls).forEach(t=>{this.forgotPasswordForm.get(t)?.markAsTouched()})}simulaInvioEmailReset(t){return y(this,null,function*(){return new Promise((e,i)=>{setTimeout(()=>{Math.random()<.1?i({code:"NETWORK_ERROR",message:"Errore di connessione. Riprova pi\xF9 tardi."}):e()},1500)})})}getErrorMessage(t){return t?.code==="NETWORK_ERROR"?t.message:t?.code==="USER_NOT_FOUND"?"Nessun account trovato con questa email.":t?.code==="TOO_MANY_REQUESTS"?"Troppi tentativi. Riprova pi\xF9 tardi.":"Si \xE8 verificato un errore. Riprova pi\xF9 tardi."}hasError(t,e){let i=this.forgotPasswordForm.get(t);return i?i.hasError(e)&&i.touched:!1}static \u0275fac=function(e){return new(e||n)(D(Ii),D(le),D(Ie))};static \u0275cmp=we({type:n,selectors:[["app-forgot-password"]],decls:73,vars:8,consts:[[1,"gradient-container"],[1,"form-card"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"filter-group"],[1,"form-label"],["type","email","formControlName","email","placeholder","inserisci la tua email","autocomplete","email"],[1,"error"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-content"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],[1,"status-message","error"],[1,"status-message","info"],[1,"form-actions"],["type","button","routerLink","/login",1,"promethea-button","ghost"],["type","submit",1,"promethea-button",3,"disabled"],[1,"loading-spinner"],[1,"form-footer"],["routerLink","/support",1,"link"]],template:function(e,i){if(e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5,"key"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Recupera Password"),l(),c(9,"p",7),d(10,"Inserisci la tua email per reimpostare la password"),l()()(),c(11,"form",8),x("ngSubmit",function(){return i.onSubmit()}),c(12,"div",9)(13,"h2",6)(14,"span",4),d(15,"email"),l(),d(16," Informazioni Account "),l(),c(17,"div",10)(18,"div",11)(19,"label",12)(20,"span",4),d(21,"alternate_email"),l(),d(22," Email * "),l(),P(23,"input",13),ee(24,vk,3,2,"div",14),l()()(),c(25,"div",9)(26,"div",15)(27,"div",16)(28,"span",4),d(29,"info"),l(),c(30,"h3",17),d(31,"Cosa succede dopo?"),l()(),c(32,"div",18)(33,"div",19)(34,"span",4),d(35,"send"),l(),c(36,"div",20)(37,"span",21),d(38,"Invio email"),l(),c(39,"span",22),d(40,"Riceverai un link per reimpostare la password"),l()()(),c(41,"div",19)(42,"span",4),d(43,"schedule"),l(),c(44,"div",20)(45,"span",21),d(46,"Validit\xE0"),l(),c(47,"span",22),d(48,"Il link scade dopo 24 ore"),l()()(),c(49,"div",19)(50,"span",4),d(51,"security"),l(),c(52,"div",20)(53,"span",21),d(54,"Sicurezza"),l(),c(55,"span",22),d(56,"Il link \xE8 personale e sicuro"),l()()()()()(),ee(57,_k,4,1,"div",23),ee(58,yk,4,1,"div",24),c(59,"div",25)(60,"button",26)(61,"span",4),d(62,"arrow_back"),l(),d(63," Torna al Login "),l(),c(64,"button",27),ee(65,bk,2,0,"span",4),ee(66,wk,1,0,"span",28),d(67),l()(),c(68,"div",29)(69,"p",7),d(70," Problemi? "),c(71,"a",30),d(72,"Contatta il supporto"),l()()()()()()),e&2){let r;p(11),_("formGroup",i.forgotPasswordForm),p(13),te((r=i.forgotPasswordForm.get("email"))!=null&&r.invalid&&((r=i.forgotPasswordForm.get("email"))!=null&&r.touched)?24:-1),p(33),te(i.errorMessage?57:-1),p(),te(i.successMessage?58:-1),p(6),_("disabled",i.forgotPasswordForm.invalid||i.isLoading),p(),te(i.isLoading?-1:65),p(),te(i.isLoading?66:-1),p(),R(" ",i.isLoading?"Invio in corso...":"Invia Link di Reset"," ")}},dependencies:[Ee,Ti,Ln,Re,Fe,Fn,jn,oi,jt,Ht],styles:["[_nghost-%COMP%]{display:block;width:100%}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{max-width:95%!important;padding:var(--gutter-lg)!important}.form-actions[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}.form-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})};var $n=class n{message="";fullScreen=!0;size="64px";get style(){return{"--spinner-size":this.size}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=we({type:n,selectors:[["app-loading-spinner"]],inputs:{message:"message",fullScreen:"fullScreen",size:"size"},decls:7,vars:4,consts:[["role","status","aria-live","polite","aria-busy","true",1,"spinner-overlay"],[1,"spinner-wrap",3,"ngStyle"],["aria-hidden","true",1,"loading-spinner"],[1,"spinner-message"],[1,"visually-hidden"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1),P(2,"div",2),c(3,"div",3),d(4),l(),c(5,"span",4),d(6,"Caricamento in corso"),l()()()),e&2&&(Se("fullscreen",i.fullScreen),p(),_("ngStyle",i.style),p(3),T(i.message||"Caricamento in corso..."))},dependencies:[Ee,al],styles:[".spinner-overlay[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:var(--gutter-lg);width:100%;box-sizing:border-box;pointer-events:none}.spinner-overlay.fullscreen[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;background:var(--background);pointer-events:auto}.spinner-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:calc(var(--gutter-sm) / 2);padding:calc(var(--gutter-sm));border-radius:12px;background:transparent}.visually-hidden[_ngcontent-%COMP%]{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}.loading-spinner[_ngcontent-%COMP%]{min-width:48px;min-height:48px;width:var(--fs-xl);height:var(--fs-xl);border-radius:50%;border:6px solid color-mix(in srgb,var(--muted) 25%,transparent);border-top-color:var(--primary-color, #1976d2);box-sizing:border-box;animation:_ngcontent-%COMP%_spinner-rotate .9s linear infinite}.spinner-message[_ngcontent-%COMP%]{margin-top:8px;color:var(--text-muted);opacity:.95;text-align:center;max-width:min(320px,80vw);white-space:normal;line-height:1.2;font-weight:700;font-style:italic}@keyframes _ngcontent-%COMP%_spinner-rotate{to{transform:rotate(360deg)}}"]})};var Nt=class n{constructor(t,e,i){this.http=t;this.authService=e;this.supabaseService=i}timbrature=Je([]);base="/api/timbrature";fetchTimbrature(){return y(this,arguments,function*(t={}){try{let e=this.supabaseService.getClient(),i=t.select??"*, user:users(id,first_name,last_name,role)",r=e.from("timbrature").select(i);if(t.userId&&(r=r.eq("user_id",t.userId)),t.companyId&&(r=r.eq("company_id",t.companyId)),t.deleted===!0?r=r.eq("deleted",!0):r=r.eq("deleted",!1),t.date){let a=new Date(t.date);a.setHours(0,0,0,0);let u=new Date(a);u.setDate(u.getDate()+1),r=r.gte("start_ts",a.toISOString()).lt("start_ts",u.toISOString())}else if(t.from&&(r=r.gte("start_ts",t.from.toISOString())),t.to){let a=new Date(t.to);a.setDate(a.getDate()+1),r=r.lt("start_ts",a.toISOString())}r=r.order("start_ts",{ascending:!!t.orderAsc}),t.limit&&(r=r.limit(t.limit));let{data:o,error:s}=yield r;if(s)throw console.error("[TimbratureService] fetchTimbrature error",s),s;return o??[]}catch(e){throw console.error("[TimbratureService] fetchTimbrature unexpected",e),e}})}getRecent(t=10){let e=this.authService.getAuthHeaders();return this.http.get(`${this.base}?limit=${t}`,{headers:e})}approve(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.base}/${t}/approve`,{},{headers:e})}punchIn(){let t=this.authService.getAuthHeaders();return this.http.post(`${this.base}/punch-in`,{},{headers:t})}punchOut(){let t=this.authService.getAuthHeaders();return this.http.post(`${this.base}/punch-out`,{},{headers:t})}eliminaTimbratura(t){let e=this.authService.getAuthHeaders();return this.http.delete(`${this.base}/${t}`,{headers:e})}getTimbraturaBId(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("timbrature").select("*, user:users(id,first_name,last_name,role)").eq("id",t).maybeSingle();if(r)throw console.error("[TimbratureService] getTimbraturaBId error",r),r;return i}catch(e){throw console.error("[TimbratureService] getTimbraturaBId unexpected",e),e}})}aggiornaTimbratura(t,e){return y(this,null,function*(){try{let i=this.supabaseService.getClient(),{data:r,error:o}=yield i.from("timbrature").update(e).eq("id",t).select().maybeSingle();if(o)throw console.error("[TimbratureService] aggiornaTimbratura error",o),o;return r}catch(i){throw console.error("[TimbratureService] aggiornaTimbratura unexpected",i),i}})}creaTimbraturaSupabase(t){return y(this,null,function*(){return this.creaTimbratura(t)})}getTimbraturePerGiorno(t,e){return e.filter(i=>{let r=new Date(i.start_ts);return this.isStessoGiorno(r,t)})}isStessoGiorno(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}formattaOrarioTimbratura(t){let e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null,r=e.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});if(i){let o=i.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),s=t.total_minutes||Math.round((i.getTime()-e.getTime())/(1e3*60)),a=Math.floor(s/60),u=s%60;return`${r} - ${o} (${a}h ${u}m)`}else return`${r} - In corso`}getColoreTimbratura(t){return t.end_ts?"var(--primary)":"#ef4444"}getTimbratureUtente(t){return y(this,null,function*(){return this.fetchTimbrature({userId:t,orderAsc:!1})})}getTimbratureAzienda(t){return y(this,null,function*(){return this.fetchTimbrature({companyId:t,orderAsc:!1})})}creaTimbratura(t){return y(this,null,function*(){try{let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("timbrature").insert(t).select().maybeSingle();if(r)throw console.error("[TimbratureService] creaTimbratura error",r),r;return i}catch(e){throw console.error("[TimbratureService] creaTimbratura unexpected",e),e}})}getTimbraturePerCalendario(){return y(this,null,function*(){return this.fetchTimbrature({orderAsc:!1})})}hasTimbraturaPerGiorno(t,e,i){return y(this,null,function*(){if(!t||!e)return!1;let r=typeof e=="string"?new Date(e):new Date(e);r.setHours(0,0,0,0);let o=new Date(r);o.setDate(o.getDate()+1);try{let a=this.supabaseService.getClient().from("timbrature").select("id").eq("user_id",t).gte("start_ts",r.toISOString()).lt("start_ts",o.toISOString()).limit(1),{data:u,error:f}=yield a;if(f)return console.error("[TimbratureService] hasTimbraturaPerGiorno error",f),!1;if(!u||Array.isArray(u)&&u.length===0)return!1;let h=Array.isArray(u)?u[0]?.id:u?.id;return!(!h||i&&h===i)}catch(s){return console.error("[TimbratureService] hasTimbraturaPerGiorno unexpected",s),!1}})}getDeletedTimbrature(t){return y(this,null,function*(){return this.fetchTimbrature({userId:t??void 0,deleted:!0,orderAsc:!1})})}softDeleteTimbratura(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient(),{error:r}=yield i.from("timbrature").update({deleted:!0,deleted_at:new Date().toISOString(),deleted_by:e??null}).eq("id",t);if(r)throw console.error("[TimbratureService] softDeleteTimbratura error",r),r})}restoreTimbratura(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{error:i}=yield e.from("timbrature").update({deleted:!1,deleted_at:null,deleted_by:null}).eq("id",t);if(i)throw console.error("[TimbratureService] restoreTimbratura error",i),i})}getRichiesteModifica(t,e){return y(this,null,function*(){try{let r=this.supabaseService.getClient().from("richieste_modifica_timbrature").select("*, timbratura:timbrature(id, start_ts, total_minutes, user_id), user:users(id,first_name,last_name,email)").order("created_at",{ascending:!1});t&&(r=r.eq("company_id",t)),e&&(r=r.eq("status",e));let{data:o,error:s}=yield r;if(s)throw console.error("[TimbratureService] getRichiesteModifica error",s),s;return o??[]}catch(i){throw console.error("[TimbratureService] getRichiesteModifica unexpected",i),i}})}aggiornaRichiestaModifica(t,e,i,r=!1){return y(this,null,function*(){try{let o=this.supabaseService.getClient();if(e==="approved"&&r){let{data:u,error:f}=yield o.from("richieste_modifica_timbrature").select("*").eq("id",t).maybeSingle();if(f)throw f;if(u&&u.timbratura_id&&u.requested_changes){let{error:h}=yield o.from("timbrature").update(u.requested_changes).eq("id",u.timbratura_id);if(h)throw h}}let{data:s,error:a}=yield o.from("richieste_modifica_timbrature").update({status:e,admin_response:i??null,updated_at:new Date().toISOString()}).eq("id",t).select().maybeSingle();if(a)throw console.error("[TimbratureService] aggiornaRichiestaModifica error",a),a;return s}catch(o){throw console.error("[TimbratureService] aggiornaRichiestaModifica unexpected",o),o}})}creaRichiestaModifica(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{data:i,error:r}=yield e.from("richieste_modifica_timbrature").insert({timbratura_id:t.timbratura_id,user_id:t.user_id,company_id:t.company_id,requested_changes:t.requested_changes,original_data:t.original_data??null,reason:t.reason??null,status:"pending"}).select().maybeSingle();if(r)throw console.error("[TimbratureService] creaRichiestaModifica error",r),r;return i})}static \u0275fac=function(e){return new(e||n)(z(bi),z(le),z(pt))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ek(n,t){n&1&&P(0,"app-loading-spinner")}function Ck(n,t){if(n&1&&(c(0,"p",10),d(1),l()),n&2){let e=g();p(),R("Benvenuto in ",e.company.name)}}function Sk(n,t){if(n&1&&(Ze(0),d(1),Qe()),n&2){let e=g(3);p(),R(" ",e.timbratureService.formattaOrarioTimbratura(e.todaysTimbratura)," ")}}function xk(n,t){n&1&&(c(0,"div",25),d(1,"Non presente"),l())}function Dk(n,t){if(n&1&&(Ze(0),E(1,Sk,2,1,"ng-container",24)(2,xk,2,0,"ng-template",null,0,wn),Qe()),n&2){let e=en(3),i=g(2);p(),_("ngIf",i.todaysTimbratura)("ngIfElse",e)}}function Ik(n,t){if(n&1&&(Ze(0),d(1),Qe()),n&2){let e=g(2);p(),R(" ",e.getTimbratureOggi()," ")}}function Tk(n,t){if(n&1&&(c(0,"div",13)(1,"h3",14),d(2,"Dipendenti Attivi"),l(),c(3,"div",15),d(4),l(),c(5,"p",10),d(6,"Nell'azienda"),l()()),n&2){let e=g(2);p(4),T(e.getDipendentiAttivi())}}function Mk(n,t){n&1&&(c(0,"button",26)(1,"span",5),d(2,"people"),l(),d(3," Gestisci Dipendenti "),l())}function Ak(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12)(2,"div",13)(3,"h3",14),d(4,"Ore Lavorate"),l(),c(5,"div",15),d(6),Z(7,"number"),l(),c(8,"p",10),d(9),l()(),c(10,"div",13)(11,"h3",14),d(12,"Timbrature Oggi"),l(),c(13,"div",15),E(14,Dk,4,2,"ng-container",1)(15,Ik,2,1,"ng-container",1),l(),c(16,"p",10),d(17),l()(),E(18,Tk,7,1,"div",16),c(19,"div",13)(20,"h3",14),d(21,"Stato"),l(),c(22,"div",15)(23,"span",17),d(24),l()(),c(25,"p",10),d(26,"Il tuo account"),l()()(),c(27,"div",18)(28,"h2",7)(29,"span",5),d(30,"flash_on"),l(),d(31," Azioni Rapide "),l(),c(32,"div",19)(33,"button",20),x("click",function(){C(e);let r=g();return S(r.nuovaTimbraturaWithCheck())}),c(34,"span",5),d(35,"add_circle"),l(),d(36," Nuova Timbratura "),l(),c(37,"button",21)(38,"span",5),d(39,"list"),l(),d(40," Vedi Timbrature "),l(),c(41,"button",22)(42,"span",5),d(43,"settings"),l(),d(44," Impostazioni "),l(),E(45,Mk,4,0,"button",23),l()()()}if(n&2){let e=g();p(6),R("",X(7,10,e.getOreLavorateMese(),"1.1-1"),"h"),p(3),R(" ",(e.currentUser==null?null:e.currentUser.role)==="employee"?"Tue ore questo mese":"Totale ore questo mese"," "),p(5),_("ngIf",(e.currentUser==null?null:e.currentUser.role)==="employee"),p(),_("ngIf",e.currentUser&&e.currentUser.role!=="employee"),p(2),R(" ",(e.currentUser==null?null:e.currentUser.role)==="employee"?"La tua timbratura di oggi":"Timbrature odierne nell'azienda"," "),p(),_("ngIf",e.hasRole("admin")||e.hasRole("manager")),p(5),br(e.currentUser!=null&&e.currentUser.is_active?"active":"inactive"),p(),R(" ",e.currentUser!=null&&e.currentUser.is_active?"Attivo":"Inattivo"," "),p(21),_("ngIf",e.hasRole("admin"))}}var gp=class n{constructor(t,e,i,r){this.authService=t;this.companyService=e;this.timbratureService=i;this.router=r}currentUser=null;company=null;timbrature=[];todaysTimbratura=null;dipendenti=[];isLoading=!0;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&this.caricaDatiHome(t.company_id)})}caricaDatiHome(t){return y(this,null,function*(){this.isLoading=!0;try{this.companyService.getAzienda(t).subscribe({next:e=>{this.company=e},error:e=>{console.error("Errore nel caricamento dati azienda:",e)}}),this.currentUser&&(this.currentUser.role==="employee"?this.timbrature=yield this.timbratureService.getTimbratureUtente(this.currentUser.id):this.currentUser.role==="admin"?this.timbrature=yield this.timbratureService.getTimbratureAzienda(t):this.currentUser.role==="manager"&&(this.timbrature=yield this.timbratureService.getTimbratureUtente(this.currentUser.id)),this.updateTodayTimbratura()),this.hasRole("admin")||this.hasRole("manager")?this.companyService.getDipendenti(t).subscribe({next:e=>{this.dipendenti=e,this.isLoading=!1},error:e=>{console.error("Errore nel caricamento dipendenti:",e),this.isLoading=!1}}):this.isLoading=!1}catch(e){console.error("Errore nel caricamento dati home:",e),this.isLoading=!1}})}hasRole(t){return this.authService.hasRole(t)}getOreLavorateSettimana(){if(!this.timbrature||this.timbrature.length===0)return 0;let{inizioSettimana:t,oggi:e}=this.getIntervaloSettimanaCorrente(),i=this.timbrature.filter(s=>{if(!s.end_ts)return!1;let a=new Date(s.start_ts);return a>=t&&a<=e}),r=i;return this.currentUser?.role==="employee"&&(r=i.filter(s=>s.user_id===this.currentUser?.id)),r.reduce((s,a)=>s+(a.total_minutes||0),0)/60}getTimbratureOggi(){if(!this.timbrature||this.timbrature.length===0)return 0;let t=new Date;t.setHours(0,0,0,0);let e=new Date(t);e.setDate(e.getDate()+1);let i=this.timbrature.filter(r=>{let o=new Date(r.start_ts);return o>=t&&o<e});return this.currentUser?.role==="employee"?i.filter(r=>r.user_id===this.currentUser?.id).length:i.length}getDipendentiAttivi(){return this.dipendenti.filter(t=>t.is_active).length}getIntervaloSettimanaCorrente(){let t=new Date;t.setHours(23,59,59,999);let e=t.getDay(),i=e===0?6:e-1,r=new Date(t);return r.setDate(t.getDate()-i),r.setHours(0,0,0,0),{inizioSettimana:r,oggi:t}}nuovaTimbraturaWithCheck(){return y(this,null,function*(){try{if(!this.currentUser){this.router.navigate(["/crea-timbratura"]);return}let t=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1);let r=t.find(o=>{let s=new Date(o.start_ts);return s>=e&&s<i});if(r){let o=new Date(r.start_ts).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});window.confirm(`\xC8 gi\xE0 presente una timbratura in data di oggi con ingresso alle ${o}.
Vuoi modificarla?`)&&this.router.navigate(["/crea-timbratura"],{queryParams:{edit:r.id,mode:"edit"}})}else this.router.navigate(["/crea-timbratura"])}catch(t){console.error("[Home] nuovaTimbraturaWithCheck error",t),this.router.navigate(["/crea-timbratura"])}})}updateTodayTimbratura(){if(this.todaysTimbratura=null,!this.currentUser||!this.timbrature||!this.timbrature.length)return;let t=new Date;t.setHours(0,0,0,0);let e=new Date(t);e.setDate(t.getDate()+1);let i=this.timbrature.find(r=>{if(!r?.start_ts)return!1;let o=new Date(r.start_ts);return o>=t&&o<e&&(this.currentUser?.role==="admin"||r.user_id===this.currentUser?.id)})||null;this.todaysTimbratura=i}getOreLavorateMese(){if(!this.timbrature||!this.timbrature.length)return 0;let t=new Date,e=t.getFullYear(),i=t.getMonth(),r=0;for(let o of this.timbrature){if(!o?.start_ts)continue;let s=new Date(o.start_ts);if(!(s.getFullYear()!==e||s.getMonth()!==i)){if(typeof o.total_minutes=="number"){r+=o.total_minutes;continue}if(o.end_ts){let a=new Date(o.end_ts),f=Math.max(0,Math.round((a.getTime()-s.getTime())/6e4)),h=o.breaks;if(Array.isArray(h)&&h.length){for(let m of h)if(typeof m=="number")f-=m;else if(typeof m?.minutes=="number")f-=m.minutes;else if(m?.start&&m?.end){let b=new Date(m.start),v=new Date(m.end);f-=Math.max(0,Math.round((v.getTime()-b.getTime())/6e4))}}r+=Math.max(0,f)}}}return r/60}static \u0275fac=function(e){return new(e||n)(D(le),D(et),D(Nt),D(Ie))};static \u0275cmp=we({type:n,selectors:[["app-home"]],decls:11,vars:3,consts:[["noTimbr",""],[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],["class","text-muted",4,"ngIf"],["class","dashboard-grid",4,"ngIf"],[1,"text-muted"],[1,"dashboard-grid"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"],["class","card",4,"ngIf"],[1,"chip"],[1,"form-section"],[1,"grid-alternative"],["type","button",1,"promethea-button",3,"click"],["routerLink","/timbrature",1,"promethea-button","outline"],["routerLink","/impostazioni",1,"promethea-button","secondary"],["class","promethea-button ghost","routerLink","/dipendenti",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"muted"],["routerLink","/dipendenti",1,"promethea-button","ghost"]],template:function(e,i){e&1&&(E(0,Ek,1,0,"app-loading-spinner",1),c(1,"div",2)(2,"div",3)(3,"div",4)(4,"span",5),d(5,"dashboard"),l()(),c(6,"div",6)(7,"h1",7),d(8,"Dashboard"),l(),E(9,Ck,2,1,"p",8),l()(),E(10,Ak,46,13,"div",9),l()),e&2&&(_("ngIf",i.isLoading),p(9),_("ngIf",i.company),p(),_("ngIf",!i.isLoading))},dependencies:[Ee,xe,jt,Ht,$n,tn],encapsulation:2})};function Rk(n,t){n&1&&P(0,"app-loading-spinner")}function Ok(n,t){if(n&1){let e=k();c(0,"button",31),x("click",function(){C(e);let r=g();return S(r.toggleShowDeleted())}),c(1,"span",4),d(2,"delete_outline"),l(),d(3),l()}if(n&2){let e=g();p(3),R(" ",e.showDeletedSection?"Nascondi cestino":"Timbrature cancellate"," ")}}function Nk(n,t){n&1&&(c(0,"div",32)(1,"h2",33),d(2,"Richieste di modifica timbrature"),l()())}function Pk(n,t){n&1&&(c(0,"div",34),d(1,"Nessuna richiesta di modifica in attesa."),l())}function kk(n,t){if(n&1&&(c(0,"div")(1,"strong"),d(2),l(),c(3,"span",34),d(4),l(),c(5,"span"),d(6," \u2192 "),l(),c(7,"span"),d(8),l()()),n&2){let e=t.$implicit;p(2),R("",e.label,":"),p(2),T(e.old),p(4),T(e.newVal)}}function Fk(n,t){if(n&1){let e=k();c(0,"tr")(1,"td"),d(2),l(),c(3,"td"),d(4),Z(5,"date"),l(),c(6,"td",35),E(7,kk,9,3,"div",27),l(),c(8,"td",36)(9,"button",37),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.handleRichiestaAction(r,"approve"))}),d(10,"Approva"),l(),c(11,"button",38),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.handleRichiestaAction(r,"reject"))}),d(12,"Rifiuta"),l()()()}if(n&2){let e=t.$implicit,i=g(2);p(2),ve("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name),p(2),T(X(5,4,e.timbratura==null?null:e.timbratura.start_ts,"yyyy-MM-dd")),p(3),_("ngForOf",i.formatRequestedChanges(e))}}function Lk(n,t){if(n&1&&(c(0,"table",26)(1,"thead")(2,"tr")(3,"th"),d(4,"Utente"),l(),c(5,"th"),d(6,"Data"),l(),c(7,"th",35),d(8,"Richiesta"),l(),c(9,"th",36),d(10,"Azioni"),l()()(),c(11,"tbody"),E(12,Fk,13,7,"tr",27),l()()),n&2){let e=g();p(12),_("ngForOf",e.richiesteModifica)}}function jk(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function Vk(n,t){if(n&1&&(c(0,"td")(1,"div",43)(2,"div",44),d(3),l(),c(4,"div",45)(5,"strong"),d(6),l()()()()),n&2){let e=g().$implicit,i=g();p(3),R(" ",i.getInitials(e.user==null?null:e.user.first_name,e.user==null?null:e.user.last_name)," "),p(3),ve("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name)}}function zk(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e=g().$implicit;p(),R(" ",e.breaks.length," ")}}function Uk(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function Bk(n,t){if(n&1&&(c(0,"span",46),d(1),l()),n&2){let e=g().$implicit,i=g();_("title",e.notes),p(),R(" ",i.troncaTesto(e.notes,30)," ")}}function $k(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function Hk(n,t){if(n&1){let e=k();c(0,"button",47),x("click",function(r){C(e);let o=g().$implicit;return g().eliminaTimbratura(o),S(r.stopPropagation())}),c(1,"span",4),d(2,"delete"),l()()}}function Wk(n,t){if(n&1){let e=k();c(0,"tr"),E(1,Vk,7,3,"td",0),c(2,"td"),d(3),Z(4,"date"),l(),c(5,"td"),d(6),Z(7,"date"),l(),c(8,"td"),d(9),Z(10,"date"),l(),c(11,"td"),d(12),Z(13,"number"),l(),c(14,"td"),E(15,zk,2,1,"span",0)(16,Uk,2,0,"span",0),l(),c(17,"td"),E(18,Bk,2,2,"span",39)(19,$k,2,0,"span",0),l(),c(20,"td")(21,"div",40)(22,"button",41),x("click",function(){let r=C(e).$implicit,o=g();return S(o.visualizzaTimbratura(r))}),c(23,"span",4),d(24,"visibility"),l()(),E(25,Hk,3,0,"button",42),l()()()}if(n&2){let e=t.$implicit,i=g();p(),_("ngIf",i.hasRole("admin")),p(2),T(X(4,10,e.start_ts,"dd/MM/yyyy")),p(3),T(X(7,13,e.start_ts,"HH:mm")),p(3),T(e.end_ts?X(10,16,e.end_ts,"HH:mm"):"In corso..."),p(3),R("",X(13,19,e.total_minutes/60,"1.1-1"),"h"),p(3),_("ngIf",e.breaks&&e.breaks.length>0),p(),_("ngIf",!e.breaks||e.breaks.length===0),p(2),_("ngIf",e.notes),p(),_("ngIf",!e.notes),p(6),_("ngIf",i.hasRole("admin"))}}function Gk(n,t){n&1&&(c(0,"div",48)(1,"span",4),d(2,"inbox"),l(),c(3,"h3"),d(4,"Nessuna timbratura trovata"),l(),c(5,"p"),d(6,"Non sono state trovate timbrature con i filtri attuali."),l()())}function qk(n,t){if(n&1&&(c(0,"div",49)(1,"div",50),d(2),l()()),n&2){let e=g();p(2),ve(" Mostrando ",e.timbratureFiltrate.length," di ",e.timbrature.length," timbrature ")}}function Jk(n,t){n&1&&(c(0,"div",48)(1,"span",4),d(2,"inbox"),l(),c(3,"h3"),d(4,"Nessuna timbratura nel cestino"),l()())}function Kk(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function Yk(n,t){if(n&1&&(c(0,"td"),d(1),l()),n&2){let e=g().$implicit;p(),ve("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name)}}function Zk(n,t){if(n&1){let e=k();c(0,"tr"),E(1,Yk,2,2,"td",0),c(2,"td"),d(3),Z(4,"date"),l(),c(5,"td"),d(6),Z(7,"date"),l(),c(8,"td"),d(9),Z(10,"number"),l(),c(11,"td"),d(12),Z(13,"date"),l(),c(14,"td")(15,"div",40)(16,"button",51),x("click",function(r){let o=C(e).$implicit;return g(3).ripristinaTimbratura(o),S(r.stopPropagation())}),c(17,"span",4),d(18,"undo"),l()()()()()}if(n&2){let e=t.$implicit,i=g(3);p(),_("ngIf",i.hasRole("admin")),p(2),T(X(4,5,e.start_ts,"dd/MM/yyyy")),p(3),T(X(7,8,e.start_ts,"HH:mm")),p(3),R("",X(10,11,e.total_minutes/60,"1.1-1"),"h"),p(3),T(e.deleted_at?X(13,14,e.deleted_at,"dd/MM/yyyy HH:mm"):"-")}}function Qk(n,t){if(n&1&&(c(0,"table",26)(1,"thead")(2,"tr"),E(3,Kk,2,0,"th",0),c(4,"th"),d(5,"Data"),l(),c(6,"th"),d(7,"Ora Inizio"),l(),c(8,"th"),d(9,"Ore Totali"),l(),c(10,"th"),d(11,"Eliminata il"),l(),c(12,"th"),d(13,"Azioni"),l()()(),c(14,"tbody"),E(15,Zk,19,17,"tr",27),l()()),n&2){let e=g(2);p(3),_("ngIf",e.hasRole("admin")),p(12),_("ngForOf",e.deletedTimbrature)}}function Xk(n,t){if(n&1&&(c(0,"div",23)(1,"h2",6),d(2,"Timbrature cancellate"),l(),c(3,"div",24),E(4,Jk,5,0,"div",28)(5,Qk,16,2,"table",25),l()()),n&2){let e=g();p(4),_("ngIf",e.deletedTimbrature.length===0),p(),_("ngIf",e.deletedTimbrature.length>0)}}var vp=class n{constructor(t,e,i,r){this.timbratureService=t;this.authService=e;this.companyService=i;this.router=r}timbrature=[];timbratureFiltrate=[];currentUser=null;isLoading=!1;showDeletedSection=!1;deletedTimbrature=[];richiesteModifica=[];filtroDataInizio="";filtroDataFine="";filtroStato="";filtroOggi=!1;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t?(this.caricaTimbrature(),t.role==="admin"&&this.caricaRichiesteModifica()):(this.timbrature=[],this.timbratureFiltrate=[])})}caricaTimbrature(){return y(this,null,function*(){if(this.currentUser){this.isLoading=!0;try{let t=[],e=this.currentUser;if(e.role==="employee")t=yield this.timbratureService.getTimbratureUtente(e.id);else if(e.role==="admin")t=yield this.timbratureService.getTimbratureAzienda(e.company_id);else if(e.role==="manager"){let i=yield this.timbratureService.getTimbraturePerCalendario(),s=(((yield this.companyService.getAzienda(e.company_id).toPromise)?yield this.companyService.getAzienda(e.company_id).toPromise():yield this.companyService.getAzienda(e.company_id))?.manager_visibility??{})[e.id]??{mode:"self",user_ids:[],roles:[]};if(s.mode==="self")t=i.filter(a=>a.user_id===e.id);else if(s.mode==="selected_users"){let a=Array.isArray(s.user_ids)?s.user_ids:[];t=i.filter(u=>a.includes(u.user_id))}else if(s.mode==="roles"){let a=Array.isArray(s.roles)?s.roles:[];t=i.filter(u=>!!u.user&&a.includes(u.user.role))}else t=i.filter(a=>a.user_id===e.id)}else t=yield this.timbratureService.getTimbratureUtente(e.id);this.timbrature=t||[],this.applicaFiltri()}catch(t){console.error("Errore nel caricamento delle timbrature:",t)}finally{this.isLoading=!1}}})}applicaFiltri(){let t=this.timbrature;if(this.filtroDataInizio){let e=new Date(this.filtroDataInizio);t=t.filter(i=>new Date(i.start_ts)>=e)}if(this.filtroDataFine){let e=new Date(this.filtroDataFine);e.setHours(23,59,59,999),t=t.filter(i=>new Date(i.start_ts)<=e)}if(this.filtroStato&&(this.filtroStato==="attiva"?t=t.filter(e=>!e.end_ts):this.filtroStato==="completata"&&(t=t.filter(e=>!!e.end_ts))),this.filtroOggi){let e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1),t=t.filter(r=>{let o=new Date(r.start_ts);return o>=e&&o<i})}this.timbratureFiltrate=t}filtraOggi(){this.filtroOggi=!this.filtroOggi,this.filtroOggi&&(this.filtroDataInizio="",this.filtroDataFine=""),this.applicaFiltri()}nuovaTimbraturaWithCheck(){return y(this,null,function*(){try{if(!this.currentUser){this.router.navigate(["/crea-timbratura"]);return}let t=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),e=new Date;e.setHours(0,0,0,0);let i=new Date(e);i.setDate(i.getDate()+1);let r=t.find(o=>{let s=new Date(o.start_ts);return s>=e&&s<i});if(r){let o=new Date(r.start_ts).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"});window.confirm(`\xC8 gi\xE0 presente una timbratura in data di oggi con ingresso alle ${o}.
Vuoi modificarla?`)&&this.router.navigate(["/crea-timbratura"],{queryParams:{edit:r.id,mode:"edit"}})}else this.router.navigate(["/crea-timbratura"])}catch(t){console.error("[ListaTimbrature] nuovaTimbraturaWithCheck error",t),this.router.navigate(["/crea-timbratura"])}})}visualizzaTimbratura(t){this.router.navigate(["/crea-timbratura"],{queryParams:{edit:t.id,mode:"edit"}})}troncaTesto(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}hasRole(t){return this.currentUser?.role===t}getInitials(t,e){if(!t&&!e)return"?";let i=t?.charAt(0)?.toUpperCase()||"",r=e?.charAt(0)?.toUpperCase()||"";return i+r}caricaDeletedTimbrature(){return y(this,null,function*(){if(this.currentUser)try{this.currentUser.role==="admin"?this.deletedTimbrature=yield this.timbratureService.getDeletedTimbrature():this.deletedTimbrature=yield this.timbratureService.getDeletedTimbrature(this.currentUser.id)}catch(t){console.error("[ListaTimbrature] caricaDeletedTimbrature error",t)}})}eliminaTimbratura(t){return y(this,null,function*(){if(!(!this.currentUser||!confirm("Confermi lo spostamento della timbratura nel cestino? (potrai ripristinarla)")))try{yield this.timbratureService.softDeleteTimbratura(t.id,this.currentUser.id),yield this.caricaTimbrature(),this.showDeletedSection&&(yield this.caricaDeletedTimbrature())}catch(i){console.error("[ListaTimbrature] eliminaTimbratura error",i),alert("Errore durante lo spostamento nel cestino.")}})}ripristinaTimbratura(t){return y(this,null,function*(){if(confirm("Ripristinare la timbratura dal cestino?"))try{yield this.timbratureService.restoreTimbratura(t.id),yield this.caricaTimbrature(),yield this.caricaDeletedTimbrature()}catch(i){console.error("[ListaTimbrature] ripristinaTimbratura error",i),alert("Errore durante il ripristino.")}})}toggleShowDeleted(){this.showDeletedSection=!this.showDeletedSection,this.showDeletedSection&&this.caricaDeletedTimbrature()}caricaRichiesteModifica(){return y(this,null,function*(){try{let t=this.currentUser?.company_id;this.richiesteModifica=yield this.timbratureService.getRichiesteModifica(t,"pending")}catch(t){console.error("[ListaTimbrature] caricaRichiesteModifica error",t),this.richiesteModifica=[]}})}handleRichiestaAction(t,e){return y(this,null,function*(){if(confirm(`Confermi ${e==="approve"?"approvazione":"rifiuto"} della richiesta?`))try{e==="approve"?yield this.timbratureService.aggiornaRichiestaModifica(t.id,"approved","Approvata da admin",!0):yield this.timbratureService.aggiornaRichiestaModifica(t.id,"rejected","Rifiutata da admin",!1),yield this.caricaTimbrature(),yield this.caricaRichiesteModifica()}catch(r){console.error("[ListaTimbrature] handleRichiestaAction error",r),alert("Errore durante l'operazione")}})}formatRequestedChanges(t){let e=[];if(!t?.requested_changes)return e;let i=t.requested_changes||{},r=t.original_data||{},o=s=>s?new Date(s).toLocaleString():"\u2014";return i.start_ts!==void 0&&e.push({label:"Inizio",old:o(r.start_ts),newVal:o(i.start_ts)}),i.end_ts!==void 0&&e.push({label:"Fine",old:o(r.end_ts),newVal:o(i.end_ts)}),i.notes!==void 0&&e.push({label:"Note",old:r.notes??"\u2014",newVal:i.notes??"\u2014"}),e}static \u0275fac=function(e){return new(e||n)(D(Nt),D(le),D(et),D(Ie))};static \u0275cmp=we({type:n,selectors:[["app-lista-timbrature"]],decls:71,vars:15,consts:[[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],["value","attiva"],["value","completata"],[1,"actions-container"],[1,"promethea-button","ghost",3,"click"],[1,"promethea-button",3,"click"],["class","promethea-button outline",3,"click",4,"ngIf"],["style","margin-top:var(--gutter-lg)",4,"ngIf"],["class","muted",4,"ngIf"],[1,"table-section"],[1,"table-container"],["class","crm-table",4,"ngIf"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","pagination-container",4,"ngIf"],["class","table-section",4,"ngIf"],[1,"promethea-button","outline",3,"click"],[2,"margin-top","var(--gutter-lg)"],[1,"section-title",2,"margin","0"],[1,"muted"],[1,"col-richiesta"],[1,"col-azioni"],[1,"promethea-button","small",3,"click"],[1,"promethea-button","small","secondary",3,"click"],["class","notes-preview",3,"title",4,"ngIf"],[1,"action-buttons"],["title","Visualizza",1,"icon-button",3,"click"],["class","icon-button","title","Elimina",3,"click",4,"ngIf"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],[1,"notes-preview",3,"title"],["title","Elimina",1,"icon-button",3,"click"],[1,"empty-state"],[1,"pagination-container"],[1,"pagination-info"],["title","Ripristina",1,"icon-button",3,"click"]],template:function(e,i){e&1&&(E(0,Rk,1,0,"app-loading-spinner",0),c(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5,"view_list"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Lista Timbrature"),l(),c(9,"p",7),d(10,"Visualizza e gestisci tutte le tue timbrature"),l()()(),c(11,"div",8)(12,"div",9)(13,"div",10)(14,"label",11),d(15,"Data Inizio"),l(),c(16,"input",12),W("ngModelChange",function(o){return G(i.filtroDataInizio,o)||(i.filtroDataInizio=o),o}),x("change",function(){return i.applicaFiltri()}),l()(),c(17,"div",10)(18,"label",11),d(19,"Data Fine"),l(),c(20,"input",12),W("ngModelChange",function(o){return G(i.filtroDataFine,o)||(i.filtroDataFine=o),o}),x("change",function(){return i.applicaFiltri()}),l()(),c(21,"div",10)(22,"label",11),d(23,"Stato"),l(),c(24,"select",13),W("ngModelChange",function(o){return G(i.filtroStato,o)||(i.filtroStato=o),o}),x("change",function(){return i.applicaFiltri()}),c(25,"option",14),d(26,"Tutti"),l(),c(27,"option",15),d(28,"Attive"),l(),c(29,"option",16),d(30,"Completate"),l()()()(),c(31,"div",17)(32,"button",18),x("click",function(){return i.filtraOggi()}),c(33,"span",4),d(34,"today"),l(),d(35," Oggi "),l(),c(36,"button",19),x("click",function(){return i.nuovaTimbraturaWithCheck()}),c(37,"span",4),d(38,"add"),l(),d(39," Nuova Timbratura "),l(),E(40,Ok,4,1,"button",20),l()(),E(41,Nk,3,0,"div",21)(42,Pk,2,0,"div",22),c(43,"div",23)(44,"div",24),E(45,Lk,13,1,"table",25),l()(),c(46,"div",23)(47,"div",24)(48,"table",26)(49,"thead")(50,"tr"),E(51,jk,2,0,"th",0),c(52,"th"),d(53,"Data"),l(),c(54,"th"),d(55,"Ora Inizio"),l(),c(56,"th"),d(57,"Ora Fine"),l(),c(58,"th"),d(59,"Ore Totali"),l(),c(60,"th"),d(61,"Pause"),l(),c(62,"th"),d(63,"Note"),l(),c(64,"th"),d(65,"Azioni"),l()()(),c(66,"tbody"),E(67,Wk,26,22,"tr",27),l()()(),E(68,Gk,7,0,"div",28),l(),E(69,qk,3,2,"div",29)(70,Xk,6,2,"div",30),l()),e&2&&(_("ngIf",i.isLoading),p(16),H("ngModel",i.filtroDataInizio),p(4),H("ngModel",i.filtroDataFine),p(4),H("ngModel",i.filtroStato),p(8),Se("active",i.filtroOggi),p(8),_("ngIf",i.currentUser),p(),_("ngIf",(i.currentUser==null?null:i.currentUser.role)==="admin"&&i.richiesteModifica.length>0),p(),_("ngIf",(i.currentUser==null?null:i.currentUser.role)==="admin"&&i.richiesteModifica.length===0),p(3),_("ngIf",(i.currentUser==null?null:i.currentUser.role)==="admin"&&i.richiesteModifica.length>0),p(6),_("ngIf",i.hasRole("admin")),p(16),_("ngForOf",i.timbratureFiltrate),p(),_("ngIf",i.timbratureFiltrate.length===0),p(),_("ngIf",i.timbratureFiltrate.length>0),p(),_("ngIf",i.showDeletedSection))},dependencies:[Ee,Be,xe,jt,Rt,Wt,Gt,Re,At,Fe,yt,$n,tn,lt],styles:[".table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-richiesta[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-richiesta[_ngcontent-%COMP%]{width:55%;min-width:260px;white-space:normal;vertical-align:top}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%]{width:130px;max-width:160px;white-space:nowrap;text-align:center;vertical-align:middle}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni-small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]{width:90px;max-width:110px;white-space:nowrap;text-align:center;vertical-align:middle}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%]   .promethea-button.small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{padding:6px 8px;min-height:36px}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-richiesta[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-richiesta[_ngcontent-%COMP%]{width:auto;min-width:160px}.table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   th.col-azioni-small[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]   .crm-table[_ngcontent-%COMP%]   td.col-azioni-small[_ngcontent-%COMP%]{width:auto}}"]})};function eF(n,t){n&1&&(Ze(0),c(1,"span",4),d(2,"content_copy"),l(),Qe())}function tF(n,t){n&1&&(Ze(0),P(1,"span",32),Qe())}function nF(n,t){if(n&1){let e=k();c(0,"button",31),x("click",function(){C(e);let r=g(2);return S(r.copiaGiornoPrecedente())}),E(1,eF,3,0,"ng-container",25)(2,tF,2,0,"ng-container",25),d(3," Copia Precedente "),l()}if(n&2){let e=g(2);_("disabled",e.caricandoTimbraturaPrecedente),p(),_("ngIf",!e.caricandoTimbraturaPrecedente),p(),_("ngIf",e.caricandoTimbraturaPrecedente)}}function iF(n,t){if(n&1&&(c(0,"div",29),E(1,nF,4,3,"button",30),l()),n&2){let e=g();p(),_("ngIf",e.timbraturaPrecedenteDisponibile)}}function rF(n,t){n&1&&(c(0,"div",33)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Modalit\xE0 Richiesta Modifica"),l()(),c(8,"div",35),d(9," Stai modificando una timbratura esistente. Le modifiche verranno inviate come richiesta all'amministratore che potr\xE0 approvarle o respingerle. "),l()()()())}function oF(n,t){n&1&&(c(0,"div",36)(1,"div",34)(2,"span",4),d(3,"admin_panel_settings"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Modalit\xE0 Amministratore"),l()(),c(8,"div",35),d(9," Le modifiche verranno applicate immediatamente alla timbratura. "),l()()()())}function sF(n,t){if(n&1&&(c(0,"div",37)(1,"div",34)(2,"span",4),d(3,"warning"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Hai gi\xE0 una timbratura per questa data"),l()(),c(8,"div",35),d(9),Z(10,"date"),l()()()()),n&2){let e=g();p(9),R(" ",e.existingTimbraturaForDate?"Ingresso alle "+X(10,1,e.existingTimbraturaForDate.start_ts,"HH:mm"):"",". Non \xE8 consentito creare pi\xF9 di una timbratura nello stesso giorno. ")}}function aF(n,t){n&1&&(c(0,"span"),d(1,"Data obbligatoria"),l())}function lF(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e,i=g(2);p(),T((e=i.timbraturaForm.get("data"))==null||e.errors==null||e.errors.futureDate==null?null:e.errors.futureDate.message)}}function cF(n,t){if(n&1&&(c(0,"div",18),E(1,aF,2,0,"span",25)(2,lF,2,1,"span",25),l()),n&2){let e,i,r=g();p(),_("ngIf",(e=r.timbraturaForm.get("data"))==null?null:e.hasError("required")),p(),_("ngIf",(i=r.timbraturaForm.get("data"))==null?null:i.hasError("futureDate"))}}function uF(n,t){n&1&&(c(0,"span"),d(1,"Ora ingresso obbligatoria"),l())}function dF(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e,i=g(2);p(),T((e=i.timbraturaForm.get("ora_inizio"))==null||e.errors==null||e.errors.futureTime==null?null:e.errors.futureTime.message)}}function fF(n,t){if(n&1&&(c(0,"div",18),E(1,uF,2,0,"span",25)(2,dF,2,1,"span",25),l()),n&2){let e,i,r=g();p(),_("ngIf",(e=r.timbraturaForm.get("ora_inizio"))==null?null:e.hasError("required")),p(),_("ngIf",(i=r.timbraturaForm.get("ora_inizio"))==null?null:i.hasError("futureTime"))}}function pF(n,t){if(n&1&&(c(0,"div",18),d(1),l()),n&2){let e=g();p(),R(" ",e.timeRangeErrorMessage," ")}}function hF(n,t){if(n&1&&(c(0,"div",18),d(1),l()),n&2){let e,i=g();p(),R(" ",(e=i.timbraturaForm.get("ora_fine"))==null||e.errors==null||e.errors.futureTime==null?null:e.errors.futureTime.message," ")}}function mF(n,t){if(n&1){let e=k();c(0,"button",46),x("click",function(){C(e);let r=g().$index,o=g();return S(o.rimuoviPausa(r))}),c(1,"span",4),d(2,"delete"),l()()}}function gF(n,t){if(n&1&&(c(0,"div",44),d(1),l()),n&2){let e,i=g().$index,r=g();p(),R(" ",(e=r.getPausaControl(i,"inizio").errors)==null||e.futureTime==null?null:e.futureTime.message," ")}}function vF(n,t){if(n&1&&(c(0,"div",44),d(1),l()),n&2){let e,i=g().$index,r=g();p(),R(" ",(e=r.getPausaControl(i,"fine").errors)==null||e.futureTime==null?null:e.futureTime.message," ")}}function _F(n,t){if(n&1&&(c(0,"div",45),d(1),l()),n&2){let e=g().$index,i=g();p(),R(" ",i.getPauseTimeErrorMessage(e)," ")}}function yF(n,t){if(n&1&&(c(0,"div",22)(1,"div",38)(2,"div",39)(3,"span",4),d(4,"schedule"),l(),c(5,"strong"),d(6),l()(),E(7,mF,3,0,"button",40),l(),c(8,"div",41)(9,"div",42)(10,"label",15),d(11,"Inizio"),l(),P(12,"input",43),ee(13,gF,2,1,"div",44),l(),c(14,"div",42)(15,"label",15),d(16,"Fine"),l(),P(17,"input",43),ee(18,vF,2,1,"div",44),l()(),ee(19,_F,2,1,"div",45),l()),n&2){let e=t.$index,i=g();p(6),R("Pausa ",e+1),p(),_("ngIf",i.canRemovePause(e)),p(5),_("formControl",i.getPausaControl(e,"inizio")),p(),te(i.getPausaControl(e,"inizio").hasError("futureTime")?13:-1),p(4),_("formControl",i.getPausaControl(e,"fine")),p(),te(i.getPausaControl(e,"fine").hasError("futureTime")?18:-1),p(),te(i.hasPauseTimeError(e)?19:-1)}}function bF(n,t){n&1&&(Ze(0),c(1,"span",4),d(2,"my_location"),l(),Qe())}function wF(n,t){n&1&&(Ze(0),P(1,"span",32),Qe())}function EF(n,t){n&1&&(c(0,"div",56),d(1,"Ottenendo posizione\u2026"),l())}function CF(n,t){if(n&1&&(c(0,"small"),d(1),Z(2,"number"),l()),n&2){let e=g(3);p(),R("(",X(2,1,e.posizioneAttuale.accuracy,"1.0-0")," m)")}}function SF(n,t){if(n&1&&(c(0,"div",57)(1,"span",58),d(2,"check_circle"),l(),d(3," Posizione ottenuta "),E(4,CF,3,4,"small",25),l()),n&2){let e=g(2);p(4),_("ngIf",e.posizioneAttuale.accuracy)}}function xF(n,t){n&1&&(c(0,"div",59),d(1,"Nessuna posizione"),l())}function DF(n,t){n&1&&(c(0,"span",75),d(1,"Disponibile"),l())}function IF(n,t){n&1&&(c(0,"span",76)(1,"span",77),d(2,"check_circle"),l(),d(3," Selezionato "),l())}function TF(n,t){if(n&1){let e=k();c(0,"button",78),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.selezionaPunto(r))}),c(1,"span",4),d(2,"location_on"),l(),d(3," Seleziona "),l()}}function MF(n,t){if(n&1){let e=k();c(0,"button",79),x("click",function(){C(e);let r=g(4);return S(r.deselezionaPunto())}),c(1,"span",4),d(2,"close"),l(),d(3," Deseleziona "),l()}}function AF(n,t){if(n&1&&(c(0,"div",65)(1,"div",66)(2,"div",67)(3,"strong"),d(4),l(),c(5,"div",68),d(6),l(),c(7,"div",69),d(8),l()(),c(9,"div",70),E(10,DF,2,0,"span",71)(11,IF,4,0,"span",72)(12,TF,4,0,"button",73)(13,MF,4,0,"button",74),l()()()),n&2){let e=t.$implicit,i=g(3);p(4),T((e==null?null:e.name)||"Punto di timbratura"),p(2),T(i.pointLabel(e)),p(2),R("Distanza: ",i.distanceToPoint(e)," m"),p(2),_("ngIf",!i.isPuntoSelezionato(e)),p(),_("ngIf",i.isPuntoSelezionato(e)),p(),_("ngIf",!i.isPuntoSelezionato(e)),p(),_("ngIf",i.isPuntoSelezionato(e))}}function RF(n,t){n&1&&(c(0,"div",80)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Seleziona un punto"),l()(),c(8,"div",81),d(9," Seleziona il punto di timbratura corretto per procedere. "),l()()()())}function OF(n,t){if(n&1&&(c(0,"div",82)(1,"div",34)(2,"span",4),d(3,"check_circle"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Punto selezionato"),l()(),c(8,"div",81),d(9),l()()()()),n&2){let e=g(3);p(9),R(" ",(e.puntoSelezionato==null?null:e.puntoSelezionato.name)||"Punto di timbratura"," - Puoi procedere con la timbratura. ")}}function NF(n,t){if(n&1&&(c(0,"div",60)(1,"div",61),d(2),l(),E(3,AF,14,7,"div",62)(4,RF,10,0,"div",63)(5,OF,10,1,"div",64),l()),n&2){let e=g(2);p(2),R(" Punti di timbratura disponibili (",e.getPuntiNelRaggio().length,"): "),p(),_("ngForOf",e.getPuntiNelRaggio()),p(),_("ngIf",!e.puntoSelezionato),p(),_("ngIf",e.puntoSelezionato)}}function PF(n,t){if(n&1&&(c(0,"div",85)(1,"div",68),d(2,"Punto pi\xF9 vicino:"),l(),c(3,"div",86)(4,"strong"),d(5),l(),P(6,"br"),c(7,"span",87),d(8),l(),P(9,"br"),c(10,"span",87),d(11),l()()()),n&2){let e=g(3);p(5),T((e.nearestPoint==null?null:e.nearestPoint.name)||"Punto di timbratura"),p(3),T(e.pointLabel(e.nearestPoint)),p(3),R("Distanza: ",e.distanceToNearest," m")}}function kF(n,t){if(n&1&&(c(0,"div",83)(1,"div",34)(2,"span",4),d(3,"warning"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Nessun punto disponibile"),l()(),c(8,"div",35),d(9,"Non ti trovi nel raggio di nessun punto di timbratura configurato."),l(),E(10,PF,12,3,"div",84),l()()()),n&2){let e=g(2);p(10),_("ngIf",e.nearestPoint)}}function FF(n,t){n&1&&(c(0,"div",88)(1,"div",34)(2,"span",4),d(3,"info"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Posizione non verificata"),l()(),c(8,"div",35),d(9,' La tua posizione non \xE8 stata ancora verificata. Usa "Ottieni Posizione" per vedere i punti di timbratura disponibili. '),l()()()())}function LF(n,t){n&1&&(c(0,"div",89)(1,"div",34)(2,"span",4),d(3,"error"),l(),c(4,"div")(5,"div")(6,"strong"),d(7,"Non puoi timbrare"),l()(),c(8,"div",35),d(9,"Non sono configurati punti di timbratura per la tua azienda."),l()()()())}function jF(n,t){if(n&1&&(c(0,"div",89),d(1),l()),n&2){let e=g(2);p(),T(e.errorMessage)}}function VF(n,t){if(n&1&&(c(0,"div",88),d(1),l()),n&2){let e=g(2);p(),T(e.successMessage)}}function zF(n,t){if(n&1){let e=k();c(0,"div")(1,"div",14)(2,"label",15)(3,"span",4),d(4,"location_on"),l(),d(5," Posizione "),l(),c(6,"div",47)(7,"button",48),x("click",function(){C(e);let r=g();return S(r.ottieniPosizione())}),E(8,bF,3,0,"ng-container",25)(9,wF,2,0,"ng-container",25),d(10),l(),E(11,EF,2,0,"div",49)(12,SF,5,1,"div",50)(13,xF,2,0,"div",51),l(),E(14,NF,6,4,"div",52)(15,kF,11,1,"div",53)(16,FF,10,0,"div",54)(17,LF,10,0,"div",55)(18,jF,2,1,"div",55)(19,VF,2,1,"div",54),l()()}if(n&2){let e=g();p(7),_("disabled",e.ottenendoPosizione),p(),_("ngIf",!e.ottenendoPosizione),p(),_("ngIf",e.ottenendoPosizione),p(),R(" ",e.ottenendoPosizione?"Ottenendo...":"Ottieni Posizione"," "),p(),_("ngIf",e.ottenendoPosizione),p(),_("ngIf",!e.ottenendoPosizione&&e.posizioneAttuale),p(),_("ngIf",!e.ottenendoPosizione&&!e.posizioneAttuale),p(),_("ngIf",e.posizioneAttuale&&e.getPuntiNelRaggio().length>0),p(),_("ngIf",e.posizioneAttuale&&e.getPuntiNelRaggio().length===0),p(),_("ngIf",!e.posizioneAttuale&&!e.ottenendoPosizione),p(),_("ngIf",((e.currentCompany==null||e.currentCompany.punch_points==null?null:e.currentCompany.punch_points.length)??0)===0),p(),_("ngIf",e.errorMessage),p(),_("ngIf",e.successMessage)}}function UF(n,t){if(n&1&&(c(0,"div",91)(1,"h3",92),d(2,"Pause"),l(),c(3,"div",93),d(4),l()()),n&2){let e=g(2);p(4),T(e.formattaOreMinuti(e.calcolaPauseTotali()))}}function BF(n,t){if(n&1&&(c(0,"div",12)(1,"h2",6)(2,"span",4),d(3,"summarize"),l(),d(4," Riepilogo "),l(),c(5,"div",90)(6,"div",91)(7,"h3",92),d(8,"Ore Totali"),l(),c(9,"div",93),d(10),l()(),ee(11,UF,5,1,"div",91),c(12,"div",91)(13,"h3",92),d(14,"Ore Lavorative"),l(),c(15,"div",93),d(16),l()()()()),n&2){let e=g();p(10),T(e.formattaOreMinuti(e.calcolaOreTotali())),p(),te(e.calcolaPauseTotali()>0?11:-1),p(5),T(e.formattaOreMinuti(e.calcolaLavoroEffettivo()))}}function $F(n,t){if(n&1&&(Ze(0),c(1,"span",4),d(2),l(),Qe()),n&2){let e=g();p(2),T(e.isEditMode?(e.currentUser==null?null:e.currentUser.role)==="admin"?"save":"send":"save")}}function HF(n,t){n&1&&(Ze(0),P(1,"span",32),Qe())}function WF(n,t){let e={},i={},r=o=>o??null;if(t.start_ts!==void 0){let o=r(n.start_ts),s=r(t.start_ts);o!==s&&(e.start_ts=s,i.start_ts=o)}if(t.end_ts!==void 0){let o=r(n.end_ts),s=r(t.end_ts);o!==s&&(e.end_ts=s,i.end_ts=o)}if(t.notes!==void 0){let o=r(n.notes),s=r(t.notes);o!==s&&(e.notes=s,i.notes=o)}return{requested_changes:e,original_data:i}}var _p=class n{constructor(t,e,i,r,o,s){this.fb=t;this.timbratureService=e;this.authService=i;this.router=r;this.route=o;this.companyService=s;this.timbraturaForm=this.createForm()}POSITION_ACCURACY_THRESHOLD=150;editReason=null;timbraturaForm;isLoading=!1;errorMessage="";successMessage="";ottenendoPosizione=!1;posizioneAttuale=null;posizioneValida=!1;nearestPoint=null;distanceToNearest=null;currentUser=null;currentCompany=null;existingTimbraturaForDate=null;hasTimbraturaForSelectedDate=!1;requiresGeolocation=!1;timbraturaPrecedenteDisponibile=!1;caricandoTimbraturaPrecedente=!1;timbraturaPrecedente=null;isEditMode=!1;timbraturaOriginale=null;timbraturaId=null;puntoSelezionato=null;ngOnInit(){return y(this,null,function*(){let t=new Date().toISOString().split("T")[0];this.timbraturaForm.patchValue({data:t}),this.timbraturaForm.get("data")?.valueChanges.subscribe(()=>{this.timbraturaForm.get("ora_inizio")?.updateValueAndValidity(),this.timbraturaForm.get("ora_fine")?.updateValueAndValidity(),this.revalidateAllPauses(),this.checkExistingTimbraturaForDate(this.timbraturaForm.value.data).catch(e=>console.error(e))}),this.route.queryParams.subscribe(e=>{e.edit&&e.mode==="edit"&&(this.isEditMode=!0,this.timbraturaId=e.edit,this.timbraturaId&&this.caricaTimbraturaPerModifica(this.timbraturaId))}),this.authService.currentUser$.subscribe(e=>y(this,null,function*(){this.currentUser=e,e&&this.companyService.getAziendaForUser(e.id,e.company_id).subscribe({next:i=>y(this,null,function*(){this.currentCompany=i,this.requiresGeolocation=i?.timbratura_type==="punti",console.debug("[CreaTimbratura] company caricata",{id:i?.id,name:i?.name,punch_points_length:Array.isArray(i?.punch_points)?i.punch_points.length:0,punch_points:i?.punch_points}),this.isEditMode||(yield this.verificaTimbraturaPrecedente(),this.checkExistingTimbraturaForDate(this.timbraturaForm.value.data).catch(r=>console.error(r)))}),error:i=>console.error("[CreaTimbratura] errore carica azienda",i)})}))})}checkExistingTimbraturaForDate(t){return y(this,null,function*(){try{if(this.existingTimbraturaForDate=null,this.hasTimbraturaForSelectedDate=!1,!this.currentUser||!t)return;let e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id),i=new Date(t);i.setHours(0,0,0,0);let r=e.find(o=>{if(!o.start_ts)return!1;let s=new Date(o.start_ts);return s.setHours(0,0,0,0),s.getTime()===i.getTime()})||null;r&&(this.existingTimbraturaForDate=r,this.hasTimbraturaForSelectedDate=!0)}catch(e){throw console.error("[CreaTimbratura] checkExistingTimbraturaForDate error",e),this.hasTimbraturaForSelectedDate=!1,this.existingTimbraturaForDate=null,e}})}caricaTimbraturaPerModifica(t){return y(this,null,function*(){try{if(this.isLoading=!0,this.timbraturaOriginale=yield this.timbratureService.getTimbraturaBId(t),!this.timbraturaOriginale){this.errorMessage="Timbratura non trovata",this.router.navigate(["/lista-timbrature"]);return}if(this.currentUser?.role!=="admin"&&this.timbraturaOriginale.user_id!==this.currentUser?.id){this.errorMessage="Non hai i permessi per modificare questa timbratura",this.router.navigate(["/lista-timbrature"]);return}this.popolaFormConDatiEsistenti(this.timbraturaOriginale)}catch(e){console.error("Errore nel caricamento della timbratura:",e),this.errorMessage="Errore nel caricamento della timbratura",this.router.navigate(["/lista-timbrature"])}finally{this.isLoading=!1}})}verificaTimbraturaPrecedente(){return y(this,null,function*(){if(this.currentUser)try{let t=this.calcolaGiornoLavorativoPrecedente();if(!t)return;let e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id);this.timbraturaPrecedente=e.find(i=>{let r=new Date(i.start_ts).toISOString().split("T")[0],o=t.toISOString().split("T")[0];return r===o})||null,this.timbraturaPrecedenteDisponibile=!!this.timbraturaPrecedente}catch(t){console.error("Errore nella verifica timbratura precedente:",t)}})}calcolaGiornoLavorativoPrecedente(){let t=new Date;t.setHours(0,0,0,0);let i=(this.currentCompany?.closed_days||[]).map(a=>{if(typeof a=="number")return a;if(typeof a=="string"){let u=parseInt(a,10);return isNaN(u)?-1:u}return-1}).filter(a=>a>=0&&a<=6),r=i.length>0?i:[0,6],o=new Date(t);o.setDate(o.getDate()-1);let s=0;for(;s<7&&r.includes(o.getDay());)o.setDate(o.getDate()-1),s++;return s<7?o:null}copiaGiornoPrecedente(){return y(this,null,function*(){if(this.timbraturaPrecedente){this.caricandoTimbraturaPrecedente=!0;try{let t=this.timbraturaPrecedente,e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null;if(this.timbraturaForm.patchValue({ora_inizio:e.toTimeString().substring(0,5),ora_fine:i?i.toTimeString().substring(0,5):"",notes:t.notes||""}),t.breaks&&Array.isArray(t.breaks)){for(;this.pause.length>0;)this.pause.removeAt(0);t.breaks.length>0?t.breaks.forEach(r=>{let o=new Date(r.start),s=new Date(r.end),a=this.fb.group({inizio:[o.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)],fine:[s.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator});this.pause.push(a)}):this.pause.push(this.creaPausaGroup())}if(t.locations&&Array.isArray(t.locations)&&t.locations.length>0){let r=t.locations[0];if(this.posizioneAttuale={lat:r.lat,lng:r.lng,indirizzo:r.address,timestamp:new Date,accuracy:0},this.posizioneValida=!0,this.currentCompany?.timbratura_type==="punti"){let o=this.checkInsidePoints(this.posizioneAttuale);this.posizioneValida=o.inside,this.nearestPoint=o.nearest,this.distanceToNearest=o.distance}}this.successMessage="Dati copiati dal giorno lavorativo precedente!",setTimeout(()=>this.successMessage="",3e3)}catch(t){console.error("Errore nella copia:",t),this.errorMessage="Errore durante la copia dei dati precedenti",setTimeout(()=>this.errorMessage="",3e3)}finally{this.caricandoTimbraturaPrecedente=!1}}})}formattaOreMinuti(t){let e=Math.floor(t),i=Math.round((t-e)*60);return e===0&&i===0?"0h":e===0?`${i}m`:i===0?`${e}h`:`${e}h ${i}m`}popolaFormConDatiEsistenti(t){let e=new Date(t.start_ts),i=t.end_ts?new Date(t.end_ts):null;if(this.timbraturaForm.patchValue({data:e.toISOString().split("T")[0],ora_inizio:e.toTimeString().substring(0,5),ora_fine:i?i.toTimeString().substring(0,5):"",notes:t.notes||""}),t.breaks&&Array.isArray(t.breaks)){for(;this.pause.length>0;)this.pause.removeAt(0);t.breaks.forEach(r=>{let o=new Date(r.start),s=new Date(r.end),a=this.fb.group({inizio:[o.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)],fine:[s.toTimeString().substring(0,5),this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator});this.pause.push(a)})}if(this.pause.length===0&&this.pause.push(this.creaPausaGroup()),t.locations&&Array.isArray(t.locations)&&t.locations.length>0){let r=t.locations[0];this.posizioneAttuale={lat:r.lat,lng:r.lng,indirizzo:r.address,timestamp:new Date(r.timestamp),accuracy:0},this.posizioneValida=!0}}createForm(){return this.fb.group({data:["",[ne.required,this.noFutureDateValidator]],ora_inizio:["",[ne.required,this.noFutureTimeValidator.bind(this)]],ora_fine:["",this.noFutureTimeValidator.bind(this)],notes:[""],pause:this.fb.array([this.creaPausaGroup()])},{validators:this.timeRangeValidator})}noFutureTimeValidator(t){if(!t.value)return null;let e=this.timbraturaForm?.get("data");if(!e?.value)return null;let i=e.value,r=new Date().toISOString().split("T")[0];if(i!==r)return null;let o=new Date,s=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`;return t.value>s?{futureTime:{message:"Non \xE8 possibile inserire orari futuri per la data odierna"}}:null}get maxTimeForToday(){let t=this.timbraturaForm?.get("data");if(!t?.value)return null;let e=t.value,i=new Date().toISOString().split("T")[0];if(e===i){let r=new Date;return`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`}return null}get isSelectedDateToday(){let t=this.timbraturaForm?.get("data");if(!t?.value)return!1;let e=t.value,i=new Date().toISOString().split("T")[0];return e===i}timeRangeValidator(t){let e=t.get("ora_inizio")?.value,i=t.get("ora_fine")?.value;return!e||!i?null:i<=e?{invalidTimeRange:{message:"L'ora di uscita deve essere successiva all'ora di ingresso"}}:null}get hasTimeRangeError(){return this.timbraturaForm.hasError("invalidTimeRange")}get timeRangeErrorMessage(){return this.timbraturaForm.getError("invalidTimeRange")?.message||""}noFutureDateValidator(t){if(!t.value)return null;let e=new Date(t.value),i=new Date;return i.setHours(23,59,59,999),e>i?{futureDate:{message:"Non \xE8 possibile inserire timbrature future"}}:null}get maxDate(){return new Date().toISOString().split("T")[0]}creaPausaGroup(){return this.fb.group({inizio:["",this.noFutureTimeValidator.bind(this)],fine:["",this.noFutureTimeValidator.bind(this)]},{validators:this.pauseTimeRangeValidator})}revalidateAllPauses(){this.pause.controls.forEach(t=>{t.get("inizio")?.updateValueAndValidity(),t.get("fine")?.updateValueAndValidity()})}pauseTimeRangeValidator(t){let e=t.get("inizio")?.value,i=t.get("fine")?.value;return!e||!i?null:i<=e?{invalidPauseTimeRange:{message:"La fine pausa deve essere successiva all'inizio pausa"}}:null}hasPauseTimeError(t){return this.pause.at(t).hasError("invalidPauseTimeRange")}getPauseTimeErrorMessage(t){return this.pause.at(t).getError("invalidPauseTimeRange")?.message||""}get pause(){return this.timbraturaForm.get("pause")}getPausaControl(t,e){return this.pause.at(t).get(e)}aggiungiPausa(){this.pause.push(this.creaPausaGroup())}rimuoviPausa(t){this.pause.length>1&&t>=0&&t<this.pause.length&&this.pause.removeAt(t)}isPauseUsed(t){let e=this.pause.at(t),i=e.get("inizio")?.value,r=e.get("fine")?.value;return!!(i||r)}canRemovePause(t){return this.pause.length>1&&this.isPauseUsed(t)}ottieniPosizione(){if(this.puntoSelezionato=null,this.posizioneValida=!1,this.ottenendoPosizione=!0,this.errorMessage="",this.nearestPoint=null,this.distanceToNearest=null,!navigator.geolocation){this.errorMessage="Geolocalizzazione non supportata dal browser",this.ottenendoPosizione=!1;return}let t=[],e=6,i=8e3,r=Date.now(),o=h=>{console.debug("[CreaTimbratura] sample coords",h.coords.latitude,h.coords.longitude,h.coords.accuracy),t.push(h),(typeof h.coords.accuracy=="number"&&h.coords.accuracy<=this.POSITION_ACCURACY_THRESHOLD||t.length>=e||Date.now()-r>i)&&u()},s=h=>{console.error("[CreaTimbratura] geolocation error",h),f(),this.errorMessage=h.message||"Errore nella richiesta di posizione",this.ottenendoPosizione=!1},a=navigator.geolocation.watchPosition(o,s,{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}),u=()=>{let h=null;for(let m of t){if(!h){h=m;continue}let b=typeof m.coords.accuracy=="number"?m.coords.accuracy:1/0,v=typeof h.coords.accuracy=="number"?h.coords.accuracy:1/0;b<v&&(h=m)}if(h)if(console.debug("[CreaTimbratura] best sample",h.coords.latitude,h.coords.longitude,h.coords.accuracy),this.posizioneAttuale={lat:h.coords.latitude,lng:h.coords.longitude,timestamp:new Date,accuracy:h.coords.accuracy},this.currentCompany?.timbratura_type==="punti"){let m=this.checkInsidePoints(this.posizioneAttuale);this.nearestPoint=m.nearest,this.distanceToNearest=m.distance}else this.posizioneValida=!0;else this.errorMessage="Impossibile ottenere campioni di posizione";f(),this.ottenendoPosizione=!1},f=()=>{typeof a=="number"&&navigator.geolocation.clearWatch&&(navigator.geolocation.clearWatch(a),a=-1)};setTimeout(()=>{this.ottenendoPosizione&&u()},i+200)}getPuntiNelRaggio(){return!this.posizioneAttuale||this.currentCompany?.timbratura_type!=="punti"?[]:(this.currentCompany.punch_points||[]).filter(e=>this.isInsidePoint(e))}checkInsidePoints(t){let e={inside:!1,nearest:null,distance:null};if(!t||!this.currentCompany)return e;let i=this.currentCompany.punch_points||[];if(!i.length)return e;let r=null,o=Number.POSITIVE_INFINITY;console.debug("[checkInsidePoints] posizione utente",t,"punti disponibili",i.length);for(let s of i){let a=this.toNumber(s.lat),u=this.toNumber(s.lng),f=this.toNumber(s.radius_m)||50;if(!isFinite(a)||!isFinite(u)){console.warn("[checkInsidePoints] punto senza coordinate numeriche",s);continue}let h=this.distanzaMetri(t.lat,t.lng,a,u);console.debug("[checkInsidePoints] punto",{id:s.id,name:s.name,plat:a,plng:u,pradius:f,distance_m:Math.round(h)}),h<o&&(o=h,r=Q(N({},s),{lat:a,lng:u,radius_m:f}))}return r?(e.nearest=r,e.distance=Math.round(o),e.inside=o<=(r.radius_m||50),console.debug("[checkInsidePoints] nearest",e.nearest,"distance",e.distance,"inside",e.inside)):console.debug("[checkInsidePoints] nessun punto valido trovato"),e}toNumber(t){if(t==null)return NaN;if(typeof t=="number")return t;if(typeof t=="string"){let e=t.trim().replace(",",".");return Number(e)}return Number(t)}calcolaOreTotali(){let t=this.timbraturaForm.value;if(!t.ora_inizio||!t.ora_fine)return 0;let e=new Date(`2000-01-01T${t.ora_inizio}`),r=new Date(`2000-01-01T${t.ora_fine}`).getTime()-e.getTime();return Math.max(0,r/(1e3*60*60))}calcolaPauseTotali(){let t=0;return this.timbraturaForm.value.pause.forEach(i=>{if(i.inizio&&i.fine){let r=new Date(`2000-01-01T${i.inizio}`),s=new Date(`2000-01-01T${i.fine}`).getTime()-r.getTime();t+=Math.max(0,s/(1e3*60*60))}}),t}calcolaLavoroEffettivo(){let t=this.calcolaOreTotali(),e=this.calcolaPauseTotali();return Math.max(0,t-e)}preparaDatiTimbratura(){let t=this.timbraturaForm.value,e=new Date(`${t.data}T${t.ora_inizio}`),i=t.ora_fine?new Date(`${t.data}T${t.ora_fine}`):null,r=t.pause.filter(a=>a.inizio&&a.fine).map(a=>({start:new Date(`${t.data}T${a.inizio}`).toISOString(),end:new Date(`${t.data}T${a.fine}`).toISOString()})),o=this.posizioneAttuale?[{lat:this.posizioneAttuale.lat,lng:this.posizioneAttuale.lng,address:this.posizioneAttuale.indirizzo,timestamp:this.posizioneAttuale.timestamp.toISOString()}]:[],s=Math.round(this.calcolaLavoroEffettivo()*60);return{id:this.timbraturaId||void 0,start_ts:e.toISOString(),end_ts:i?.toISOString()||null,breaks:r.length>0?r:null,locations:o.length>0?o:null,notes:t.notes||null,total_minutes:s,company_id:this.currentUser?.company_id||"",user_id:this.currentUser?.id||""}}onSubmit(){return y(this,null,function*(){if(this.timbraturaForm.invalid){this.timbraturaForm.markAllAsTouched();return}if(!this.currentUser||!this.currentUser.id){this.errorMessage="Utente non autenticato";return}this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=this.isEditMode?this.timbraturaOriginale?.id:void 0;if(this.currentUser.role!=="admin"&&(yield this.timbratureService.hasTimbraturaPerGiorno(this.currentUser.id,this.timbraturaForm.value.data,t))){this.isLoading=!1,this.errorMessage="Hai gi\xE0 una timbratura per questa data. Non \xE8 consentito creare pi\xF9 di una timbratura al giorno.";return}}catch(t){console.error("[CreaTimbratura] errore controllo timbratura esistente",t)}try{if(this.currentCompany?.timbratura_type==="punti"){let t=this.currentCompany.punch_points||[];if(!t.length){this.isLoading=!1,this.errorMessage="Nessun punto di timbratura configurato per l'azienda.";return}if(this.puntoSelezionato)this.posizioneAttuale=this.posizioneAttuale??{lat:Number(this.puntoSelezionato.lat),lng:Number(this.puntoSelezionato.lng),timestamp:new Date,accuracy:0},this.posizioneValida=!0;else{if(!this.posizioneAttuale)try{let r=yield this.askForPositionOnce(12e3);this.posizioneAttuale={lat:r.coords.latitude,lng:r.coords.longitude,timestamp:new Date,accuracy:r.coords.accuracy},console.debug("[CreaTimbratura] posizione ottenuta onSubmit",this.posizioneAttuale)}catch(r){this.isLoading=!1,this.errorMessage=r?.message||"Impossibile ottenere la posizione";return}if((this.posizioneAttuale?.accuracy??1/0)>this.POSITION_ACCURACY_THRESHOLD){this.isLoading=!1,this.errorMessage=`Precisione posizione insufficiente (${Math.round(this.posizioneAttuale?.accuracy??0)} m). Usa un dispositivo con GPS o seleziona manualmente il punto.`;return}}let e=null,i=Number.POSITIVE_INFINITY;for(let r of t){let o=Number(r.lat),s=Number(r.lng);if(!isFinite(o)||!isFinite(s))continue;let a=this.distanzaMetri(this.posizioneAttuale.lat,this.posizioneAttuale.lng,o,s);a<i&&(i=a,e=Q(N({},r),{lat:o,lng:s,radius_m:Number(r.radius_m)||50}))}if(this.nearestPoint=e??null,this.distanceToNearest=i===Number.POSITIVE_INFINITY?null:Math.round(i),!e){this.isLoading=!1,this.errorMessage="Nessun punto di timbratura valido configurato (coordinate mancanti).";return}if(this.posizioneValida=i<=(e.radius_m||50),console.debug("[CreaTimbratura] verifica geofence",{nearest:e,nearestDist:i,posizioneValida:this.posizioneValida}),!this.posizioneValida){this.isLoading=!1,this.errorMessage=`Sei fuori dai punti di timbratura consentiti. Distanza: ${Math.round(i)} m (raggio: ${e.radius_m} m).`;return}}this.isEditMode?yield this.handleModificaTimbratura():yield this.saveTimbratura()}catch(t){console.error("[CreaTimbratura] errore onSubmit",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante il salvataggio della timbratura"}})}handleModificaTimbratura(){return y(this,null,function*(){if(!this.timbraturaOriginale||!this.currentUser){this.errorMessage="Dati mancanti per la modifica";return}try{let t=this.timbraturaForm.value,e=new Date(this.timbraturaOriginale.start_ts).toISOString().split("T")[0],i=new Date(`${e}T${t.ora_inizio}`).toISOString(),r=t.ora_fine?new Date(`${e}T${t.ora_fine}`).toISOString():null,o=(t.pause||[]).filter(f=>f.inizio&&f.fine).map(f=>({start:new Date(`${e}T${f.inizio}`).toISOString(),end:new Date(`${e}T${f.fine}`).toISOString()})),s=this.posizioneAttuale?[{lat:this.posizioneAttuale.lat,lng:this.posizioneAttuale.lng,address:this.posizioneAttuale.indirizzo,timestamp:this.posizioneAttuale.timestamp.toISOString()}]:this.timbraturaOriginale.locations??null,a=Math.round(this.calcolaLavoroEffettivo()*60),u={id:this.timbraturaOriginale.id,user_id:this.timbraturaOriginale.user_id,company_id:this.timbraturaOriginale.company_id,start_ts:i,end_ts:r??null,breaks:o.length>0?o:null,locations:s&&s.length>0?s:null,notes:t.notes||this.timbraturaOriginale.notes||null,total_minutes:a};if(this.currentUser.role==="admin")yield this.timbratureService.aggiornaTimbratura(this.timbraturaOriginale.id,u),this.isLoading=!1,this.successMessage="Timbratura aggiornata con successo!",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),1200);else{let f={timbratura_id:this.timbraturaOriginale.id,user_id:this.currentUser.id,company_id:this.currentUser.company_id,status:"pending",requested_changes:u,original_data:this.timbraturaOriginale,reason:"Richiesta di modifica tramite interfaccia utente"};yield this.timbratureService.creaRichiestaModifica(f),this.isLoading=!1,this.successMessage="Richiesta di modifica inviata! L'amministratore la valuter\xE0.",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),2e3)}}catch(t){console.error("[CreaTimbratura] errore aggiornamento",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante l'aggiornamento della timbratura"}})}distanzaMetri(t,e,i,r){let s=M=>M*Math.PI/180,a=s(t),u=s(i),f=s(i-t),h=s(r-e),m=Math.sin(f/2),b=Math.sin(h/2),v=m*m+Math.cos(a)*Math.cos(u)*b*b;return 6371e3*(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)))}saveTimbratura(){return y(this,null,function*(){try{let t=this.preparaDatiTimbratura();if(t.company_id=this.currentCompany?.id||this.currentUser?.company_id||t.company_id,!t.user_id||!t.company_id){this.isLoading=!1,this.errorMessage="Impossibile determinare utente o azienda";return}let e=yield this.timbratureService.creaTimbraturaSupabase(t);console.debug("[CreaTimbratura] timbratura creata",e),this.isLoading=!1,this.successMessage="Timbratura registrata con successo!",setTimeout(()=>this.router.navigate(["/lista-timbrature"]),1200)}catch(t){console.error("[CreaTimbratura] errore saveTimbratura",t),this.isLoading=!1,this.errorMessage=t?.message||"Errore durante il salvataggio della timbratura"}})}submitAfterManualConfirm(t){t&&(this.posizioneAttuale={lat:Number(t.lat),lng:Number(t.lng),timestamp:new Date,accuracy:0},this.posizioneValida=!0,this.nearestPoint=t,this.distanceToNearest=0,this.isLoading=!0,this.errorMessage="",this.isEditMode?this.handleModificaTimbratura():this.saveTimbratura())}askForPositionOnce(t=1e4){return new Promise((e,i)=>{if(!navigator.geolocation)return i(new Error("Geolocalizzazione non supportata"));navigator.geolocation.getCurrentPosition(e,r=>{i(r)},{enableHighAccuracy:!0,timeout:t,maximumAge:0})})}pointRadius(t){let e=Number(t?.radius_m??t?.raggio??50);return isFinite(e)&&e>0?e:50}distanceToPoint(t){if(!this.posizioneAttuale)return null;let e=Number(t?.lat),i=Number(t?.lng);if(!isFinite(e)||!isFinite(i))return null;let r=this.distanzaMetri(this.posizioneAttuale.lat,this.posizioneAttuale.lng,e,i);return Math.round(r)}isInsidePoint(t){let e=this.distanceToPoint(t);if(e===null)return!1;let i=this.pointRadius(t);return e<=i}pointLabel(t){if(!t)return"Punto";let e=(t?.address||"").toString().trim();if(!e)return t?.name||"Punto";let i=e.split(",").map(v=>v.trim()).filter(Boolean),r=["italia","italy"];for(;i.length&&r.includes(i[i.length-1].toLowerCase());)i.pop();for(;i.length&&/^\d{4,}$/.test(i[i.length-1]);)i.pop();let o="",s="",a="",u="",f=/\b(Via|Viale|Corso|Piazza|Piazzale|Strada|Largo|P.za|Piazzetta|Vicolo|Borgo|Contrada)\b/i;if(i.length>=2&&/^\d+/.test(i[0]))s=i[0],o=i[1];else if(i.length>=2&&/^\d+/.test(i[1]))o=i[0],s=i[1];else{let v=i.findIndex(w=>f.test(w));if(v>=0){o=i[v];let w=o.match(/^(.*\D)\s+(\d+\S*)$/);w&&(o=w[1].trim(),s=w[2].trim())}else{o=i[0]||"";let w=o.match(/^(.*\D)\s+(\d+\S*)$/);w&&(o=w[1].trim(),s=w[2].trim())}}for(let v=i.length-1;v>=0;v--){let w=i[v];if(!(!w||w===o||w===s)&&!(/^\d+$/.test(w)||w.length>40)){if(!a)a=w;else if(!u&&w.length<=30){u=w;break}}}let h=o?s?`${o} ${s}`:o:t?.name||"Punto",m=this.pointRadius(t),b=h;return u&&(b+=`, ${u}`),a&&(b+=`, ${a}`),b+=`, raggio: ${m} m`,b}hasPauseErrors(){for(let t=0;t<this.pause.length;t++){let e=this.pause.at(t);if(e.invalid)return!0;let i=e.get("inizio"),r=e.get("fine");if(i?.hasError("futureTime")||r?.hasError("futureTime"))return!0}return!1}getSubmitButtonText(){return this.isLoading?this.isEditMode?this.currentUser?.role==="admin"?"Salvando...":"Inviando richiesta...":"Salvando...":this.isEditMode?this.currentUser?.role==="admin"?"Salva Modifiche":"Invia Richiesta Modifica":"Salva Timbratura"}selezionaPunto(t){this.puntoSelezionato=t,this.posizioneValida=!0,this.posizioneAttuale={lat:Number(t?.lat),lng:Number(t?.lng),indirizzo:t?.address||t?.indirizzo||null,timestamp:new Date,accuracy:0},this.successMessage=`Punto selezionato: ${t?.name||"Punto di timbratura"}`,setTimeout(()=>this.successMessage="",3e3),console.debug("[CreaTimbratura] Punto selezionato:",{nome:t?.name,indirizzo:this.pointLabel(t),distanza:this.distanceToPoint(t)})}deselezionaPunto(){this.puntoSelezionato=null,this.posizioneValida=!1}isPuntoSelezionato(t){return this.puntoSelezionato&&this.puntoSelezionato.id===t.id}submitEditRequest(t,e){return y(this,null,function*(){let{requested_changes:i,original_data:r}=WF(t,e);if(Object.keys(i).length===0){alert("Nessuna modifica da inviare.");return}if(!t?.id){console.error("[CreaTimbratura] missing original.id"),alert("Dati timbratura mancanti.");return}if(!this.currentUser?.id||!this.currentUser?.company_id){console.error("[CreaTimbratura] missing currentUser ids"),alert("Utente/azienda non disponibili.");return}let o={timbratura_id:t.id,user_id:this.currentUser.id,company_id:this.currentUser.company_id,requested_changes:i,original_data:Object.keys(r).length?r:null,reason:this.editReason??null,status:"pending"};try{yield this.timbratureService.creaRichiestaModifica(o),alert("Richiesta inviata.")}catch(s){console.error("errore invio richiesta",s),alert("Errore invio richiesta")}})}static \u0275fac=function(e){return new(e||n)(D(Ii),D(Nt),D(le),D(Ie),D($t),D(et))};static \u0275cmp=we({type:n,selectors:[["app-crea-timbratura"]],decls:79,vars:20,consts:[[1,"gradient-container"],[1,"form-card"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],["class","header-actions",4,"ngIf"],["class","status-message info","style","margin-bottom: var(--gutter-lg);",4,"ngIf"],["class","status-message warning","style","margin-bottom: var(--gutter-lg);",4,"ngIf"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"filter-group"],[1,"form-label"],["type","date","formControlName","data",3,"max"],["class","status-message warning","style","margin-top:8px",4,"ngIf"],[1,"error"],["type","time","formControlName","ora_inizio"],["type","time","formControlName","ora_fine"],[1,"pause-container"],[1,"card","small",2,"margin-bottom","var(--gutter-md)"],["type","button",1,"promethea-button","outline",3,"click","disabled"],["formControlName","notes","rows","4","placeholder","Note opzionali sulla timbratura...",1,"mobile-textarea"],[4,"ngIf"],[1,"form-actions"],["type","button","routerLink","/lista-timbrature",1,"promethea-button","ghost"],["type","submit",1,"promethea-button",3,"disabled"],[1,"header-actions"],["type","button","class","promethea-button ghost","title","Copia orari e luogo dal giorno lavorativo precedente",3,"disabled","click",4,"ngIf"],["type","button","title","Copia orari e luogo dal giorno lavorativo precedente",1,"promethea-button","ghost",3,"click","disabled"],[1,"loading-spinner"],[1,"status-message","info",2,"margin-bottom","var(--gutter-lg)"],[2,"display","flex","align-items","flex-start","gap","8px"],[1,"muted",2,"margin-top","6px"],[1,"status-message","warning",2,"margin-bottom","var(--gutter-lg)"],[1,"status-message","warning",2,"margin-top","8px"],[1,"card-header",2,"justify-content","space-between"],[2,"display","flex","align-items","center","gap","var(--gutter-sm)","flex","1"],["type","button","class","promethea-button small secondary",3,"click",4,"ngIf"],[1,"pause-inputs",2,"margin-top","var(--gutter-sm)"],[1,"form-group"],["type","time",1,"form-control",3,"formControl"],[1,"error",2,"margin-top","4px"],[1,"error",2,"margin-top","8px"],["type","button",1,"promethea-button","small","secondary",3,"click"],[1,"location-actions",2,"display","flex","align-items","center","gap","8px"],["type","button",1,"promethea-button","secondary",3,"click","disabled"],["class","chip","style","background:#fff7e6;color:#8a6d00",4,"ngIf"],["class","chip","style","background:#e6fff1;color:#0a7a3a",4,"ngIf"],["class","chip","style","background:#f0f0f0;color:#333",4,"ngIf"],["style","margin-top:12px",4,"ngIf"],["class","status-message warning","style","margin-top:12px",4,"ngIf"],["class","status-message info","style","margin-top:12px",4,"ngIf"],["class","status-message error","style","margin-top:12px",4,"ngIf"],[1,"chip",2,"background","#fff7e6","color","#8a6d00"],[1,"chip",2,"background","#e6fff1","color","#0a7a3a"],[1,"material-icons",2,"vertical-align","middle"],[1,"chip",2,"background","#f0f0f0","color","#333"],[2,"margin-top","12px"],[1,"muted",2,"margin-bottom","8px"],["class","card small","style","margin-bottom:8px",4,"ngFor","ngForOf"],["class","status-message info","style","margin-top:8px",4,"ngIf"],["class","status-message success","style","margin-top:8px",4,"ngIf"],[1,"card","small",2,"margin-bottom","8px"],[2,"display","flex","justify-content","space-between","align-items","center"],[2,"flex","1"],[1,"muted",2,"font-size","0.9rem"],[1,"muted",2,"font-size","0.85rem"],[2,"display","flex","align-items","center","gap","8px"],["class","chip active",4,"ngIf"],["class","chip","style","background:#e6fff1;color:#0a7a3a;border:1px solid #22c55e",4,"ngIf"],["type","button","class","promethea-button small","title","Seleziona questo punto per timbrare",3,"click",4,"ngIf"],["type","button","class","promethea-button small secondary","title","Deseleziona questo punto",3,"click",4,"ngIf"],[1,"chip","active"],[1,"chip",2,"background","#e6fff1","color","#0a7a3a","border","1px solid #22c55e"],[1,"material-icons",2,"font-size","14px","vertical-align","middle"],["type","button","title","Seleziona questo punto per timbrare",1,"promethea-button","small",3,"click"],["type","button","title","Deseleziona questo punto",1,"promethea-button","small","secondary",3,"click"],[1,"status-message","info",2,"margin-top","8px"],[1,"muted",2,"margin-top","4px"],[1,"status-message","success",2,"margin-top","8px"],[1,"status-message","warning",2,"margin-top","12px"],["style","margin-top:8px",4,"ngIf"],[2,"margin-top","8px"],[2,"background","#f8f9fa","padding","8px","border-radius","6px","margin-top","4px"],[1,"muted"],[1,"status-message","info",2,"margin-top","12px"],[1,"status-message","error",2,"margin-top","12px"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"]],template:function(e,i){if(e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5),l()(),c(6,"div",5)(7,"h1",6),d(8),l(),c(9,"p",7),d(10),l()(),E(11,iF,2,1,"div",8),l(),E(12,rF,10,0,"div",9)(13,oF,10,0,"div",10),c(14,"form",11),x("ngSubmit",function(){return i.onSubmit()}),c(15,"div",12)(16,"h2",6)(17,"span",4),d(18,"schedule"),l(),d(19," Orario Timbratura "),l(),c(20,"div",13)(21,"div",14)(22,"label",15)(23,"span",4),d(24,"event"),l(),d(25," Data * "),l(),P(26,"input",16),E(27,sF,11,4,"div",17),ee(28,cF,3,2,"div",18),l(),c(29,"div",14)(30,"label",15)(31,"span",4),d(32,"play_arrow"),l(),d(33," Ora Ingresso * "),l(),P(34,"input",19),ee(35,fF,3,2,"div",18),l(),c(36,"div",14)(37,"label",15)(38,"span",4),d(39,"stop"),l(),d(40," Ora Uscita "),l(),P(41,"input",20),ee(42,pF,2,1,"div",18),ee(43,hF,2,1,"div",18),l()()(),c(44,"div",12)(45,"h2",6)(46,"span",4),d(47,"free_breakfast"),l(),d(48," Gestione Pause "),l(),c(49,"div",21),It(50,yF,20,7,"div",22,Ag),c(52,"button",23),x("click",function(){return i.aggiungiPausa()}),c(53,"span",4),d(54,"add"),l(),d(55," Aggiungi Pausa "),l()()(),c(56,"div",12)(57,"h2",6)(58,"span",4),d(59,"notes"),l(),d(60," Dettagli Aggiuntivi "),l(),c(61,"div",13)(62,"div",14)(63,"label",15)(64,"span",4),d(65,"sticky_note_2"),l(),d(66," Note "),l(),P(67,"textarea",24),l()(),E(68,zF,20,13,"div",25),l(),ee(69,BF,17,3,"div",12),c(70,"div",26)(71,"button",27)(72,"span",4),d(73,"arrow_back"),l(),d(74," Torna alle Timbrature "),l(),c(75,"button",28),E(76,$F,3,1,"ng-container",25)(77,HF,2,0,"ng-container",25),d(78),l()()()()()),e&2){let r,o,s;p(5),T(i.isEditMode?"edit":"assignment_add"),p(3),T(i.isEditMode?"Modifica Timbratura":"Nuova Timbratura"),p(2),T(i.isEditMode?"Richiedi modifiche alla tua timbratura":"Registra la tua timbratura giornaliera"),p(),_("ngIf",!i.isEditMode),p(),_("ngIf",i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)!=="admin"),p(),_("ngIf",i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)==="admin"),p(),_("formGroup",i.timbraturaForm),p(12),_("max",i.maxDate),p(),_("ngIf",i.hasTimbraturaForSelectedDate&&!i.isEditMode&&(i.currentUser==null?null:i.currentUser.role)!=="admin"),p(),te((r=i.timbraturaForm.get("data"))!=null&&r.invalid&&((r=i.timbraturaForm.get("data"))!=null&&r.touched)?28:-1),p(7),te((o=i.timbraturaForm.get("ora_inizio"))!=null&&o.invalid&&((o=i.timbraturaForm.get("ora_inizio"))!=null&&o.touched)?35:-1),p(7),te(i.hasTimeRangeError?42:-1),p(),te((s=i.timbraturaForm.get("ora_fine"))!=null&&s.hasError("futureTime")?43:-1),p(7),Tt(i.pause.controls),p(2),_("disabled",i.hasPauseErrors()),p(16),_("ngIf",(i.currentCompany==null?null:i.currentCompany.timbratura_type)==="punti"),p(),te(i.calcolaOreTotali()>0?69:-1),p(6),_("disabled",i.timbraturaForm.invalid||i.isLoading||(i.currentCompany==null?null:i.currentCompany.timbratura_type)==="punti"&&!i.posizioneValida),p(),_("ngIf",!i.isLoading),p(),_("ngIf",i.isLoading),p(),R(" ",i.getSubmitButtonText()," ")}},dependencies:[Ee,Be,xe,Ti,Ln,Re,Fe,Fn,uv,jn,oi,jt,Ht,tn,lt],styles:[".pause-inputs[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-md)}.pause-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}@media (max-width: 768px){.pause-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}}.header-actions[_ngcontent-%COMP%]{margin-left:auto;display:flex;gap:var(--gutter-sm)}.header-actions[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)}.mobile-textarea[_ngcontent-%COMP%]{min-height:10rem}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 15%,transparent);color:var(--success);border:1px solid color-mix(in srgb,var(--success) 30%,transparent)}@media (max-width: 768px){.pause-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}.header-actions[_ngcontent-%COMP%]{margin-left:0;margin-top:var(--gutter-sm)}.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);border:1px solid color-mix(in srgb,var(--primary) 30%,transparent)}.status-message.success[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 10%,transparent);border:1px solid color-mix(in srgb,var(--success) 20%,transparent);color:var(--success)}.status-message.success[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--success)}@media (max-width: 768px){.promethea-button.small[_ngcontent-%COMP%]{padding:4px 8px;font-size:.8rem}.promethea-button.small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px}}"]})};var ra=class n{constructor(t,e){this.supabaseService=t;this.authService=e}getAnnunciAzienda(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("announcements").select("*").eq("company_id",t).order("created_at",{ascending:!1});if(o)throw console.error("[AnnouncementsService] getAnnunciAzienda error",o),o;return Array.isArray(r)?r:[]});return J(i)}creaAnnuncio(t,e){let i=this.supabaseService.getClient(),r=y(this,null,function*(){let o=yield nt(this.authService.currentUser$);if(!o||o.role!=="admin")throw new Error("Solo gli admin possono creare annunci");let s={company_id:t,title:e.title,content:e.content,created_by:o.id,created_at:new Date().toISOString(),is_active:!0},{data:a,error:u}=yield i.from("announcements").insert([s]).select().maybeSingle();if(u)throw console.error("[AnnouncementsService] creaAnnuncio error",u),u;return a});return J(r)}generateId(){return"ann_"+Math.random().toString(36).substr(2,9)}getAnnunciAziendaWithReadStatus(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield nt(this.authService.currentUser$),{data:o,error:s}=yield e.from("announcements").select("*").eq("company_id",t).order("created_at",{ascending:!1});if(s)throw s;let a=Array.isArray(o)?o:[];if(!r||a.length===0)return a.map(m=>Q(N({},m),{is_read:!1}));let u=a.map(m=>m.id).filter(m=>!!m),f=[];if(u.length>0){let m=yield e.from("announcements_reads").select("announcement_id, read_at").in("announcement_id",u).eq("user_id",r.id);if(m.error)throw m.error;f=Array.isArray(m.data)?m.data:[]}let h=new Map;return(f||[]).forEach(m=>h.set(m.announcement_id,m.read_at)),a.map(m=>Q(N({},m),{is_read:m.id?h.has(m.id):!1}))});return J(i)}markAsRead(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield nt(this.authService.currentUser$);if(!r)throw new Error("User not authenticated");let o={announcement_id:t,user_id:r.id,read_at:new Date().toISOString()},{data:s,error:a}=yield e.from("announcements_reads").upsert([o],{onConflict:"announcement_id,user_id"}).select().maybeSingle();if(a)throw a;return s});return J(i)}markAsUnread(t){if(!t)return K(null);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let r=yield nt(this.authService.currentUser$);if(!r)throw new Error("User not authenticated");let{error:o}=yield e.from("announcements_reads").delete().eq("announcement_id",t).eq("user_id",r.id);if(o)throw o;return!0});return J(i)}getUnreadCountForUser(t){return y(this,null,function*(){if(!t)return 0;let e=this.supabaseService.getClient(),i=yield nt(this.authService.currentUser$);if(!i)return 0;let{data:r,error:o}=yield e.from("announcements").select("id").eq("company_id",t).eq("is_active",!0);if(o)throw o;let s=(r||[]).map(m=>m.id);if(s.length===0)return 0;let{data:a,error:u}=yield e.from("announcements_reads").select("announcement_id").in("announcement_id",s).eq("user_id",i.id);if(u)throw u;let f=new Set((a||[]).map(m=>m.announcement_id));return s.filter(m=>!f.has(m)).length})}static \u0275fac=function(e){return new(e||n)(z(pt),z(le))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var GF=["announcementsSection"];function qF(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"corporate_fare"),l(),c(4,"h3",13),d(5,"Informazioni Azienda"),l()(),c(6,"div",22)(7,"div",23)(8,"span",24),d(9,"Nome Azienda"),l(),c(10,"span",25),d(11),l()(),c(12,"div",23)(13,"span",24),d(14,"Partita IVA"),l(),c(15,"span",25),d(16),l()(),c(17,"div",23)(18,"span",24),d(19,"Forma Giuridica"),l(),c(20,"span",25),d(21),l()(),c(22,"div",23)(23,"span",24),d(24,"Settore"),l(),c(25,"span",25),d(26),l()()()()),n&2){let e=g();p(11),T(e.azienda.name),p(5),T(e.azienda.vat),p(5),T(e.azienda.legal_form||"Non specificata"),p(5),T(e.azienda.category||"Non specificato")}}function JF(n,t){if(n&1&&(c(0,"span",29),d(1),l()),n&2){let e=g(3);p(),ve(" ",e.azienda.city,", ",e.azienda.province," ")}}function KF(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"location_on"),l(),c(3,"div",27)(4,"span",24),d(5,"Indirizzo"),l(),c(6,"span",25),d(7),l(),E(8,JF,2,2,"span",28),l()()),n&2){let e=g(2);p(7),R(" ",e.azienda.address," "),p(),_("ngIf",e.azienda.city||e.azienda.province)}}function YF(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"phone"),l(),c(3,"div",27)(4,"span",24),d(5,"Telefono"),l(),c(6,"span",25),d(7),l()()()),n&2){let e=g(2);p(7),T(e.azienda.numero_telefono)}}function ZF(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"email"),l(),c(3,"div",27)(4,"span",24),d(5,"Email"),l(),c(6,"span",25)(7,"a",30),d(8),l()()()()),n&2){let e=g(2);p(7),_("href","mailto:"+e.azienda.email,Wa),p(),T(e.azienda.email)}}function QF(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"web"),l(),c(3,"div",27)(4,"span",24),d(5,"Sito Web"),l(),c(6,"a",31),d(7),l()()()),n&2){let e=g(2);p(6),_("href",e.azienda.website,Wa),p(),T(e.azienda.website)}}function XF(n,t){if(n&1&&(c(0,"div",23)(1,"span",5),d(2,"person"),l(),c(3,"div",27)(4,"span",24),d(5,"Amministratore"),l(),c(6,"span",25),d(7),l(),c(8,"span",29),d(9),l()()()),n&2){let e=g(2);p(7),ve("",e.adminAzienda.first_name," ",e.adminAzienda.last_name),p(2),T(e.adminAzienda.email)}}function eL(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"contact_page"),l(),c(4,"h3",13),d(5,"Contatti"),l()(),c(6,"div",22),E(7,KF,9,2,"div",26)(8,YF,8,1,"div",26)(9,ZF,9,2,"div",26)(10,QF,8,2,"div",26)(11,XF,10,3,"div",26),l()()),n&2){let e=g();p(7),_("ngIf",e.azienda.address||e.azienda.civic_number||e.azienda.city||e.azienda.province),p(),_("ngIf",e.azienda.numero_telefono),p(),_("ngIf",e.azienda.email),p(),_("ngIf",e.azienda.website),p(),_("ngIf",e.adminAzienda)}}function tL(n,t){if(n&1&&(c(0,"div",23)(1,"span",24),d(2,"Orario Ufficio"),l(),c(3,"span",25),d(4),l()()),n&2){let e=g(2);p(4),ve("",e.azienda.opening_time," - ",e.azienda.closing_time)}}function nL(n,t){if(n&1&&(c(0,"div",36)(1,"span",37),d(2),l(),c(3,"span",38),d(4),l()()),n&2){let e=t.$implicit,i=g(2);p(2),T(e.label),p(),Se("closed",i.isGiornoChiuso(e.key)),p(),R(" ",i.getOrarioGiorno(e.key)," ")}}function iL(n,t){if(n&1&&(c(0,"div",12)(1,"div",21)(2,"span",5),d(3,"schedule"),l(),c(4,"h3",13),d(5,"Orari di Lavoro"),l()(),c(6,"div",22),E(7,tL,5,2,"div",26),c(8,"div",32)(9,"h4",33),d(10,"Orari Settimanali"),l(),c(11,"div",34),E(12,nL,5,4,"div",35),l()()()()),n&2){let e=g();p(7),_("ngIf",e.azienda.opening_time&&e.azienda.closing_time),p(5),_("ngForOf",e.giorniSettimana)}}function rL(n,t){if(n&1&&(c(0,"div",41)(1,"div",42),d(2),l(),c(3,"div",43)(4,"div",44),d(5),l(),c(6,"div",45),d(7),l()(),c(8,"div",46),d(9),l()()),n&2){let e=t.$implicit,i=g(2);p(2),ve(" ",((e==null?null:e.first_name)||"")==null?null:((e==null?null:e.first_name)||"").charAt(0),"",((e==null?null:e.last_name)||"")==null?null:((e==null?null:e.last_name)||"").charAt(0)," "),p(3),ve("",e==null?null:e.first_name," ",e==null?null:e.last_name),p(),br("role-"+(e==null?null:e.role)),p(),R(" ",i.getRuoloLabel(e==null?null:e.role)," "),p(),Se("active",e==null?null:e.is_active),p(),R(" ",e!=null&&e.is_active?"Attivo":"Inattivo"," ")}}function oL(n,t){if(n&1&&(c(0,"div",11)(1,"h2",7)(2,"span",5),d(3,"groups"),l(),d(4," Team Aziendale "),l(),c(5,"div",39),E(6,rL,10,10,"div",40),l()()),n&2){let e=g();p(6),_("ngForOf",e.dipendenti)}}function sL(n,t){if(n&1){let e=k();c(0,"button",47),x("click",function(){C(e);let r=g();return S(r.mostraFormAnnuncio=!r.mostraFormAnnuncio)}),c(1,"span",5),d(2,"add"),l(),d(3," Nuovo Annuncio "),l()}}function aL(n,t){if(n&1){let e=k();c(0,"div",48)(1,"h3",33)(2,"span",5),d(3,"create"),l(),d(4," Crea Nuovo Annuncio "),l(),c(5,"div",49)(6,"label",50),d(7,"Titolo Annuncio"),l(),c(8,"input",51),W("ngModelChange",function(r){C(e);let o=g();return G(o.nuovoAnnuncio.title,r)||(o.nuovoAnnuncio.title=r),S(r)}),l()(),c(9,"div",49)(10,"label",50),d(11,"Contenuto"),l(),c(12,"textarea",52),W("ngModelChange",function(r){C(e);let o=g();return G(o.nuovoAnnuncio.content,r)||(o.nuovoAnnuncio.content=r),S(r)}),l()(),c(13,"div",53)(14,"button",54),x("click",function(){C(e);let r=g();return S(r.annullaCreazioneAnnuncio())}),d(15," Annulla "),l(),c(16,"button",55),x("click",function(){C(e);let r=g();return S(r.creaAnnuncio())}),c(17,"span",5),d(18,"publish"),l(),d(19," Pubblica Annuncio "),l()()()}if(n&2){let e=g();p(8),H("ngModel",e.nuovoAnnuncio.title),p(4),H("ngModel",e.nuovoAnnuncio.content),p(4),_("disabled",!e.nuovoAnnuncio.title||!e.nuovoAnnuncio.content)}}function lL(n,t){n&1&&(c(0,"span",67),d(1,"fiber_new"),l())}function cL(n,t){n&1&&(c(0,"span"),d(1,"\u2026"),l())}function uL(n,t){if(n&1){let e=k();c(0,"div",58)(1,"div",59)(2,"h4",60)(3,"a",61),x("click",function(r){let o=C(e).$implicit;return g(2).openAnnouncement(o),S(r.preventDefault())}),d(4),E(5,lL,2,0,"span",62),l()(),c(6,"span",63),d(7),Z(8,"date"),l()(),c(9,"p",64),d(10),Z(11,"slice"),E(12,cL,2,0,"span",65),l(),c(13,"div",66),d(14),l()()}if(n&2){let e=t.$implicit;p(4),R(" ",e.title," "),p(),_("ngIf",!e.is_read),p(2),T(X(8,6,e.created_at,"dd/MM/yyyy HH:mm")),p(3),T(Qa(11,9,e.content,0,200)),p(2),_("ngIf",e.content.length>200),p(2),R("Pubblicato da ",e.author_name||e.author)}}function dL(n,t){if(n&1&&(c(0,"div",56,1),E(2,uL,15,13,"div",57),l()),n&2){let e=g();p(2),_("ngForOf",e.annunci)}}function fL(n,t){if(n&1){let e=k();c(0,"div",68),x("click",function(){C(e);let r=g();return S(r.closeAnnouncement())}),c(1,"div",69),x("click",function(r){return C(e),S(r.stopPropagation())}),c(2,"div",21)(3,"h3",13),d(4),l()(),c(5,"div",70)(6,"button",47),x("click",function(){C(e);let r=g();return S(r.toggleMarkUnread(r.selectedAnnouncement))}),d(7),l(),c(8,"button",54),x("click",function(){C(e);let r=g();return S(r.closeAnnouncement())}),d(9,"Chiudi"),l()(),c(10,"div",22)(11,"div",63),d(12),Z(13,"date"),l(),c(14,"div",71),d(15),l()()()()}if(n&2){let e=g();p(),_("ngStyle",e.modalStyle),p(3),T(e.selectedAnnouncement==null?null:e.selectedAnnouncement.title),p(3),R(" ",e.selectedAnnouncement!=null&&e.selectedAnnouncement.is_read?"Segna da leggere":"Segna come letto"," "),p(5),T(X(13,5,e.selectedAnnouncement==null?null:e.selectedAnnouncement.created_at,"dd/MM/yyyy HH:mm")),p(3),T(e.selectedAnnouncement==null?null:e.selectedAnnouncement.content)}}function pL(n,t){n&1&&(c(0,"p",8),d(1,' Clicca su "Nuovo Annuncio" per pubblicare il primo annuncio. '),l())}function hL(n,t){if(n&1&&(c(0,"div",72)(1,"span",5),d(2,"campaign"),l(),c(3,"h3"),d(4,"Nessun annuncio"),l(),c(5,"p"),d(6,"Non ci sono annunci aziendali al momento."),l(),E(7,pL,2,0,"p",73),l()),n&2){let e=g();p(7),_("ngIf",e.hasRole("admin"))}}function mL(n,t){n&1&&(c(0,"div",74),P(1,"div",75),c(2,"p"),d(3,"Caricamento annunci..."),l()())}var yp=class n{constructor(t,e,i,r,o){this.authService=t;this.companyService=e;this.announcementsService=i;this.timbratureService=r;this.dipendentiService=o}announcementsSectionRef;azienda=null;adminAzienda=null;dipendenti=[];statistiche=null;annunci=[];currentUser=null;isLoading=!0;selectedAnnouncement=null;showAnnouncementModal=!1;modalStyle={};giorniSettimana=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];mostraFormAnnuncio=!1;nuovoAnnuncio={title:"",content:""};isLoadingAnnunci=!1;ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&this.caricaDatiAzienda(t.company_id)})}caricaDatiAzienda(t){this.isLoading=!0,this.companyService.getAzienda(t).subscribe(e=>{if(!e){console.warn("Nessuna azienda trovata per id",t),this.isLoading=!1;return}this.azienda=e,this.caricaDipendenti(t),this.caricaAnnunci()},e=>{console.error("Errore nel caricamento dati azienda:",e),this.isLoading=!1})}caricaDipendenti(t){console.debug("[ProfiloAziendale] caricaDipendenti start (using Dipendenti service)",{companyId:t}),this.dipendentiService.getDipendenti(t).subscribe({next:e=>{let i=Array.isArray(e)?e:[];console.debug("[ProfiloAziendale] dipendenti (from Dipendenti):",i.length,i.slice(0,5)),this.dipendenti=i,this.statistiche={dipendentiTotali:i.length,dipendentiAttivi:i.filter(r=>!!r?.is_active).length,timbratureOggi:0,presenzeOggi:0},this.caricaAdminAzienda(this.dipendenti),this.loadTimbratureAndPresenze(),this.isLoading=!1},error:e=>{console.error("[ProfiloAziendale] errore getDipendenti (Dipendenti):",e),this.dipendenti=[],this.statistiche={dipendentiTotali:0,dipendentiAttivi:0,timbratureOggi:this.statistiche?.timbratureOggi??0,presenzeOggi:this.statistiche?.presenzeOggi??0},this.isLoading=!1}})}caricaAdminAzienda(t){let e=t.find(i=>i.role==="admin");e&&(this.adminAzienda=e)}caricaStatistiche(t){let e=t.filter(i=>i.is_active).length;console.debug("[ProfiloAziendale] caricaStatistiche dipendenti.length=",t.length,"attivi=",e),this.statistiche={dipendentiTotali:t.length,dipendentiAttivi:e,timbratureOggi:0,presenzeOggi:0},this.loadTimbratureAndPresenze()}loadTimbratureAndPresenze(){if(!this.azienda?.id){console.debug("[ProfiloAziendale] no azienda id, skip timbrature");return}let t=this.azienda.id;this.timbratureService.getTimbratureAzienda(t).then(e=>{let i=Array.isArray(e)?e:[];console.debug("[ProfiloAziendale] timbrature azienda count:",i.length);let r=new Date,o=u=>{if(!u)return!1;let f=new Date(u);return f.getFullYear()===r.getFullYear()&&f.getMonth()===r.getMonth()&&f.getDate()===r.getDate()},s=i.filter(u=>o(u.start_ts??u.created_at??u.ts)),a=new Set(s.map(u=>u.user_id??u.uid)).size;this.statistiche||(this.statistiche={dipendentiTotali:this.dipendenti.length,dipendentiAttivi:this.dipendenti.filter(u=>u.is_active).length,timbratureOggi:0,presenzeOggi:0}),this.statistiche.timbratureOggi=s.length,this.statistiche.presenzeOggi=a}).catch(e=>{console.error("[ProfiloAziendale] errore getTimbratureAzienda:",e),this.statistiche||(this.statistiche={dipendentiTotali:this.dipendenti.length,dipendentiAttivi:this.dipendenti.filter(i=>i.is_active).length,timbratureOggi:0,presenzeOggi:0}),this.statistiche.timbratureOggi=0,this.statistiche.presenzeOggi=0})}caricaAnnunci(){this.azienda?.id&&(this.isLoadingAnnunci=!0,this.announcementsService.getAnnunciAziendaWithReadStatus(this.azienda.id).subscribe({next:t=>{this.annunci=t,this.isLoadingAnnunci=!1},error:t=>{console.error("Errore nel caricamento annunci:",t),this.isLoadingAnnunci=!1,this.annunci=[]}}))}ensureSectionVisible(){return y(this,null,function*(){let t=this.announcementsSectionRef?.nativeElement;t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),yield new Promise(e=>setTimeout(e,300)))})}openAnnouncement(t){return y(this,null,function*(){yield this.ensureSectionVisible();let e=this.announcementsSectionRef?.nativeElement,i=e?e.getBoundingClientRect():null,r=20,o=900,s=i?i.left+window.scrollX:window.scrollX+r,a=i?i.top+window.scrollY:window.scrollY+r,u=i?i.width:Math.min(window.innerWidth-r*2,o),f=Math.min(u*.9,o),h=Math.max(r,s+(u-f)/2),m=Math.min(800,Math.floor(window.innerHeight*.8)),b=window.scrollY+Math.max(r,(window.innerHeight-m)/2);this.modalStyle={position:"fixed",top:`${Math.floor(b)}px`,left:`${Math.floor(h)}px`,width:`${Math.floor(f)}px`},this.selectedAnnouncement=t,this.showAnnouncementModal=!0;let v=t?.id;v?this.announcementsService.markAsRead(v).subscribe({next:()=>{this.annunci=this.annunci.map(w=>w?.id===v?Q(N({},w),{is_read:!0}):w),this.selectedAnnouncement&&this.selectedAnnouncement.id===v&&(this.selectedAnnouncement.is_read=!0)},error:w=>console.error("markAsRead err",w)}):t.is_read=!0})}closeAnnouncement(){this.showAnnouncementModal=!1,this.selectedAnnouncement=null,this.modalStyle={}}toggleMarkUnread(t){if(!t)return;let e=t.id;if(!e){t.is_read=!t.is_read,this.selectedAnnouncement&&this.selectedAnnouncement===t&&(this.selectedAnnouncement.is_read=t.is_read);return}t.is_read?this.announcementsService.markAsUnread(e).subscribe({next:()=>{this.annunci=this.annunci.map(i=>i?.id===e?Q(N({},i),{is_read:!1}):i),this.selectedAnnouncement&&this.selectedAnnouncement.id===e&&(this.selectedAnnouncement.is_read=!1)},error:i=>console.error("markAsUnread err",i)}):this.announcementsService.markAsRead(e).subscribe({next:()=>{this.annunci=this.annunci.map(i=>i?.id===e?Q(N({},i),{is_read:!0}):i),this.selectedAnnouncement&&this.selectedAnnouncement.id===e&&(this.selectedAnnouncement.is_read=!0)},error:i=>console.error("markAsRead err",i)})}creaAnnuncio(){if(!this.azienda?.id||!this.currentUser)return;let t={title:this.nuovoAnnuncio.title,content:this.nuovoAnnuncio.content,author_id:this.currentUser.id,author_name:`${this.currentUser.first_name} ${this.currentUser.last_name}`};this.announcementsService.creaAnnuncio(this.azienda.id,t).subscribe({next:e=>{this.annunci=[e,...this.annunci],this.nuovoAnnuncio={title:"",content:""},this.mostraFormAnnuncio=!1},error:e=>{console.error("Errore nella creazione annuncio:",e),alert("Errore nella creazione dell'annuncio: "+e.message)}})}annullaCreazioneAnnuncio(){this.mostraFormAnnuncio=!1,this.nuovoAnnuncio={title:"",content:""}}getMockAnnunci(){return[{id:"mock1",title:"Nuovo Orario Estivo",content:"A partire dal 1 giugno, l'orario di lavoro sar\xE0 dalle 8:00 alle 16:00.",author_id:"admin",author_name:"Amministrazione",created_at:new Date("2024-05-15").toISOString(),is_active:!0,date:new Date("2024-05-15"),author:"Amministrazione"}]}hasRole(t){return this.authService.hasRole(t)}isGiornoChiuso(t){if(!t)return!1;let e=this.azienda?.closed_days;return!e||!Array.isArray(e)?!1:e.some(i=>{if(!i)return!1;if(typeof i=="string"||typeof i=="number"){let o=String(i).split("|")[0];if(o.includes("/")){let[s,a]=o.split("/");return t>=s&&t<=a}return o===t}if(typeof i=="object"){let r=i.type||(i.start&&i.end?"range":"single");if(r==="single")return i.start===t;if(r==="range")return!i.start||!i.end?!1:t>=i.start&&t<=i.end}return!1})}getOrarioGiorno(t){if(!t)return"Non specificato";if(this.isGiornoChiuso(t))return"Chiuso";let i=this.azienda?.opening_hours?.[t];return i?i?.closed||!i?.open||!i?.close?"Chiuso":`${i.open} - ${i.close}`:this.azienda?.opening_time&&this.azienda?.closing_time?`${this.azienda.opening_time} - ${this.azienda.closing_time}`:"Non specificato"}getRuoloLabel(t){if(!t)return"Dipendente";switch(t){case"admin":return"Amministratore";case"manager":return"Manager";case"employee":return"Dipendente";default:return t.charAt(0).toUpperCase()+t.slice(1)}}static \u0275fac=function(e){return new(e||n)(D(le),D(et),D(ra),D(Nt),D(Ot))};static \u0275cmp=we({type:n,selectors:[["app-profilo-aziendale"]],viewQuery:function(e,i){if(e&1&&Ya(GF,5),e&2){let r;so(r=ao())&&(i.announcementsSectionRef=r.first)}},decls:62,vars:14,consts:[["noAnnunci",""],["announcementsSection",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],["class","card",4,"ngIf"],[1,"form-section"],[1,"card"],[1,"card-title"],[1,"card-number"],["class","form-section",4,"ngIf"],["class","promethea-button outline",3,"click",4,"ngIf"],["class","form-card",4,"ngIf"],["class","announcements-list",4,"ngIf","ngIfElse"],["class","modal-overlay-fixed",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],[1,"card-header"],[1,"card-content"],[1,"info-item"],[1,"info-label"],[1,"info-value"],["class","info-item",4,"ngIf"],[1,"contact-info"],["class","info-detail",4,"ngIf"],[1,"info-detail"],[1,"info-link",3,"href"],["target","_blank",1,"info-link",3,"href"],[1,"opening-hours"],[1,"subsection-title"],[1,"hours-grid"],["class","hour-item",4,"ngFor","ngForOf"],[1,"hour-item"],[1,"day-label"],[1,"hour-value"],[1,"team-grid"],["class","team-member",4,"ngFor","ngForOf"],[1,"team-member"],[1,"member-avatar"],[1,"member-info"],[1,"member-name"],[1,"member-role","chip"],[1,"member-status"],[1,"promethea-button","outline",3,"click"],[1,"form-card"],[1,"form-group"],[1,"form-label"],["type","text","placeholder","Inserisci il titolo dell'annuncio",1,"form-input",3,"ngModelChange","ngModel"],["placeholder","Inserisci il contenuto dell'annuncio","rows","4",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"form-actions"],[1,"promethea-button","ghost",3,"click"],[1,"promethea-button",3,"click","disabled"],[1,"announcements-list"],["class","announcement-item",4,"ngFor","ngForOf"],[1,"announcement-item"],[1,"announcement-header"],[1,"announcement-title"],["href","#",1,"info-link",3,"click"],["class","material-icons","title","Non letto",4,"ngIf"],[1,"announcement-date"],[1,"announcement-content"],[4,"ngIf"],[1,"announcement-author"],["title","Non letto",1,"material-icons"],[1,"modal-overlay-fixed",3,"click"],[1,"form-card","modal-popup-card",3,"click","ngStyle"],[1,"actions-container",2,"padding","var(--gutter-md) 0"],[2,"white-space","pre-line","margin-top","var(--gutter-md)"],[1,"empty-state"],["class","text-muted",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"]],template:function(e,i){if(e&1&&(c(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),d(4,"business"),l()(),c(5,"div",6)(6,"h1",7),d(7,"Profilo Aziendale"),l(),c(8,"p",8),d(9,"Informazioni e contatti dell'azienda"),l()()(),c(10,"div",9),E(11,qF,27,4,"div",10)(12,eL,12,5,"div",10)(13,iL,13,2,"div",10),l(),c(14,"div",11)(15,"h2",7)(16,"span",5),d(17,"insights"),l(),d(18," Statistiche Aziendali "),l(),c(19,"div",9)(20,"div",12)(21,"h3",13),d(22,"Dipendenti Totali"),l(),c(23,"div",14),d(24),l(),c(25,"p",8),d(26,"Persone nell'azienda"),l()(),c(27,"div",12)(28,"h3",13),d(29,"Dipendenti Attivi"),l(),c(30,"div",14),d(31),l(),c(32,"p",8),d(33,"Attualmente attivi"),l()(),c(34,"div",12)(35,"h3",13),d(36,"Timbrature Oggi"),l(),c(37,"div",14),d(38),l(),c(39,"p",8),d(40,"Registrate oggi"),l()(),c(41,"div",12)(42,"h3",13),d(43,"Presenze Oggi"),l(),c(44,"div",14),d(45),l(),c(46,"p",8),d(47,"Dipendenti in ufficio"),l()()()(),E(48,oL,7,1,"div",15),c(49,"div",11)(50,"div",3)(51,"h2",7)(52,"span",5),d(53,"announcement"),l(),d(54," Annunci Aziendali "),l(),E(55,sL,4,0,"button",16),l(),E(56,aL,20,3,"div",17)(57,dL,3,1,"div",18)(58,fL,16,8,"div",19)(59,hL,8,1,"ng-template",null,0,wn)(61,mL,4,0,"div",20),l()()),e&2){let r=en(60);p(11),_("ngIf",i.azienda),p(),_("ngIf",i.azienda),p(),_("ngIf",i.azienda),p(11),T((i.statistiche==null?null:i.statistiche.dipendentiTotali)||0),p(7),T((i.statistiche==null?null:i.statistiche.dipendentiAttivi)||0),p(7),T((i.statistiche==null?null:i.statistiche.timbratureOggi)||0),p(7),T((i.statistiche==null?null:i.statistiche.presenzeOggi)||0),p(3),_("ngIf",i.dipendenti.length>0),p(7),_("ngIf",i.hasRole("admin")),p(),_("ngIf",i.mostraFormAnnuncio&&i.hasRole("admin")),p(),_("ngIf",i.annunci.length>0)("ngIfElse",r),p(),_("ngIf",i.showAnnouncementModal),p(3),_("ngIf",i.isLoadingAnnunci)}},dependencies:[Ee,Be,xe,al,Rt,Re,Fe,yt,cl,lt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000da;display:flex;align-items:center;justify-content:center;padding:2rem;z-index:9999}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:900px;max-height:calc(100vh - 4rem);overflow:auto;box-shadow:0 30px 60px #00000073;border-radius:16px}body.modal-open[_ngcontent-%COMP%]{overflow:hidden}.announcements-list[_ngcontent-%COMP%]{position:relative;z-index:1}.announcements-modal-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:color-mix(in srgb,var(--background) 60%,transparent);display:flex;align-items:flex-start;justify-content:center;padding:1.2rem;z-index:50}.announcements-modal-card[_ngcontent-%COMP%]{width:100%;max-width:820px;margin-top:1rem;max-height:calc(100% - 2rem);overflow:auto;box-shadow:0 20px 40px #00000059;border-radius:12px}.modal-overlay-fixed[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000bf;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);display:flex;align-items:flex-start;justify-content:center;padding:var(--gutter-sm);z-index:12000;pointer-events:auto}.modal-popup-card[_ngcontent-%COMP%]{position:fixed;z-index:12001;box-shadow:0 30px 60px #0009;border-radius:12px;background:var(--background);max-height:calc(100vh - 40px);overflow:auto;padding:var(--gutter-lg);top:50%}"]})};function gL(n,t){if(n&1&&(c(0,"div",17),d(1),l()),n&2){let e=g();p(),T(e.error)}}function vL(n,t){n&1&&(c(0,"div",18),d(1,"Nessun invito presente"),l())}function _L(n,t){if(n&1){let e=k();c(0,"li",19)(1,"div",20)(2,"strong",21),d(3),l(),c(4,"small",18),d(5),Z(6,"date"),l()(),c(7,"div",22)(8,"button",23),x("click",function(){let r=C(e).$implicit,o=g();return S(o.rimuovi(r))}),c(9,"span",5),d(10,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=g();p(3),T(e.email),p(2),T(X(6,3,e.created_at,"dd/MM/yyyy")),p(3),_("disabled",i.loading)}}var oa=class n{constructor(t,e){this.invitiService=t;this.auth=e}companyId;closeModal=new Pe;inviti=[];newEmail="";loading=!1;error="";userSub;currentUserId=null;ngOnInit(){this.userSub=this.auth.currentUser$.subscribe(t=>{this.currentUserId=t?.id??null}),this.load()}ngOnDestroy(){this.userSub?.unsubscribe()}load(){this.companyId&&this.invitiService.listByCompany(this.companyId).subscribe({next:t=>this.inviti=t,error:t=>{console.error("Inviti load error",t),t?.message?.includes('relation "employee_invitations" does not exist')&&console.warn("La tabella employee_invitations non esiste ancora in Supabase. Esegui la migrazione SQL.")}})}aggiungi(){if(this.error="",!this.newEmail||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.newEmail)){this.error="Inserire una email valida";return}if(!this.companyId){this.error="Company non disponibile";return}this.loading=!0;let t=this.currentUserId;this.invitiService.addInvite(this.companyId,this.newEmail,t??void 0).subscribe({next:()=>{this.newEmail="",this.loading=!1,this.load()},error:e=>{this.loading=!1,this.error="Errore aggiunta",console.error("Errore addInvite:",e),e?.message?.includes('relation "employee_invitations" does not exist')&&(this.error="Tabella inviti non trovata nel DB. Esegui la migrazione SQL.")}})}rimuovi(t){confirm(`Rimuovere ${t.email}?`)&&(this.loading=!0,this.invitiService.removeInviteById(t.id).subscribe({next:()=>{this.loading=!1,this.load()},error:e=>{this.loading=!1,console.error(e)}}))}close(){this.closeModal.emit()}static \u0275fac=function(e){return new(e||n)(D(ia),D(le))};static \u0275cmp=we({type:n,selectors:[["app-inviti-dipendenti"]],inputs:{companyId:"companyId"},outputs:{closeModal:"closeModal"},decls:23,vars:5,consts:[["tabindex","-1","role","dialog","aria-modal","true",1,"modal-overlay",3,"click"],[1,"modal-card",3,"click"],[1,"modal-header"],[1,"h3"],["aria-label","Chiudi",1,"icon-button",3,"click"],[1,"material-icons"],[1,"modal-body"],[1,"form-group"],[1,"form-label"],["type","email","placeholder","nome@esempio.it",1,"form-control",3,"ngModelChange","ngModel"],["class","text-error",4,"ngIf"],[1,"form-actions"],[1,"promethea-button",3,"click","disabled"],[1,"divider"],["class","text-muted",4,"ngIf"],[1,"invites-list"],["class","list-row",4,"ngFor","ngForOf"],[1,"text-error"],[1,"text-muted"],[1,"list-row"],[1,"invite-left"],[1,"invite-email"],[1,"invite-actions"],["aria-label","Rimuovi",1,"icon-button",3,"click","disabled"]],template:function(e,i){e&1&&(c(0,"div",0),x("click",function(){return i.close()}),c(1,"div",1),x("click",function(o){return o.stopPropagation()}),c(2,"header",2)(3,"h3",3),d(4,"Inviti dipendenti"),l(),c(5,"button",4),x("click",function(){return i.close()}),c(6,"span",5),d(7,"close"),l()()(),c(8,"section",6)(9,"div",7)(10,"label",8),d(11,"Email da invitare"),l(),c(12,"input",9),W("ngModelChange",function(o){return G(i.newEmail,o)||(i.newEmail=o),o}),l(),E(13,gL,2,1,"div",10),l(),c(14,"div",11)(15,"button",12),x("click",function(){return i.aggiungi()}),c(16,"span",5),d(17,"person_add"),l(),d(18," Aggiungi "),l()(),P(19,"hr",13),E(20,vL,2,0,"div",14),c(21,"ul",15),E(22,_L,11,6,"li",16),l()()()()),e&2&&(p(12),H("ngModel",i.newEmail),p(),_("ngIf",i.error),p(2),_("disabled",i.loading),p(5),_("ngIf",(i.inviti==null?null:i.inviti.length)===0),p(2),_("ngForOf",i.inviti))},dependencies:[Ee,Be,xe,Rt,Re,Fe,yt,lt],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:var(--gutter-lg, 20px);background:#0000006b;z-index:1200}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:720px;background:var(--background);color:var(--text-color, #111);border-radius:12px;box-shadow:0 8px 28px #00000052;overflow:hidden}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 18px;border-bottom:1px solid color-mix(in srgb,var(--muted, #ddd) 18%,transparent)}.modal-body[_ngcontent-%COMP%]{padding:14px 18px 20px}.form-group[_ngcontent-%COMP%]{margin-bottom:12px}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:6px;font-weight:600}.form-control[type=email][_ngcontent-%COMP%]{width:100%;max-width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;margin-bottom:12px}.invites-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.invites-list[_ngcontent-%COMP%]   .list-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px dashed color-mix(in srgb,var(--muted, #ddd) 12%,transparent)}.invite-left[_ngcontent-%COMP%]{min-width:0;flex:1 1 auto;overflow:hidden}.invite-email[_ngcontent-%COMP%]{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.invite-actions[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:8px}@media (max-width:520px){.modal-card[_ngcontent-%COMP%]{max-width:calc(100% - 24px);margin:0 6px}.modal-header[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]{padding-left:12px;padding-right:12px}.form-actions[_ngcontent-%COMP%]{flex-wrap:wrap;gap:8px}}"]})};var Ex=()=>[],yL=n=>["chip",n];function bL(n,t){n&1&&P(0,"app-loading-spinner")}function wL(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function EL(n,t){if(n&1){let e=k();c(0,"button",32),x("click",function(){C(e);let r=g();return S(r.openInvitiModal())}),c(1,"span",4),d(2,"person_add"),l(),d(3," Nuovo Dipendente "),l()}}function CL(n,t){if(n&1&&(c(0,"span"),d(1),l()),n&2){let e=g();p(),R("(",e.dipendentiCestino.length||0,")")}}function SL(n,t){if(n&1){let e=k();c(0,"button",40),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaDipendente(r))}),c(1,"span",4),d(2,"person_off"),l()()}}function xL(n,t){if(n&1){let e=k();c(0,"tr")(1,"td")(2,"div",33)(3,"div",34),d(4),l(),c(5,"div",35)(6,"a",36),x("click",function(r){let o=C(e).$implicit,s=g();return S(s.apriDettaglio(o.id,r))}),c(7,"strong"),d(8),l()()()()(),c(9,"td"),d(10),l(),c(11,"td")(12,"span",37),d(13),l()(),c(14,"td"),d(15),l(),c(16,"td"),d(17),l(),c(18,"td"),d(19),Z(20,"date"),l(),c(21,"td")(22,"div",38),E(23,SL,3,0,"button",39),l()()()}if(n&2){let e=t.$implicit,i=g();p(4),ve(" ",(e.first_name||"")[0],"",(e.last_name||"")[0]," "),p(4),ve("",e.first_name||"-"," ",e.last_name||"-"),p(2),T(e.email||"-"),p(2),_("ngClass",Ng(14,yL,"role-"+(e.role||"unknown"))),p(),R(" ",e.role||"\u2014"," "),p(2),T(e.job_title||"\u2014"),p(2),T(e.phone||"-"),p(2),R(" ",e!=null&&e.hire_date?X(20,11,e.hire_date,"dd/MM/yyyy"):"Non specificata"," "),p(4),_("ngIf",i.hasRole("admin"))}}function DL(n,t){if(n&1){let e=k();c(0,"button",32),x("click",function(){C(e);let r=g(2);return S(r.openInvitiModal())}),c(1,"span",4),d(2,"person_add"),l(),d(3," Aggiungi il primo dipendente "),l()}}function IL(n,t){if(n&1&&(c(0,"div",41)(1,"span",4),d(2,"group"),l(),c(3,"h3"),d(4,"Nessun dipendente trovato"),l(),c(5,"p",42),d(6,"Non sono stati trovati dipendenti con i filtri attuali."),l(),E(7,DL,4,0,"button",21),l()),n&2){let e=g();p(7),_("ngIf",e.hasRole("admin"))}}function TL(n,t){if(n&1&&(c(0,"div",43)(1,"div",44),d(2),l()()),n&2){let e=g();p(2),ve(" Mostrando ",e.dipendentiFiltrati.length," di ",e.dipendenti.length," dipendenti ")}}function ML(n,t){if(n&1){let e=k();c(0,"tr")(1,"td")(2,"div",33)(3,"div",34),d(4),l(),c(5,"div",35)(6,"a",36),x("click",function(r){let o=C(e).$implicit,s=g(2);return S(s.apriDettaglio(o.id,r))}),c(7,"strong"),d(8),l()()()()(),c(9,"td"),d(10),l(),c(11,"td")(12,"span",45),d(13),l()(),c(14,"td"),d(15),l(),c(16,"td"),d(17),l(),c(18,"td"),d(19),Z(20,"date"),l(),c(21,"td")(22,"div",38)(23,"button",46),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.riattivaDipendente(r))}),c(24,"span",4),d(25,"cached"),l()()()()()}if(n&2){let e=t.$implicit;p(4),ve(" ",(e.first_name||"")[0],"",(e.last_name||"")[0]," "),p(4),ve("",e.first_name||"-"," ",e.last_name||"-"),p(2),T(e.email||"-"),p(3),T(e.role||"\u2014"),p(2),T(e.job_title||"\u2014"),p(2),T(e.phone||"-"),p(2),T(e!=null&&e.hire_date?X(20,9,e.hire_date,"dd/MM/yyyy"):"Non specificata")}}function AL(n,t){n&1&&(c(0,"div",41),d(1," Nessun dipendente nel cestino. "),l())}function RL(n,t){if(n&1&&(c(0,"div",23)(1,"h2",6),d(2),l(),c(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th"),d(8,"Nome"),l(),c(9,"th"),d(10,"Email"),l(),c(11,"th"),d(12,"Ruolo"),l(),c(13,"th"),d(14,"Mansione"),l(),c(15,"th"),d(16,"Telefono"),l(),c(17,"th"),d(18,"Data Assunzione"),l(),c(19,"th"),d(20,"Azioni"),l()()(),c(21,"tbody"),E(22,ML,26,12,"tr",26),l()(),E(23,AL,2,0,"div",27),l()()),n&2){let e=g();p(2),R("Cestino - dipendenti disattivati (",e.dipendentiCestino.length||0,")"),p(20),_("ngForOf",e.dipendentiFiltratiCestino||Ue(4,Ex))("ngForTrackBy",e.trackById),p(),_("ngIf",e.dipendentiFiltratiCestino.length===0)}}function OL(n,t){if(n&1){let e=k();c(0,"app-inviti-dipendenti",47),x("closeModal",function(){C(e);let r=g();return S(r.showInvitiModal=!1)}),l()}if(n&2){let e=g();_("companyId",(e.aziendaCorrente==null?null:e.aziendaCorrente.id)??null)}}var bp=class n{constructor(t,e,i,r){this.companyService=t;this.dipendentiService=e;this.authService=i;this.router=r}dipendenti=[];dipendentiAttivi=[];dipendentiCestino=[];dipendentiFiltratiAttivi=[];dipendentiFiltratiCestino=[];filtroMansione="";jobTitles=[];canEditEmployees=!1;dipendentiFiltrati=[];currentUser=null;isLoading=!1;showInvitiModal=!1;aziendaCorrente=null;mostraDisattivati=!1;filtroTesto="";filtroRuolo="";filtroStato="";ngOnInit(){this.isLoading=!0,this.authService.currentUser$.pipe(rt(t=>!!t?.id),wt(1),He(t=>(this.currentUser=t??null,this.companyService.getAziendaForUser(t.id,t.company_id)))).subscribe({next:t=>{this.aziendaCorrente=t;let e=t&&t.id?t.id:this.currentUser?.company_id??null;if(this.currentUser?.role==="manager"){let i=this.companyService.resolveManagerConfig?this.companyService.resolveManagerConfig(t,this.currentUser.id):t?.manager_visibility?.[this.currentUser.id]??{mode:"self"};if((i.mode??"self")==="self"&&!i.can_view_all_employees){alert("Non hai i permessi per visualizzare la lista dipendenti. Visualizzi solo le tue timbrature."),this.router.navigate(["/home"]),this.isLoading=!1;return}this.canEditEmployees=!!i.can_edit_employees}if(e&&this.caricaDipendenti(e),this.currentUser?.role==="manager"){let i=this.companyService.resolveManagerConfig(t,this.currentUser.id);this.canEditEmployees=!!i.can_edit_employees}this.isLoading=!1},error:t=>{console.error("Errore caricamento azienda corrente",t),this.isLoading=!1}})}caricaDipendenti(t,e=!1){return y(this,null,function*(){try{let i=t??this.currentUser?.company_id??null;if(!i){this.dipendenti=[],this.dipendentiAttivi=[],this.dipendentiCestino=[],this.applicaFiltri();return}let r=yield nt(this.dipendentiService.getDipendenti(i)),o=Array.isArray(r)?r:[];if(this.currentUser?.role==="manager"){let s=yield nt(this.companyService.getAziendaForUser(this.currentUser.id,i));o=this.companyService.filterEmployeesByVisibility(o,s,this.currentUser.id)}this.dipendenti=o,this.dipendentiAttivi=o.filter(s=>!!s?.is_active),this.dipendentiCestino=o.filter(s=>!s?.is_active),this.applicaFiltri()}catch(i){console.error("[ListaDipendenti] caricaDipendenti error",i),this.dipendenti=[],this.dipendentiAttivi=[],this.dipendentiCestino=[],this.applicaFiltri()}})}toggleMostraDisattivati(){this.mostraDisattivati=!this.mostraDisattivati,this.mostraDisattivati&&this.aziendaCorrente?.id?this.caricaDipendenti(this.aziendaCorrente.id,!0):this.applicaFiltri()}applicaFiltri(){let t=(this.filtroTesto||"").toLowerCase(),e=this.filtroRuolo||"",i=this.filtroMansione??"",r=this.filtroStato||"",o=s=>(s||[]).filter(a=>{if(i){if(i==="__none__"){if(a.job_title)return!1}else if((a.job_title||"").toLowerCase()!==i.toLowerCase())return!1}return!(e&&(a.role||"")!==e||r==="attivo"&&!a.is_active||r==="inattivo"&&a.is_active||t&&!`${a.first_name||""} ${a.last_name||""} ${a.email||""}`.toLowerCase().includes(t))});this.dipendentiFiltratiAttivi=o(this.dipendentiAttivi),this.dipendentiFiltratiCestino=o(this.dipendentiCestino)}hasRole(t){return this.authService.hasRole(t)}openInvitiModal(){if(!this.aziendaCorrente||!this.aziendaCorrente.id){alert("Nessuna azienda associata. Assicurati che l'utente sia amministratore di una azienda.");return}this.showInvitiModal=!0}closeInvitiModal(){this.showInvitiModal=!1}cambiaStatoDipendente(t){if(!t?.id)return;let e=!t.is_active;if(!confirm(`Vuoi ${e?"riattivare":"disattivare"} il dipendente ${t.first_name} ${t.last_name}?`))return;this.isLoading=!0,(e?this.dipendentiService.restoreUser(t.id):this.dipendentiService.deleteUser(t.id)).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:o=>{console.error("Errore nello switch stato dipendente",o),alert("Errore durante l'operazione"),this.isLoading=!1}})}eliminaDipendente(t){t?.id&&confirm(`Sei sicuro di voler spostare nel cestino ${t.first_name} ${t.last_name}?`)&&(this.isLoading=!0,this.dipendentiService.deleteUser(t.id).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:e=>{console.error("Errore disattivazione",e),alert("Errore durante la disattivazione"),this.isLoading=!1}}))}riattivaDipendente(t){t?.id&&confirm(`Vuoi riattivare ${t.first_name} ${t.last_name}?`)&&(this.isLoading=!0,this.dipendentiService.restoreUser(t.id).subscribe({next:()=>{this.aziendaCorrente?.id&&this.caricaDipendenti(this.aziendaCorrente.id,!0),this.isLoading=!1},error:e=>{console.error("Errore ripristino",e),alert("Errore durante il ripristino"),this.isLoading=!1}}))}trackById(t,e){return e?.id??t}apriDettaglio(t,e){if(this.currentUser?.role==="manager"&&!this.canEditEmployees){alert("Non hai i permessi per vedere i dettagli dei dipendenti. Contatta un amministratore.");return}this.router.navigate(["/dipendenti",t])}static \u0275fac=function(e){return new(e||n)(D(et),D(Ot),D(le),D(Ie))};static \u0275cmp=we({type:n,selectors:[["app-lista-dipendenti"]],decls:70,vars:16,consts:[[1,"page-container"],[4,"ngIf"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Nome, cognome, email...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],["value","admin"],["value","manager"],["value","employee"],["value","__none__"],[3,"value",4,"ngFor","ngForOf"],[1,"actions-container"],["class","promethea-button",3,"click",4,"ngIf"],[1,"promethea-button","outline",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["class","pagination-container",4,"ngIf"],["class","table-section",4,"ngIf"],[3,"companyId","closeModal",4,"ngIf"],[3,"value"],[1,"promethea-button",3,"click"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],["href","#","title","Apri dettaglio",1,"link",3,"click"],[3,"ngClass"],[1,"action-buttons"],["class","icon-button","title","Elimina",3,"click",4,"ngIf"],["title","Elimina",1,"icon-button",3,"click"],[1,"empty-state"],[2,"margin-bottom","var(--gutter-lg)"],[1,"pagination-container"],[1,"pagination-info"],[1,"chip"],["title","Ripristina",1,"icon-button",3,"click"],[3,"closeModal","companyId"]],template:function(e,i){e&1&&(c(0,"div",0),E(1,bL,1,0,"app-loading-spinner",1),c(2,"div",2)(3,"div",3)(4,"span",4),d(5,"people"),l()(),c(6,"div",5)(7,"h1",6),d(8,"Lista Dipendenti"),l(),c(9,"p",7),d(10,"Gestisci i dipendenti dell'azienda"),l()()(),c(11,"div",8)(12,"div",9)(13,"div",10)(14,"label",11),d(15,"Cerca"),l(),c(16,"input",12),W("ngModelChange",function(o){return G(i.filtroTesto,o)||(i.filtroTesto=o),o}),x("input",function(){return i.applicaFiltri()}),l()(),c(17,"div",10)(18,"label",11),d(19,"Ruolo"),l(),c(20,"select",13),W("ngModelChange",function(o){return G(i.filtroRuolo,o)||(i.filtroRuolo=o),o}),x("change",function(){return i.applicaFiltri()}),c(21,"option",14),d(22,"Tutti"),l(),c(23,"option",15),d(24,"Admin"),l(),c(25,"option",16),d(26,"Manager"),l(),c(27,"option",17),d(28,"Dipendente"),l()()(),c(29,"div",10)(30,"label",11),d(31,"Mansione"),l(),c(32,"select",13),W("ngModelChange",function(o){return G(i.filtroMansione,o)||(i.filtroMansione=o),o}),x("change",function(){return i.applicaFiltri()}),c(33,"option",14),d(34,"Tutte"),l(),c(35,"option",18),d(36,"Senza mansione"),l(),E(37,wL,2,2,"option",19),l()()(),c(38,"div",20),E(39,EL,4,0,"button",21),c(40,"button",22),x("click",function(){return i.toggleMostraDisattivati()}),c(41,"span",4),d(42),l(),d(43),E(44,CL,2,1,"span",1),l()()(),c(45,"div",23)(46,"div",24)(47,"table",25)(48,"thead")(49,"tr")(50,"th"),d(51,"Nome"),l(),c(52,"th"),d(53,"Email"),l(),c(54,"th"),d(55,"Ruolo"),l(),c(56,"th"),d(57,"Mansione"),l(),c(58,"th"),d(59,"Telefono"),l(),c(60,"th"),d(61,"Data Assunzione"),l(),c(62,"th"),d(63,"Azioni"),l()()(),c(64,"tbody"),E(65,xL,24,16,"tr",26),l()()(),E(66,IL,8,1,"div",27),l(),E(67,TL,3,2,"div",28)(68,RL,24,5,"div",29),l(),E(69,OL,1,1,"app-inviti-dipendenti",30)),e&2&&(p(),_("ngIf",i.isLoading),p(15),H("ngModel",i.filtroTesto),p(4),H("ngModel",i.filtroRuolo),p(12),H("ngModel",i.filtroMansione),p(5),_("ngForOf",i.jobTitles),p(2),_("ngIf",i.hasRole("admin")),p(3),T(i.mostraDisattivati?"visibility_off":"visibility"),p(),R(" ",i.mostraDisattivati?"Nascondi cestino":"Mostra cestino"," "),p(),_("ngIf",i.mostraDisattivati),p(21),_("ngForOf",i.dipendentiFiltratiAttivi||Ue(15,Ex))("ngForTrackBy",i.trackById),p(),_("ngIf",i.dipendentiFiltrati.length===0),p(),_("ngIf",i.dipendentiFiltrati.length>0),p(),_("ngIf",i.mostraDisattivati),p(),_("ngIf",i.showInvitiModal))},dependencies:[Ee,o0,Be,xe,jt,Rt,Wt,Gt,Re,At,Fe,yt,$n,oa,lt],styles:[".user-info-compact[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.user-avatar-small[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:var(--gradiente);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.8rem;flex-shrink:0}.user-details-compact[_ngcontent-%COMP%]{min-width:0}.user-details-compact[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chip.role-admin[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 20%,transparent);color:var(--primary)}.chip.role-manager[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.chip.role-employee[_ngcontent-%COMP%], .chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 20%,transparent);color:#ef4444}@media (max-width: 768px){.user-info-compact[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:0}.user-avatar-small[_ngcontent-%COMP%]{margin-bottom:4px}}"]})};var Nr=class n{constructor(t){this.supabaseService=t}getDepartments(t){let i=this.supabaseService.getClient().from("departments").select("*, employee_count:users(count)").eq("company_id",t).order("name").then(r=>{if(r.error)throw r.error;return(r.data||[]).map(o=>Q(N({},o),{employee_count:o.employee_count?.[0]?.count||0}))});return J(i)}createDepartment(t){let e=this.supabaseService.getClient();return J(e.from("departments").insert([t]).select("*").maybeSingle().then(i=>{if(i.error)throw i.error;return i.data}))}updateDepartment(t,e){let r=this.supabaseService.getClient().from("departments").update(Q(N({},e),{updated_at:new Date().toISOString()})).eq("id",t).select().single().then(o=>{if(o.error)throw o.error;return o.data});return J(r)}deleteDepartment(t){let i=this.supabaseService.getClient().from("departments").delete().eq("id",t).then(r=>{if(r.error)throw r.error});return J(i)}updateEmployeeDepartment(t,e){let r=this.supabaseService.getClient().from("users").update({department_id:e,updated_at:new Date().toISOString()}).eq("id",t).select("*, department:departments(id, name)").single().then(o=>{if(o.error)throw o.error;return o.data});return J(r)}getDipendentiConReparto(t){let i=this.supabaseService.getClient().from("users").select("*, department:departments(id, name)").eq("company_id",t).order("first_name").then(r=>{if(r.error)throw r.error;return r.data||[]});return J(i)}canDeleteDepartment(t){let i=this.supabaseService.getClient().from("users").select("id",{count:"exact"}).eq("department_id",t).then(r=>{if(r.error)throw r.error;let o=typeof r.count=="number"?r.count:0;return{canDelete:o===0,employeeCount:o}});return J(i)}static \u0275fac=function(e){return new(e||n)(z(pt))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var sa=class n{constructor(t,e){this.supabaseService=t;this.authService=e}getJobTitles(t){if(!t)return K([]);let e=this.supabaseService.getClient(),i=y(this,null,function*(){let{data:r,error:o}=yield e.from("job_titles").select("*").eq("company_id",t).order("name",{ascending:!0});if(o)throw o;return Array.isArray(r)?r:[]});return J(i)}createJobTitle(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient(),r=yield nt(this.authService.currentUser$),o={company_id:t,name:e.name,description:e.description??null,created_by:r?.id??null},{data:s,error:a}=yield i.from("job_titles").insert([o]).select().maybeSingle();if(a)throw a;return s})}updateJobTitle(t,e){return y(this,null,function*(){let i=this.supabaseService.getClient();e.updated_at=new Date().toISOString();let{data:r,error:o}=yield i.from("job_titles").update(e).eq("id",t).select().maybeSingle();if(o)throw o;return r})}setJobTitleActive(t,e){return y(this,null,function*(){return this.updateJobTitle(t,{is_active:!!e,updated_at:new Date().toISOString()})})}deleteJobTitle(t){return y(this,null,function*(){let e=this.supabaseService.getClient(),{error:i}=yield e.from("job_titles").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",t);if(i)throw i})}static \u0275fac=function(e){return new(e||n)(z(pt),z(le))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var Sx=(n,t)=>t.id,NL=(n,t)=>t.giorno;function PL(n,t){if(n&1){let e=k();c(0,"div",9)(1,"button",44),x("click",function(){C(e);let r=g();return S(r.generaReport())}),c(2,"span",4),d(3,"download"),l(),d(4," Report "),l()()}}function kL(n,t){if(n&1&&(c(0,"div",45)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioSuccesso," ")}}function FL(n,t){if(n&1&&(c(0,"div",46)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioErrore," ")}}function LL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.first_name)||"Non specificato")}}function jL(n,t){if(n&1){let e=k();c(0,"input",47),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.first_name,r)||(o.editWorkModel.first_name=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.first_name)}}function VL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.last_name)||"Non specificato")}}function zL(n,t){if(n&1){let e=k();c(0,"input",48),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.last_name,r)||(o.editWorkModel.last_name=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.last_name)}}function UL(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g();R(" ",X(1,1,e.dipendente==null?null:e.dipendente.birth_date,"dd/MM/yyyy")," ")}}function BL(n,t){n&1&&d(0," Non specificata ")}function $L(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.birth_place)||"Non specificato")}}function HL(n,t){if(n&1){let e=k();c(0,"input",49),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.birth_place,r)||(o.editWorkModel.birth_place=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.birth_place)}}function WL(n,t){if(n&1){let e=k();c(0,"button",50),x("click",function(){C(e);let r=g();return S(r.beginEditWorkInfo())}),c(1,"span",4),d(2,"edit"),l()()}}function GL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T(e.getDepartmentName())}}function qL(n,t){if(n&1&&(c(0,"option",53),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),T(e.name)}}function JL(n,t){if(n&1){let e=k();c(0,"div",25)(1,"select",51),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.department_id,r)||(o.editWorkModel.department_id=r),S(r)}),c(2,"option",52),d(3,"Nessun reparto"),l(),It(4,qL,2,2,"option",53,Sx),l()()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.department_id),p(3),Tt(e.departments)}}function KL(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T((e.dipendente==null?null:e.dipendente.job_title)||"Non specificata")}}function YL(n,t){if(n&1&&(c(0,"option",58),d(1),l()),n&2){let e=t.$implicit;_("value",e.id)("disabled",!e.is_active),p(),T(e.name)}}function ZL(n,t){if(n&1){let e=k();Ze(0),c(1,"input",59),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.editWorkModel.job_title,r)||(o.editWorkModel.job_title=r),S(r)}),l(),Qe()}if(n&2){let e=g(2);p(),H("ngModel",e.editWorkModel.job_title)}}function QL(n,t){if(n&1){let e=k();c(0,"div",27)(1,"select",54),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.job_title_id,r)||(o.editWorkModel.job_title_id=r),S(r)}),c(2,"option",52),d(3,"-- Seleziona mansione --"),l(),E(4,YL,2,3,"option",55),c(5,"option",56),d(6,"Altro (testo libero)"),l()(),E(7,ZL,2,1,"ng-container",57),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.job_title_id),p(3),_("ngForOf",e.jobTitles),p(3),_("ngIf",e.editWorkModel.job_title_id===null||e.editWorkModel.job_title_id===""||e.editWorkModel.job_title_id==="__altro")}}function XL(n,t){if(n&1&&(c(0,"span",60),d(1),l()),n&2){let e=g();br("role-"+((e.dipendente==null?null:e.dipendente.role)||"employee")),p(),R(" ",e.getRuoloLabel(e.dipendente==null?null:e.dipendente.role)," ")}}function ej(n,t){if(n&1){let e=k();c(0,"select",61),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.role,r)||(o.editWorkModel.role=r),S(r)}),c(1,"option",62),d(2,"Dipendente"),l(),c(3,"option",63),d(4,"Manager"),l(),c(5,"option",64),d(6,"Amministratore"),l()()}if(n&2){let e=g();H("ngModel",e.editWorkModel.role)}}function tj(n,t){if(n&1&&(c(0,"span",60),d(1),l()),n&2){let e=g();Se("active",e.dipendente==null?null:e.dipendente.is_active)("inactive",!(e.dipendente!=null&&e.dipendente.is_active)),p(),R(" ",e.dipendente!=null&&e.dipendente.is_active?"Attivo":"Inattivo"," ")}}function nj(n,t){if(n&1){let e=k();c(0,"label",31)(1,"input",65),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.is_active,r)||(o.editWorkModel.is_active=r),S(r)}),l(),d(2," Attivo "),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.is_active)}}function ij(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),T(e.dipendente!=null&&e.dipendente.full_time?"Full-Time":"Part-Time")}}function rj(n,t){if(n&1){let e=k();c(0,"label",31)(1,"input",66),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.full_time,r)||(o.editWorkModel.full_time=r),S(r)}),l(),d(2," Full-Time "),l()}if(n&2){let e=g();p(),H("ngModel",e.editWorkModel.full_time)}}function oj(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g(2);R(" ",X(1,1,e.dipendente==null?null:e.dipendente.hire_date,"dd/MM/yyyy")," ")}}function sj(n,t){n&1&&d(0," Non specificata ")}function aj(n,t){if(n&1&&(c(0,"span",20),ee(1,oj,2,4)(2,sj,1,0),l()),n&2){let e=g();p(),te(e.dipendente!=null&&e.dipendente.hire_date?1:2)}}function lj(n,t){if(n&1){let e=k();c(0,"input",67),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.hire_date,r)||(o.editWorkModel.hire_date=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.hire_date)}}function cj(n,t){if(n&1&&(c(0,"span",20),d(1),l()),n&2){let e=g();p(),R("",(e.dipendente==null?null:e.dipendente.monthly_hours)||0," ore")}}function uj(n,t){if(n&1){let e=k();c(0,"input",68),W("ngModelChange",function(r){C(e);let o=g();return G(o.editWorkModel.monthly_hours,r)||(o.editWorkModel.monthly_hours=r),S(r)}),l()}if(n&2){let e=g();H("ngModel",e.editWorkModel.monthly_hours)}}function dj(n,t){if(n&1){let e=k();c(0,"div",34)(1,"button",44),x("click",function(){C(e);let r=g();return S(r.onSaveWorkInfo())}),d(2," Salva modifiche "),l(),c(3,"button",69),x("click",function(){C(e);let r=g();return S(r.cancelEditWorkInfo())}),d(4,"Annulla"),l()()}}function fj(n,t){n&1&&(c(0,"th"),d(1,"Azioni"),l())}function pj(n,t){if(n&1&&(d(0),Z(1,"date")),n&2){let e=g().$implicit;R(" ",X(1,1,e.end_ts,"HH:mm")," ")}}function hj(n,t){n&1&&d(0," In corso ")}function mj(n,t){if(n&1){let e=k();c(0,"td")(1,"div",71)(2,"button",72),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.modificaTimbratura(r))}),c(3,"span",4),d(4,"edit"),l()(),c(5,"button",72),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaTimbratura(r))}),c(6,"span",4),d(7,"delete"),l()()()()}}function gj(n,t){if(n&1&&(c(0,"tr")(1,"td"),d(2),Z(3,"date"),l(),c(4,"td"),d(5),Z(6,"date"),l(),c(7,"td"),ee(8,pj,2,4)(9,hj,1,0),l(),c(10,"td"),d(11),Z(12,"number"),l(),c(13,"td"),d(14),l(),c(15,"td",70),d(16),l(),ee(17,mj,8,0,"td"),l()),n&2){let e=t.$implicit,i=g();p(2),T(X(3,7,e.start_ts,"dd/MM/yyyy")),p(3),T(X(6,10,e.start_ts,"HH:mm")),p(3),te(e.end_ts?8:9),p(3),R("",X(12,13,e.total_minutes/60,"1.1-1")," ore"),p(3),T(e.breaks?"S\xEC":"No"),p(2),T(e.notes||"Nessuna"),p(),te(i.hasRole("admin")||i.hasRole("manager")?17:-1)}}function vj(n,t){n&1&&(c(0,"div",39)(1,"span",4),d(2,"schedule"),l(),c(3,"h3"),d(4,"Nessuna timbratura"),l(),c(5,"p"),d(6,"Non sono state trovate timbrature recenti per questo dipendente."),l()())}function _j(n,t){if(n&1&&(c(0,"div",42)(1,"div",73),P(2,"div",74),l(),c(3,"div",75),d(4),Z(5,"number"),l(),c(6,"div",76),d(7),l()()),n&2){let e=t.$implicit,i=g();p(2),vi("height",i.getAltezzaBarra(e.ore)+"%"),p(2),R("",X(5,4,e.ore,"1.1-1"),"h"),p(3),T(e.giorno)}}function yj(n,t){n&1&&(c(0,"div",43),P(1,"div",77),c(2,"p"),d(3,"Caricamento dettaglio dipendente..."),l()())}var wp=class n{constructor(t,e,i,r,o,s,a,u){this.route=t;this.router=e;this.dipendentiService=i;this.timbratureService=r;this.departmentsService=o;this.jobTitlesService=s;this.authService=a;this.companyService=u}isLoading=!0;dipendente=null;timbratureRecenti=[];statistiche={oreLavorate:0,giorniPresenti:0,mediaOreGiornaliere:0,puntualita:0};andamentoSettimanale=[];jobTitles=[];isLoadingJobTitles=!1;editWorkModel={};departments=[];editingDepartment=!1;messaggioSuccesso="";messaggioErrore="";editingWorkInfo=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){console.error("Dipendente non trovato: id mancante nella route"),this.router.navigate(["/dipendenti"]);return}this.authService.currentUser$.pipe(wt(1)).subscribe(e=>{if(!e){this.router.navigate(["/login"]);return}e.role==="manager"?this.companyService.getAziendaForUser(e.id,e.company_id).subscribe({next:i=>{if(!this.companyService.resolveManagerConfig(i,e.id).can_edit_employees){alert("Non hai i permessi per accedere al dettaglio dipendente. Contatta un amministratore."),this.router.navigate(["/dipendenti"]);return}this.loadDipendenteAndData(t)},error:i=>{console.warn("[DipendenteDettaglio] errore lettura azienda per permessi",i),this.router.navigate(["/dipendenti"])}}):this.loadDipendenteAndData(t)})}loadDipendenteAndData(t){this.isLoading=!0,this.dipendentiService.getDipendenteById(t).subscribe({next:e=>{e?(this.dipendente=e,this.dipendente?.company_id&&this.loadJobTitles(this.dipendente.company_id),this.caricaTimbratureRecenti(e.id),this.caricaStatistiche(e.id),this.caricaAndamentoSettimanale(e.id),this.caricaReparti()):(console.error("Dipendente non trovato",t),this.router.navigate(["/dipendenti"])),this.isLoading=!1},error:e=>{console.error("Errore caricamento dipendente",e),this.isLoading=!1,this.messaggioErrore="Errore nel caricamento del dipendente",this.nascondiMessaggioDopoTimeout()}})}caricaTimbratureRecenti(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t);console.debug("[DipendenteDettaglio] timbrature raw",e);let i=(Array.isArray(e)?e:[]).map(r=>Q(N({},r),{start_ts:r?.start_ts?new Date(r.start_ts):null,end_ts:r?.end_ts?new Date(r.end_ts):null,total_minutes:Number(r?.total_minutes)||0})).filter(r=>r&&r.start_ts);i.sort((r,o)=>o.start_ts.getTime()-r.start_ts.getTime()),this.timbratureRecenti=i.slice(0,10),console.debug("[DipendenteDettaglio] timbratureRecenti",this.timbratureRecenti)}catch(e){console.error("Errore nel caricamento delle timbrature",e),this.timbratureRecenti=[]}})}caricaStatistiche(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t);console.debug("[DipendenteDettaglio] timbrature raw",e),this.calcolaStatistiche(Array.isArray(e)?e:[])}catch(e){console.error("Errore nel caricamento delle statistiche",e),this.statistiche={oreLavorate:120.5,giorniPresenti:15,mediaOreGiornaliere:8,puntualita:.85}}})}calcolaStatistiche(t){let e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()+1,1),o=t.filter(u=>{if(!u?.start_ts)return!1;let f=new Date(u.start_ts);return f>=i&&f<r}),s=o.reduce((u,f)=>{let h=Number(f.total_minutes)||0;return u+h/60},0),a=new Set(o.map(u=>new Date(u.start_ts).toISOString().slice(0,10))).size;this.statistiche={oreLavorate:s,giorniPresenti:a,mediaOreGiornaliere:a>0?s/a:0,puntualita:this.statistiche.puntualita},console.debug("[DipendenteDettaglio] statistiche calcolate",this.statistiche,{timbratureMeseCount:o.length})}caricaAndamentoSettimanale(t){return y(this,null,function*(){try{let e=yield this.timbratureService.getTimbratureUtente(t),i=new Date,r=(i.getDay()+6)%7,o=new Date(i);o.setHours(0,0,0,0),o.setDate(o.getDate()-r);let s=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],a=[];for(let u=0;u<7;u++){let f=new Date(o);f.setDate(o.getDate()+u),f.setHours(0,0,0,0);let h=new Date(f);h.setDate(f.getDate()+1);let m=(Array.isArray(e)?e:[]).filter(b=>b&&b.start_ts).reduce((b,v)=>{try{let w=new Date(v.start_ts);if(w>=f&&w<h){let M=Number(v.total_minutes)||(v.end_ts?Math.round((new Date(v.end_ts).getTime()-w.getTime())/6e4):0);return b+(isFinite(M)?M:0)}}catch{}return b},0);a.push({giorno:s[u],ore:Math.round(m/60*10)/10})}this.andamentoSettimanale=a}catch(e){console.error("[DipendenteDettaglio] caricaAndamentoSettimanale error",e),this.andamentoSettimanale=[{giorno:"Lun",ore:0},{giorno:"Mar",ore:0},{giorno:"Mer",ore:0},{giorno:"Gio",ore:0},{giorno:"Ven",ore:0},{giorno:"Sab",ore:0},{giorno:"Dom",ore:0}]}})}caricaReparti(){this.dipendente?.company_id&&this.departmentsService.getDepartments(this.dipendente.company_id).subscribe({next:t=>{this.departments=t,this.editingWorkInfo&&(this.editWorkModel?.department_id===void 0||this.editWorkModel.department_id===null)&&(this.editWorkModel.department_id=this.dipendente?.department?.id??this.dipendente?.department_id??null)},error:t=>{console.error("Errore caricamento reparti",t)}})}saveWorkInfo(t){this.dipendente?.id&&(this.isLoading=!0,this.dipendentiService.updateUser(this.dipendente.id,t).subscribe({next:e=>{if(this.isLoading=!1,e){this.dipendente=e;let i=this.editWorkModel?.department_id??this.dipendente?.department?.id??null;if(i&&(!this.dipendente.department||!this.dipendente.department.id)){let r=Array.isArray(this.departments)?this.departments.find(o=>o&&o.id===i):void 0;r?this.dipendente.department={id:r.id,name:r.name}:this.dipendente?.company_id&&this.departmentsService.getDepartments(this.dipendente.company_id).subscribe({next:o=>{let s=Array.isArray(o)?o.find(a=>a&&a.id===i):void 0;s&&(this.dipendente.department={id:s.id,name:s.name})},error:o=>console.warn("[DipendenteDettaglio] errore fetch departments fallback",o)})}}this.messaggioSuccesso="Informazioni lavorative aggiornate",this.editingWorkInfo=!1,this.editingDepartment=!1,this.nascondiMessaggioDopoTimeout()},error:e=>{this.isLoading=!1,console.error("[DipendenteDettaglio] saveWorkInfo error",e),this.messaggioErrore="Errore durante il salvataggio",this.nascondiMessaggioDopoTimeout()}}))}cambiaReparto(t){this.saveWorkInfo({department_id:t||null})}nascondiMessaggioDopoTimeout(){setTimeout(()=>{this.messaggioSuccesso="",this.messaggioErrore=""},5e3)}getRuoloLabel(t){return t?{admin:"Amministratore",manager:"Manager",employee:"Dipendente"}[t]||t:"Dipendente"}getDifferenzaOre(){let t=this.dipendente?.monthly_hours||0;return(this.statistiche.oreLavorate||0)-t}getClasseDifferenzaOre(){return this.getDifferenzaOre()>=0?"positive":"negative"}getPercentualeCompletamento(){let t=this.dipendente?.monthly_hours||0,e=this.statistiche.oreLavorate||0;return t>0?e/t:0}getAltezzaBarra(t){let e=Math.max(...this.andamentoSettimanale.map(i=>i.ore));return e>0?t/e*100:0}modificaDipendente(){this.dipendente&&this.router.navigate(["/dipendenti",this.dipendente.id,"modifica"])}generaReport(){this.dipendente&&this.generaReportLocale()}generaReportLocale(){let t=`
      REPORT DIPENDENTE
      =================
      
      Nome: ${this.dipendente?.first_name} ${this.dipendente?.last_name}
      Email: ${this.dipendente?.email}
      Mansione: ${this.dipendente?.job_title}
      Reparto: ${this.dipendente?.department?.name||"Nessun reparto"}
      
      STATISTICHE MENSILI
      -------------------
      Ore lavorate: ${this.statistiche.oreLavorate}
      Giorni presenti: ${this.statistiche.giorniPresenti}
      Media ore/giorno: ${this.statistiche.mediaOreGiornaliere}
      Puntualit\xE0: ${(this.statistiche.puntualita*100).toFixed(1)}%
    `,e=new Blob([t],{type:"text/plain"}),i=window.URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download=`report_${this.dipendente?.first_name}_${this.dipendente?.last_name}.txt`,r.click(),window.URL.revokeObjectURL(i)}vediTutteTimbrature(){this.dipendente&&this.router.navigate(["/timbrature"],{queryParams:{dipendente:this.dipendente.id}})}modificaTimbratura(t){console.log("Modifica timbratura:",t),this.router.navigate(["/timbrature",t.id,"modifica"])}eliminaTimbratura(t){confirm("Sei sicuro di voler eliminare questa timbratura?")&&(console.log("Elimina timbratura:",t),this.timbratureRecenti=this.timbratureRecenti.filter(e=>e.id!==t.id))}hasRole(t){return t==="admin"}beginEditWorkInfo(){this.dipendente&&(this.editWorkModel={department_id:this.dipendente.department?.id??this.dipendente?.department_id??null,job_title_id:this.dipendente?.job_title_id??null,job_title:this.dipendente.job_title??null,role:this.dipendente.role??"employee",is_active:!!this.dipendente.is_active,full_time:!!this.dipendente.full_time,monthly_hours:typeof this.dipendente.monthly_hours=="number"?this.dipendente.monthly_hours:null,hire_date:this.dipendente?.hire_date??null,first_name:this.dipendente.first_name??null,last_name:this.dipendente.last_name??null,birth_place:this.dipendente.birth_place??null},this.editingWorkInfo=!0,this.editingDepartment=!0)}cancelEditWorkInfo(){this.editingWorkInfo=!1,this.editingDepartment=!1,this.editWorkModel={}}onSaveWorkInfo(){return y(this,null,function*(){if(this.dipendente?.id){this.isLoading=!0;try{if(this.editWorkModel.job_title_id==="__altro"&&(this.editWorkModel.job_title??"").trim())if(!this.hasRole("admin"))this.editWorkModel.job_title_id=null;else{if(!this.dipendente.company_id)throw new Error("Company id mancante, impossibile creare mansione");let s=yield this.jobTitlesService.createJobTitle(this.dipendente.company_id,{name:(this.editWorkModel.job_title??"").trim()});s?(this.jobTitles=[s,...this.jobTitles.filter(a=>a.id!==s.id)],this.editWorkModel.job_title_id=s.id):this.editWorkModel.job_title_id=null}let t=typeof this.editWorkModel.monthly_hours<"u"&&this.editWorkModel.monthly_hours!==null?Number(this.editWorkModel.monthly_hours):typeof this.dipendente.monthly_hours<"u"?this.dipendente.monthly_hours:null,e=this.editWorkModel.job_title_id==="__altro"?null:this.editWorkModel.job_title_id??this.dipendente?.job_title_id??null,i={department_id:typeof this.editWorkModel.department_id<"u"?this.editWorkModel.department_id:this.dipendente.department?.id??null,job_title_id:e,job_title:this.editWorkModel.job_title??this.dipendente.job_title??null,role:this.editWorkModel.role??this.dipendente.role??null,is_active:typeof this.editWorkModel.is_active<"u"?!!this.editWorkModel.is_active:!!this.dipendente.is_active,full_time:typeof this.editWorkModel.full_time<"u"?!!this.editWorkModel.full_time:!!this.dipendente.full_time,monthly_hours:t,hire_date:typeof this.editWorkModel.hire_date<"u"?this.editWorkModel.hire_date:this.dipendente?.hire_date??null,first_name:typeof this.editWorkModel.first_name<"u"?this.editWorkModel.first_name:this.dipendente.first_name??null,last_name:typeof this.editWorkModel.last_name<"u"?this.editWorkModel.last_name:this.dipendente.last_name??null,birth_place:typeof this.editWorkModel.birth_place<"u"?this.editWorkModel.birth_place:this.dipendente.birth_place??null};if(console.debug("[DipendenteDettaglio] onSaveWorkInfo payload",i),!confirm("Sei sicuro di voler salvare le modifiche al dipendente?")){console.debug("[DipendenteDettaglio] save cancelled by user"),this.isLoading=!1;return}let o=yield nt(this.dipendentiService.updateUser(this.dipendente.id,i));o&&(this.dipendente=o),i.first_name&&(this.dipendente.first_name=i.first_name),i.last_name&&(this.dipendente.last_name=i.last_name),i.birth_place&&(this.dipendente.birth_place=i.birth_place),i.hire_date&&(this.dipendente.hire_date=i.hire_date),this.editingWorkInfo=!1,this.editingDepartment=!1,this.messaggioSuccesso="Informazioni salvate",this.nascondiMessaggioDopoTimeout()}catch(t){console.error("[DipendenteDettaglio] onSaveWorkInfo error",t),this.messaggioErrore="Errore salvataggio: "+(t?.message||JSON.stringify(t))}finally{this.isLoading=!1}}})}getDepartmentName(){let t=this.dipendente?.department?.name;if(t)return t;let e=this.editWorkModel?.department_id??this.dipendente?.department_id??this.dipendente?.department?.id??null;if(!e)return"Nessun reparto assegnato";if(Array.isArray(this.departments)){let i=this.departments.find(r=>r&&r.id===e);if(i?.name)return i.name}return"Nessun reparto assegnato"}loadJobTitles(t){if(!t){this.jobTitles=[];return}this.isLoadingJobTitles=!0,this.jobTitlesService.getJobTitles(t).subscribe({next:e=>{this.jobTitles=Array.isArray(e)?e.filter(i=>i):[],this.isLoadingJobTitles=!1},error:e=>{console.error("[DipendenteDettaglio] loadJobTitles",e),this.jobTitles=[],this.isLoadingJobTitles=!1}})}static \u0275fac=function(e){return new(e||n)(D($t),D(Ie),D(Ot),D(Nt),D(Nr),D(sa),D(le),D(et))};static \u0275cmp=we({type:n,selectors:[["app-dipendente-dettaglio"]],decls:248,vars:50,consts:[["workForm","ngForm"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],["routerLink","/dipendenti",1,"link"],[1,"actions-container"],["class","status-message info",4,"ngIf"],["class","status-message error",4,"ngIf"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-content"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],["name","first_name","type","text",1,"form-control",3,"ngModel"],["name","last_name","type","text",1,"form-control",3,"ngModel"],["name","birth_place","type","text",1,"form-control",3,"ngModel"],["title","Modifica informazioni e reparto",1,"icon-button"],[2,"display","flex","gap","8px","align-items","center","width","100%"],["novalidate",""],[2,"display","flex","gap","8px","align-items","center"],[1,"chip",3,"class"],["name","role",1,"form-control",3,"ngModel"],[1,"chip",3,"active","inactive"],[2,"display","inline-flex","align-items","center","gap","8px"],["name","hire_date","type","date",1,"form-control",3,"ngModel"],["name","monthly_hours","type","number",1,"form-control",2,"width","140px",3,"ngModel"],[1,"form-actions",2,"margin-top","12px"],[1,"form-section"],[1,"promethea-button","outline",3,"click"],[1,"table-container"],[1,"crm-table"],[1,"empty-state"],[1,"chart-container"],[1,"chart-bars"],[1,"chart-bar"],[1,"loading-container"],[1,"promethea-button",3,"click"],[1,"status-message","info"],[1,"status-message","error"],["name","first_name","type","text",1,"form-control",3,"ngModelChange","ngModel"],["name","last_name","type","text",1,"form-control",3,"ngModelChange","ngModel"],["name","birth_place","type","text",1,"form-control",3,"ngModelChange","ngModel"],["title","Modifica informazioni e reparto",1,"icon-button",3,"click"],["name","department_id",1,"form-control",2,"min-width","240px",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["name","job_title_id",1,"form-control",2,"min-width","240px",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],["value","__altro"],[4,"ngIf"],[3,"value","disabled"],["name","job_title","type","text","placeholder","Inserisci mansione",1,"form-control",3,"ngModelChange","ngModel"],[1,"chip"],["name","role",1,"form-control",3,"ngModelChange","ngModel"],["value","employee"],["value","manager"],["value","admin"],["name","is_active","type","checkbox",3,"ngModelChange","ngModel"],["name","full_time","type","checkbox",3,"ngModelChange","ngModel"],["name","hire_date","type","date",1,"form-control",3,"ngModelChange","ngModel"],["name","monthly_hours","type","number",1,"form-control",2,"width","140px",3,"ngModelChange","ngModel"],[1,"promethea-button","ghost",3,"click"],[1,"notes-preview"],[1,"action-buttons"],[1,"icon-button",3,"click"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"bar-label"],[1,"loading-spinner"]],template:function(e,i){if(e&1){let r=k();c(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),d(4,"person"),l()(),c(5,"div",5)(6,"h1",6),d(7),l(),c(8,"p",7)(9,"a",8),d(10,"Dipendenti"),l(),d(11," / Dettaglio dipendente "),l()(),ee(12,PL,5,0,"div",9),l(),E(13,kL,4,1,"div",10)(14,FL,4,1,"div",11),c(15,"div",12)(16,"div",13)(17,"div",14)(18,"span",4),d(19,"badge"),l(),c(20,"h2",15),d(21,"Informazioni Personali"),l()(),c(22,"div",16)(23,"div",17)(24,"span",4),d(25,"badge"),l(),c(26,"div",18)(27,"span",19),d(28,"Nome"),l(),ee(29,LL,2,1,"span",20)(30,jL,1,1,"input",21),l()(),c(31,"div",17)(32,"span",4),d(33,"badge"),l(),c(34,"div",18)(35,"span",19),d(36,"Cognome"),l(),ee(37,VL,2,1,"span",20)(38,zL,1,1,"input",22),l()(),c(39,"div",17)(40,"span",4),d(41,"email"),l(),c(42,"div",18)(43,"span",19),d(44,"Email"),l(),c(45,"span",20),d(46),l()()(),c(47,"div",17)(48,"span",4),d(49,"phone"),l(),c(50,"div",18)(51,"span",19),d(52,"Telefono"),l(),c(53,"span",20),d(54),l()()(),c(55,"div",17)(56,"span",4),d(57,"cake"),l(),c(58,"div",18)(59,"span",19),d(60,"Data di Nascita"),l(),c(61,"span",20),ee(62,UL,2,4)(63,BL,1,0),l()()(),c(64,"div",17)(65,"span",4),d(66,"place"),l(),c(67,"div",18)(68,"span",19),d(69,"Luogo di Nascita"),l(),ee(70,$L,2,1,"span",20)(71,HL,1,1,"input",23),l()(),c(72,"div",17)(73,"span",4),d(74,"fingerprint"),l(),c(75,"div",18)(76,"span",19),d(77,"Codice Fiscale"),l(),c(78,"span",20),d(79),l()()()()(),c(80,"div",13)(81,"div",14)(82,"span",4),d(83,"work"),l(),c(84,"h2",15),d(85,"Informazioni Lavorative"),l(),ee(86,WL,3,0,"button",24),l(),c(87,"div",16)(88,"div",17)(89,"span",4),d(90,"groups"),l(),c(91,"div",18)(92,"span",19),d(93,"Reparto"),l(),ee(94,GL,2,1,"span",20)(95,JL,6,1,"div",25),l()(),c(96,"form",26,0)(98,"div",17)(99,"span",4),d(100,"business_center"),l(),c(101,"div",18)(102,"span",19),d(103,"Mansione"),l(),ee(104,KL,2,1,"span",20)(105,QL,8,3,"div",27),l()(),c(106,"div",17)(107,"span",4),d(108,"admin_panel_settings"),l(),c(109,"div",18)(110,"span",19),d(111,"Ruolo"),l(),ee(112,XL,2,3,"span",28)(113,ej,7,1,"select",29),l()(),c(114,"div",17)(115,"span",4),d(116,"toggle_on"),l(),c(117,"div",18)(118,"span",19),d(119,"Stato"),l(),ee(120,tj,2,5,"span",30)(121,nj,3,1,"label",31),l()(),c(122,"div",17)(123,"span",4),d(124,"schedule"),l(),c(125,"div",18)(126,"span",19),d(127,"Tipo di Contratto"),l(),ee(128,ij,2,1,"span",20)(129,rj,3,1,"label",31),l()(),c(130,"div",17)(131,"span",4),d(132,"work_outline"),l(),c(133,"div",18)(134,"span",19),d(135,"Data di Assunzione"),l(),ee(136,aj,3,1,"span",20)(137,lj,1,1,"input",32),l()(),c(138,"div",17)(139,"span",4),d(140,"av_timer"),l(),c(141,"div",18)(142,"span",19),d(143,"Ore Mensili Previste"),l(),ee(144,cj,2,1,"span",20)(145,uj,1,1,"input",33),l()(),ee(146,dj,5,0,"div",34),l()()(),c(147,"div",13)(148,"div",14)(149,"span",4),d(150,"insights"),l(),c(151,"h2",15),d(152,"Statistiche Mese Corrente"),l()(),c(153,"div",16)(154,"div",17)(155,"span",19),d(156,"Ore Lavorate"),l(),c(157,"span",20),d(158),Z(159,"number"),l()(),c(160,"div",17)(161,"span",19),d(162,"Giorni Presenti"),l(),c(163,"span",20),d(164),l()(),c(165,"div",17)(166,"span",19),d(167,"Media Ore Giornaliere"),l(),c(168,"span",20),d(169),Z(170,"number"),l()(),c(171,"div",17)(172,"span",19),d(173,"Puntualit\xE0"),l(),c(174,"span",20),d(175),Z(176,"percent"),l()()()(),c(177,"div",13)(178,"div",14)(179,"span",4),d(180,"calendar_today"),l(),c(181,"h2",15),d(182,"Riepilogo Presenze"),l()(),c(183,"div",16)(184,"div",17)(185,"span",19),d(186,"Ore Previste"),l(),c(187,"span",20),d(188),l()(),c(189,"div",17)(190,"span",19),d(191,"Ore Raggiunte"),l(),c(192,"span",20),d(193),Z(194,"number"),l()(),c(195,"div",17)(196,"span",19),d(197,"Differenza"),l(),c(198,"span",20),d(199),Z(200,"number"),l()(),c(201,"div",17)(202,"span",19),d(203,"Progresso"),l(),c(204,"span",20),d(205),Z(206,"percent"),l()()()()(),c(207,"div",35)(208,"div",2)(209,"h2",6)(210,"span",4),d(211,"schedule"),l(),d(212," Timbrature Recenti "),l(),c(213,"button",36),x("click",function(){return C(r),S(i.vediTutteTimbrature())}),c(214,"span",4),d(215,"list"),l(),d(216," Vedi Tutte "),l()(),c(217,"div",37)(218,"table",38)(219,"thead")(220,"tr")(221,"th"),d(222,"Data"),l(),c(223,"th"),d(224,"Ingresso"),l(),c(225,"th"),d(226,"Uscita"),l(),c(227,"th"),d(228,"Ore Totali"),l(),c(229,"th"),d(230,"Pause"),l(),c(231,"th"),d(232,"Note"),l(),ee(233,fj,2,0,"th"),l()(),c(234,"tbody"),It(235,gj,18,16,"tr",null,Sx),l()()(),ee(237,vj,7,0,"div",39),l(),c(238,"div",35)(239,"h2",6)(240,"span",4),d(241,"bar_chart"),l(),d(242," Andamento Settimanale "),l(),c(243,"div",40)(244,"div",41),It(245,_j,8,7,"div",42,NL),l()()(),ee(247,yj,4,0,"div",43),l()}e&2&&(p(7),ve("",i.dipendente==null?null:i.dipendente.first_name," ",i.dipendente==null?null:i.dipendente.last_name),p(5),te(i.hasRole("admin")||i.hasRole("manager")?12:-1),p(),_("ngIf",i.messaggioSuccesso),p(),_("ngIf",i.messaggioErrore),p(15),te(i.editingWorkInfo?30:29),p(8),te(i.editingWorkInfo?38:37),p(9),T(i.dipendente==null?null:i.dipendente.email),p(8),T((i.dipendente==null?null:i.dipendente.phone)||"Non specificato"),p(8),te(i.dipendente!=null&&i.dipendente.birth_date?62:63),p(8),te(i.editingWorkInfo?71:70),p(9),T((i.dipendente==null?null:i.dipendente.fiscal_code)||"Non specificato"),p(7),te(i.hasRole("admin")?86:-1),p(8),te(i.editingDepartment?95:94),p(10),te(i.editingWorkInfo?105:104),p(8),te(i.editingWorkInfo?113:112),p(8),te(i.editingWorkInfo?121:120),p(8),te(i.editingWorkInfo?129:128),p(8),te(i.editingWorkInfo?137:136),p(8),te(i.editingWorkInfo?145:144),p(2),te(i.editingWorkInfo?146:-1),p(12),R("",X(159,34,i.statistiche.oreLavorate,"1.1-1")," ore"),p(6),R("",i.statistiche.giorniPresenti," giorni"),p(5),R("",X(170,37,i.statistiche.mediaOreGiornaliere,"1.1-1")," ore"),p(6),T(Ji(176,40,i.statistiche.puntualita)),p(13),R("",(i.dipendente==null?null:i.dipendente.monthly_hours)||0," ore"),p(5),R("",X(194,42,i.statistiche.oreLavorate,"1.1-1")," ore"),p(5),br(i.getClasseDifferenzaOre()),p(),R(" ",X(200,45,i.getDifferenzaOre(),"1.1-1")," ore "),p(6),T(Ji(206,48,i.getPercentualeCompletamento())),p(28),te(i.hasRole("admin")||i.hasRole("manager")?233:-1),p(2),Tt(i.timbratureRecenti),p(2),te(i.timbratureRecenti.length===0?237:-1),p(8),Tt(i.andamentoSettimanale),p(2),te(i.isLoading?247:-1))},dependencies:[Ee,Be,xe,jt,Ht,Rt,Ln,Wt,Gt,Re,Wl,bo,At,Fe,Fn,yt,av,tn,ll,lt],styles:["[_ngcontent-%COMP%]:root{--dip-card-min: 500px}.grid-cards[_ngcontent-%COMP%]{gap:var(--gutter-lg);grid-template-columns:repeat(auto-fit,minmax(var(--dip-card-min),1fr));max-width:calc((var(--dip-card-min) * 2) + var(--gutter-lg));width:100%;margin-left:auto;margin-right:auto;box-sizing:border-box}.grid-cards[_ngcontent-%COMP%] > .card[_ngcontent-%COMP%]{width:100%;max-width:none;box-sizing:border-box}"]})};var aa=class n{constructor(t,e){this.http=t;this.authService=e}baseUrl="/api/reports";generaReportTimbrature(t,e="xlsx"){let i=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/timbrature`,Q(N({},t),{format:e}),{headers:i,responseType:"blob"})}esportaPDF(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/export/pdf`,t,{headers:e,responseType:"blob"})}esportaExcel(t){let e=this.authService.getAuthHeaders();return this.http.post(`${this.baseUrl}/export/excel`,t,{headers:e,responseType:"blob"})}generaReportKPI(t){return this.http.post(`${this.baseUrl}/kpi`,t,{responseType:"blob"})}static \u0275fac=function(e){return new(e||n)(z(bi),z(le))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};function bj(n,t){n&1&&P(0,"app-loading-spinner")}function wj(n,t){if(n&1&&(c(0,"option",42),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),ve("",e.first_name," ",e.last_name)}}function Ej(n,t){if(n&1){let e=k();Ze(0),c(1,"select",13),W("ngModelChange",function(r){C(e);let o=g();return G(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onFiltroChange())}),c(2,"option",20),d(3,"Tutti i dipendenti"),l(),E(4,wj,2,3,"option",21),l(),Qe()}if(n&2){let e=g();p(),H("ngModel",e.filtroDipendente),p(3),_("ngForOf",e.dipendenti)}}function Cj(n,t){if(n&1){let e=k();c(0,"div",43),d(1),l(),c(2,"input",44),W("ngModelChange",function(r){C(e);let o=g();return G(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),l()}if(n&2){let e=g();p(),ve(" ",e.currentUser==null?null:e.currentUser.first_name," ",e.currentUser==null?null:e.currentUser.last_name," "),p(),H("ngModel",e.filtroDipendente)}}function Sj(n,t){if(n&1&&(c(0,"option",42),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),T(e.name)}}function xj(n,t){if(n&1&&(c(0,"div",45)(1,"div",46),P(2,"div",47),l(),c(3,"div",48),d(4),Z(5,"number"),l(),c(6,"div",49),d(7),l()()),n&2){let e=t.$implicit,i=g();p(2),vi("height",i.getAltezzaBarra(e.ore)+"%"),p(2),R("",X(5,4,e.ore,"1.0-1"),"h"),p(3),T(e.nome)}}function Dj(n,t){if(n&1&&(c(0,"div",50)(1,"span",51),d(2),l(),c(3,"span",52),d(4),Z(5,"percent"),l()()),n&2){let e=t.$implicit;p(2),T(e.fascia),p(2),T(Ji(5,2,e.percentuale))}}function Ij(n,t){if(n&1&&(c(0,"tr")(1,"td")(2,"div",53)(3,"div",54),d(4),l(),c(5,"div",55)(6,"strong"),d(7),l()()()(),c(8,"td"),d(9),Z(10,"number"),l(),c(11,"td"),d(12),Z(13,"number"),l(),c(14,"td"),d(15),l(),c(16,"td"),d(17),Z(18,"percent"),l(),c(19,"td")(20,"span",56),d(21),l()()()),n&2){let e=t.$implicit;p(4),R(" ",e.nome.charAt(0)," "),p(3),T(e.nome),p(2),R("",X(10,12,e.oreTotali,"1.1-1"),"h"),p(3),R("",X(13,15,e.oreMedieGiorno,"1.1-1"),"h"),p(3),ve("",e.giorniPresente,"/",e.giorniTotali),p(2),T(Ji(18,18,e.puntualita)),p(3),Se("active",e.attivo)("inactive",!e.attivo),p(),R(" ",e.attivo?"Attivo":"Inattivo"," ")}}function Tj(n,t){if(n&1&&(c(0,"div",50)(1,"span",51),d(2),l(),c(3,"span",52),d(4),Z(5,"number"),l()()),n&2){let e=t.$implicit;p(2),T(e.giorno),p(2),R("",X(5,2,e.ore,"1.1-1"),"h")}}function Mj(n,t){if(n&1&&(c(0,"div",57)(1,"span",5),d(2,"info"),l(),c(3,"div",58)(4,"span",59),d(5),l(),c(6,"span",60),d(7),l(),c(8,"span",61),d(9),Z(10,"date"),l()()()),n&2){let e=t.$implicit;p(5),T(e.tipo),p(2),T(e.descrizione),p(2),ve("",e.dipendente," - ",Ji(10,4,e.data))}}function Aj(n,t){n&1&&(c(0,"div",62)(1,"span",5),d(2,"check_circle"),l(),c(3,"h3"),d(4,"Nessuna anomalia"),l(),c(5,"p"),d(6,"Non sono state rilevate anomalie nelle timbrature"),l()())}var Ep=class n{constructor(t,e,i,r,o){this.timbratureService=t;this.dipendentiService=e;this.reportsService=i;this.authService=r;this.departmentsService=o}isLoading=!0;filtroPeriodo="mese";filtroDipendente="tutti";filtroReparto="tutti";kpi={oreTotali:0,presenzeMedie:0,oreMediePerDipendente:0,tassoPuntualita:0};orePerDipendente=[];performanceDipendenti=[];distribuzioneOrari=[];andamentoSettimanale=[];anomalie=[];dipendenti=[];reparti=[];currentUser=null;ngOnInit(){return y(this,null,function*(){let t=this.authService.currentUserSubject?.value??null;if(t){let i=t;this.currentUser=i,i.role==="employee"&&(this.filtroDipendente=i.id,this.dipendenti=[{id:i.id,first_name:i.first_name,last_name:i.last_name}]),yield this.caricaReparti(),yield this.caricaDipendenti(),yield this.caricaKPI();return}let e=this.authService.currentUserSubject?.subscribe?.(i=>y(this,null,function*(){if(!i)return;let r=i;this.currentUser=r,r.role==="employee"&&(this.filtroDipendente=r.id,this.dipendenti=[{id:r.id,first_name:r.first_name,last_name:r.last_name}]);try{yield this.caricaReparti(),yield this.caricaDipendenti(),yield this.caricaKPI()}finally{try{e.unsubscribe()}catch{}}}))})}caricaReparti(){return y(this,null,function*(){try{let t=this.currentUser?.company_id??null;if(!t){this.reparti=[];return}let e=yield Zc(this.departmentsService.getDepartments(t));this.reparti=Array.isArray(e)?e:[]}catch(t){console.error("[KPI] caricaReparti error",t),this.reparti=[]}})}getDateRange(t){let e=new Date,i=new Date(e),r=new Date(e);switch(t){case"oggi":i.setHours(0,0,0,0),r=new Date(i),r.setDate(r.getDate()+1);break;case"settimana":let o=(e.getDay()+6)%7;i.setDate(e.getDate()-o),i.setHours(0,0,0,0),r=new Date(i),r.setDate(i.getDate()+7);break;case"trimestre":i.setMonth(e.getMonth()-3),i.setHours(0,0,0,0),r=new Date(e),r.setHours(23,59,59,999);break;case"mese":default:i.setDate(1),i.setHours(0,0,0,0),r=new Date(i.getFullYear(),i.getMonth()+1,1);break}return{start:i,end:r}}caricaDipendenti(){return y(this,null,function*(){try{let t=this.currentUser?.company_id??null;if(!t){this.dipendenti=[];return}let e=yield Zc(this.dipendentiService.getDipendenti(t));this.dipendenti=e??[]}catch(t){console.error("Errore nel caricamento dei dipendenti",t),this.dipendenti=[]}})}caricaKPI(){return y(this,null,function*(){this.isLoading=!0;try{let t=this.currentUser?.company_id??null,e=[];this.currentUser?.role==="employee"?e=yield this.timbratureService.getTimbratureUtente(this.currentUser.id):t?e=yield this.timbratureService.getTimbratureAzienda(t):e=[];let i=B=>!this.filtroReparto||this.filtroReparto==="tutti"?B:B.filter(q=>q.department_id===this.filtroReparto),r=B=>!this.filtroDipendente||this.filtroDipendente==="tutti"?B:B.filter(q=>q.user_id===this.filtroDipendente),o=this.getDateRange(this.filtroPeriodo),s=o.start.getTime(),a=o.end.getTime(),u=B=>{if(!B?.start_ts)return!1;let q=new Date(B.start_ts).getTime();return q>=s&&q<a},f=r(i(e)).filter(u),h=f.reduce((B,q)=>B+(Number(q.total_minutes)||0),0);this.kpi.oreTotali=Math.round(h/60*10)/10;let m=[];for(let B=new Date(o.start);B<o.end;B.setDate(B.getDate()+1))m.push(new Date(B));let b=m.map(B=>{let q=new Date(B);q.setHours(0,0,0,0);let he=new Date(q);return he.setDate(he.getDate()+1),new Set(f.filter(ht=>{let Oi=new Date(ht.start_ts);return Oi>=q&&Oi<he}).map(ht=>ht.user_id)).size}),v=b.length||1;this.kpi.presenzeMedie=Math.round(b.reduce((B,q)=>B+q,0)/v*10)/10;let w={},M={},I=0;f.forEach(B=>{let q=B.user_id??"unknown",he=Number(B.total_minutes)||0;w[q]=(w[q]||0)+he;let Ve=new Date(B.start_ts).toISOString().slice(0,10);M[q]=M[q]||new Set,M[q].add(Ve);try{new Date(B.start_ts).getHours()<=9&&I++}catch{}});let A=(this.dipendenti||[]).reduce((B,q)=>(B[q.id]=q,B),{});this.orePerDipendente=Object.keys(w).map(B=>({nome:A[B]?`${A[B].first_name} ${A[B].last_name}`:B||"Utente",ore:Math.round(w[B]/60*10)/10})).sort((B,q)=>q.ore-B.ore),this.performanceDipendenti=Object.keys(w).map(B=>{let q=w[B],he=M[B]?M[B].size:0,Ve=Math.round(q/60*10)/10;return{nome:A[B]?`${A[B].first_name} ${A[B].last_name}`:B||"Utente",oreTotali:Ve,oreMedieGiorno:he>0?Math.round(Ve/he*10)/10:0,giorniPresente:he,giorniTotali:m.length,puntualita:0,attivo:!!(A[B]?.is_active??!0)}});let j=this.filtroDipendente&&this.filtroDipendente!=="tutti"?1:(this.dipendenti||[]).length||1;this.kpi.oreMediePerDipendente=Math.round(this.kpi.oreTotali/j*10)/10,this.kpi.tassoPuntualita=f.length>0?Math.round(I/f.length*100)/100:0;let V={before8:0,b8_830:0,b830_9:0,after9:0};f.forEach(B=>{try{let q=new Date(B.start_ts),he=q.getHours()*60+q.getMinutes();he<480?V.before8++:he<510?V.b8_830++:he<540?V.b830_9++:V.after9++}catch{}});let L=f.length||1;this.distribuzioneOrari=[{fascia:"Prima delle 8:00",percentuale:Math.round(V.before8/L*100)/100},{fascia:"8:00 - 8:30",percentuale:Math.round(V.b8_830/L*100)/100},{fascia:"8:30 - 9:00",percentuale:Math.round(V.b830_9/L*100)/100},{fascia:"Dopo le 9:00",percentuale:Math.round(V.after9/L*100)/100}];let se=[];for(let B=6;B>=0;B--){let q=new Date;q.setHours(0,0,0,0),q.setDate(q.getDate()-B);let he=new Date(q),Ve=new Date(q);Ve.setDate(Ve.getDate()+1);let ht=f.reduce((Oi,Pr)=>{let jo=new Date(Pr.start_ts);return jo>=he&&jo<Ve?Oi+(Number(Pr.total_minutes)||0):Oi},0);se.push({giorno:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"][q.getDay()===0?6:q.getDay()-1],ore:Math.round(ht/60*10)/10})}this.andamentoSettimanale=se,this.anomalie=f.filter(B=>!B.end_ts||Number(B.total_minutes)<=0).map(B=>({tipo:B.end_ts?"Durata sospetta":"Uscita mancante",descrizione:B.end_ts?"Durata <= 0":"Uscita non registrata",dipendente:A[B.user_id]?`${A[B.user_id].first_name} ${A[B.user_id].last_name}`:B.user_id||"Utente",data:new Date(B.start_ts)}))}catch(t){console.error("Errore nel caricamento dei KPI",t)}finally{this.isLoading=!1}})}getAltezzaBarra(t){let e=Math.max(...this.orePerDipendente.map(i=>i.ore));return e>0?t/e*100:0}onFiltroChange(){this.caricaKPI()}aggiornaDati(){return y(this,null,function*(){yield this.caricaKPI()})}esportaReport(){return y(this,null,function*(){try{yield this.reportsService.generaReportKPI({periodo:this.filtroPeriodo,dipendente:this.filtroDipendente,reparto:this.filtroReparto}).toPromise(),alert("Report KPI esportato con successo!")}catch(t){console.error("Errore nell'esportazione del report",t),alert("Errore nell'esportazione del report")}})}simulaCaricamentoDati(){return new Promise(t=>setTimeout(()=>t(),300))}static \u0275fac=function(e){return new(e||n)(D(Nt),D(Ot),D(aa),D(le),D(Nr))};static \u0275cmp=we({type:n,selectors:[["app-kpi"]],decls:154,vars:27,consts:[["selfOnly",""],[4,"ngIf"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],[3,"ngModelChange","change","ngModel"],["value","oggi"],["value","settimana"],["value","mese"],["value","trimestre"],[4,"ngIf","ngIfElse"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value","tutti"],[3,"value",4,"ngFor","ngForOf"],[1,"actions-container"],[1,"promethea-button","outline",3,"click"],[1,"promethea-button",3,"click"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"card-content"],[1,"chart-container"],[1,"chart-bars"],["class","chart-bar",4,"ngFor","ngForOf"],[1,"hours-grid"],["class","hour-item",4,"ngFor","ngForOf"],[1,"form-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","info-item",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[3,"value"],[1,"readonly-field"],["type","hidden",3,"ngModelChange","ngModel"],[1,"chart-bar"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"bar-label"],[1,"hour-item"],[1,"day-label"],[1,"hour-value"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"],[1,"chip"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],[1,"info-detail"],[1,"empty-state"]],template:function(e,i){if(e&1){let r=k();E(0,bj,1,0,"app-loading-spinner",1),c(1,"div",2)(2,"div",3)(3,"div",4)(4,"span",5),d(5,"insights"),l()(),c(6,"div",6)(7,"h1",7),d(8,"Key Performance Indicators"),l(),c(9,"p",8),d(10,"Metriche e statistiche sulle timbrature"),l()()(),c(11,"div",9)(12,"div",10)(13,"div",11)(14,"label",12),d(15,"Periodo"),l(),c(16,"select",13),W("ngModelChange",function(s){return C(r),G(i.filtroPeriodo,s)||(i.filtroPeriodo=s),S(s)}),x("change",function(){return C(r),S(i.onFiltroChange())}),c(17,"option",14),d(18,"Oggi"),l(),c(19,"option",15),d(20,"Questa Settimana"),l(),c(21,"option",16),d(22,"Questo Mese"),l(),c(23,"option",17),d(24,"Questo Trimestre"),l()()(),c(25,"div",11)(26,"label",12),d(27,"Dipendente"),l(),E(28,Ej,5,2,"ng-container",18)(29,Cj,3,3,"ng-template",null,0,wn),l(),c(31,"div",11)(32,"label",12),d(33,"Reparto"),l(),c(34,"select",19),W("ngModelChange",function(s){return C(r),G(i.filtroReparto,s)||(i.filtroReparto=s),S(s)}),x("change",function(){return C(r),S(i.onFiltroChange())}),c(35,"option",20),d(36,"Tutti"),l(),E(37,Sj,2,2,"option",21),l()()(),c(38,"div",22)(39,"button",23),x("click",function(){return C(r),S(i.esportaReport())}),c(40,"span",5),d(41,"download"),l(),d(42," Esporta Report "),l(),c(43,"button",24),x("click",function(){return C(r),S(i.aggiornaDati())}),c(44,"span",5),d(45,"refresh"),l(),d(46," Aggiorna "),l()()(),c(47,"div",25)(48,"div",26)(49,"div",27)(50,"span",5),d(51,"schedule"),l(),c(52,"h3",28),d(53,"Ore Totali Lavorate"),l()(),c(54,"div",29),d(55),Z(56,"number"),l(),c(57,"p",8),d(58,"Nel periodo selezionato"),l()(),c(59,"div",26)(60,"div",27)(61,"span",5),d(62,"groups"),l(),c(63,"h3",28),d(64,"Presenze Medie"),l()(),c(65,"div",29),d(66),Z(67,"number"),l(),c(68,"p",8),d(69,"Dipendenti per giorno"),l()(),c(70,"div",26)(71,"div",27)(72,"span",5),d(73,"timelapse"),l(),c(74,"h3",28),d(75,"Ore Medie per Dip."),l()(),c(76,"div",29),d(77),Z(78,"number"),l(),c(79,"p",8),d(80,"Per dipendente"),l()(),c(81,"div",26)(82,"div",27)(83,"span",5),d(84,"access_time"),l(),c(85,"h3",28),d(86,"Puntualit\xE0"),l()(),c(87,"div",29),d(88),Z(89,"percent"),l(),c(90,"p",8),d(91,"Ingressi in orario"),l()()(),c(92,"div",25)(93,"div",26)(94,"div",27)(95,"span",5),d(96,"bar_chart"),l(),c(97,"h3",28),d(98,"Ore per Dipendente"),l()(),c(99,"div",30)(100,"div",31)(101,"div",32),E(102,xj,8,7,"div",33),l()()()(),c(103,"div",26)(104,"div",27)(105,"span",5),d(106,"pie_chart"),l(),c(107,"h3",28),d(108,"Distribuzione Orari"),l()(),c(109,"div",30)(110,"div",34),E(111,Dj,6,4,"div",35),l()()()(),c(112,"div",36)(113,"h2",7)(114,"span",5),d(115,"leaderboard"),l(),d(116," Performance Dipendenti "),l(),c(117,"div",37)(118,"table",38)(119,"thead")(120,"tr")(121,"th"),d(122,"Dipendente"),l(),c(123,"th"),d(124,"Ore Totali"),l(),c(125,"th"),d(126,"Ore Medie/Giorno"),l(),c(127,"th"),d(128,"Giorni Presente"),l(),c(129,"th"),d(130,"Puntualit\xE0"),l(),c(131,"th"),d(132,"Status"),l()()(),c(133,"tbody"),E(134,Ij,22,20,"tr",39),l()()()(),c(135,"div",25)(136,"div",26)(137,"div",27)(138,"span",5),d(139,"trending_up"),l(),c(140,"h3",28),d(141,"Andamento Settimanale"),l()(),c(142,"div",30)(143,"div",34),E(144,Tj,6,5,"div",35),l()()(),c(145,"div",26)(146,"div",27)(147,"span",5),d(148,"warning"),l(),c(149,"h3",28),d(150,"Anomalie Rilevate"),l()(),c(151,"div",30),E(152,Mj,11,6,"div",40)(153,Aj,7,0,"div",41),l()()()()}if(e&2){let r=en(30);_("ngIf",i.isLoading),p(16),H("ngModel",i.filtroPeriodo),p(12),_("ngIf",(i.currentUser==null?null:i.currentUser.role)!=="employee")("ngIfElse",r),p(6),H("ngModel",i.filtroReparto),p(3),_("ngForOf",i.reparti),p(18),R("",X(56,16,i.kpi.oreTotali,"1.0-1"),"h"),p(11),T(X(67,19,i.kpi.presenzeMedie,"1.0-1")),p(11),R("",X(78,22,i.kpi.oreMediePerDipendente,"1.0-1"),"h"),p(11),T(Ji(89,25,i.kpi.tassoPuntualita)),p(14),_("ngForOf",i.orePerDipendente),p(9),_("ngForOf",i.distribuzioneOrari),p(23),_("ngForOf",i.performanceDipendenti),p(10),_("ngForOf",i.andamentoSettimanale),p(8),_("ngForOf",i.anomalie),p(),_("ngIf",i.anomalie.length===0)}},dependencies:[Rt,Wt,Gt,Re,At,Fe,yt,Ee,Be,xe,$n,tn,ll,lt],encapsulation:2})};var ln=()=>({standalone:!0});function Rj(n,t){n&1&&(c(0,"div",53),d(1," Nome obbligatorio "),l())}function Oj(n,t){n&1&&(c(0,"div",53),d(1," Cognome obbligatorio "),l())}function Nj(n,t){n&1&&(c(0,"div",53),d(1," Email obbligatoria e valida "),l())}function Pj(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function kj(n,t){n&1&&P(0,"span",54)}function Fj(n,t){if(n&1){let e=k();c(0,"div")(1,"form",16),x("ngSubmit",function(){C(e);let r=g();return S(r.salvaProfilo())}),c(2,"div",17)(3,"div",18)(4,"label",19)(5,"span",6),d(6,"badge"),l(),d(7," Nome * "),l(),P(8,"input",36),E(9,Rj,2,0,"div",37),l(),c(10,"div",18)(11,"label",19)(12,"span",6),d(13,"badge"),l(),d(14," Cognome * "),l(),P(15,"input",38),E(16,Oj,2,0,"div",37),l(),c(17,"div",18)(18,"label",19)(19,"span",6),d(20,"email"),l(),d(21," Email * "),l(),P(22,"input",39),E(23,Nj,2,0,"div",37),l(),c(24,"div",18)(25,"label",19)(26,"span",6),d(27,"phone"),l(),d(28," Telefono "),l(),P(29,"input",40),l(),c(30,"div",18)(31,"label",19)(32,"span",6),d(33,"event_available"),l(),d(34," Data di Assunzione "),l(),P(35,"input",41),c(36,"div",42),d(37,"Modificabile solo dall'amministratore"),l()(),c(38,"div",18)(39,"label",19)(40,"span",6),d(41,"cake"),l(),d(42," Data di Nascita "),l(),P(43,"input",43),l(),c(44,"div",18)(45,"label",19)(46,"span",6),d(47,"place"),l(),d(48," Luogo di Nascita "),l(),P(49,"input",44),l(),c(50,"div",18)(51,"label",19)(52,"span",6),d(53,"badge"),l(),d(54," Codice Fiscale "),l(),P(55,"input",45),l(),c(56,"div",18)(57,"label",19)(58,"span",6),d(59,"work_outline"),l(),d(60," Job Title "),l(),P(61,"input",46),l(),c(62,"div",18)(63,"label",19)(64,"span",6),d(65,"schedule"),l(),d(66," Ore Mensili "),l(),P(67,"input",47),l(),c(68,"div",48)(69,"label",49),P(70,"input",50)(71,"span",30),d(72," Full time "),l()(),c(73,"div",18)(74,"label",19)(75,"span",6),d(76,"public"),l(),d(77," Timezone "),l(),P(78,"input",51),l(),c(79,"div",18)(80,"label",19)(81,"span",6),d(82,"work"),l(),d(83," Ruolo "),l(),P(84,"input",52),l(),c(85,"div",18)(86,"label",19)(87,"span",6),d(88,"business"),l(),d(89," Azienda "),l(),P(90,"input",52),l()(),c(91,"div",23)(92,"button",24),E(93,Pj,2,0,"span",25)(94,kj,1,0,"span",26),d(95),l()()()()}if(n&2){let e,i,r,o=g();p(),_("formGroup",o.profiloForm),p(8),_("ngIf",((e=o.profiloForm.get("first_name"))==null?null:e.invalid)&&((e=o.profiloForm.get("first_name"))==null?null:e.touched)),p(7),_("ngIf",((i=o.profiloForm.get("last_name"))==null?null:i.invalid)&&((i=o.profiloForm.get("last_name"))==null?null:i.touched)),p(7),_("ngIf",((r=o.profiloForm.get("email"))==null?null:r.invalid)&&((r=o.profiloForm.get("email"))==null?null:r.touched)),p(12),_("disabled",!o.hasRole("admin")),p(49),_("value",o.currentUser==null?null:o.currentUser.role),p(6),_("value",(o.aziendaCorrente==null?null:o.aziendaCorrente.name)||"N/A"),p(2),_("disabled",o.profiloForm.invalid||o.salvataggioProfilo),p(),_("ngIf",!o.salvataggioProfilo),p(),_("ngIf",o.salvataggioProfilo),p(),R(" ",o.salvataggioProfilo?"Salvando...":"Salva Profilo"," ")}}function Lj(n,t){n&1&&(c(0,"div",53),d(1," Nome azienda obbligatorio "),l())}function jj(n,t){n&1&&(c(0,"div",53),d(1," Partita IVA obbligatoria "),l())}function Vj(n,t){if(n&1&&(c(0,"span"),d(1),Z(2,"number"),Z(3,"number"),l()),n&2){let e=g().$implicit;p(),ve("coord: ",X(2,2,e.lat,"1.5-5"),", ",X(3,5,e.lng,"1.5-5"))}}function zj(n,t){n&1&&(c(0,"span"),d(1,"coord: \u2014"),l())}function Uj(n,t){if(n&1){let e=k();c(0,"div",77)(1,"div",78),d(2),l(),c(3,"div",79)(4,"div",80),d(5),l(),c(6,"div",81)(7,"span",82),d(8,"place"),l(),c(9,"div",83)(10,"div",84)(11,"strong",85),d(12),c(13,"small",86),d(14),l()(),c(15,"div",87),E(16,Vj,4,8,"span",14)(17,zj,2,0,"span",14),l()(),c(18,"div",88)(19,"div",89),d(20),l(),c(21,"div",90)(22,"span",91),d(23),l()()()()()(),c(24,"div")(25,"button",92),x("click",function(){let r=C(e).index,o=g(4);return S(o.removePunchPoint(r))}),c(26,"span",6),d(27,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=t.index,r=g(4);p(2),R(" ",((e.name||e.address||"Punto "+(i+1))==null?null:(e.name||e.address||"Punto "+(i+1)).charAt(0))||i+1," "),p(3),T(e.name||e.address||"Punto "+(i+1)),p(7),R(" ",r.getStreet(e)," "),p(2),T(r.getCivic(e)),p(2),_("ngIf",(e==null?null:e.lat)&&(e==null?null:e.lng)),p(),_("ngIf",!(e!=null&&e.lat)||!(e!=null&&e.lng)),p(3),T(r.getCityProvince(e)||"\u2014"),p(3),R("raggio: ",e.radius_m||50," m")}}function Bj(n,t){if(n&1){let e=k();c(0,"div",93)(1,"div",18)(2,"label",19),d(3,"Nome Punto"),l(),c(4,"input",94),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.name,r)||(o.newPoint.name=r),S(r)}),l()(),c(5,"div",95)(6,"div",96)(7,"label",19),d(8,"Via / Indirizzo"),l(),c(9,"input",97),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.address,r)||(o.newPoint.address=r),S(r)}),l()(),c(10,"div",98)(11,"label",19),d(12,"Civico"),l(),c(13,"input",99),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.civic_number,r)||(o.newPoint.civic_number=r),S(r)}),l()()(),c(14,"div",100)(15,"div",18)(16,"label",19),d(17,"Citt\xE0"),l(),c(18,"input",101),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.city,r)||(o.newPoint.city=r),S(r)}),l()(),c(19,"div",18)(20,"label",19),d(21,"Provincia"),l(),c(22,"input",102),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.province,r)||(o.newPoint.province=r),S(r)}),l()()(),c(23,"div",103)(24,"div",104)(25,"label",19),d(26,"Raggio (m)"),l(),c(27,"input",105),W("ngModelChange",function(r){C(e);let o=g(4);return G(o.newPoint.radius_m,r)||(o.newPoint.radius_m=r),S(r)}),l()()(),c(28,"div",23)(29,"button",33),x("click",function(){C(e);let r=g(4);return S(r.addPunchPoint())}),d(30," Salva Punto "),l()()()}if(n&2){let e=g(4);p(4),H("ngModel",e.newPoint.name),_("ngModelOptions",Ue(13,ln)),p(5),H("ngModel",e.newPoint.address),_("ngModelOptions",Ue(14,ln)),p(4),H("ngModel",e.newPoint.civic_number),_("ngModelOptions",Ue(15,ln)),p(5),H("ngModel",e.newPoint.city),_("ngModelOptions",Ue(16,ln)),p(4),H("ngModel",e.newPoint.province),_("ngModelOptions",Ue(17,ln)),p(5),H("ngModel",e.newPoint.radius_m),_("ngModelOptions",Ue(18,ln)),p(2),_("disabled",!(e.aziendaCorrente!=null&&e.aziendaCorrente.id)||e.salvataggioAzienda)}}function $j(n,t){if(n&1){let e=k();c(0,"div",69)(1,"h3",72)(2,"span",6),d(3,"place"),l(),d(4,"Punti di Timbratura"),l(),c(5,"div",73),E(6,Uj,28,8,"div",74),l(),c(7,"div",75)(8,"button",33),x("click",function(){C(e);let r=g(3);return S(r.toggleAddPointForm())}),c(9,"span",6),d(10),l(),d(11),l()(),E(12,Bj,31,19,"div",76),l()}if(n&2){let e=g(3);p(6),_("ngForOf",e.punchPoints),p(2),_("disabled",e.salvataggioAzienda),p(2),T(e.showAddPointForm?"close":"add"),p(),R(" ",e.showAddPointForm?"Annulla":"Aggiungi Punto"," "),p(),_("ngIf",e.showAddPointForm)}}function Hj(n,t){if(n&1&&(c(0,"div",109)(1,"div",110),d(2),l(),c(3,"div",111)(4,"div",104)(5,"label",19),d(6,"Apertura"),l(),P(7,"input",112),l(),c(8,"div",104)(9,"label",19),d(10,"Chiusura"),l(),P(11,"input",113),l(),c(12,"div",114)(13,"label",49),P(14,"input",115)(15,"span",30),d(16," Chiuso "),l()()()()),n&2){let e=t.$implicit;_("formGroupName",e.key),p(2),T(e.label)}}function Wj(n,t){if(n&1){let e=k();c(0,"div")(1,"div",106),E(2,Hj,17,2,"div",107),l(),c(3,"div",23)(4,"button",108),x("click",function(){C(e);let r=g(3);return S(r.resetOrariDefault())}),c(5,"span",6),d(6,"restore"),l(),d(7," Ripristina Orari Predefiniti "),l()()()}if(n&2){let e=g(3);p(2),_("ngForOf",e.giorniSettimana)}}function Gj(n,t){if(n&1){let e=k();c(0,"div",125)(1,"div")(2,"strong"),d(3),l(),c(4,"div",126),d(5),l()(),c(6,"div")(7,"button",92),x("click",function(){let r=C(e).index,o=g(4);return S(o.rimuoviGiornoChiusura(r))}),c(8,"span",6),d(9,"delete"),l()()()()}if(n&2){let e=t.$implicit,i=g(4);p(3),T(i.formatClosedDay(e)),p(2),T(e.label||(e.type==="range"?"Intervallo":"Giorno singolo"))}}function qj(n,t){if(n&1){let e=k();c(0,"div")(1,"div",116),E(2,Gj,10,2,"div",117),l(),c(3,"div",118)(4,"div",119)(5,"input",120),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.newDate,r)||(o.newDate=r),S(r)}),l(),c(6,"input",121),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.newDateLabel,r)||(o.newDateLabel=r),S(r)}),l(),c(7,"button",122),x("click",function(){C(e);let r=g(3);return S(r.aggiungiGiornoSingolo())}),d(8,"Aggiungi Giorno"),l()(),c(9,"div",119)(10,"input",120),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.rangeStart,r)||(o.rangeStart=r),S(r)}),l(),c(11,"input",120),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.rangeEnd,r)||(o.rangeEnd=r),S(r)}),l(),c(12,"button",122),x("click",function(){C(e);let r=g(3);return S(r.aggiungiIntervallo())}),d(13,"Aggiungi Intervallo"),l()(),c(14,"div",123)(15,"button",124),x("click",function(){C(e);let r=g(3);return S(r.ripristinaFestivita())}),d(16,"Ripristina Festivit\xE0"),l()()()()}if(n&2){let e=g(3);p(2),_("ngForOf",e.giorniChiusura),p(3),H("ngModel",e.newDate),_("ngModelOptions",Ue(9,ln)),p(),H("ngModel",e.newDateLabel),_("ngModelOptions",Ue(10,ln)),p(4),H("ngModel",e.rangeStart),_("ngModelOptions",Ue(11,ln)),p(),H("ngModel",e.rangeEnd),_("ngModelOptions",Ue(12,ln))}}function Jj(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function Kj(n,t){n&1&&P(0,"span",54)}function Yj(n,t){if(n&1){let e=k();c(0,"div")(1,"form",16),x("ngSubmit",function(){C(e);let r=g(2);return S(r.salvaAzienda())}),c(2,"div",17)(3,"div",18)(4,"label",19)(5,"span",6),d(6,"corporate_fare"),l(),d(7," Nome Azienda * "),l(),P(8,"input",56),E(9,Lj,2,0,"div",37),l(),c(10,"div",18)(11,"label",19)(12,"span",6),d(13,"receipt"),l(),d(14," Partita IVA * "),l(),P(15,"input",57),E(16,jj,2,0,"div",37),l(),c(17,"div",18)(18,"label",19)(19,"span",6),d(20,"location_on"),l(),d(21," Indirizzo "),l(),P(22,"input",58),l(),c(23,"div",18)(24,"label",19)(25,"span",6),d(26,"location_city"),l(),d(27," Citt\xE0 "),l(),P(28,"input",59),l(),c(29,"div",18)(30,"label",19)(31,"span",6),d(32,"map"),l(),d(33," Provincia "),l(),P(34,"input",60),l(),c(35,"div",18)(36,"label",19)(37,"span",6),d(38,"web"),l(),d(39," Sito Web "),l(),P(40,"input",61),l(),c(41,"div",18)(42,"label",19)(43,"span",6),d(44,"phone"),l(),d(45," Telefono Aziendale "),l(),P(46,"input",62),l(),c(47,"div",18)(48,"label",19)(49,"span",6),d(50,"email"),l(),d(51," Email Aziendale "),l(),P(52,"input",39),l(),c(53,"div",18)(54,"label",19)(55,"span",6),d(56,"room_preferences"),l(),d(57," Tipologia Timbratura "),l(),c(58,"div",63)(59,"label",64),P(60,"input",65)(61,"span",66),d(62," Libera "),l(),c(63,"label",64),P(64,"input",67)(65,"span",66),d(66," Punti Timbratura "),l()()(),E(67,$j,13,5,"div",68),c(68,"div",69)(69,"div",12),x("click",function(){C(e);let r=g(2);return S(r.toggleOpeningHours())}),c(70,"h3",8)(71,"span",6),d(72,"schedule"),l(),d(73," Orari di Lavoro "),l(),c(74,"button",70)(75,"span",6),d(76),l()()(),E(77,Wj,8,1,"div",14),l(),c(78,"div",69)(79,"div",12),x("click",function(){C(e);let r=g(2);return S(r.toggleClosedDays())}),c(80,"h3",8)(81,"span",6),d(82,"event_busy"),l(),d(83," Giorni di Chiusura (festivit\xE0 / chiusure)"),l(),c(84,"button",71)(85,"span",6),d(86),l()()(),E(87,qj,17,13,"div",14),l()(),c(88,"div",23)(89,"button",24),E(90,Jj,2,0,"span",25)(91,Kj,1,0,"span",26),d(92),l()()()()}if(n&2){let e,i,r,o=g(2);p(),_("formGroup",o.aziendaForm),p(8),_("ngIf",((e=o.aziendaForm.get("name"))==null?null:e.invalid)&&((e=o.aziendaForm.get("name"))==null?null:e.touched)),p(7),_("ngIf",((i=o.aziendaForm.get("vat"))==null?null:i.invalid)&&((i=o.aziendaForm.get("vat"))==null?null:i.touched)),p(51),_("ngIf",((r=o.aziendaForm.get("timbratura_type"))==null?null:r.value)==="punti"),p(7),fn("aria-expanded",_i(o.showOpeningHours)),p(2),T(o.showOpeningHours?"expand_less":"expand_more"),p(),_("ngIf",o.showOpeningHours),p(7),fn("aria-expanded",_i(o.showClosedDays)),p(2),T(o.showClosedDays?"expand_less":"expand_more"),p(),_("ngIf",o.showClosedDays),p(2),_("disabled",o.aziendaForm.invalid||o.salvataggioAzienda),p(),_("ngIf",!o.salvataggioAzienda),p(),_("ngIf",o.salvataggioAzienda),p(),R(" ",o.salvataggioAzienda?"Salvando...":"Salva Azienda"," ")}}function Zj(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleAzienda())}),c(2,"h2",8)(3,"span",6),d(4,"business"),l(),d(5," Dati Azienda"),l(),c(6,"button",55)(7,"span",6),d(8),l()()(),E(9,Yj,93,16,"div",14),l()}if(n&2){let e=g();p(6),fn("aria-expanded",_i(e.showAzienda)),p(2),T(e.showAzienda?"expand_less":"expand_more"),p(),_("ngIf",e.showAzienda)}}function Qj(n,t){n&1&&(c(0,"div",136),P(1,"div",137),l())}function Xj(n,t){if(n&1){let e=k();Ze(0),c(1,"input",146),W("ngModelChange",function(r){C(e);let o=g(6);return G(o.editingJobTitle.name,r)||(o.editingJobTitle.name=r),S(r)}),l(),Qe()}if(n&2){let e=g(6);p(),H("ngModel",e.editingJobTitle.name)}}function e3(n,t){if(n&1&&d(0),n&2){let e=g().$implicit;T(e.name)}}function t3(n,t){if(n&1){let e=k();Ze(0),c(1,"input",146),W("ngModelChange",function(r){C(e);let o=g(6);return G(o.editingJobTitle.description,r)||(o.editingJobTitle.description=r),S(r)}),l(),Qe()}if(n&2){let e=g(6);p(),H("ngModel",e.editingJobTitle.description)}}function n3(n,t){if(n&1&&d(0),n&2){let e=g().$implicit;T(e.description||"-")}}function i3(n,t){if(n&1){let e=k();c(0,"button",147),x("click",function(){C(e);let r=g().$implicit,o=g(5);return S(o.beginEditJobTitle(r))}),c(1,"span",6),d(2,"edit"),l()()}}function r3(n,t){if(n&1){let e=k();c(0,"button",147),x("click",function(){C(e);let r=g(6);return S(r.saveEditJobTitle())}),c(1,"span",6),d(2,"check"),l()()}}function o3(n,t){if(n&1){let e=k();c(0,"button",147),x("click",function(){C(e);let r=g(6);return S(r.cancelEditJobTitle())}),c(1,"span",6),d(2,"close"),l()()}}function s3(n,t){if(n&1){let e=k();c(0,"tr")(1,"td"),E(2,Xj,2,1,"ng-container",142)(3,e3,1,1,"ng-template",null,1,wn),l(),c(5,"td"),E(6,t3,2,1,"ng-container",142)(7,n3,1,1,"ng-template",null,2,wn),l(),c(9,"td")(10,"span",91),d(11),l()(),c(12,"td")(13,"div",143),E(14,i3,3,0,"button",144)(15,r3,3,0,"button",144)(16,o3,3,0,"button",144),c(17,"button",145),x("click",function(r){let o=C(e).$implicit;return g(5).toggleJobTitleActive(o),S(r.stopPropagation())}),c(18,"span",6),d(19),l()()()()()}if(n&2){let e=t.$implicit,i=en(4),r=en(8),o=g(5);p(2),_("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id)("ngIfElse",i),p(4),_("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id)("ngIfElse",r),p(4),Se("inactive",!e.is_active),p(),T(e.is_active?"Attiva":"Disattiva"),p(3),_("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)!==e.id),p(),_("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id),p(),_("ngIf",(o.editingJobTitle==null?null:o.editingJobTitle.id)===e.id),p(),_("title",_i(e.is_active?"Disattiva":"Riattiva")),p(2),T(e.is_active?"toggle_on":"toggle_off")}}function a3(n,t){if(n&1&&(c(0,"table",140)(1,"thead")(2,"tr")(3,"th"),d(4,"Nome"),l(),c(5,"th"),d(6,"Descrizione"),l(),c(7,"th"),d(8,"Stato"),l(),c(9,"th"),d(10,"Azioni"),l()()(),c(11,"tbody"),E(12,s3,20,13,"tr",141),l()()),n&2){let e=g(4);p(12),_("ngForOf",e.jobTitles)}}function l3(n,t){n&1&&(c(0,"div",148)(1,"h3"),d(2,"Nessuna mansione"),l(),c(3,"p",9),d(4,"Aggiungi una nuova mansione per iniziare ad assegnarla ai dipendenti."),l()())}function c3(n,t){if(n&1&&(c(0,"div",138),E(1,a3,13,1,"table",139)(2,l3,5,0,"ng-template",null,0,wn),l()),n&2){let e=en(3),i=g(3);p(),_("ngIf",i.jobTitles.length>0)("ngIfElse",e)}}function u3(n,t){if(n&1){let e=k();c(0,"div")(1,"div",128)(2,"div",129)(3,"div",130)(4,"input",131),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.newJobTitleName,r)||(o.newJobTitleName=r),S(r)}),l(),c(5,"input",132),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.newJobTitleDescription,r)||(o.newJobTitleDescription=r),S(r)}),l(),c(6,"button",122),x("click",function(){C(e);let r=g(2);return S(r.createJobTitle(r.aziendaCorrente==null?null:r.aziendaCorrente.id))}),c(7,"span",6),d(8,"add"),l(),d(9," Aggiungi "),l()(),E(10,Qj,2,0,"div",133),c(11,"div",134),E(12,c3,4,2,"div",135),l()()()()}if(n&2){let e=g(2);p(4),H("ngModel",e.newJobTitleName),p(),H("ngModel",e.newJobTitleDescription),p(5),_("ngIf",e.isLoadingJobTitles),p(2),_("ngIf",!e.isLoadingJobTitles)}}function d3(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleMansioni())}),c(2,"h2",8)(3,"span",6),d(4,"work_outline"),l(),d(5," Mansioni"),l(),c(6,"button",127)(7,"span",6),d(8),l()()(),E(9,u3,13,4,"div",14),l()}if(n&2){let e=g();p(6),fn("aria-expanded",_i(e.showMansioni)),p(2),T(e.showMansioni?"expand_less":"expand_more"),p(),_("ngIf",e.showMansioni)}}function f3(n,t){n&1&&(c(0,"div",148)(1,"span",6),d(2,"inbox"),l(),c(3,"p"),d(4,"Nessun reparto creato"),l()())}function p3(n,t){if(n&1&&(c(0,"p",169),d(1),l()),n&2){let e=g(2).$implicit;p(),T(e.description)}}function h3(n,t){n&1&&(c(0,"p",9),d(1,"Nessuna descrizione"),l())}function m3(n,t){if(n&1&&(c(0,"div",164)(1,"div",165)(2,"h4"),d(3),l(),c(4,"span",166),d(5),l()(),E(6,p3,2,1,"p",167)(7,h3,2,0,"p",168),l()),n&2){let e=g().$implicit;p(3),T(e.name),p(2),R("",e.employee_count||0," dipendenti"),p(),_("ngIf",e.description),p(),_("ngIf",!e.description)}}function g3(n,t){if(n&1){let e=k();c(0,"div",170)(1,"input",171),x("ngModelChange",function(r){C(e);let o=g(4);return S(o.editingDepartment&&(o.editingDepartment.name=r))}),l(),c(2,"textarea",172),x("ngModelChange",function(r){C(e);let o=g(4);return S(o.editingDepartment&&(o.editingDepartment.description=r))}),l()()}if(n&2){let e=g(4);p(),_("ngModel",(e.editingDepartment==null?null:e.editingDepartment.name)||""),p(),_("ngModel",(e.editingDepartment==null?null:e.editingDepartment.description)||"")}}function v3(n,t){if(n&1){let e=k();c(0,"div",173)(1,"button",174),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.avviaModificaReparto(r))}),c(2,"span",6),d(3,"edit"),l()(),c(4,"button",175),x("click",function(){C(e);let r=g().$implicit,o=g(3);return S(o.eliminaReparto(r))}),c(5,"span",6),d(6,"delete"),l()()()}if(n&2){let e=g().$implicit;p(4),_("disabled",(e.employee_count||0)>0)}}function _3(n,t){if(n&1){let e=k();c(0,"div")(1,"button",176),x("click",function(){C(e);let r=g(4);return S(r.salvaModificaReparto())}),c(2,"span",6),d(3,"check"),l()(),c(4,"button",177),x("click",function(){C(e);let r=g(4);return S(r.annullaModificaReparto())}),c(5,"span",6),d(6,"close"),l()()()}}function y3(n,t){if(n&1&&(c(0,"div",158)(1,"div",159),E(2,m3,8,4,"div",160)(3,g3,3,2,"div",161),l(),c(4,"div",162),E(5,v3,7,1,"div",163)(6,_3,7,0,"div",14),l()()),n&2){let e=t.$implicit,i=g(3);p(2),_("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)!==e.id),p(),_("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)===e.id),p(2),_("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)!==e.id),p(),_("ngIf",(i.editingDepartment==null?null:i.editingDepartment.id)===e.id)}}function b3(n,t){if(n&1){let e=k();c(0,"div",151)(1,"div",152)(2,"h3",72),d(3,"Aggiungi Nuovo Reparto"),l(),c(4,"div",17)(5,"div",18)(6,"label",19),d(7,"Nome Reparto *"),l(),c(8,"input",153),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.newDepartmentName,r)||(o.newDepartmentName=r),S(r)}),l()(),c(9,"div",18)(10,"label",19),d(11,"Descrizione"),l(),c(12,"textarea",154),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.newDepartmentDescription,r)||(o.newDepartmentDescription=r),S(r)}),l()()(),c(13,"div",23)(14,"button",33),x("click",function(){C(e);let r=g(2);return S(r.aggiungiReparto())}),c(15,"span",6),d(16,"add"),l(),d(17," Aggiungi Reparto "),l()()(),c(18,"div",152)(19,"h3",72),d(20,"Reparti Esistenti"),l(),E(21,f3,5,0,"div",155),c(22,"div",156),E(23,y3,7,4,"div",157),l()()()}if(n&2){let e=g(2);p(8),H("ngModel",e.newDepartmentName),_("ngModelOptions",Ue(7,ln)),p(4),H("ngModel",e.newDepartmentDescription),_("ngModelOptions",Ue(8,ln)),p(2),_("disabled",!e.newDepartmentName||!e.newDepartmentName.trim()||e.salvataggioAzienda),p(7),_("ngIf",e.departments.length===0),p(2),_("ngForOf",e.departments)}}function w3(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleGestioneReparti())}),c(2,"h2",8)(3,"span",6),d(4,"groups"),l(),d(5," Gestione Reparti"),l(),c(6,"button",149)(7,"span",6),d(8),l()()(),E(9,b3,24,9,"div",150),l()}if(n&2){let e=g();p(6),fn("aria-expanded",_i(e.showGestioneReparti)),p(2),T(e.showGestioneReparti?"expand_less":"expand_more"),p(),_("ngIf",e.showGestioneReparti)}}function E3(n,t){if(n&1&&(c(0,"option",180),d(1),l()),n&2){let e=t.$implicit;_("ngValue",e.id),p(),vd("",e.first_name," ",e.last_name," (",e.email,")")}}function C3(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",195),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerUser(o.id,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),_("value",e.id)("checked",i.managerConfig.user_ids.includes(e.id)),p(),ve(" ",e.first_name," ",e.last_name," ")}}function S3(n,t){if(n&1){let e=k();c(0,"div",42)(1,"button",108),x("click",function(){C(e);let r=g(5);return S(r.toggleShowEmployees())}),d(2),l()()}if(n&2){let e=g(5);p(2),R(" ",e.showAllEmployees?"Mostra meno":"Mostra tutti ("+e.companyEmployees.length+")"," ")}}function x3(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Utenti"),l(),c(3,"div",192),E(4,C3,3,4,"label",193),Z(5,"slice"),l(),E(6,S3,3,1,"div",194),l()),n&2){let e=g(4);p(4),_("ngForOf",e.showAllEmployees?e.companyEmployees:Qa(5,2,e.companyEmployees,0,10)),p(2),_("ngIf",e.companyEmployees.length>10)}}function D3(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",195),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerRole(o,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),_("value",e)("checked",i.managerConfig.roles.includes(e)),p(),R(" ",e," ")}}function I3(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Ruoli"),l(),c(3,"div",196),E(4,D3,3,3,"label",193),l()()),n&2){let e=g(4);p(4),_("ngForOf",e.availableRoles)}}function T3(n,t){if(n&1){let e=k();c(0,"label",49)(1,"input",195),x("change",function(r){let o=C(e).$implicit,s=g(5);return S(s.toggleManagerDepartment(o.id,r))}),l(),d(2),l()}if(n&2){let e=t.$implicit,i=g(5);p(),_("value",e.id)("checked",i.managerConfig.department_ids==null?null:i.managerConfig.department_ids.includes(e.id)),p(),R(" ",e.name," ")}}function M3(n,t){if(n&1&&(c(0,"div",18)(1,"label",19),d(2,"Seleziona Reparti"),l(),c(3,"div",156),E(4,T3,3,3,"label",193),l()()),n&2){let e=g(4);p(4),_("ngForOf",e.departments)}}function A3(n,t){if(n&1){let e=k();c(0,"div",183)(1,"div",18)(2,"label",19),d(3,"Modalit\xE0 di visibilit\xE0"),l(),c(4,"div",184)(5,"label",64)(6,"input",185),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(7," Solo proprie timbrature"),l(),c(8,"label",64)(9,"input",186),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(10," Lista utenti selezionati"),l(),E(11,x3,7,6,"div",187),c(12,"label",64)(13,"input",188),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(14," Per ruolo"),l(),E(15,I3,5,1,"div",187),c(16,"label",64)(17,"input",189),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.mode,r)||(o.managerConfig.mode=r),S(r)}),l(),d(18," Per reparto"),l(),E(19,M3,5,1,"div",187),l()(),c(20,"div",152)(21,"h4",72),d(22,"Permessi Responsabile"),l(),c(23,"div",190)(24,"label",49)(25,"input",191),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.can_view_all_employees,r)||(o.managerConfig.can_view_all_employees=r),S(r)}),l(),P(26,"span",30),d(27," Pu\xF2 vedere tutti i dipendenti dell'azienda "),l(),c(28,"label",49)(29,"input",29),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.can_manage_departments,r)||(o.managerConfig.can_manage_departments=r),S(r)}),l(),P(30,"span",30),d(31," Pu\xF2 gestire i reparti (creare, modificare, eliminare) "),l(),c(32,"label",49)(33,"input",29),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.can_manage_job_titles,r)||(o.managerConfig.can_manage_job_titles=r),S(r)}),l(),P(34,"span",30),d(35," Pu\xF2 gestire le mansioni (Aggiungi/Modifica/Disattiva) "),l(),c(36,"label",49)(37,"input",191),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.can_view_reports,r)||(o.managerConfig.can_view_reports=r),S(r)}),l(),P(38,"span",30),d(39," Pu\xF2 visualizzare i report aziendali "),l(),c(40,"label",49)(41,"input",191),W("ngModelChange",function(r){C(e);let o=g(3);return G(o.managerConfig.can_edit_employees,r)||(o.managerConfig.can_edit_employees=r),S(r)}),l(),P(42,"span",30),d(43," Pu\xF2 modificare i dati dei dipendenti (anagrafiche) "),l()()(),c(44,"div",23)(45,"button",33),x("click",function(){C(e);let r=g(3);return S(r.salvaManagerVisibility())}),d(46," Salva Visibilit\xE0 "),l()()()}if(n&2){let e=g(3);p(6),H("ngModel",e.managerConfig.mode),p(3),H("ngModel",e.managerConfig.mode),p(2),_("ngIf",e.managerConfig.mode==="selected_users"),p(2),H("ngModel",e.managerConfig.mode),p(2),_("ngIf",e.managerConfig.mode==="roles"),p(2),H("ngModel",e.managerConfig.mode),p(2),_("ngIf",e.managerConfig.mode==="department"),p(6),H("ngModel",e.managerConfig.can_view_all_employees),_("ngModelOptions",Ue(16,ln)),p(4),H("ngModel",e.managerConfig.can_manage_departments),p(4),H("ngModel",e.managerConfig.can_manage_job_titles),p(4),H("ngModel",e.managerConfig.can_view_reports),_("ngModelOptions",Ue(17,ln)),p(4),H("ngModel",e.managerConfig.can_edit_employees),_("ngModelOptions",Ue(18,ln)),p(4),_("disabled",e.salvataggioAzienda)}}function R3(n,t){if(n&1){let e=k();c(0,"div",151)(1,"div",18)(2,"label",19),d(3,"Seleziona Responsabile"),l(),c(4,"select",179),W("ngModelChange",function(r){C(e);let o=g(2);return G(o.selectedManagerId,r)||(o.selectedManagerId=r),S(r)}),x("change",function(){C(e);let r=g(2);return S(r.onManagerSelected())}),c(5,"option",180),d(6,"-- Seleziona --"),l(),E(7,E3,2,4,"option",181),l()(),E(8,A3,47,19,"div",182),l()}if(n&2){let e=g(2);p(4),H("ngModel",e.selectedManagerId),p(),_("ngValue",null),p(2),_("ngForOf",e.managerUsers),p(),_("ngIf",e.selectedManagerId)}}function O3(n,t){if(n&1){let e=k();c(0,"div",11)(1,"div",12),x("click",function(){C(e);let r=g();return S(r.toggleVisibilitaResponsabili())}),c(2,"h2",8)(3,"span",6),d(4,"visibility"),l(),d(5," Visibilit\xE0 Responsabili"),l(),c(6,"button",178)(7,"span",6),d(8),l()()(),E(9,R3,9,4,"div",150),l()}if(n&2){let e=g();p(6),fn("aria-expanded",_i(e.showVisibilitaResponsabili)),p(2),T(e.showVisibilitaResponsabili?"expand_less":"expand_more"),p(),_("ngIf",e.showVisibilitaResponsabili)}}function N3(n,t){n&1&&(c(0,"span",6),d(1,"lock"),l())}function P3(n,t){n&1&&P(0,"span",54)}function k3(n,t){if(n&1){let e=k();c(0,"label",28)(1,"input",29),W("ngModelChange",function(r){C(e);let o=g();return G(o.impostazioniNotifiche.notificheAmministratore,r)||(o.impostazioniNotifiche.notificheAmministratore=r),S(r)}),l(),P(2,"span",30),c(3,"div",31)(4,"strong"),d(5,"Notifiche Amministratore"),l(),c(6,"span"),d(7,"Ricevi notifiche per le attivit\xE0 aziendali"),l()()()}if(n&2){let e=g();p(),H("ngModel",e.impostazioniNotifiche.notificheAmministratore)}}function F3(n,t){n&1&&(c(0,"span",6),d(1,"save"),l())}function L3(n,t){n&1&&P(0,"span",54)}function j3(n,t){if(n&1&&(c(0,"div",197)(1,"span",6),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioSuccesso," ")}}function V3(n,t){if(n&1&&(c(0,"div",198)(1,"span",6),d(2,"error"),l(),d(3),l()),n&2){let e=g();p(3),R(" ",e.messaggioErrore," ")}}var Cp=class n{constructor(t,e,i,r,o,s){this.fb=t;this.authService=e;this.companyService=i;this.dipendentiService=r;this.jobtitleService=o;this.departmentsService=s;this.profiloForm=this.creaProfiloForm(),this.aziendaForm=this.creaAziendaForm(),this.sicurezzaForm=this.creaSicurezzaForm()}profiloForm;aziendaForm;sicurezzaForm;giorniChiusura=[];newDate=null;newDateLabel=null;rangeStart=null;rangeEnd=null;currentYear=new Date().getFullYear();punchPoints=[];newPoint={name:"",address:"",civic_number:"",city:null,province:null,lat:null,lng:null,radius_m:50};showAllEmployees=!1;companyEmployees=[];availableRoles=[];selectedManagerId=null;managerConfig={mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_manage_departments:!1,can_manage_job_titles:!1,can_view_reports:!1,can_edit_employees:!1};managerVisibilityMap={};currentUser=null;aziendaCorrente=null;impostazioniNotifiche={emailNotifiche:!0,riepilogoGiornaliero:!1,notificheAmministratore:!0};closedDays=[];salvataggioProfilo=!1;salvataggioAzienda=!1;salvataggioPassword=!1;salvataggioNotifiche=!1;departments=[];newDepartmentName="";newDepartmentDescription="";editingDepartment=null;messaggioSuccesso="";messaggioErrore="";giorniSettimana=[{key:"monday",label:"Luned\xEC"},{key:"tuesday",label:"Marted\xEC"},{key:"wednesday",label:"Mercoled\xEC"},{key:"thursday",label:"Gioved\xEC"},{key:"friday",label:"Venerd\xEC"},{key:"saturday",label:"Sabato"},{key:"sunday",label:"Domenica"}];showAddPointForm=!1;showOpeningHours=!1;showProfilo=!1;showAzienda=!1;showReparti=!1;showClosedDays=!1;showGestioneReparti=!1;showVisibilitaResponsabili=!1;showMansioni=!1;jobTitles=[];isLoadingJobTitles=!1;newJobTitleName=null;newJobTitleDescription=null;editingJobTitle=null;ngOnInit(){this.aziendaForm=this.creaAziendaForm(),this.authService.currentUser$.subscribe(t=>{this.currentUser=t??null,t&&(this.caricaDatiProfilo(),this.companyService.getAziendaForUser(t.id,t.company_id).subscribe({next:e=>{if(!e){console.warn("[Impostazioni] nessuna azienda trovata per utente",t.id);return}this.aziendaCorrente=e,this.managerVisibilityMap=e.manager_visibility??{},this.loadManagerVisibilityData(),(this.hasRole("admin")||this.hasRole("manager")&&this.canManageDepartments())&&this.caricaReparti(),this.patchAziendaForm(e);let i=this.openingHoursGroup;i&&i.valueChanges.pipe(eh(800),th((r,o)=>JSON.stringify(r)===JSON.stringify(o))).subscribe(()=>{this.aziendaCorrente?.id&&this.autoSaveOpeningHours()})},error:e=>{console.error("[Impostazioni] errore getAziendaForUser",e)}}))})}safeGet(t,e=""){return t??e}creaProfiloForm(){return this.fb.group({first_name:["",ne.required],last_name:["",ne.required],email:["",[ne.required,ne.email]],phone:[""],hire_date:[""],birth_date:[""],birth_place:[""],fiscal_code:[""],job_title:[""],monthly_hours:[null],full_time:[!1],timezone:["Europe/Rome"]})}creaAziendaForm(){let t=this.fb.group({});return this.giorniSettimana.forEach(e=>{t.addControl(e.key,this.fb.group({open:[""],close:[""],closed:[!1]}))}),this.fb.group({name:["",ne.required],vat:["",ne.required],address:[""],city:[""],province:[""],numero_telefono:[""],email:["",ne.email],website:[""],opening_hours:t,timbratura_type:["libera"]})}get openingHoursGroup(){return this.aziendaForm.get("opening_hours")}patchAziendaForm(t){let e=N({},t);t.opening_hours&&(e.opening_hours=t.opening_hours),e.timbratura_type=t.timbratura_type??"libera",this.aziendaForm.patchValue(e),this.punchPoints=t.punch_points?[...t.punch_points]:[],t.city&&(this.newPoint.city=t.city),t.province&&(this.newPoint.province=t.province);let i=this.openingHoursGroup,r=t?.opening_hours;console.log("[Impostazioni] Dati opening_hours dal DB:",r),r&&typeof r=="object"?this.giorniSettimana.forEach(s=>{let a=r[s.key],u=i.get(s.key);u&&a?(console.log(`[Impostazioni] Patch giorno ${s.key}:`,a),u.patchValue({open:a.open||"",close:a.close||"",closed:a.closed||!1})):console.warn(`[Impostazioni] FormGroup non trovato per giorno: ${s.key}`)}):console.warn("[Impostazioni] opening_hours non trovato o non valido:",r);let o=t.closed_days;o&&Array.isArray(o)&&o.length>0?this.giorniChiusura=o.map(s=>{if(!s)return null;if(typeof s=="string")if(s.includes("/")){let[a,u]=s.split("/");return{type:"range",start:a,end:u,label:`Chiusura ${this.formatDateDisplay(a)}`}}else{let a=this.festivitaMap()[s];return{type:"single",start:s,label:a??"Festa"}}return{type:s.type==="range"?"range":"single",start:s.start,end:s.end??void 0,label:s.label??(s.type==="range"?`Chiusura ${this.formatDateDisplay(s.start)}`:"Festa")}}).filter(Boolean):this.giorniChiusura.length===0&&(this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear))}debugOrari(){console.log("=== DEBUG ORARI ==="),console.log("giorniSettimana:",this.giorniSettimana),console.log("openingHoursGroup:",this.openingHoursGroup),console.log("openingHoursGroup valid:",this.openingHoursGroup?.valid),console.log("openingHoursGroup value:",JSON.stringify(this.openingHoursGroup?.value,null,2)),console.log("showOpeningHours:",this.showOpeningHours),this.giorniSettimana.forEach(t=>{let e=this.openingHoursGroup?.get(t.key);console.log(`${t.label} (${t.key}):`,{open:e?.get("open")?.value,close:e?.get("close")?.value,closed:e?.get("closed")?.value,valid:e?.valid})})}aggiungiGiornoSingolo(){if(!this.newDate)return;let t=(this.newDateLabel||"").trim()||"Festa personalizzata";this.giorniChiusura.some(i=>i.type==="single"&&i.start===this.newDate)||(this.giorniChiusura.push({type:"single",start:this.newDate,label:t}),this.newDate=null,this.newDateLabel=null,this.persistClosedDays())}aggiungiIntervallo(){if(!this.rangeStart||!this.rangeEnd)return;if(this.rangeEnd<this.rangeStart){let e=this.rangeStart;this.rangeStart=this.rangeEnd,this.rangeEnd=e}this.giorniChiusura.some(e=>e.type==="range"&&e.start===this.rangeStart&&e.end===this.rangeEnd)||(this.giorniChiusura.push({type:"range",start:this.rangeStart,end:this.rangeEnd,label:"Intervallo personalizzato"}),this.rangeStart=null,this.rangeEnd=null,this.persistClosedDays())}rimuoviGiornoChiusura(t){this.giorniChiusura.splice(t,1),this.persistClosedDays()}ripristinaFestivita(){this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear)}persistClosedDays(){if(!this.aziendaCorrente?.id){console.warn("[Impostazioni] persistClosedDays: aziendaCorrente mancante, skip save");return}let t={closed_days:this.closedDaysToPayload()};this.salvataggioAzienda=!0,this.messaggioErrore="",this.companyService.aggiornaAzienda(this.aziendaCorrente.id,t).subscribe({next:e=>{this.salvataggioAzienda=!1,e&&(this.aziendaCorrente=e,this.patchAziendaForm(e)),this.messaggioSuccesso="Festivit\xE0 salvata",this.nascondiMessaggioDopoTimeout()},error:e=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] errore persistClosedDays",e),this.messaggioErrore="Errore durante il salvataggio delle festivit\xE0",this.nascondiMessaggioDopoTimeout()}})}closedDaysToPayload(){return this.giorniChiusura.map(t=>t?t.type==="range"?{type:"range",start:t.start,end:t.end,label:t.label??`Chiusura ${this.formatDateDisplay(t.start)}`}:{type:"single",start:t.start,label:t.label??"Festa"}:null).filter(Boolean)}creaSicurezzaForm(){return this.fb.group({currentPassword:[""],newPassword:[""],confirmPassword:[""]})}caricaDatiProfilo(){this.currentUser&&(this.profiloForm.patchValue({first_name:this.currentUser.first_name,last_name:this.currentUser.last_name,email:this.currentUser.email,phone:this.currentUser.phone||"",hire_date:this.currentUser.hire_date??"",birth_date:this.currentUser.birth_date??"",birth_place:this.currentUser.birth_place??"",fiscal_code:this.currentUser.fiscal_code??"",job_title:this.currentUser.job_title??"",monthly_hours:this.currentUser.monthly_hours??null,full_time:this.currentUser.full_time??!1,timezone:this.currentUser.timezone??"Europe/Rome"}),this.currentUser.notifications_preferences&&(this.impostazioniNotifiche=N(N({},this.impostazioniNotifiche),this.currentUser.notifications_preferences)),this.hasRole("admin")?this.profiloForm.get("hire_date")?.enable():this.profiloForm.get("hire_date")?.disable())}caricaDatiAzienda(t){t&&this.companyService.getAzienda(t).subscribe({next:e=>{if(!e){console.warn("Nessuna azienda trovata per id",t);return}this.aziendaCorrente=e;let i=N({},e);e.opening_hours&&(i.opening_hours=e.opening_hours),this.aziendaForm.patchValue(i);let r=e.closed_days;r&&Array.isArray(r)&&r.length>0?this.giorniChiusura=r.map(s=>{if(typeof s!="string")return null;if(s.includes("/")){let[a,u]=s.split("/");return{type:"range",start:a,end:u,label:`Chiusura ${this.formatDateDisplay(a)}`}}else{let a=this.festivitaMap()[s];return{type:"single",start:s,label:a??"Festa"}}}).filter(Boolean):this.giorniChiusura=this.getFestivitaItalianeDetailed(this.currentYear);let o=this.openingHoursGroup;e.opening_hours&&Object.keys(e.opening_hours).forEach(s=>{let a=o.get(s);a&&(a.get("open")?.setValue(e.opening_hours?.[s]?.open??""),a.get("close")?.setValue(e.opening_hours?.[s]?.close??""),a.get("closed")?.setValue(!!e.opening_hours?.[s]?.closed))})},error:e=>{console.error("Errore nel caricamento dati azienda:",e)}})}hasRole(t){return this.authService.hasRole(t)}salvaProfilo(){return y(this,null,function*(){if(this.profiloForm.invalid||!this.currentUser){this.profiloForm.markAllAsTouched();return}this.salvataggioProfilo=!0,this.messaggioErrore="";try{let t=this.profiloForm.getRawValue(),e={first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone||null,birth_date:t.birth_date?t.birth_date:null,birth_place:t.birth_place||null,fiscal_code:t.fiscal_code||null,job_title:t.job_title||null,monthly_hours:t.monthly_hours!==""&&t.monthly_hours!=null?Number(t.monthly_hours):null,full_time:!!t.full_time,timezone:t.timezone||null};this.hasRole("admin")&&(e.hire_date=t.hire_date?t.hire_date:null),e.notifications_preferences=this.impostazioniNotifiche;let i=yield this.authService.updateUserProfile(this.currentUser.id,e);this.currentUser=i??this.currentUser,this.messaggioSuccesso="Profilo aggiornato con successo!",this.nascondiMessaggioDopoTimeout(),this.showSystemNotification("Aggiornato il profilo con successo")}catch(t){console.error("[Impostazioni] errore salvaProfilo",t),this.messaggioErrore="Errore durante il salvataggio del profilo"}finally{this.salvataggioProfilo=!1}})}salvaAzienda(){if(this.aziendaForm.invalid){this.aziendaForm.markAllAsTouched();return}this.salvataggioAzienda=!0,this.messaggioErrore="";let t=this.aziendaForm.value,e={},i=this.aziendaForm.get("opening_hours");this.giorniSettimana.forEach(o=>{let s=i.get(o.key);e[o.key]={open:s.get("open")?.value||null,close:s.get("close")?.value||null,closed:!!s.get("closed")?.value}});let r=Q(N({},t),{opening_hours:e,closed_days:this.closedDaysToPayload(),timbratura_type:t.timbratura_type??"libera",punch_points:this.punchPoints});console.debug("[Impostazioni] salvaAzienda payload:",r,"companyId:",this.aziendaCorrente?.id),this.companyService.aggiornaAzienda(this.aziendaCorrente.id,r).subscribe({next:o=>{this.salvataggioAzienda=!1,o&&(this.aziendaCorrente=o,this.patchAziendaForm(o)),this.messaggioSuccesso="Dati azienda aggiornati con successo!",this.nascondiMessaggioDopoTimeout()},error:o=>{this.salvataggioAzienda=!1,this.messaggioErrore="Errore durante il salvataggio dei dati azienda",console.error("Errore aggiornamento azienda:",o)}})}showSystemNotification(t,e=!1){return y(this,null,function*(){if(!("Notification"in window)){console.debug("[Impostazioni] Notification API non disponibile");return}if(!(location.protocol==="https:"||location.hostname==="localhost"||location.hostname==="127.0.0.1")){console.debug("[Impostazioni] Notification API richiede HTTPS o localhost");return}try{if(Notification.permission==="granted"){new Notification(t,{silent:!1});return}if(Notification.permission!=="denied"){let r=yield Notification.requestPermission();r==="granted"?new Notification(t,{silent:!1}):console.debug("[Impostazioni] Notification permission non concessa:",r)}else console.debug("[Impostazioni] Notification permission \xE8 denied")}catch(r){console.warn("[Impostazioni] errore Notification API",r)}})}cambiaPassword(){if(this.sicurezzaForm.invalid){this.sicurezzaForm.markAllAsTouched();return}this.salvataggioPassword=!0,this.messaggioErrore="",setTimeout(()=>{this.salvataggioPassword=!1,this.sicurezzaForm.reset(),this.messaggioSuccesso="Password cambiata con successo!",this.nascondiMessaggioDopoTimeout()},1e3)}salvaNotifiche(){return y(this,null,function*(){if(!this.currentUser){console.debug("[Impostazioni] salvaNotifiche: utente non autenticato");return}this.salvataggioNotifiche=!0,this.messaggioErrore="";let t=null;try{"Notification"in window?location.protocol==="https:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"?(t=yield Notification.requestPermission(),console.debug("[Impostazioni] Notification.requestPermission =>",t)):console.debug("[Impostazioni] Notification API richiede HTTPS o localhost"):console.debug("[Impostazioni] Notification API non disponibile")}catch(i){console.warn("[Impostazioni] errore requestPermission",i)}let e={notifications_preferences:this.impostazioniNotifiche};console.debug("[Impostazioni] salvaNotifiche payload:",e);try{let i=yield this.authService.updateUserProfile(this.currentUser.id,e);if(console.debug("[Impostazioni] updateUserProfile response:",i),this.currentUser=i??this.currentUser,this.salvataggioNotifiche=!1,this.messaggioSuccesso="Preferenze notifiche salvate!",this.nascondiMessaggioDopoTimeout(),t==="granted")try{new Notification("Aggiornato il profilo con successo")}catch(r){console.warn("[Impostazioni] errore creazione Notification",r)}else console.debug("[Impostazioni] permesso notifiche non concesso, nessuna notifica di sistema mostrata")}catch(i){let r=i&&(i.message||i.error||JSON.stringify(i))||"Errore sconosciuto";if(console.error("[Impostazioni] errore salvaNotifiche",i),this.salvataggioNotifiche=!1,this.messaggioErrore="Errore durante il salvataggio delle preferenze: "+r,t==="granted")try{new Notification("Salvataggio preferenze fallito")}catch{}}})}toggleGiornoChiusura(t){let e=t.target,i=e.value;if(i){e.checked?this.giorniChiusura.some(o=>o.type==="single"&&o.start===i)||this.giorniChiusura.push({type:"single",start:i,label:"Festa personalizzata"}):this.giorniChiusura=this.giorniChiusura.filter(r=>!(r.type==="single"&&r.start===i));try{this.persistClosedDays()}catch(r){console.warn("[Impostazioni] persistClosedDays failed from toggleGiornoChiusura",r)}}}formatDateDisplay(t){if(!t)return"";let e=t.split("-");if(e.length!==3)return t;let[i,r,o]=e;return`${o}/${r}/${i}`}formatClosedDay(t){return t?t.type==="range"?`${this.formatDateDisplay(t.start)} \u2192 ${this.formatDateDisplay(t.end??"")}`:this.formatDateDisplay(t.start):""}nascondiMessaggioDopoTimeout(){setTimeout(()=>{this.messaggioSuccesso="",this.messaggioErrore=""},5e3)}getFestivitaItalianeDetailed(t){let e=h=>h.toString().padStart(2,"0"),i=h=>`${h.getFullYear()}-${e(h.getMonth()+1)}-${e(h.getDate())}`,r={[i(new Date(t,0,1))]:"Capodanno",[i(new Date(t,0,6))]:"Epifania",[i(new Date(t,3,25))]:"Festa della Liberazione",[i(new Date(t,4,1))]:"Festa del Lavoro",[i(new Date(t,5,2))]:"Festa della Repubblica",[i(new Date(t,7,15))]:"Ferragosto",[i(new Date(t,10,1))]:"Ognissanti",[i(new Date(t,11,8))]:"Immacolata Concezione",[i(new Date(t,11,25))]:"Natale",[i(new Date(t,11,26))]:"Santo Stefano"},o=this.calculateEasterDate(t),s=i(o),a=new Date(o);a.setDate(a.getDate()+1);let u=i(a),f=[];return Object.keys(r).forEach(h=>f.push({type:"single",start:h,label:r[h]})),f.push({type:"single",start:s,label:"Pasqua"}),f.push({type:"single",start:u,label:"Pasquetta"}),f.sort((h,m)=>h.start>m.start?1:h.start<m.start?-1:0),f}festivitaMap(){let t=this.getFestivitaItalianeDetailed(this.currentYear),e={};return t.forEach(i=>{e[i.start]=i.label??"Festa"}),e}calculateEasterDate(t){let e=t%19,i=Math.floor(t/100),r=t%100,o=Math.floor(i/4),s=i%4,a=Math.floor((i+8)/25),u=Math.floor((i-a+1)/3),f=(19*e+i-o-u+15)%30,h=Math.floor(r/4),m=r%4,b=(32+2*s+2*h-f-m)%7,v=Math.floor((e+11*f+22*b)/451),w=Math.floor((f+b-7*v+114)/31),M=(f+b-7*v+114)%31+1;return new Date(t,w-1,M)}loadManagerVisibilityData(){if(!this.aziendaCorrente?.id){console.debug("[Impostazioni] loadManagerVisibilityData called without aziendaCorrente.id");return}let t=this.aziendaCorrente.id;console.debug("[Impostazioni] loadManagerVisibilityData companyId=",t),this.dipendentiService.getDipendenti(t).subscribe({next:e=>{let i=e??[];console.debug("[Impostazioni] loadManagerVisibilityData response count=",i.length),this.companyEmployees=i;let r=new Set;i.forEach(o=>{o&&typeof o.role=="string"&&o.role.trim()&&r.add(o.role)}),this.availableRoles=Array.from(r),i.length===0&&console.warn("[Impostazioni] loadManagerVisibilityData: no employees returned for company",t)},error:e=>{console.error("[Impostazioni] errore loadManagerVisibilityData",e)}})}onManagerSelected(){if(!this.selectedManagerId){this.managerConfig={mode:"self",user_ids:[],roles:[],department_ids:[],can_view_all_employees:!1,can_manage_departments:!1,can_manage_job_titles:!1};return}let t=this.managerVisibilityMap[this.selectedManagerId]??{mode:"self",user_ids:[],roles:[]};this.managerConfig={mode:t.mode??"self",user_ids:Array.isArray(t.user_ids)?t.user_ids:[],roles:Array.isArray(t.roles)?t.roles:[],department_ids:Array.isArray(t.department_ids)?t.department_ids:[],can_view_all_employees:!!t.can_view_all_employees,can_manage_departments:!!t.can_manage_departments,can_manage_job_titles:!!t.can_manage_job_titles}}canManageJobTitles(){return this.hasRole("admin")?!0:this.currentUser?!!(this.managerVisibilityMap[this.currentUser.id]??{}).can_manage_job_titles:!1}canManageDepartments(){return this.hasRole("admin")?!0:this.currentUser?!!(this.managerVisibilityMap[this.currentUser.id]??{}).can_manage_departments:!1}toggleManagerUser(t,e){let i=e.target.checked,r=this.managerConfig.user_ids.indexOf(t);i&&r===-1?this.managerConfig.user_ids.push(t):!i&&r!==-1&&this.managerConfig.user_ids.splice(r,1)}toggleManagerRole(t,e){e.target.checked?this.managerConfig.roles.includes(t)||this.managerConfig.roles.push(t):this.managerConfig.roles=this.managerConfig.roles.filter(r=>r!==t)}salvaManagerVisibility(){if(!this.aziendaCorrente||!this.aziendaCorrente.id||!this.selectedManagerId)return;this.managerVisibilityMap[this.selectedManagerId]=N({},this.managerConfig);let t={manager_visibility:this.managerVisibilityMap};this.salvataggioAzienda=!0,console.debug("[Impostazioni] salvaManagerVisibility payload =>",{companyId:this.aziendaCorrente.id,payload:t}),this.companyService.aggiornaAzienda(this.aziendaCorrente.id,t).subscribe({next:e=>{this.salvataggioAzienda=!1,console.debug("[Impostazioni] salvaManagerVisibility response =>",e),this.messaggioSuccesso="Visibilit\xE0 responsabile salvata",this.nascondiMessaggioDopoTimeout()},error:e=>{this.salvataggioAzienda=!1,this.messaggioErrore="Errore salvataggio visibilit\xE0 responsabile: "+(e?.message||JSON.stringify(e)),console.error("[Impostazioni] salvaManagerVisibility error",e)}})}addPunchPoint(){return y(this,null,function*(){if(this.messaggioErrore="",!this.aziendaCorrente?.id){if(!this.currentUser){this.messaggioErrore="Azienda non selezionata e utente non autenticato",console.debug("[Impostazioni] addPunchPoint abort: aziendaCorrente missing and no currentUser",{currentUser:this.currentUser});return}try{let u=yield nt(this.companyService.getAziendaForUser(this.currentUser.id,this.currentUser.company_id));u&&(this.aziendaCorrente=u,this.punchPoints=[...u.punch_points||[]],this.patchAziendaForm(u))}catch(u){console.warn("[Impostazioni] fallback getAziendaForUser failed",u)}}if(!this.aziendaCorrente?.id){this.messaggioErrore="Azienda non selezionata",console.debug("[Impostazioni] addPunchPoint abort: aziendaCorrente missing after reload attempt",{currentUser:this.currentUser});return}let t=N({},this.newPoint);t.radius_m=Number(t.radius_m)||50;let e=t.address||"",i=t.civic_number||"",r=t.city||this.aziendaCorrente?.city||"",o=t.province||this.aziendaCorrente?.province||"",s=yield this.geocodeAddress(e,i,r,o);if(!s){this.messaggioErrore="Impossibile trovare coordinate per l'indirizzo inserito. Controlla indirizzo/civico/citt\xE0.";return}t.lat=s.lat,t.lng=s.lng,t.address=s.displayName,t.id=Math.random().toString(36).slice(2,9),delete t.civic_number;let a=[...this.punchPoints||[],t];this.salvataggioAzienda=!0,this.companyService.aggiornaAzienda(this.aziendaCorrente.id,{punch_points:a}).subscribe({next:u=>y(this,null,function*(){this.salvataggioAzienda=!1,console.debug("[Impostazioni] aggiornaAzienda response",u);try{if(!this.currentUser)console.warn("[Impostazioni] currentUser non definito, salto refresh azienda");else{let f=yield nt(this.companyService.getAziendaForUser(this.currentUser.id,this.currentUser.company_id));f&&(this.aziendaCorrente=f,this.punchPoints=[...f.punch_points||[]],this.patchAziendaForm(f))}}catch(f){console.warn("[Impostazioni] impossibile ricaricare azienda dopo update",f),u&&(this.aziendaCorrente=u,this.punchPoints=u.punch_points||a,this.patchAziendaForm(u))}this.messaggioSuccesso="Punto di timbratura salvato",this.nascondiMessaggioDopoTimeout()}),error:u=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] errore salva punch_point",u),this.messaggioErrore="Errore durante il salvataggio del punto (verifica permessi / console network)"}})})}removePunchPoint(t){this.punchPoints.splice(t,1)}toggleShowEmployees(){this.showAllEmployees=!this.showAllEmployees}geocodeAddress(t,e,i,r){return y(this,null,function*(){let o=[];t&&o.push(t),e&&o.push(e),i&&o.push(i),r&&o.push(r);let s=o.join(", ");if(!s)return null;let a="https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+encodeURIComponent(s);try{let u=yield fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(!u.ok)return null;let f=yield u.json();if(!Array.isArray(f)||f.length===0)return null;let h=f[0];return{lat:Number(h.lat),lng:Number(h.lon),displayName:h.display_name}}catch(u){return console.error("[Impostazioni] geocodeAddress error",u),null}})}getStreet(t){let e=(t?.address||t?.name||"").toString().trim();if(!e)return"";let i=e.split(",").map(s=>s.trim()).filter(Boolean),r=i[0]||"",o=r.match(/^(.*\D)\s+(\d+\S*)$/);return o?o[1].trim():i.length>=2&&/^\d+\S*$/.test(i[0])?i[1]:r}getCivic(t){let e=(t?.address||"").toString().trim();if(!e)return"";let i=e.split(",").map(s=>s.trim()).filter(Boolean),o=(i[0]||"").match(/^(.*\D)\s+(\d+\S*)$/);return o?o[2].trim():i.length>=2&&/^\d+\S*$/.test(i[0])?i[0]:i.length>=2&&/^\d+\S*$/.test(i[1])?i[1]:""}getCityProvince(t){let e=(t?.city||"").toString().trim(),i=(t?.province||"").toString().trim();if(e||i)return`${e}${i&&e!==i?" "+i:""}`.trim();let r=(t?.address||"").toString().trim();if(!r)return"";let o=r.split(",").map(f=>f.trim()).filter(Boolean),s=["italia","italy"];for(;o.length&&s.includes(o[o.length-1].toLowerCase());)o.pop();for(;o.length&&/^\d{4,}$/.test(o[o.length-1]);)o.pop();let a=this.getStreet(t),u=this.getCivic(t);for(let f=o.length-1;f>=0;f--){let h=o[f];if(h&&!(h===a||h===u)&&!(/^\d+$/.test(h)||h.length>40))return h}return""}caricaReparti(){if(!this.aziendaCorrente?.id){console.debug("[Impostazioni] caricaReparti called without aziendaCorrente.id");return}console.debug("[Impostazioni] caricaReparti companyId=",this.aziendaCorrente.id),this.departmentsService.getDepartments(this.aziendaCorrente.id).subscribe({next:t=>{console.debug("[Impostazioni] caricaReparti response count=",(t||[]).length),this.departments=t},error:t=>{console.error("[Impostazioni] errore caricamento reparti",t)}})}aggiungiReparto(){if(!this.newDepartmentName.trim()||!this.aziendaCorrente?.id)return;let t={company_id:this.aziendaCorrente.id,name:this.newDepartmentName.trim(),description:this.newDepartmentDescription.trim()||void 0};this.departmentsService.createDepartment(t).subscribe({next:e=>{this.departments.push(e),this.newDepartmentName="",this.newDepartmentDescription="",this.messaggioSuccesso="Reparto aggiunto con successo",this.nascondiMessaggioDopoTimeout()},error:e=>{console.error("[Impostazioni] errore aggiunta reparto",e),this.messaggioErrore="Errore durante l'aggiunta del reparto",this.nascondiMessaggioDopoTimeout()}})}avviaModificaReparto(t){this.editingDepartment=N({},t)}salvaModificaReparto(){this.editingDepartment&&this.departmentsService.updateDepartment(this.editingDepartment.id,{name:this.editingDepartment.name,description:this.editingDepartment.description}).subscribe({next:t=>{let e=this.departments.findIndex(i=>i.id===t.id);e!==-1&&(this.departments[e]=t),this.editingDepartment=null,this.messaggioSuccesso="Reparto aggiornato con successo",this.nascondiMessaggioDopoTimeout()},error:t=>{console.error("[Impostazioni] errore modifica reparto",t),this.messaggioErrore="Errore durante la modifica del reparto",this.nascondiMessaggioDopoTimeout()}})}annullaModificaReparto(){this.editingDepartment=null}toggleManagerDepartment(t,e){let i=e.target.checked;this.managerConfig.department_ids||(this.managerConfig.department_ids=[]);let r=this.managerConfig.department_ids.indexOf(t);i&&r===-1?this.managerConfig.department_ids.push(t):!i&&r!==-1&&this.managerConfig.department_ids.splice(r,1)}eliminaReparto(t){this.departmentsService.canDeleteDepartment(t.id).subscribe({next:e=>{if(!e.canDelete){this.messaggioErrore=`Impossibile eliminare il reparto "${t.name}". Ci sono ${e.employeeCount} dipendenti assegnati.`,this.nascondiMessaggioDopoTimeout();return}confirm(`Sei sicuro di voler eliminare il reparto "${t.name}"?`)&&this.departmentsService.deleteDepartment(t.id).subscribe({next:()=>{this.departments=this.departments.filter(i=>i.id!==t.id),this.messaggioSuccesso="Reparto eliminato con successo",this.nascondiMessaggioDopoTimeout()},error:i=>{console.error("[Impostazioni] errore eliminazione reparto",i),this.messaggioErrore="Errore durante l'eliminazione del reparto",this.nascondiMessaggioDopoTimeout()}})},error:e=>{console.error("[Impostazioni] errore controllo eliminazione reparto",e),this.messaggioErrore="Errore durante il controllo del reparto",this.nascondiMessaggioDopoTimeout()}})}toggleAddPointForm(){this.showAddPointForm=!this.showAddPointForm,this.showAddPointForm?this.aziendaCorrente&&(this.newPoint.city=this.aziendaCorrente.city??this.newPoint.city,this.newPoint.province=this.aziendaCorrente.province??this.newPoint.province):this.newPoint={name:"",address:"",civic_number:"",city:this.aziendaCorrente?.city||null,province:this.aziendaCorrente?.province||null,lat:null,lng:null,radius_m:50}}toggleOpeningHours(){this.showOpeningHours=!this.showOpeningHours}toggleProfilo(){this.showProfilo=!this.showProfilo}toggleAzienda(){this.showAzienda=!this.showAzienda}toggleReparti(){this.showReparti=!this.showReparti}toggleGestioneReparti(){this.showGestioneReparti=!this.showGestioneReparti}toggleVisibilitaResponsabili(){this.showVisibilitaResponsabili=!this.showVisibilitaResponsabili}toggleClosedDays(){this.showClosedDays=!this.showClosedDays}autoSaveOpeningHours(){if(this.aziendaCorrente?.id)try{let t=this.aziendaForm.get("opening_hours"),e={};this.giorniSettimana.forEach(i=>{let r=t.get(i.key);e[i.key]={open:r.get("open")?.value||null,close:r.get("close")?.value||null,closed:!!r.get("closed")?.value}}),this.salvataggioAzienda=!0,this.companyService.aggiornaAzienda(this.aziendaCorrente.id,{opening_hours:e}).subscribe({next:i=>{this.salvataggioAzienda=!1,i&&(this.aziendaCorrente=i,console.debug("[Impostazioni] opening_hours autosaved",e))},error:i=>{this.salvataggioAzienda=!1,console.error("[Impostazioni] autosave opening_hours failed",i)}})}catch(t){console.error("[Impostazioni] autoSaveOpeningHours unexpected",t)}}resetOrariDefault(){let t=this.openingHoursGroup,e={monday:{open:"09:00",close:"18:00",closed:!1},tuesday:{open:"09:00",close:"18:00",closed:!1},wednesday:{open:"09:00",close:"18:00",closed:!1},thursday:{open:"09:00",close:"18:00",closed:!1},friday:{open:"09:00",close:"18:00",closed:!1},saturday:{open:"09:00",close:"13:00",closed:!1},sunday:{open:"",close:"",closed:!0}};this.giorniSettimana.forEach(i=>{let r=t.get(i.key);r&&r.patchValue(e[i.key])}),this.messaggioSuccesso="Orari reimpostati ai valori predefiniti",this.nascondiMessaggioDopoTimeout()}get managerUsers(){return(this.companyEmployees||[]).filter(t=>(t?.role??"").toString().trim().toLowerCase()==="manager")}loadJobTitles(t){if(!t){this.jobTitles=[];return}this.isLoadingJobTitles=!0,this.jobtitleService.getJobTitles(t).subscribe({next:e=>{this.jobTitles=Array.isArray(e)?e:[],this.isLoadingJobTitles=!1},error:e=>{console.error("[Impostazioni] loadJobTitles error",e),this.jobTitles=[],this.isLoadingJobTitles=!1}})}createJobTitle(t){if(!t){alert("Company non impostata");return}let e=(this.newJobTitleName??"").trim();if(!e)return alert("Inserisci il nome della mansione");this.isLoadingJobTitles=!0,this.jobtitleService.createJobTitle(t,{name:e,description:this.newJobTitleDescription??null}).then(i=>{this.jobTitles.unshift(i),this.newJobTitleName=null,this.newJobTitleDescription=null,this.isLoadingJobTitles=!1}).catch(i=>{console.error("[Impostazioni] createJobTitle error",i),alert("Errore creazione mansione"),this.isLoadingJobTitles=!1})}beginEditJobTitle(t){this.editingJobTitle=N({},t)}saveEditJobTitle(){if(!this.editingJobTitle?.id)return;let t=this.editingJobTitle.id,e={name:this.editingJobTitle.name,description:this.editingJobTitle.description};this.isLoadingJobTitles=!0,this.jobtitleService.updateJobTitle(t,e).then(i=>{let r=this.jobTitles.findIndex(o=>o.id===t);r>=0&&(this.jobTitles[r]=i??this.jobTitles[r]),this.editingJobTitle=null,this.isLoadingJobTitles=!1}).catch(i=>{console.error("[Impostazioni] saveEditJobTitle error",i),alert("Errore salvataggio mansione"),this.isLoadingJobTitles=!1})}cancelEditJobTitle(){this.editingJobTitle=null}deactivateJobTitle(t){confirm("Disattivare questa mansione? (non verr\xE0 cancellata, potr\xE0 essere riattivata)")&&(this.isLoadingJobTitles=!0,this.jobtitleService.deleteJobTitle(t).then(()=>{let e=this.jobTitles.findIndex(i=>i.id===t);e>=0&&(this.jobTitles[e].is_active=!1),this.isLoadingJobTitles=!1}).catch(e=>{console.error("[Impostazioni] deactivateJobTitle error",e),alert("Errore disattivazione mansione"),this.isLoadingJobTitles=!1}))}toggleMansioni(){if(this.showMansioni=!this.showMansioni,this.showMansioni)try{this.loadJobTitles(this.aziendaCorrente?.id??null)}catch(t){console.warn("[Impostazioni] toggleMansioni loadJobTitles failed",t)}}toggleJobTitleActive(t){return y(this,null,function*(){if(!t||!t.id)return;let e=!t.is_active;if(!(!e&&!confirm(`Disattivare la mansione "${t.name}"?`))){this.isLoadingJobTitles=!0;try{let i=this.jobtitleService.setJobTitleActive?yield this.jobtitleService.setJobTitleActive(t.id,e):yield this.jobtitleService.updateJobTitle(t.id,{is_active:e});if(i){let r=this.jobTitles.findIndex(o=>o.id===i.id);r>=0&&(this.jobTitles[r]=i)}}catch(i){console.error("[Impostazioni] toggleJobTitleActive error",i),alert("Errore durante l'aggiornamento dello stato mansione")}finally{this.isLoadingJobTitles=!1}}})}static \u0275fac=function(e){return new(e||n)(D(Ii),D(le),D(et),D(Ot),D(sa),D(Nr))};static \u0275cmp=we({type:n,selectors:[["app-impostazioni"]],decls:85,vars:22,consts:[["noMansioni",""],["showName",""],["showDesc",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"settings-grid"],[1,"form-section"],[1,"subsection-header",2,"display","flex","align-items","center","justify-content","space-between","cursor","pointer",3,"click"],["type","button","title","Mostra/Nascondi Profilo",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],[4,"ngIf"],["class","form-section",4,"ngIf"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],["type","password","formControlName","currentPassword",1,"form-control"],["type","password","formControlName","newPassword",1,"form-control"],["type","password","formControlName","confirmPassword",1,"form-control"],[1,"form-actions"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"notifications-grid"],[1,"checkbox-label","large"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"checkmark"],[1,"notification-info"],["class","checkbox-label large",4,"ngIf"],["type","button",1,"promethea-button",3,"click","disabled"],["class","status-message info",4,"ngIf"],["class","status-message error",4,"ngIf"],["type","text","formControlName","first_name",1,"form-control"],["class","error",4,"ngIf"],["type","text","formControlName","last_name",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","tel","formControlName","phone",1,"form-control"],["type","date","formControlName","hire_date",1,"form-control",3,"disabled"],[1,"info","small"],["type","date","formControlName","birth_date",1,"form-control"],["type","text","formControlName","birth_place",1,"form-control"],["type","text","formControlName","fiscal_code",1,"form-control"],["type","text","formControlName","job_title",1,"form-control"],["type","number","min","0","formControlName","monthly_hours",1,"form-control"],[1,"form-group","checkbox-inline"],[1,"checkbox-label"],["type","checkbox","formControlName","full_time"],["type","text","formControlName","timezone","placeholder","Europe/Rome",1,"form-control"],["type","text","disabled","",1,"form-control",3,"value"],[1,"error"],[1,"loading-spinner"],["type","button","title","Mostra/Nascondi Dati Azienda",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["type","text","formControlName","name",1,"form-control"],["type","text","formControlName","vat",1,"form-control"],["type","text","formControlName","address",1,"form-control"],["type","text","formControlName","city",1,"form-control"],["type","text","formControlName","province",1,"form-control"],["type","url","formControlName","website",1,"form-control"],["type","tel","formControlName","numero_telefono",1,"form-control"],[1,"radio-group"],[1,"radio-label"],["type","radio","formControlName","timbratura_type","value","libera"],[1,"radio-checkmark"],["type","radio","formControlName","timbratura_type","value","punti"],["class","form-subsection full-width",4,"ngIf"],[1,"form-subsection","full-width"],["type","button","title","Mostra/Nascondi orari",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["type","button","title","Mostra/Nascondi Giorni Chiusura",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],[1,"subsection-title"],[1,"punch-points-list"],["class","team-member",4,"ngFor","ngForOf"],[1,"form-actions",2,"margin","12px 0"],["class","point-form",4,"ngIf"],[1,"team-member"],["aria-hidden","true",1,"user-avatar-small"],[1,"member-info"],[1,"member-name"],[1,"info-detail","location-chip",2,"display","flex","align-items","center","gap","8px"],["aria-hidden","true",1,"material-icons"],[2,"display","flex","flex","1","align-items","center","gap","12px","flex-wrap","wrap","min-width","0"],[2,"min-width","0","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],[2,"display","inline-block","overflow","hidden","text-overflow","ellipsis"],[2,"font-size","0.85em","color","var(--text-color)","opacity","0.8","margin-left","6px"],[1,"muted","small",2,"margin-top","4px"],[2,"margin-left","auto","text-align","right","white-space","nowrap"],[1,"muted","small"],[2,"margin-top","6px"],[1,"chip"],["type","button","title","Rimuovi",1,"icon-button",3,"click"],[1,"point-form"],["type","text","placeholder","Es. Sede Principale",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"grid-alternative",2,"display","flex","gap","var(--gutter-sm)"],[1,"form-group","wider"],["type","text","placeholder","Es. Via Roma",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-group","narrower"],["type","text","placeholder","Es. 12/A",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"grid-alternative"],["type","text","placeholder","Citt\xE0",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Provincia (es. RM)",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"inline-fields"],[1,"form-group","small"],["type","number","placeholder","50",1,"form-control","small",3,"ngModelChange","ngModel","ngModelOptions"],["formGroupName","opening_hours",1,"opening-hours-grid"],["class","day-row",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"promethea-button","ghost","small",3,"click"],[1,"day-row",3,"formGroupName"],[1,"day-label"],[1,"day-controls"],["type","time","formControlName","open","step","60",1,"form-control"],["type","time","formControlName","close","step","60",1,"form-control"],[1,"form-group","small","checkbox-inline"],["type","checkbox","formControlName","closed"],[1,"closed-days-grid"],["class","day-row feste",4,"ngFor","ngForOf"],[1,"closed-days-actions"],[1,"action-group"],["type","date",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","placeholder","Nome festivit\xE0 (es. Chiusura estiva)",1,"form-control",2,"max-width","300px","margin-left","8px",3,"ngModelChange","ngModel","ngModelOptions"],["type","button",1,"promethea-button",3,"click"],[1,"actions-right"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"day-row","feste"],[1,"info-detail"],["type","button","title","Mostra/Nascondi Mansioni",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],[1,"form-card"],[1,"card-content",2,"gap","12px"],[2,"display","flex","gap","12px","flex-wrap","wrap"],["type","text","placeholder","Nome mansione",3,"ngModelChange","ngModel"],["type","text","placeholder","Descrizione (opzionale)",3,"ngModelChange","ngModel"],["class","loading-container","style","padding:8px;",4,"ngIf"],[1,"table-section"],["class","table-container",4,"ngIf"],[1,"loading-container",2,"padding","8px"],[1,"loading-spinner",2,"width","24px","height","24px","border-width","3px"],[1,"table-container"],["class","crm-table",4,"ngIf","ngIfElse"],[1,"crm-table"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"action-buttons"],["class","icon-button",3,"click",4,"ngIf"],[1,"icon-button",3,"click","title"],["type","text",3,"ngModelChange","ngModel"],[1,"icon-button",3,"click"],[1,"empty-state"],["type","button","title","Mostra/Nascondi Gestione Reparti",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["class","generic-form",4,"ngIf"],[1,"generic-form"],[1,"form-subsection"],["type","text","placeholder","Es. Commerciale, Amministrazione",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["placeholder","Descrizione opzionale del reparto","rows","2",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],["class","empty-state",4,"ngIf"],[1,"departments-list"],["class","department-item",4,"ngFor","ngForOf"],[1,"department-item"],[1,"department-info"],["class","department-details",4,"ngIf"],["class","edit-form",4,"ngIf"],[1,"actions-container"],["style","display: flex; flex-direction: row; gap: var(--gutter-sm);",4,"ngIf"],[1,"department-details"],[1,"department-header"],[1,"employee-count"],["class","department-description",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"department-description"],[1,"edit-form"],["type","text","placeholder","Nome reparto",1,"form-control","small",3,"ngModelChange","ngModel"],["rows","2","placeholder","Descrizione",1,"form-control","small",3,"ngModelChange","ngModel"],[2,"display","flex","flex-direction","row","gap","var(--gutter-sm)"],["type","button","title","Modifica",1,"icon-button",3,"click"],["type","button","title","Elimina",1,"icon-button",3,"click","disabled"],["type","button","title","Salva",1,"icon-button","success",3,"click"],["type","button","title","Annulla",1,"icon-button",3,"click"],["type","button","title","Mostra/Nascondi Visibilit\xE0",1,"icon-button",2,"background","none","border","0","padding","6px","cursor","pointer",3,"aria-expanded"],["name","selectedManager",1,"form-control",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","manager-config",4,"ngIf"],[1,"manager-config"],[1,"announcements-list"],["type","radio","name","mode","value","self",3,"ngModelChange","ngModel"],["type","radio","name","mode","value","selected_users",3,"ngModelChange","ngModel"],["class","form-group",4,"ngIf"],["type","radio","name","mode","value","roles",3,"ngModelChange","ngModel"],["type","radio","name","mode","value","department",3,"ngModelChange","ngModel"],[1,"permissions-grid"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"users-list"],["class","checkbox-label",4,"ngFor","ngForOf"],["class","info small",4,"ngIf"],["type","checkbox",3,"change","value","checked"],[1,"roles-list"],[1,"status-message","info"],[1,"status-message","error"]],template:function(e,i){e&1&&(c(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),d(4,"settings"),l()(),c(5,"div",7)(6,"h1",8),d(7,"Impostazioni"),l(),c(8,"p",9),d(9,"Gestisci il tuo profilo e le impostazioni aziendali"),l()()(),c(10,"div",10)(11,"div",11)(12,"div",12),x("click",function(){return i.toggleProfilo()}),c(13,"h2",8)(14,"span",6),d(15,"person"),l(),d(16," Profilo Utente"),l(),c(17,"button",13)(18,"span",6),d(19),l()()(),E(20,Fj,96,11,"div",14),l(),E(21,Zj,10,4,"div",15)(22,d3,10,4,"div",15)(23,w3,10,4,"div",15)(24,O3,10,4,"div",15),c(25,"div",11)(26,"h2",8)(27,"span",6),d(28,"security"),l(),d(29," Sicurezza "),l(),c(30,"form",16),x("ngSubmit",function(){return i.cambiaPassword()}),c(31,"div",17)(32,"div",18)(33,"label",19)(34,"span",6),d(35,"lock"),l(),d(36," Password Attuale "),l(),P(37,"input",20),l(),c(38,"div",18)(39,"label",19)(40,"span",6),d(41,"lock_reset"),l(),d(42," Nuova Password "),l(),P(43,"input",21),l(),c(44,"div",18)(45,"label",19)(46,"span",6),d(47,"lock_reset"),l(),d(48," Conferma Password "),l(),P(49,"input",22),l()(),c(50,"div",23)(51,"button",24),E(52,N3,2,0,"span",25)(53,P3,1,0,"span",26),d(54),l()()()(),c(55,"div",11)(56,"h2",8)(57,"span",6),d(58,"notifications"),l(),d(59," Notifiche "),l(),c(60,"div",27)(61,"label",28)(62,"input",29),W("ngModelChange",function(o){return G(i.impostazioniNotifiche.emailNotifiche,o)||(i.impostazioniNotifiche.emailNotifiche=o),o}),l(),P(63,"span",30),c(64,"div",31)(65,"strong"),d(66,"Notifiche Email"),l(),c(67,"span"),d(68,"Ricevi notifiche via email per le tue timbrature"),l()()(),c(69,"label",28)(70,"input",29),W("ngModelChange",function(o){return G(i.impostazioniNotifiche.riepilogoGiornaliero,o)||(i.impostazioniNotifiche.riepilogoGiornaliero=o),o}),l(),P(71,"span",30),c(72,"div",31)(73,"strong"),d(74,"Riepilogo Giornaliero"),l(),c(75,"span"),d(76,"Ricevi un riepilogo giornaliero delle tue ore"),l()()(),E(77,k3,8,1,"label",32),l(),c(78,"div",23)(79,"button",33),x("click",function(){return i.salvaNotifiche()}),E(80,F3,2,0,"span",25)(81,L3,1,0,"span",26),d(82),l()()()(),E(83,j3,4,1,"div",34)(84,V3,4,1,"div",35),l()),e&2&&(p(17),fn("aria-expanded",_i(i.showProfilo)),p(2),T(i.showProfilo?"expand_less":"expand_more"),p(),_("ngIf",i.showProfilo),p(),_("ngIf",i.hasRole("admin")),p(),_("ngIf",i.hasRole("admin")||i.hasRole("manager")&&i.canManageJobTitles()),p(),_("ngIf",i.hasRole("admin")||i.hasRole("manager")&&i.canManageDepartments()),p(),_("ngIf",i.hasRole("admin")),p(6),_("formGroup",i.sicurezzaForm),p(21),_("disabled",i.sicurezzaForm.invalid||i.salvataggioPassword),p(),_("ngIf",!i.salvataggioPassword),p(),_("ngIf",i.salvataggioPassword),p(),R(" ",i.salvataggioPassword?"Salvando...":"Cambia Password"," "),p(8),H("ngModel",i.impostazioniNotifiche.emailNotifiche),p(8),H("ngModel",i.impostazioniNotifiche.riepilogoGiornaliero),p(7),_("ngIf",i.hasRole("admin")),p(2),_("disabled",i.salvataggioNotifiche),p(),_("ngIf",!i.salvataggioNotifiche),p(),_("ngIf",i.salvataggioNotifiche),p(),R(" ",i.salvataggioNotifiche?"Salvando...":"Salva Notifiche"," "),p(),_("ngIf",i.messaggioSuccesso),p(),_("ngIf",i.messaggioErrore))},dependencies:[Ee,Be,xe,Ti,Ln,Wt,Gt,Re,Wl,bo,At,lv,Fe,Fn,dv,jn,oi,Hs,Rt,yt,cl,tn],styles:[".closed-days-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--gutter-sm)}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:var(--gutter-sm);justify-content:flex-start}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{flex:1 1 auto;min-width:0;overflow:hidden}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;overflow:hidden;text-overflow:ellipsis}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   .info-detail[_ngcontent-%COMP%]{font-size:.85rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);margin-top:4px;overflow:hidden}.closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child, .closed-days-grid[_ngcontent-%COMP%]   .day-row.feste[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:8px}.closed-days-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm, 12px);margin-top:var(--space-sm, 12px);align-items:center}.closed-days-actions[_ngcontent-%COMP%]   .action-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{margin-left:auto}.closed-days-actions[_ngcontent-%COMP%]   .form-control[type=date][_ngcontent-%COMP%]{max-width:220px}@media (max-width: 600px){.closed-days-actions[_ngcontent-%COMP%]{flex-wrap:wrap;gap:10px}.closed-days-actions[_ngcontent-%COMP%]   .action-group[_ngcontent-%COMP%], .closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{flex:1 1 100%;display:flex;justify-content:flex-start}.closed-days-actions[_ngcontent-%COMP%]   .actions-right[_ngcontent-%COMP%]{justify-content:flex-end}}.point-form[_ngcontent-%COMP%], .inline-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.form-subsection.full-width[_ngcontent-%COMP%]{grid-column:1 / -1;width:100%}.form-group.wider[_ngcontent-%COMP%]{flex:2}.form-group.narrower[_ngcontent-%COMP%]{flex:1}.departments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.department-item[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:flex-start;padding:var(--gutter-sm);border:1px solid var(--border-color);border-radius:var(--border-radius);background:var(--surface-color)}.department-info[_ngcontent-%COMP%]{flex:1}.department-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin-bottom:4px}.department-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1.1em;color:var(--text-color)}.employee-count[_ngcontent-%COMP%]{font-size:.85em;color:var(--text-muted);background:var(--primary-light);padding:2px 8px;border-radius:12px}.department-description[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.9em;color:var(--text-muted)}.department-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;width:100%}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl);color:var(--text-muted)}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:3em;margin-bottom:var(--gutter-sm);opacity:.5}.form-control[type=time][_ngcontent-%COMP%]{width:140px;min-width:120px;box-sizing:border-box;padding:6px 8px}.form-group.small[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-width:120px;max-width:260px}.checkbox-inline[_ngcontent-%COMP%]{display:flex;align-items:center;min-width:120px}.day-controls[_ngcontent-%COMP%]   .form-group.small[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.day-row[_ngcontent-%COMP%]:focus-within{border-color:#0000000f;background:color-mix(in srgb,var(--primary-light) 6%,transparent)}"]})};var z3=()=>[1,2,3,4,5,6,7,8,9,10,11,12];function U3(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),R(" ",("0"+e).slice(-2)," ")}}function B3(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function $3(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Mese"),l(),c(3,"div",30)(4,"select",11),W("ngModelChange",function(r){C(e);let o=g();return G(o.monthNumber,r)||(o.monthNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onMonthChange())}),E(5,U3,2,2,"option",18),l(),c(6,"select",11),W("ngModelChange",function(r){C(e);let o=g();return G(o.yearNumber,r)||(o.yearNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onMonthChange())}),E(7,B3,2,2,"option",18),l()()()}if(n&2){let e=g();p(4),H("ngModel",e.monthNumber),p(),_("ngForOf",Ue(4,z3)),p(),H("ngModel",e.yearNumber),p(),_("ngForOf",e.years)}}function H3(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function W3(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Anno"),l(),c(3,"select",11),W("ngModelChange",function(r){C(e);let o=g();return G(o.yearNumber,r)||(o.yearNumber=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.onYearChange())}),E(4,H3,2,2,"option",18),l()()}if(n&2){let e=g();p(3),H("ngModel",e.yearNumber),p(),_("ngForOf",e.years)}}function G3(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Data Inizio"),l(),c(3,"input",32),W("ngModelChange",function(r){C(e);let o=g();return G(o.dataInizio,r)||(o.dataInizio=r),S(r)}),l()()}if(n&2){let e=g();p(3),H("ngModel",e.dataInizio)}}function q3(n,t){if(n&1){let e=k();c(0,"div",9)(1,"label",10),d(2,"Data Fine"),l(),c(3,"input",32),W("ngModelChange",function(r){C(e);let o=g();return G(o.dataFine,r)||(o.dataFine=r),S(r)}),l()()}if(n&2){let e=g();p(3),H("ngModel",e.dataFine)}}function J3(n,t){if(n&1&&(c(0,"option",31),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),ve("",e.first_name," ",e.last_name)}}function K3(n,t){if(n&1&&P(0,"input",33),n&2){let e=g();_("value",(e.currentUser==null?null:e.currentUser.first_name)+" "+(e.currentUser==null?null:e.currentUser.last_name))}}function Y3(n,t){n&1&&(c(0,"span",3),d(1,"refresh"),l())}function Z3(n,t){n&1&&P(0,"span",34)}function Q3(n,t){if(n&1&&(c(0,"div",35)(1,"h2",5)(2,"span",3),d(3,"insights"),l(),d(4," Statistiche "),l(),c(5,"div",36)(6,"div",37)(7,"h3",38),d(8,"Ore Totali"),l(),c(9,"div",39),d(10),Z(11,"number"),l(),c(12,"p",6),d(13,"Periodo selezionato"),l()(),c(14,"div",37)(15,"h3",38),d(16,"Media Giornaliera"),l(),c(17,"div",39),d(18),Z(19,"number"),l(),c(20,"p",6),d(21,"Per giorno lavorativo"),l()(),c(22,"div",37)(23,"h3",38),d(24,"Giorni Lavorati"),l(),c(25,"div",39),d(26),l(),c(27,"p",6),d(28),l()(),c(29,"div",37)(30,"h3",38),d(31,"Ore di Pause"),l(),c(32,"div",39),d(33),Z(34,"number"),l(),c(35,"p",6),d(36,"Totale pause"),l()()()()),n&2){let e=g();p(10),R("",X(11,5,e.datiReport.oreTotali,"1.1-1"),"h"),p(8),R("",X(19,8,e.datiReport.mediaGiornaliera,"1.1-1"),"h"),p(8),T(e.datiReport.giorniLavorati),p(2),R("Su ",e.datiReport.giorniTotali," giorni"),p(5),R("",X(34,11,e.datiReport.orePause,"1.1-1"),"h")}}function X3(n,t){if(n&1&&(c(0,"span",46),d(1),l()),n&2){let e=g().$implicit,i=g(2);_("title",e.note),p(),R(" ",i.troncaTesto(e.note,20)," ")}}function eV(n,t){n&1&&(c(0,"span"),d(1,"-"),l())}function tV(n,t){if(n&1&&(c(0,"tr")(1,"td"),d(2),Z(3,"date"),l(),c(4,"td"),d(5),l(),c(6,"td"),d(7),l(),c(8,"td"),d(9),l(),c(10,"td"),d(11),Z(12,"number"),l(),c(13,"td"),d(14),Z(15,"number"),l(),c(16,"td"),d(17),Z(18,"number"),l(),c(19,"td"),E(20,X3,2,2,"span",44)(21,eV,2,0,"span",45),l()()),n&2){let e=t.$implicit;p(2),T(X(3,9,e.data,"dd/MM/yyyy")),p(3),T(e.dipendente),p(2),T(e.oraInizio),p(2),T(e.oraFine),p(2),R("",X(12,12,e.oreLavorate,"1.1-1"),"h"),p(3),R("",X(15,15,e.pause,"1.1-1"),"h"),p(3),R("",X(18,18,e.oreEffettive,"1.1-1"),"h"),p(3),_("ngIf",e.note),p(),_("ngIf",!e.note)}}function nV(n,t){if(n&1&&(c(0,"div",40)(1,"h2",5)(2,"span",3),d(3,"view_list"),l(),d(4," Dettaglio Timbrature "),l(),c(5,"div",41)(6,"table",42)(7,"thead")(8,"tr")(9,"th"),d(10,"Data"),l(),c(11,"th"),d(12,"Dipendente"),l(),c(13,"th"),d(14,"Ora Inizio"),l(),c(15,"th"),d(16,"Ora Fine"),l(),c(17,"th"),d(18,"Ore Lavorate"),l(),c(19,"th"),d(20,"Pause"),l(),c(21,"th"),d(22,"Ore Effettive"),l(),c(23,"th"),d(24,"Note"),l()()(),c(25,"tbody"),E(26,tV,22,21,"tr",43),l()()()()),n&2){let e=g();p(26),_("ngForOf",e.datiReport.dettaglio)}}function iV(n,t){if(n&1&&(c(0,"div",51)(1,"div",52),d(2),l(),c(3,"div",53),P(4,"div",54),l(),c(5,"div",55),d(6),Z(7,"number"),l()()),n&2){let e=t.$implicit,i=g(2);p(2),T(e.giorno),p(2),vi("height",e.ore/i.datiReport.maxOreGiornaliere*100+"%"),p(2),R("",X(7,4,e.ore,"1.1-1"),"h")}}function rV(n,t){if(n&1&&(c(0,"div",7)(1,"h2",5)(2,"span",3),d(3,"bar_chart"),l(),d(4," Andamento Ore Lavorative "),l(),c(5,"div",47)(6,"div",48)(7,"p",6),d(8,"Grafico delle ore lavorative per giorno"),l(),c(9,"div",49),E(10,iV,8,7,"div",50),l()()()()),n&2){let e=g();p(10),_("ngForOf",e.datiReport.graficoOre)}}function oV(n,t){n&1&&(c(0,"div",56)(1,"span",3),d(2,"analytics"),l(),c(3,"h3"),d(4,"Nessun report generato"),l(),c(5,"p"),d(6,"Seleziona i filtri e genera un report per visualizzare i dati."),l()())}var Sp=class n{constructor(t,e,i,r){this.authService=t;this.companyService=e;this.timbratureService=i;this.reportsService=r}tipoReport="settimanale";dataInizio="";dataFine="";dipendenteSelezionato="tutti";monthSelected="";supportsMonthInput=!1;monthNumber=1;yearNumber=new Date().getFullYear();years=[];currentUser=null;dipendenti=[];datiReport=null;isLoading=!1;ngOnInit(){try{let i=document.createElement("input");i.setAttribute("type","month"),this.supportsMonthInput=i.type==="month"}catch{this.supportsMonthInput=!1}let t=new Date().getFullYear(),e=t-5;this.years=Array.from({length:8},(i,r)=>e+r),this.monthSelected||(this.monthNumber=new Date().getMonth()+1),this.yearNumber||(this.yearNumber=t),this.authService.currentUser$.subscribe(i=>{this.currentUser=i,i&&(this.impostaDatePredefinite(),(this.hasRole("admin")||this.hasRole("manager"))&&this.caricaDipendenti(i.company_id))})}onFiltroChange(){this.isLoading||(this.datiReport=null,this.generaReport().catch(t=>console.error("[Report] onFiltroChange error",t)))}impostaDatePredefinite(){let t=new Date;switch(this.tipoReport){case"settimanale":{if(!this.dataInizio||!this.dataFine){let e=new Date(t),i=t.getDay(),r=i===0?-6:1-i;e.setDate(t.getDate()+r),this.dataInizio=e.toISOString().split("T")[0],this.dataFine=t.toISOString().split("T")[0]}break}case"mensile":{if(this.monthSelected)this.applyMonthToDates();else{let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0");this.monthSelected=`${e}-${i}`,this.monthNumber=Number(i),this.yearNumber=e,this.applyMonthToDates()}break}case"annuale":{this.yearNumber||(this.yearNumber=t.getFullYear()),(!this.dataInizio||!this.dataFine)&&this.applyYearToDates();break}case"personalizzato":break}}applyMonthToDates(){if(!this.monthSelected)return;let[t,e]=this.monthSelected.split("-").map(o=>Number(o)),i=new Date(t,e-1,1),r=new Date(t,e,0);this.dataInizio=i.toISOString().split("T")[0],this.dataFine=r.toISOString().split("T")[0]}onYearChange(){this.yearNumber&&(this.applyYearToDates(),this.onFiltroChange())}applyYearToDates(){let t=Number(this.yearNumber)||new Date().getFullYear(),e=new Date(t,0,1),i=new Date(t,11,31);this.dataInizio=e.toISOString().split("T")[0],this.dataFine=i.toISOString().split("T")[0]}onTipoReportChange(){this.impostaDatePredefinite(),this.onFiltroChange()}caricaDipendenti(t){this.companyService.getDipendenti(t).subscribe({next:e=>{this.dipendenti=e},error:e=>{console.error("Errore nel caricamento dipendenti:",e)}})}hasRole(t){return this.authService.hasRole(t)}downloadBlob(t,e){let i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=e,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(i)}onMonthChange(){this.monthNumber=Number(this.monthNumber)||1,this.yearNumber=Number(this.yearNumber)||new Date().getFullYear();let t=String(this.monthNumber).padStart(2,"0");this.monthSelected=`${this.yearNumber}-${t}`,this.applyMonthToDates(),this.onFiltroChange()}generaReport(){return y(this,null,function*(){if(this.tipoReport==="mensile"&&(this.monthSelected||this.impostaDatePredefinite(),this.applyMonthToDates()),console.debug("[Report] generaReport - dataInizio,dataFine,tipoReport,dipendente:",this.dataInizio,this.dataFine,this.tipoReport,this.dipendenteSelezionato),!this.dataInizio||!this.dataFine){alert("Seleziona le date (o il mese) per il report");return}if(!this.currentUser?.company_id){alert("Azienda non definita");return}this.isLoading=!0,this.datiReport=null;let t={company_id:this.currentUser.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};try{yield this.buildDatiReportClientSide(t)}catch(e){console.error("Errore generazione report client-side",e),confirm("Errore nella generazione client-side. Vuoi provare a scaricare il report dal server (se disponibile)?")&&this.reportsService.generaReportTimbrature(t,"xlsx").subscribe({next:i=>{let r=`report_timbrature_${this.dataInizio}_${this.dataFine}.xlsx`;this.downloadBlob(i,r)},error:i=>{console.error("Errore generazione server report",i),alert("Impossibile generare il report sul server.")}})}finally{this.isLoading=!1}})}buildDatiReportClientSide(t){return y(this,null,function*(){let e=t.company_id,i=new Date(t.start_date).getTime(),r=new Date(t.end_date).getTime()+24*3600*1e3,o=yield this.timbratureService.getTimbratureAzienda(e),a=(Array.isArray(o)?o:[]).filter(j=>{let V=new Date(j.start_ts).getTime();return!(V<i||V>=r||t.dipendente&&t.dipendente!=="tutti"&&j.user_id!==t.dipendente)}),u=a.map(j=>{let V=new Date(j.start_ts),L=j.user?`${j.user.first_name} ${j.user.last_name}`:j.user_id??"",se=j.start_ts?new Date(j.start_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",B=j.end_ts?new Date(j.end_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",q=(Number(j.total_minutes)||0)/60,he=0;if(Array.isArray(j.breaks))try{he=j.breaks.reduce((Oi,Pr)=>{let jo=Pr.start_ts?new Date(Pr.start_ts).getTime():0,Ap=Pr.end_ts?new Date(Pr.end_ts).getTime():0;return jo&&Ap&&Ap>jo?Oi+Math.round((Ap-jo)/(1e3*60)):Oi},0)}catch{he=0}let Ve=he/60,ht=Math.max(0,q-Ve);return{data:V,dipendente:L,oraInizio:se,oraFine:B,oreLavorate:Math.round(q*10)/10,pause:Math.round(Ve*10)/10,oreEffettive:Math.round(ht*10)/10,note:j.notes??""}}),f=new Date(t.start_date),h=new Date(t.end_date),m=[],b=Math.ceil((h.getTime()-f.getTime())/(24*3600*1e3))+1;for(let j=0;j<b;j++){let V=new Date(f);V.setDate(f.getDate()+j);let L=new Date(V);L.setHours(0,0,0,0);let se=new Date(L);se.setDate(L.getDate()+1);let B=a.reduce((q,he)=>{let Ve=new Date(he.start_ts);return Ve>=L&&Ve<se?q+(Number(he.total_minutes)||0):q},0);m.push({giorno:V.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"2-digit"}),ore:Math.round(B/60*10)/10})}let v=u.reduce((j,V)=>j+V.oreEffettive,0),w=u.reduce((j,V)=>j+V.pause,0),M=u.length,I=m.length,A=m.length?Math.max(...m.map(j=>j.ore)):0;this.datiReport={oreTotali:v,mediaGiornaliera:I?Math.round(v/I*10)/10:0,giorniLavorati:M,giorniTotali:I,orePause:w,maxOreGiornaliere:A,dettaglio:u,graficoOre:m}})}esportaCSVDaDatiReport(){if(!this.datiReport){alert("Genera prima il report per poterlo esportare.");return}let t="Data;Dipendente;Ora Inizio;Ora Fine;Ore Lavorate;Pause;Ore Effettive;Note",e=this.datiReport.dettaglio.map(s=>{let a=s.data.toISOString().split("T")[0],u=(s.note||"").replace(/\r?\n|\r/g," ").replace(/;/g,",");return`${a};${s.dipendente};${s.oraInizio};${s.oraFine};${s.oreLavorate};${s.pause};${s.oreEffettive};${u}`}),i=[t,...e].join(`\r
`),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),o=`report_timbrature_${this.dataInizio}_${this.dataFine}.csv`;this.downloadBlob(r,o)}generaReportCsvClientSide(t){return y(this,null,function*(){try{this.isLoading=!0;let e=t.company_id,i=yield this.timbratureService.getTimbratureAzienda(e);i=Array.isArray(i)?i:[];let r=new Date(t.start_date).getTime(),o=new Date(t.end_date).getTime()+24*3600*1e3,f=["Data;Dipendente;Ora Inizio;Ora Fine;Ore;Note",...i.filter(b=>{let v=new Date(b.start_ts).getTime();return!(v<r||v>=o||t.dipendente&&t.dipendente!=="tutti"&&b.user_id!==t.dipendente)}).map(b=>{let v=new Date(b.start_ts).toLocaleDateString(),w=b.user_name??b.user_id??"",M=b.start_ts?new Date(b.start_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",I=b.end_ts?new Date(b.end_ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",A=((Number(b.total_minutes)||0)/60).toFixed(2),j=(b.notes||"").replace(/\r?\n|\r/g," ").replace(/;/g,",");return`${v};${w};${M};${I};${A};${j}`})].join(`\r
`),h=new Blob([f],{type:"text/csv;charset=utf-8;"}),m=`report_timbrature_${t.start_date}_${t.end_date}.csv`;this.downloadBlob(h,m)}catch(e){console.error("Errore generazione CSV client-side",e),alert("Impossibile generare report client-side")}finally{this.isLoading=!1}})}generaReportMock(){let t=[{data:new Date("2024-01-15"),dipendente:"Mario Rossi",oraInizio:"08:00",oraFine:"17:00",oreLavorate:9,pause:1,oreEffettive:8,note:"Giornata standard"},{data:new Date("2024-01-16"),dipendente:"Mario Rossi",oraInizio:"09:00",oraFine:"18:00",oreLavorate:9,pause:1,oreEffettive:8,note:"Riunione mattutina"},{data:new Date("2024-01-17"),dipendente:"Mario Rossi",oraInizio:"08:30",oraFine:"17:30",oreLavorate:9,pause:.5,oreEffettive:8.5}],e=[{giorno:"Lun",ore:8},{giorno:"Mar",ore:8},{giorno:"Mer",ore:8.5},{giorno:"Gio",ore:7.5},{giorno:"Ven",ore:8},{giorno:"Sab",ore:4},{giorno:"Dom",ore:0}],i=t.reduce((s,a)=>s+a.oreEffettive,0),r=t.reduce((s,a)=>s+a.pause,0),o=Math.max(...e.map(s=>s.ore));return{oreTotali:i,mediaGiornaliera:i/t.length,giorniLavorati:t.length,giorniTotali:7,orePause:r,maxOreGiornaliere:o,dettaglio:t,graficoOre:e}}esportaPDF(){if(!this.datiReport){alert("Genera il report prima di esportare");return}let t={company_id:this.currentUser?.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};this.reportsService.generaReportTimbrature(t,"pdf").subscribe({next:e=>this.downloadBlob(e,`report_${this.dataInizio}_${this.dataFine}.pdf`),error:()=>{alert("Errore esportazione PDF via server")}})}esportaExcel(){if(!this.datiReport){alert("Genera il report prima di esportare");return}let t={company_id:this.currentUser?.company_id,start_date:this.dataInizio,end_date:this.dataFine,dipendente:this.dipendenteSelezionato==="tutti"?null:this.dipendenteSelezionato};this.reportsService.generaReportTimbrature(t,"xlsx").subscribe({next:e=>this.downloadBlob(e,`report_${this.dataInizio}_${this.dataFine}.xlsx`),error:()=>{alert("Errore esportazione Excel via server")}})}troncaTesto(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}static \u0275fac=function(e){return new(e||n)(D(le),D(et),D(Nt),D(aa))};static \u0275cmp=we({type:n,selectors:[["app-report"]],decls:61,vars:19,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"form-section"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],[1,"form-control",3,"ngModelChange","change","ngModel"],["value","settimanale"],["value","mensile"],["value","annuale"],["value","personalizzato"],["class","form-group",4,"ngIf"],["value","tutti"],[3,"value",4,"ngFor","ngForOf"],["type","text","class","form-control","disabled","",3,"value",4,"ngIf"],[1,"form-actions"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"promethea-button","outline",3,"click","disabled"],[1,"promethea-button","secondary",3,"click","disabled"],["class","kpi-section",4,"ngIf"],["class","table-section",4,"ngIf"],["class","form-section",4,"ngIf"],["class","empty-state",4,"ngIf"],[2,"display","flex","gap","8px","align-items","center"],[3,"value"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["type","text","disabled","",1,"form-control",3,"value"],[1,"loading-spinner"],[1,"kpi-section"],[1,"grid-cards"],[1,"card"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","notes-preview",3,"title",4,"ngIf"],[4,"ngIf"],[1,"notes-preview",3,"title"],[1,"chart-placeholder"],[1,"chart-container"],[1,"chart-bars"],["class","chart-bar",4,"ngFor","ngForOf"],[1,"chart-bar"],[1,"bar-label"],[1,"bar-container"],[1,"bar-fill"],[1,"bar-value"],[1,"empty-state"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),d(4,"assessment"),l()(),c(5,"div",4)(6,"h1",5),d(7,"Report Timbrature"),l(),c(8,"p",6),d(9,"Analizza e esporta i dati delle timbrature"),l()()(),c(10,"div",7)(11,"h2",5)(12,"span",3),d(13,"filter_alt"),l(),d(14," Filtri Report "),l(),c(15,"div",8)(16,"div",9)(17,"label",10),d(18,"Tipo Report"),l(),c(19,"select",11),W("ngModelChange",function(o){return G(i.tipoReport,o)||(i.tipoReport=o),o}),x("change",function(){return i.onTipoReportChange()}),c(20,"option",12),d(21,"Settimanale"),l(),c(22,"option",13),d(23,"Mensile"),l(),c(24,"option",14),d(25,"Annuale"),l(),c(26,"option",15),d(27,"Personalizzato"),l()()(),E(28,$3,8,5,"div",16)(29,W3,5,2,"div",16)(30,G3,4,1,"div",16)(31,q3,4,1,"div",16),c(32,"div",9)(33,"label",10),d(34,"Dipendente"),l(),c(35,"select",11),W("ngModelChange",function(o){return G(i.dipendenteSelezionato,o)||(i.dipendenteSelezionato=o),o}),x("change",function(){return i.onFiltroChange()}),c(36,"option",17),d(37,"Tutti"),l(),E(38,J3,2,3,"option",18),l(),E(39,K3,1,1,"input",19),l()(),c(40,"div",20)(41,"button",21),x("click",function(){return i.generaReport()}),E(42,Y3,2,0,"span",22)(43,Z3,1,0,"span",23),d(44),l(),c(45,"button",24),x("click",function(){return i.esportaPDF()}),c(46,"span",3),d(47,"picture_as_pdf"),l(),d(48," Esporta PDF "),l(),c(49,"button",25),x("click",function(){return i.esportaExcel()}),c(50,"span",3),d(51,"table_chart"),l(),d(52," Esporta Excel "),l(),c(53,"button",21),x("click",function(){return i.esportaCSVDaDatiReport()}),c(54,"span",3),d(55,"download"),l(),d(56," Esporta CSV "),l()()(),E(57,Q3,37,14,"div",26)(58,nV,27,1,"div",27)(59,rV,11,1,"div",28)(60,oV,7,0,"div",29),l()),e&2&&(p(19),H("ngModel",i.tipoReport),p(9),_("ngIf",i.tipoReport==="mensile"),p(),_("ngIf",i.tipoReport==="annuale"),p(),_("ngIf",i.tipoReport!=="mensile"&&i.tipoReport!=="annuale"),p(),_("ngIf",i.tipoReport!=="mensile"&&i.tipoReport!=="annuale"),p(4),H("ngModel",i.dipendenteSelezionato),p(3),_("ngForOf",i.dipendenti),p(),_("ngIf",!i.hasRole("admin")&&!i.hasRole("manager")),p(2),_("disabled",i.isLoading),p(),_("ngIf",!i.isLoading),p(),_("ngIf",i.isLoading),p(),R(" ",i.isLoading?"Generando...":"Genera Report"," "),p(),_("disabled",!i.datiReport),p(4),_("disabled",!i.datiReport),p(4),_("disabled",!i.datiReport),p(4),_("ngIf",i.datiReport),p(),_("ngIf",i.datiReport),p(),_("ngIf",i.datiReport),p(),_("ngIf",!i.datiReport&&!i.isLoading))},dependencies:[Ee,Be,xe,Rt,Wt,Gt,Re,At,Fe,yt,tn,lt],styles:[".kpi-section[_ngcontent-%COMP%]{margin-bottom:var(--gutter-lg)}.chart-placeholder[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);margin-top:var(--gutter-md)}.chart-container[_ngcontent-%COMP%]{text-align:center}.chart-bars[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:var(--gutter-sm);height:200px;margin-top:var(--gutter-lg);padding:0 var(--gutter-md)}.chart-bar[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1;gap:var(--gutter-sm)}.bar-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-color);opacity:.7}.bar-container[_ngcontent-%COMP%]{height:120px;width:30px;background:color-mix(in srgb,var(--smoke-color-1) 50%,transparent);border-radius:4px 4px 0 0;position:relative;display:flex;align-items:flex-end}.bar-fill[_ngcontent-%COMP%]{width:100%;background:var(--gradiente);border-radius:4px 4px 0 0;transition:height .3s ease;min-height:4px}.bar-value[_ngcontent-%COMP%]{font-size:.8rem;font-weight:600;color:var(--text-color)}@media (max-width: 768px){.chart-bars[_ngcontent-%COMP%]{gap:4px;padding:0 var(--gutter-sm)}.bar-container[_ngcontent-%COMP%]{width:20px}.bar-label[_ngcontent-%COMP%], .bar-value[_ngcontent-%COMP%]{font-size:.7rem}}@media (max-width: 480px){.chart-bars[_ngcontent-%COMP%]{flex-wrap:wrap;height:auto;gap:var(--gutter-md)}.chart-bar[_ngcontent-%COMP%]{flex:0 0 calc(33.333% - var(--gutter-md))}}"]})};var xp=class n{constructor(t){this.supabaseService=t}BUCKET_NAME="buste-paga";getBustePagaAzienda(t){let i=this.supabaseService.getClient().from("payroll_files").select(`
        *,
        users:user_id (first_name, last_name, email)
      `).eq("company_id",t).order("period",{ascending:!1}).then(r=>{if(r.error)throw r.error;return r.data});return J(i)}getBustePagaDipendente(t){let i=this.supabaseService.getClient().from("payroll_files").select("*").eq("user_id",t).eq("visible_to_user",!0).order("period",{ascending:!1}).then(r=>{if(r.error)throw r.error;return r.data});return J(i)}uploadBustaPaga(t,e,i,r,o){return y(this,null,function*(){let s=this.supabaseService.getClient(),a=t.name.split(".").pop(),u=`${e}_${r}_${Date.now()}.${a}`,f=`${i}/${u}`,{error:h}=yield s.storage.from(this.BUCKET_NAME).upload(f,t);if(h)throw h;let{error:m}=yield s.from("payroll_files").insert({user_id:e,company_id:i,filename:u,original_name:t.name,file_size_bytes:t.size,mime_type:t.type,storage_path:f,period:r,uploaded_by:o,visible_to_user:!0});if(m)throw m;return{success:!0,fileName:u}})}downloadBustaPaga(t,e){let r=this.supabaseService.getClient().storage.from(this.BUCKET_NAME).download(t).then(o=>{if(o.error)throw o.error;let s=URL.createObjectURL(o.data),a=document.createElement("a");return a.href=s,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),{success:!0}});return J(r)}eliminaBustaPaga(t,e){let i=this.supabaseService.getClient(),r=Promise.all([i.from("payroll_files").delete().eq("id",t),i.storage.from(this.BUCKET_NAME).remove([e])]).then(([o,s])=>{if(o.error)throw o.error;if(s.error)throw s.error;return{success:!0}});return J(r)}static \u0275fac=function(e){return new(e||n)(z(pt))};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var Qv=(n,t)=>t.id;function aV(n,t){if(n&1){let e=k();c(0,"div",8)(1,"button",16),x("click",function(){C(e);let r=g();return S(r.mostraUpload=!r.mostraUpload)}),c(2,"span",4),d(3,"upload"),l(),d(4," Carica Buste Paga "),l()()}}function lV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),ve("",e.first_name," ",e.last_name)}}function cV(n,t){if(n&1){let e=k();c(0,"div",32)(1,"span",4),d(2,"cloud_upload"),l(),c(3,"h3"),d(4,"Trascina i file PDF qui"),l(),c(5,"p",33),d(6,"oppure"),l(),c(7,"button",34),x("click",function(){C(e);let r=en(12);return S(r.click())}),c(8,"span",4),d(9,"attach_file"),l(),d(10," Seleziona File "),l(),c(11,"input",35,0),x("change",function(r){C(e);let o=g(2);return S(o.onFileSelected(r))}),l()()}}function uV(n,t){if(n&1){let e=k();c(0,"div",38)(1,"span",4),d(2,"picture_as_pdf"),l(),c(3,"div",39)(4,"span",40),d(5),l(),c(6,"span",41),d(7),l()(),c(8,"button",42),x("click",function(){let r=C(e).index,o=g(3);return S(o.rimuoviFile(r))}),c(9,"span",4),d(10,"close"),l()()()}if(n&2){let e=t.$implicit;p(5),T(e.name),p(2),R("",(e.size/1024/1024).toFixed(2)," MB")}}function dV(n,t){if(n&1&&(c(0,"div",36)(1,"h4"),d(2),l(),E(3,uV,11,2,"div",37),l()),n&2){let e=g(2);p(2),R("File selezionati (",e.selectedFiles.length,")"),p(),_("ngForOf",e.selectedFiles)}}function fV(n,t){if(n&1&&(c(0,"div",26)(1,"span",4),d(2,"error"),l(),d(3),l()),n&2){let e=g(2);p(3),R(" ",e.errorMessage," ")}}function pV(n,t){if(n&1&&(c(0,"div",27)(1,"span",4),d(2,"check_circle"),l(),d(3),l()),n&2){let e=g(2);p(3),R(" ",e.successMessage," ")}}function hV(n,t){n&1&&(c(0,"span",4),d(1,"upload"),l())}function mV(n,t){n&1&&P(0,"span",31)}function gV(n,t){if(n&1){let e=k();c(0,"div",9)(1,"h2",6)(2,"span",4),d(3,"cloud_upload"),l(),d(4," Carica Nuove Buste Paga "),l(),c(5,"div",17)(6,"div",12)(7,"label",18)(8,"span",4),d(9,"person"),l(),d(10," Dipendente * "),l(),c(11,"select",19),W("ngModelChange",function(r){C(e);let o=g();return G(o.selectedUserId,r)||(o.selectedUserId=r),S(r)}),c(12,"option",20),d(13,"Seleziona dipendente"),l(),It(14,lV,2,3,"option",21,Qv),l()(),c(16,"div",12)(17,"label",18)(18,"span",4),d(19,"event"),l(),d(20," Periodo * "),l(),c(21,"input",22),W("ngModelChange",function(r){C(e);let o=g();return G(o.selectedPeriod,r)||(o.selectedPeriod=r),S(r)}),l()()(),c(22,"div",23),x("drop",function(r){C(e);let o=g();return S(o.onDrop(r))})("dragover",function(r){C(e);let o=g();return S(o.onDragOver(r))})("dragleave",function(r){C(e);let o=g();return S(o.onDragLeave(r))}),E(23,cV,13,0,"div",24)(24,dV,4,2,"div",25),l(),ee(25,fV,4,1,"div",26),ee(26,pV,4,1,"div",27),c(27,"div",28)(28,"button",29),x("click",function(){C(e);let r=g();return S(r.resetUpload())}),d(29," Annulla "),l(),c(30,"button",30),x("click",function(){C(e);let r=g();return S(r.onUpload())}),ee(31,hV,2,0,"span",4),ee(32,mV,1,0,"span",31),d(33),l()()()}if(n&2){let e=g();p(11),H("ngModel",e.selectedUserId),_("disabled",e.isLoading),p(3),Tt(e.dipendenti),p(7),H("ngModel",e.selectedPeriod),_("disabled",e.isLoading),p(),Se("drag-over",e.isDragOver)("has-files",e.selectedFiles.length>0),p(),_("ngIf",e.selectedFiles.length===0),p(),_("ngIf",e.selectedFiles.length>0),p(),te(e.errorMessage?25:-1),p(),te(e.successMessage?26:-1),p(2),_("disabled",e.isLoading),p(2),_("disabled",!e.canUpload()||e.isLoading),p(),te(e.isLoading?-1:31),p(),te(e.isLoading?32:-1),p(),R(" ",e.isLoading?"Caricamento...":"Carica Buste Paga"," ")}}function vV(n,t){if(n&1&&(c(0,"div",10)(1,"div",43)(2,"h3",44),d(3,"Buste Paga Totali"),l(),c(4,"div",45),d(5),l()(),c(6,"div",43)(7,"h3",44),d(8,"Ultima Busta Paga"),l(),c(9,"div",45),d(10),l()()()),n&2){let e=g();p(5),T(e.bustePaga.length),p(5),R(" ",(e.ultimaBustaPaga==null?null:e.ultimaBustaPaga.period)||"N/A"," ")}}function _V(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function yV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;_("value",e.id),p(),ve("",e.first_name," ",e.last_name)}}function bV(n,t){if(n&1){let e=k();c(0,"div",12)(1,"label",18),d(2,"Filtra per periodo"),l(),c(3,"select",46),W("ngModelChange",function(r){C(e);let o=g();return G(o.filtroPeriodo,r)||(o.filtroPeriodo=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(4,"option",20),d(5,"Tutti i periodi"),l(),It(6,_V,2,2,"option",21,yr),l()(),c(8,"div",12)(9,"label",18),d(10,"Filtra per dipendente"),l(),c(11,"select",46),W("ngModelChange",function(r){C(e);let o=g();return G(o.filtroDipendente,r)||(o.filtroDipendente=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(12,"option",20),d(13,"Tutti i dipendenti"),l(),It(14,yV,2,3,"option",21,Qv),l()()}if(n&2){let e=g();p(3),H("ngModel",e.filtroPeriodo),p(3),Tt(e.periodiUnici),p(5),H("ngModel",e.filtroDipendente),p(3),Tt(e.dipendenti)}}function wV(n,t){if(n&1&&(c(0,"option",21),d(1),l()),n&2){let e=t.$implicit;_("value",e),p(),T(e)}}function EV(n,t){if(n&1){let e=k();c(0,"div",12)(1,"label",18),d(2,"Anno"),l(),c(3,"select",46),W("ngModelChange",function(r){C(e);let o=g();return G(o.filtroAnno,r)||(o.filtroAnno=r),S(r)}),x("change",function(){C(e);let r=g();return S(r.applicaFiltri())}),c(4,"option",20),d(5,"Tutti gli anni"),l(),It(6,wV,2,2,"option",21,yr),l()()}if(n&2){let e=g();p(3),H("ngModel",e.filtroAnno),p(3),Tt(e.anniDisponibili)}}function CV(n,t){n&1&&(c(0,"th"),d(1,"Dipendente"),l())}function SV(n,t){if(n&1&&(c(0,"td")(1,"div",50)(2,"div",51),d(3),l(),c(4,"div",52)(5,"strong"),d(6),l(),c(7,"span",7),d(8),l()()()()),n&2){let e=g().$implicit;p(3),ve(" ",e.user==null||e.user.first_name==null?null:e.user.first_name.charAt(0),"",e.user==null||e.user.last_name==null?null:e.user.last_name.charAt(0)," "),p(3),ve("",e.user==null?null:e.user.first_name," ",e.user==null?null:e.user.last_name),p(2),T(e.user==null?null:e.user.email)}}function xV(n,t){if(n&1){let e=k();c(0,"button",48),x("click",function(){C(e);let r=g().$implicit,o=g();return S(o.eliminaBustaPaga(r))}),c(1,"span",4),d(2,"delete"),l()()}}function DV(n,t){if(n&1){let e=k();c(0,"tr"),ee(1,SV,9,5,"td"),c(2,"td"),d(3),l(),c(4,"td")(5,"div",39)(6,"span",4),d(7,"picture_as_pdf"),l(),d(8),l()(),c(9,"td"),d(10),Z(11,"date"),l(),c(12,"td"),d(13),l(),c(14,"td")(15,"div",47)(16,"button",48),x("click",function(){let r=C(e).$implicit,o=g();return S(o.downloadBustaPaga(r))}),c(17,"span",4),d(18,"download"),l()(),ee(19,xV,3,0,"button",49),l()()()}if(n&2){let e=t.$implicit,i=g();p(),te(i.isAdmin?1:-1),p(2),T(e.period),p(5),R(" ",e.original_name," "),p(2),T(X(11,6,e.uploaded_at,"dd/MM/yyyy")),p(3),R("",(e.file_size_bytes/1024/1024).toFixed(2)," MB"),p(6),te(i.isAdmin?19:-1)}}function IV(n,t){if(n&1&&(c(0,"div",15)(1,"span",4),d(2,"description"),l(),c(3,"h3"),d(4,"Nessuna busta paga"),l(),c(5,"p"),d(6),l()()),n&2){let e=g();p(6),R(" ",e.isAdmin?"Non sono state caricate buste paga per i filtri selezionati.":"Non sono presenti buste paga per i filtri selezionati."," ")}}var Dp=class n{constructor(t,e,i){this.bustePagaService=t;this.dipendentiService=e;this.authService=i}destroy$=new $e;isAdmin=!1;isLoading=!1;bustePaga=[];bustePagaFiltrate=[];mostraUpload=!1;selectedFiles=[];isDragOver=!1;selectedUserId="";selectedPeriod="";filtroPeriodo="";filtroDipendente="";filtroAnno="";dipendenti=[];periodiUnici=[];anniDisponibili=[];errorMessage="";successMessage="";ngOnInit(){return y(this,null,function*(){this.verificaRuolo(),yield this.caricaDati()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}verificaRuolo(){return y(this,null,function*(){try{let t=yield nt(this.authService.currentUser$);this.isAdmin=t?.role==="admin"||t?.role==="manager",console.log("Ruolo utente:",this.isAdmin?"Admin":"Dipendente")}catch(t){console.error("Errore nel verificare il ruolo:",t),this.isAdmin=!1}})}caricaDati(){return y(this,null,function*(){this.isLoading=!0;try{let t=localStorage.getItem("companyId");if(!t)throw new Error("Company ID non trovato");if(this.isAdmin)yield Promise.all([this.caricaBustePagaAzienda(t),this.caricaDipendenti(t)]);else{let e=yield this.getCurrentUserId();yield this.caricaBustePagaDipendente(e)}this.inizializzaFiltri()}catch(t){console.error("Errore nel caricamento dei dati:",t),this.errorMessage="Errore nel caricamento dei dati"}finally{this.isLoading=!1}})}caricaBustePagaAzienda(t){return new Promise((e,i)=>{this.bustePagaService.getBustePagaAzienda(t).pipe(Wn(this.destroy$)).subscribe({next:r=>{this.bustePaga=r,this.bustePagaFiltrate=r,e()},error:r=>{console.error("Errore nel caricamento buste paga azienda:",r),i(r)}})})}caricaBustePagaDipendente(t){return new Promise((e,i)=>{this.bustePagaService.getBustePagaDipendente(t).pipe(Wn(this.destroy$)).subscribe({next:r=>{this.bustePaga=r,this.bustePagaFiltrate=r,e()},error:r=>{console.error("Errore nel caricamento buste paga dipendente:",r),i(r)}})})}caricaDipendenti(t){return new Promise((e,i)=>{this.dipendentiService.getDipendenti(t).pipe(Wn(this.destroy$)).subscribe({next:r=>{this.dipendenti=r,e()},error:r=>{console.error("Errore nel caricamento dipendenti:",r),i(r)}})})}inizializzaFiltri(){this.isAdmin?this.periodiUnici=[...new Set(this.bustePaga.map(t=>t.period))].sort().reverse():this.anniDisponibili=[...new Set(this.bustePaga.map(t=>t.period.split("-")[0]))].sort().reverse()}getCurrentUserId(){return y(this,null,function*(){return(yield nt(this.authService.currentUser$))?.id||""})}applicaFiltri(){let t=this.bustePaga;this.isAdmin?(this.filtroPeriodo&&(t=t.filter(e=>e.period===this.filtroPeriodo)),this.filtroDipendente&&(t=t.filter(e=>e.user_id===this.filtroDipendente))):this.filtroAnno&&(t=t.filter(e=>e.period.startsWith(this.filtroAnno))),this.bustePagaFiltrate=t}onDragOver(t){t.preventDefault(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),this.isDragOver=!1}onDrop(t){t.preventDefault(),this.isDragOver=!1;let e=t.dataTransfer?.files;e&&this.processFiles(e)}onFileSelected(t){let e=t.target;e.files&&this.processFiles(e.files)}processFiles(t){let e=Array.from(t).filter(i=>i.type==="application/pdf");if(e.length===0){this.errorMessage="Seleziona solo file PDF";return}this.selectedFiles=[...this.selectedFiles,...e],this.errorMessage=""}rimuoviFile(t){this.selectedFiles.splice(t,1)}canUpload(){return!!this.selectedUserId&&!!this.selectedPeriod&&this.selectedFiles.length>0}onUpload(){return y(this,null,function*(){if(this.canUpload()){this.isLoading=!0,this.errorMessage="",this.successMessage="";try{let t=localStorage.getItem("companyId");if(!t)throw new Error("Company ID non trovato");let e=yield nt(this.authService.currentUser$);if(!e?.id)throw new Error("Utente non autenticato");let i=e.id;for(let r of this.selectedFiles)yield this.bustePagaService.uploadBustaPaga(r,this.selectedUserId,t,this.selectedPeriod,i);this.successMessage=`Caricamento completato! ${this.selectedFiles.length} file caricati.`,this.resetUpload(),yield this.caricaDati()}catch(t){console.error("Errore durante l'upload:",t),this.errorMessage=t.message||"Errore durante l'upload"}finally{this.isLoading=!1}}})}resetUpload(){this.selectedFiles=[],this.selectedUserId="",this.selectedPeriod="",this.mostraUpload=!1}downloadBustaPaga(t){this.bustePagaService.downloadBustaPaga(t.storage_path,t.original_name).pipe(Wn(this.destroy$)).subscribe({error:e=>{console.error("Errore nel download:",e),this.errorMessage="Errore durante il download"}})}eliminaBustaPaga(t){confirm("Sei sicuro di voler eliminare questa busta paga?")&&this.bustePagaService.eliminaBustaPaga(t.id,t.storage_path).pipe(Wn(this.destroy$)).subscribe({next:()=>{this.successMessage="Busta paga eliminata con successo",this.caricaDati()},error:e=>{console.error("Errore nell'eliminazione:",e),this.errorMessage="Errore durante l'eliminazione"}})}get ultimaBustaPaga(){return this.bustePaga.length>0?this.bustePaga[0]:null}static \u0275fac=function(e){return new(e||n)(D(xp),D(Ot),D(le))};static \u0275cmp=we({type:n,selectors:[["app-buste-paga"]],decls:41,vars:9,consts:[["fileInput",""],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"actions-container"],[1,"form-section"],[1,"grid-cards"],[1,"filters-container"],[1,"filter-group"],[1,"table-container"],[1,"crm-table"],[1,"empty-state"],[1,"promethea-button",3,"click"],[1,"grid-form",2,"margin-bottom","var(--gutter-lg)"],[1,"form-label"],[3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value"],["type","month",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"drop-zone",3,"drop","dragover","dragleave"],["class","drop-content",4,"ngIf"],["class","files-list",4,"ngIf"],[1,"status-message","error"],[1,"status-message","info"],[1,"form-actions"],["type","button",1,"promethea-button","ghost",3,"click","disabled"],["type","button",1,"promethea-button",3,"click","disabled"],[1,"loading-spinner"],[1,"drop-content"],[1,"text-muted",2,"margin-bottom","var(--gutter-lg)"],["type","button",1,"promethea-button","outline",3,"click"],["type","file","accept",".pdf","multiple","","hidden","",3,"change"],[1,"files-list"],["class","file-item",4,"ngFor","ngForOf"],[1,"file-item"],[1,"file-info"],[1,"file-name"],[1,"file-size"],["type","button",1,"icon-button",3,"click"],[1,"card"],[1,"card-title"],[1,"card-number"],[3,"ngModelChange","change","ngModel"],[1,"action-buttons"],[1,"icon-button",3,"click"],[1,"icon-button"],[1,"user-info-compact"],[1,"user-avatar-small"],[1,"user-details-compact"]],template:function(e,i){e&1&&(c(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),d(4,"payments"),l()(),c(5,"div",5)(6,"h1",6),d(7),l(),c(8,"p",7),d(9),l()(),ee(10,aV,5,0,"div",8),l(),ee(11,gV,34,17,"div",9),ee(12,vV,11,2,"div",10),c(13,"div",9)(14,"div",2)(15,"h2",6)(16,"span",4),d(17,"list_alt"),l(),d(18),l(),c(19,"div",11),ee(20,bV,16,2)(21,EV,8,1,"div",12),l()(),c(22,"div",13)(23,"table",14)(24,"thead")(25,"tr"),ee(26,CV,2,0,"th"),c(27,"th"),d(28,"Periodo"),l(),c(29,"th"),d(30,"File"),l(),c(31,"th"),d(32,"Data Caricamento"),l(),c(33,"th"),d(34,"Dimensione"),l(),c(35,"th"),d(36,"Azioni"),l()()(),c(37,"tbody"),It(38,DV,20,9,"tr",null,Qv),l()()(),ee(40,IV,7,1,"div",15),l()()),e&2&&(p(7),R(" ",i.isAdmin?"Gestione Buste Paga":"Le mie Buste Paga"," "),p(2),R(" ",i.isAdmin?"Carica e gestisci le buste paga dei dipendenti":"Consulta e scarica le tue buste paga"," "),p(),te(i.isAdmin?10:-1),p(),te(i.isAdmin&&i.mostraUpload?11:-1),p(),te(i.isAdmin?-1:12),p(6),R(" ",i.isAdmin?"Buste Paga Caricate":"Storico Buste Paga"," "),p(2),te(i.isAdmin?20:21),p(6),te(i.isAdmin?26:-1),p(12),Tt(i.bustePagaFiltrate),p(2),te(i.bustePagaFiltrate.length===0?40:-1))},dependencies:[Ee,Be,xe,Rt,Wt,Gt,Re,At,Fe,yt,jt,lt],styles:[".drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--smoke-color-1);border-radius:16px;padding:var(--gutter-xl);text-align:center;transition:all .3s ease;background:color-mix(in srgb,var(--background) 95%,transparent)}.drop-zone.drag-over[_ngcontent-%COMP%]{border-color:var(--primary);background:color-mix(in srgb,var(--primary) 5%,transparent)}.drop-zone.has-files[_ngcontent-%COMP%]{border-style:solid;border-color:var(--primary);background:color-mix(in srgb,var(--primary) 2%,transparent)}.drop-content[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--smoke-color-1)}.drop-zone.drag-over[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--primary)}.files-list[_ngcontent-%COMP%]{text-align:left}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm);border:1px solid var(--smoke-color-1);border-radius:8px;margin-bottom:var(--gutter-sm);background:var(--background)}.file-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.file-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.file-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}.file-size[_ngcontent-%COMP%]{font-size:.8rem;color:color-mix(in srgb,var(--text-color) 60%,transparent)}@media (max-width: 768px){.drop-zone[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.file-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gutter-sm)}.action-buttons[_ngcontent-%COMP%]{align-self:flex-end}}"]})};var TV=()=>({month:"long",year:"numeric"}),MV=(n,t)=>t.id;function AV(n,t){n&1&&(c(0,"div",10),P(1,"div",18),c(2,"p"),d(3,"Caricamento calendario..."),l()())}function RV(n,t){if(n&1&&(c(0,"div",13),d(1),l()),n&2){let e=t.$implicit;p(),T(e)}}function OV(n,t){if(n&1&&(c(0,"div",25)(1,"span",26),d(2),l()()),n&2){let e=t.$implicit;vi("background-color",e.color),p(2),T(e.title)}}function NV(n,t){if(n&1&&(c(0,"div",22),It(1,OV,3,3,"div",24,MV),l()),n&2){let e=g().$implicit,i=g(2);p(),Tt(i.getEventsForDay(e))}}function PV(n,t){if(n&1&&(c(0,"div",23),d(1),l()),n&2){let e=g(2).$implicit,i=g(2);p(),R(" ",i.getTimbratureCounterForDay(e)," ")}}function kV(n,t){if(n&1&&E(0,PV,2,1,"div",27),n&2){let e=g().$implicit,i=g(2);_("ngIf",i.getTimbratureCounterForDay(e))}}function FV(n,t){if(n&1){let e=k();c(0,"div",20),x("click",function(){let r=C(e).$implicit,o=g(2);return S(o.onDayClick(r))}),c(1,"div",21),d(2),l(),ee(3,NV,3,0,"div",22),ee(4,kV,1,1,"div",23),l()}if(n&2){let e=t.$implicit,i=g(2);Se("current-month",i.isCurrentMonth(e))("other-month",!i.isCurrentMonth(e))("today",i.isToday(e)),p(2),R(" ",e.getDate()," "),p(),te(i.getRuoloCorrente()==="employee"?3:-1),p(),te(i.getRuoloCorrente()==="admin"||i.getRuoloCorrente()==="manager"?4:-1)}}function LV(n,t){if(n&1&&(c(0,"div",15),It(1,FV,5,9,"div",19,yr),l()),n&2){let e=t.$implicit;p(),Tt(e)}}function jV(n,t){n&1&&(c(0,"div",17),P(1,"div",28),c(2,"span"),d(3,"Timbratura completata"),l()(),c(4,"div",17),P(5,"div",29),c(6,"span"),d(7,"Timbratura in corso"),l()())}function VV(n,t){n&1&&(c(0,"div",17)(1,"span"),d(2,"Counter: Timbrature effettuate / Dipendenti totali"),l()())}var Ip=class n{currentDate=Je(new Date);weeks=Je([]);events=Je([]);timbrature=Je([]);dipendenti=Je([]);isLoading=Je(!0);daysOfWeek=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];authService=O(le);timbratureService=O(Nt);dipendentiService=O(Ot);ngOnInit(){return y(this,null,function*(){yield this.caricaDipendenti(),yield this.caricaTimbrature(),this.generateCalendar()})}caricaDipendenti(){return y(this,null,function*(){let t=this.authService.currentUserSubject.value;if((t?.role==="admin"||t?.role==="manager")&&t.company_id)try{this.dipendentiService.getDipendenti(t.company_id).subscribe({next:e=>{let i=e.filter(r=>r.is_active);this.dipendenti.set(i)},error:e=>{console.error("Errore caricamento dipendenti:",e)}})}catch(e){console.error("Errore caricamento dipendenti:",e)}})}caricaTimbrature(){return y(this,null,function*(){this.isLoading.set(!0);try{let t=this.authService.currentUserSubject.value;if(!t)return;let e=[];t.role==="admin"?e=yield this.timbratureService.getTimbratureAzienda(t.company_id):t.role==="manager"?e=yield this.timbratureService.getTimbraturePerCalendario():e=yield this.timbratureService.getTimbratureUtente(t.id),this.timbrature.set(e),this.creaEventiDaTimbrature(e)}catch(t){console.error("Errore nel caricamento timbrature:",t)}finally{this.isLoading.set(!1)}})}creaEventiDaTimbrature(t){if(this.authService.currentUserSubject.value?.role==="employee"){let i=t.map(r=>({id:r.id||"",title:`${this.formattaOrario(r.start_ts)} - ${r.end_ts?this.formattaOrario(r.end_ts):"In corso"}`,date:new Date(r.start_ts),color:r.end_ts?"#22c55e":"#f59e0b",type:"timbratura",data:r}));this.events.set(i)}else this.events.set([])}getTimbratureCounterForDay(t){if(this.authService.currentUserSubject.value?.role==="employee")return"";let i=this.dipendenti().length;if(i===0)return"";let r=this.timbrature().filter(s=>{let a=new Date(s.start_ts);return this.isSameDay(a,t)});return`${new Set(r.map(s=>s.user_id)).size}/${i}`}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}formattaOrario(t){return new Date(t).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}generateCalendar(){let t=this.currentDate().getFullYear(),e=this.currentDate().getMonth(),i=new Date(t,e,1),r=new Date(t,e+1,0),o=new Date(i),s=(i.getDay()+6)%7;o.setDate(i.getDate()-s);let a=[],u=[];for(let f=0;f<42;f++){let h=new Date(o);h.setDate(o.getDate()+f),u.push(h),u.length===7&&(a.push(u),u=[])}this.weeks.set(a)}getEventsForDay(t){return this.authService.currentUserSubject.value?.role!=="employee"?[]:this.events().filter(i=>this.isSameDay(i.date,t))}isCurrentMonth(t){return t.getMonth()===this.currentDate().getMonth()}isToday(t){let e=new Date;return this.isSameDay(t,e)}previousMonth(){return y(this,null,function*(){let t=new Date(this.currentDate());t.setMonth(t.getMonth()-1),this.currentDate.set(t),this.generateCalendar(),yield this.caricaTimbrature()})}nextMonth(){return y(this,null,function*(){let t=new Date(this.currentDate());t.setMonth(t.getMonth()+1),this.currentDate.set(t),this.generateCalendar(),yield this.caricaTimbrature()})}goToToday(){return y(this,null,function*(){this.currentDate.set(new Date),this.generateCalendar(),yield this.caricaTimbrature()})}onDayClick(t){console.log("Giorno cliccato:",t)}getRuoloCorrente(){return this.authService.currentUserSubject.value?.role||""}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=we({type:n,selectors:[["app-calendario"]],decls:31,vars:4,consts:[[1,"page-container"],[1,"card-header"],[1,"material-icons"],[1,"card-title"],[1,"calendar-controls"],["title","Mese precedente",1,"icon-button",3,"click"],[1,"promethea-button","ghost",3,"click"],[1,"calendar-month-title"],["title","Mese successivo",1,"icon-button",3,"click"],[1,"card-content"],[1,"loading-container"],[1,"calendar-container"],[1,"calendar-header"],[1,"calendar-day-header"],[1,"calendar-grid"],[1,"calendar-week"],[1,"calendar-legend"],[1,"legend-item"],[1,"loading-spinner"],[1,"calendar-day",3,"current-month","other-month","today"],[1,"calendar-day",3,"click"],[1,"day-number"],[1,"day-events"],[1,"timbrature-counter"],[1,"calendar-event","timbratura-event",3,"background-color"],[1,"calendar-event","timbratura-event"],[1,"event-time"],["class","timbrature-counter",4,"ngIf"],[1,"legend-color",2,"background-color","#22c55e"],[1,"legend-color",2,"background-color","#f59e0b"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1)(2,"span",2),d(3,"calendar_today"),l(),c(4,"h2",3),d(5,"Calendario Timbrature"),l(),c(6,"div",4)(7,"button",5),x("click",function(){return i.previousMonth()}),c(8,"span",2),d(9,"chevron_left"),l()(),c(10,"button",6),x("click",function(){return i.goToToday()}),c(11,"span",2),d(12,"today"),l(),d(13," Oggi "),l(),c(14,"h3",7),d(15),l(),c(16,"button",8),x("click",function(){return i.nextMonth()}),c(17,"span",2),d(18,"chevron_right"),l()()()(),c(19,"div",9),ee(20,AV,4,0,"div",10),c(21,"div",11)(22,"div",12),It(23,RV,2,1,"div",13,yr),l(),c(25,"div",14),It(26,LV,3,0,"div",15,yr),l()(),c(28,"div",16),ee(29,jV,8,0)(30,VV,3,0,"div",17),l()()()),e&2&&(p(15),R(" ",i.currentDate().toLocaleDateString("it-IT",Ue(3,TV))," "),p(5),te(i.isLoading()?20:-1),p(3),Tt(i.daysOfWeek),p(3),Tt(i.weeks()),p(3),te(i.getRuoloCorrente()==="employee"?29:30))},dependencies:[Ee,xe],styles:[".calendar-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-md);margin-left:auto}.calendar-month-title[_ngcontent-%COMP%]{margin:0;font-size:var(--fs-md);font-weight:600;color:var(--text-color);min-width:200px;text-align:center}.calendar-container[_ngcontent-%COMP%]{background:var(--background);border-radius:16px;overflow:hidden}.calendar-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);background:var(--smoke-color-2);border-bottom:1px solid var(--smoke-color-1)}.calendar-day-header[_ngcontent-%COMP%]{padding:var(--gutter-md);text-align:center;font-weight:600;color:var(--text-color);font-size:var(--fs-sm);border-right:1px solid var(--smoke-color-1)}.calendar-day-header[_ngcontent-%COMP%]:last-child{border-right:none}.calendar-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column}.calendar-week[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);min-height:120px}.calendar-day[_ngcontent-%COMP%]{padding:var(--gutter-sm);border-right:1px solid var(--smoke-color-1);border-bottom:1px solid var(--smoke-color-1);cursor:pointer;transition:all .2s ease;background:var(--background);position:relative}.calendar-day[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 5%,transparent);transform:translateY(-1px)}.calendar-day.other-month[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--background) 60%,transparent);color:color-mix(in srgb,var(--text-color) 40%,transparent)}.calendar-day.other-month[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 3%,transparent)}.calendar-day.today[_ngcontent-%COMP%]{background:var(--gradiente-light);border:2px solid var(--primary)}.calendar-day.today[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{font-weight:800;color:var(--primary)}.day-number[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;margin-bottom:var(--gutter-sm);text-align:center;color:var(--text-color)}.other-month[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 40%,transparent);font-weight:400}.day-events[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;max-height:80px;overflow-y:auto}.day-events[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.day-events[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--smoke-color-1);border-radius:2px}@media (max-width: 768px){.calendar-controls[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}.calendar-month-title[_ngcontent-%COMP%]{min-width:150px;order:-1;width:100%;text-align:center}.calendar-week[_ngcontent-%COMP%]{min-height:100px}.calendar-day[_ngcontent-%COMP%]{padding:4px}.day-number[_ngcontent-%COMP%]{font-size:.8rem;margin-bottom:2px}}@media (max-width: 480px){.calendar-day-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);font-size:.7rem}}.timbrature-counter[_ngcontent-%COMP%]{font-size:.75rem;color:var(--primary);font-weight:600;text-align:center;margin-top:4px;padding:2px 6px;background:color-mix(in srgb,var(--primary) 10%,transparent);border-radius:4px;border:1px solid color-mix(in srgb,var(--primary) 20%,transparent);min-height:20px;display:flex;align-items:center;justify-content:center}.calendar-day.other-month[_ngcontent-%COMP%]   .timbrature-counter[_ngcontent-%COMP%]{opacity:.5}@media (max-width: 768px){.timbrature-counter[_ngcontent-%COMP%]{font-size:.65rem;padding:1px 4px;min-height:16px}}"]})};var Dx=[{path:"",redirectTo:"/login",pathMatch:"full"},{path:"login",component:pp},{path:"register",component:hp},{path:"forgot-password",component:mp},{path:"home",component:gp},{path:"timbrature",component:vp},{path:"crea-timbratura",component:_p},{path:"profilo-aziendale",component:yp},{path:"calendario",component:Ip},{path:"dipendenti",component:bp},{path:"dipendenti/:id",component:wp},{path:"inviti-dipendenti",component:oa},{path:"report",component:Sp},{path:"buste-paga",component:Dp},{path:"kpi",component:Ep},{path:"impostazioni",component:Cp},{path:"loading-spinner",component:$n},{path:"**",redirectTo:"/home"}];var Xv={providers:[Xh(),_0(),jg({eventCoalescing:!0}),q0(Dx)]};var Tp=class n{THEME_KEY="app-theme";darkThemeClass="dark-theme";currentTheme=Je("light");constructor(){this.loadTheme()}loadTheme(){let t=localStorage.getItem(this.THEME_KEY),e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=t||(e?"dark":"light");this.setTheme(i)}toggleTheme(){let t=this.currentTheme()==="light"?"dark":"light";this.setTheme(t)}setTheme(t){this.currentTheme.set(t),localStorage.setItem(this.THEME_KEY,t),t==="dark"?(document.documentElement.setAttribute("data-theme","dark"),document.documentElement.classList.add(this.darkThemeClass)):(document.documentElement.removeAttribute("data-theme"),document.documentElement.classList.remove(this.darkThemeClass))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"})};var zV=["sidebar"];function UV(n,t){if(n&1){let e=k();c(0,"button",40),x("click",function(){C(e);let r=g(2);return S(r.toggleSidebar())}),c(1,"span",10),d(2,"chevron_left"),l()()}}function BV(n,t){n&1&&(c(0,"div",41),d(1,"Dashboard"),l())}function $V(n,t){n&1&&(c(0,"div",41),d(1,"Gestione"),l())}function HV(n,t){if(n&1){let e=k();c(0,"a",42),x("click",function(){C(e);let r=g(2);return S(r.onNavItemClicked())}),c(1,"span",10),d(2,"people"),l(),c(3,"span",16),d(4,"Dipendenti"),l()()}}function WV(n,t){if(n&1&&(c(0,"span",43),d(1),l()),n&2){let e=g(2);p(),T(e.unreadAnnouncementsCount)}}function GV(n,t){n&1&&(c(0,"div",41),d(1,"Timbrature"),l())}function qV(n,t){n&1&&(c(0,"div",41),d(1,"Report"),l())}function JV(n,t){if(n&1){let e=k();c(0,"div",13),E(1,qV,2,0,"div",14),c(2,"a",44),x("click",function(){C(e);let r=g(2);return S(r.onNavItemClicked())}),c(3,"span",10),d(4,"assessment"),l(),c(5,"span",16),d(6,"Report"),l()()()}if(n&2){let e=g(2);p(),_("ngIf",!e.isSidebarCollapsed)}}function KV(n,t){n&1&&(c(0,"div",41),d(1,"Analisi"),l())}function YV(n,t){if(n&1&&(c(0,"div",45)(1,"div",46)(2,"div",47),d(3),l(),c(4,"div",48),d(5),l()()()),n&2){let e=g(2);p(3),ve("",e.currentUser==null?null:e.currentUser.first_name," ",e.currentUser==null?null:e.currentUser.last_name),p(2),T(e.currentUser==null?null:e.currentUser.role)}}function ZV(n,t){if(n&1){let e=k();Ze(0),c(1,"div",3)(2,"aside",4,1)(4,"div",5)(5,"div",6),P(6,"img",7),l(),c(7,"div",8)(8,"button",9),x("click",function(){C(e);let r=g();return S(r.toggleTheme())}),c(9,"span",10),d(10),l()(),E(11,UV,3,0,"button",11),l()(),c(12,"nav",12)(13,"div",13),E(14,BV,2,0,"div",14),c(15,"a",15),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(16,"span",10),d(17,"dashboard"),l(),c(18,"span",16),d(19,"Dashboard"),l()()(),c(20,"div",13),E(21,$V,2,0,"div",14)(22,HV,5,0,"a",17),c(23,"a",18),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(24,"span",10),d(25,"business"),l(),c(26,"span",16),d(27,"Azienda"),l(),E(28,WV,2,1,"span",19),l()(),c(29,"div",13),E(30,GV,2,0,"div",14),c(31,"a",20),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(32,"span",10),d(33,"schedule"),l(),c(34,"span",16),d(35,"Timbrature"),l()(),c(36,"a",21),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(37,"span",10),d(38,"add_circle"),l(),c(39,"span",16),d(40,"Nuova Timbratura"),l()(),c(41,"a",22),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(42,"span",10),d(43,"calendar_today"),l(),c(44,"span",16),d(45,"Calendario"),l()()(),E(46,JV,7,1,"div",23),c(47,"div",13),E(48,KV,2,0,"div",14),c(49,"a",24),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(50,"span",10),d(51,"insights"),l(),c(52,"span",16),d(53,"KPI"),l()()()(),c(54,"div",25)(55,"div",26)(56,"div",27),d(57),l(),E(58,YV,6,3,"div",28),c(59,"div",29)(60,"a",30),x("click",function(){C(e);let r=g();return S(r.onNavItemClicked())}),c(61,"span",10),d(62,"settings"),l()(),c(63,"button",31),x("click",function(){C(e);let r=g();return S(r.logout())}),c(64,"span",10),d(65,"logout"),l()()()()()(),c(66,"main",32)(67,"header",33)(68,"button",34),x("click",function(){C(e);let r=g();return S(r.toggleSidebar())}),c(69,"span",10),d(70,"menu"),l()(),c(71,"div",35)(72,"div",36),d(73),Z(74,"date"),l(),c(75,"div",37),d(76),Z(77,"date"),l()()(),c(78,"div",38),P(79,"router-outlet"),l()(),c(80,"div",39),x("click",function(){C(e);let r=g();return S(r.closeSidebar())}),l()(),Qe()}if(n&2){let e=g();p(),Se("sidebar-collapsed",e.isSidebarCollapsed)("mobile-open",e.isMobileSidebarOpen),p(),Se("hidden",e.isSidebarCollapsed)("collapsed",e.isSidebarCollapsed&&!e.isMobileSidebarOpen),p(6),_("title",e.currentTheme()==="light"?"Attiva tema scuro":"Attiva tema chiaro"),p(2),R(" ",e.currentTheme()==="light"?"dark_mode":"light_mode"," "),p(),_("ngIf",!e.isSidebarCollapsed),p(3),_("ngIf",!e.isSidebarCollapsed),p(7),_("ngIf",!e.isSidebarCollapsed),p(),_("ngIf",e.employeesVisibilityResolved&&e.canShowEmployeesNav()),p(6),_("ngIf",e.unreadAnnouncementsCount>0),p(2),_("ngIf",!e.isSidebarCollapsed),p(16),_("ngIf",e.hasRole("admin")||e.hasRole("manager")&&e.canViewReports),p(2),_("ngIf",!e.isSidebarCollapsed),p(9),ve(" ",e.currentUser==null||e.currentUser.first_name==null?null:e.currentUser.first_name.charAt(0),"",e.currentUser==null||e.currentUser.last_name==null?null:e.currentUser.last_name.charAt(0)," "),p(),_("ngIf",!e.isSidebarCollapsed),p(2),_("title","Impostazioni"),p(3),_("title","Logout"),p(10),T(X(74,27,e.currentTime,"HH:mm")),p(3),T(X(77,30,e.currentTime,"EEEE, d MMMM yyyy")),p(4),Se("active",e.isMobileSidebarOpen)}}function QV(n,t){n&1&&(c(0,"div",49),P(1,"router-outlet"),l())}var Mp=class n{constructor(t,e,i,r){this.authService=t;this.router=e;this.announcementsService=i;this.companyService=r}sidebarRef;isSidebarCollapsed=!1;isMobileSidebarOpen=!1;currentTime=new Date;currentUser=null;isAuthRoute=!1;unreadAnnouncementsCount=0;announcementsPollSub;themeService=O(Tp);currentTheme=this.themeService.currentTheme;canViewEmployeesList=!1;canViewReports=!1;employeesVisibilityResolved=!1;timeInterval;userSub;routeSub;authRoutes=["/login","/register","/forgot-password"];ngOnInit(){this.timeInterval=setInterval(()=>{this.currentTime=new Date},1e3),this.userSub=this.authService.currentUser$.subscribe(e=>{if(this.currentUser=e,e?.company_id&&this.refreshUnreadCount(e.company_id),this.employeesVisibilityResolved=!1,this.canViewEmployeesList=!1,this.canViewReports=!1,!e){this.employeesVisibilityResolved=!0;return}if(this.hasRole("admin")){this.canViewEmployeesList=!0,this.canViewReports=!0,this.employeesVisibilityResolved=!0;return}if(e.role==="manager"){let i=this.companyService.getAziendaForUser,r=this.companyService.getAziendaById||this.companyService.getAzienda,o=this.companyService.getAziendaByAdmin,s=a=>{let f=(a?.manager_visibility??{})?.[e.id]??{},h=!!f.can_view_all_employees||!!f.can_view_employees,m=f.mode??"self",b=Array.isArray(f.user_ids)&&f.user_ids.length>0,v=Array.isArray(f.roles)&&f.roles.length>0,w=Array.isArray(f.department_ids)&&f.department_ids.length>0;this.canViewEmployeesList=h||m!=="self"||b||v||w,this.canViewReports=!!f.can_view_reports||!1,this.employeesVisibilityResolved=!0};try{let a=null;typeof i=="function"?a=i.call(this.companyService,e.id,e.company_id):typeof r=="function"?a=r.call(this.companyService,e.company_id):typeof o=="function"&&(a=o.call(this.companyService,e.id)),a?a?.subscribe?a.subscribe({next:s,error:()=>{this.canViewEmployeesList=!1,this.canViewReports=!1,this.employeesVisibilityResolved=!0}}):a?.then?a.then(s).catch(()=>{this.canViewEmployeesList=!1,this.canViewReports=!1,this.employeesVisibilityResolved=!0}):s(a??null):(this.canViewEmployeesList=!1,this.canViewReports=!1,this.employeesVisibilityResolved=!0)}catch(a){console.warn("[App] eccezione durante lettura azienda",a),this.canViewEmployeesList=!1,this.canViewReports=!1,this.employeesVisibilityResolved=!0}}}),this.announcementsPollSub=setInterval(()=>{this.currentUser?.company_id&&this.refreshUnreadCount(this.currentUser.company_id)},3e4);let t=this.router.url.split("?")[0];this.isAuthRoute=this.authRoutes.includes(t),this.routeSub=this.router.events.pipe(rt(e=>e instanceof rn)).subscribe(e=>{let i=e.urlAfterRedirects.split("?")[0];this.isAuthRoute=this.authRoutes.includes(i),this.isAuthRoute&&(this.isSidebarCollapsed=!0,this.isMobileSidebarOpen=!1)}),this.checkScreenSize()}onResize(){this.checkScreenSize()}checkScreenSize(){window.innerWidth<768?(this.isSidebarCollapsed=!0,this.isMobileSidebarOpen=!1):this.isMobileSidebarOpen=!1}canShowEmployeesNav(){return this.hasRole("admin")||this.hasRole("manager")&&!!this.canViewEmployeesList}toggleTheme(){this.themeService.toggleTheme()}toggleSidebar(){window.innerWidth<768?(this.isMobileSidebarOpen=!this.isMobileSidebarOpen,this.isSidebarCollapsed=!this.isMobileSidebarOpen):this.isSidebarCollapsed=!this.isSidebarCollapsed}closeSidebar(){window.innerWidth<768?(this.isMobileSidebarOpen=!1,this.isSidebarCollapsed=!0):this.isSidebarCollapsed=!0}onNavItemClicked(){setTimeout(()=>this.closeSidebar(),50)}handleDocumentClick(t){let e=t.target;e&&(e.closest(".sidebar")||e.closest(".sidebar-toggle")||e.closest(".sidebar-hamburger")||(this.isMobileSidebarOpen||!this.isSidebarCollapsed&&window.innerWidth>=768)&&this.closeSidebar())}hasRole(t){return this.authService.hasRole(t)}logout(){this.authService.logout(),this.router.navigate(["/login"])}ngOnDestroy(){this.timeInterval&&clearInterval(this.timeInterval),this.userSub?.unsubscribe(),this.routeSub?.unsubscribe(),this.announcementsPollSub&&clearInterval(this.announcementsPollSub)}refreshUnreadCount(t){return y(this,null,function*(){try{this.unreadAnnouncementsCount=yield this.announcementsService.getUnreadCountForUser(t)}catch(e){console.error("Unread count error",e)}})}static \u0275fac=function(e){return new(e||n)(D(le),D(Ie),D(ra),D(et))};static \u0275cmp=we({type:n,selectors:[["app-root"]],viewQuery:function(e,i){if(e&1&&Ya(zV,7),e&2){let r;so(r=ao())&&(i.sidebarRef=r.first)}},hostBindings:function(e,i){e&1&&x("resize",function(){return i.onResize()},ng)("click",function(o){return i.handleDocumentClick(o)},ig)},decls:3,vars:2,consts:[["authLayout",""],["sidebar",""],[4,"ngIf","ngIfElse"],[1,"app-container"],[1,"sidebar"],[1,"sidebar-header"],[1,"logo-container"],["src","/assets/logo.png","alt","Logo",1,"logo"],[1,"header-actions"],[1,"theme-toggle","icon-button",3,"click","title"],[1,"material-icons"],["class","sidebar-toggle icon-button",3,"click",4,"ngIf"],[1,"sidebar-nav"],[1,"nav-section"],["class","nav-label",4,"ngIf"],["routerLink","/home","routerLinkActive","active",1,"nav-item",3,"click"],[1,"nav-text"],["class","nav-item","routerLink","/dipendenti","routerLinkActive","active",3,"click",4,"ngIf"],["routerLink","/profilo-aziendale","routerLinkActive","active",1,"nav-item",3,"click"],["class","badge",4,"ngIf"],["routerLink","/timbrature","routerLinkActive","active",1,"nav-item",3,"click"],["routerLink","/crea-timbratura","routerLinkActive","active",1,"nav-item",3,"click"],["routerLink","/calendario","routerLinkActive","active",1,"nav-item",3,"click"],["class","nav-section",4,"ngIf"],["routerLink","/kpi","routerLinkActive","active",1,"nav-item",3,"click"],[1,"sidebar-footer"],[1,"user-section"],[1,"user-avatar"],["class","user-info",4,"ngIf"],[1,"user-actions"],["routerLink","/impostazioni","routerLinkActive","active",1,"nav-item","compact",3,"click","title"],[1,"nav-item","compact","logout-btn",3,"click","title"],[1,"main-content"],[1,"top-header"],[1,"sidebar-hamburger",3,"click"],[1,"header-actions",2,"background","var(--background)"],[1,"current-time"],[1,"current-date"],[1,"page-content"],[1,"mobile-overlay",3,"click"],[1,"sidebar-toggle","icon-button",3,"click"],[1,"nav-label"],["routerLink","/dipendenti","routerLinkActive","active",1,"nav-item",3,"click"],[1,"badge"],["routerLink","/report","routerLinkActive","active",1,"nav-item",3,"click"],[1,"user-info"],[1,"user-details"],[1,"user-name"],[1,"user-role","chip"],[1,"auth-layout"]],template:function(e,i){if(e&1&&E(0,ZV,81,33,"ng-container",2)(1,QV,2,0,"ng-template",null,0,wn),e&2){let r=en(2);_("ngIf",!i.isAuthRoute)("ngIfElse",r)}},dependencies:[Ee,xe,Rl,jt,Ht,G0,lt],styles:[".app-container[_ngcontent-%COMP%]{display:block;min-height:100vh;background:var(--background)}.app-container.sidebar-collapsed[_ngcontent-%COMP%]{grid-template-columns:0px 1fr}.sidebar[_ngcontent-%COMP%]{position:fixed;inset:0 auto 0 0;width:var(--grandezzasidebar);max-width:min(90vw,320px);height:100vh;max-height:100vh;box-sizing:border-box;display:flex;flex-direction:column;gap:var(--gutter-sm);padding:0;padding-bottom:calc(var(--gutter-lg) + env(safe-area-inset-bottom));background:var(--sidebar-background);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-right:1px solid var(--smoke-color-1);z-index:9999;transition:transform .32s cubic-bezier(.2,.9,.2,1);overflow:hidden;-webkit-overflow-scrolling:touch;transform:translateZ(0)}.sidebar.hidden[_ngcontent-%COMP%]{width:0;border-right:none;box-shadow:none;transition:all .4s cubic-bezier(.25,.8,.25,1);padding:0}.sidebar.collapsed[_ngcontent-%COMP%]:not(.hidden){width:0;padding:0}.sidebar-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0;border-bottom:1px solid var(--smoke-color-1);min-height:5rem;flex-shrink:0;position:relative;overflow:hidden}.sidebar-header[_ngcontent-%COMP%]   .theme-toggle[_ngcontent-%COMP%]{background:var(--smoke-color-1);border:1px solid var(--smoke-color-2);color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:50%;transition:all .3s cubic-bezier(.25,.8,.25,1);display:flex;align-items:center;justify-content:center;width:40px;height:40px;position:relative;overflow:hidden;box-shadow:0 2px 4px var(--shadow)}.logo[_ngcontent-%COMP%]{height:50px;width:auto;object-fit:contain;flex-shrink:0;transition:all .3s cubic-bezier(.25,.8,.25,1);filter:brightness(1);border-radius:50%;box-shadow:0 2px 4px var(--shadow);background:color-mix(in srgb,var(--text-color) 20%,transparent)}.logo-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex:1;min-width:0;padding:var(--gutter-sm);transition:all .3s cubic-bezier(.25,.8,.25,1)}.app-name[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-md);color:var(--primary);white-space:nowrap;opacity:1;padding:var(--gutter-sm);transition:opacity .3s ease}.sidebar.collapsed[_ngcontent-%COMP%]   .app-name[_ngcontent-%COMP%]{opacity:0;width:0}.sidebar-toggle[_ngcontent-%COMP%]{background:var(--smoke-color-1);border:1px solid var(--smoke-color-2);color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:50%;transition:all .3s cubic-bezier(.25,.8,.25,1);display:flex;align-items:center;justify-content:center;width:40px;height:40px;box-shadow:0 2px 4px var(--shadow)}.sidebar-toggle[_ngcontent-%COMP%]:hover{background:var(--text-color);color:var(--background);border-color:var(--accent);transform:translateY(-1px);box-shadow:0 4px 12px color-mix(in srgb,var(--accent) 30%,transparent)}.sidebar-nav[_ngcontent-%COMP%]{flex:1 1 auto;padding:var(--gutter-lg) 0;overflow-y:auto;-webkit-overflow-scrolling:touch}.nav-section[_ngcontent-%COMP%]{margin-bottom:var(--gutter-lg)}.nav-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;color:var(--text-color);opacity:.6;padding:0 var(--gutter-lg) var(--gutter-sm) var(--gutter-lg);text-transform:uppercase;letter-spacing:.5px;transition:opacity .3s ease}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{opacity:0;height:0;padding:0;margin:0}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) var(--gutter-lg);color:var(--text-color);text-decoration:none;transition:all .2s ease;border-left:3px solid transparent;margin:2px var(--gutter-sm);border-radius:8px;white-space:nowrap;overflow:hidden}.nav-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);border-left-color:var(--primary)}.nav-item.active[_ngcontent-%COMP%]{background:var(--smoke-color-3);border-left-color:var(--tertiary);color:var(--tertiary);font-weight:600}.nav-item.compact[_ngcontent-%COMP%]{padding:var(--gutter-sm);justify-content:center;margin:0}.nav-text[_ngcontent-%COMP%]{transition:opacity .3s ease;opacity:1}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-text[_ngcontent-%COMP%]{opacity:0;width:0}.nav-text[_ngcontent-%COMP%], .app-name[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%], .nav-label[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.25,.8,.25,1)}.nav-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:20px;min-width:24px;text-align:center}.sidebar-footer[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);position:sticky;bottom:0;z-index:2;background:transparent;padding:var(--gutter-sm) calc(var(--gutter-sm));padding-bottom:calc(var(--gutter-sm) + env(safe-area-inset-bottom));flex-shrink:0}.user-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);transition:all .3s ease}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:var(--gradiente);display:flex;align-items:center;justify-content:center;color:var(--background);font-weight:600;font-size:var(--fs-sm);flex-shrink:0}.user-info[_ngcontent-%COMP%]{flex:1;overflow:hidden;transition:opacity .3s ease;opacity:1}.sidebar.collapsed[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{opacity:0;width:0;margin:0}.user-details[_ngcontent-%COMP%]{min-width:0}.user-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-role.chip[_ngcontent-%COMP%]{font-size:.7rem;padding:2px 8px}.user-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);margin-left:auto}.logout-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;text-align:left;font-family:inherit}.main-content[_ngcontent-%COMP%]{background:var(--background);display:flex;flex-direction:column;width:calc(100% - var(--grandezzasidebar));min-height:100vh;margin-left:var(--grandezzasidebar);transition:margin-left .4s cubic-bezier(.25,.8,.25,1),width .4s cubic-bezier(.25,.8,.25,1);box-sizing:border-box;max-width:100%;transform:translateZ(0);will-change:margin-left,width}.top-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:var(--gutter-sm);background:transparent;border-bottom:1px solid var(--smoke-color-1);position:sticky;top:0;z-index:100;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);min-height:5rem}.sidebar-hamburger[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.sidebar-hamburger[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1)}.sidebar-hamburger[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex-shrink:0;padding:var(--gutter-sm);border-radius:8px;transition:all .3s cubic-bezier(.25,.8,.25,1)}.current-time[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;color:var(--primary)}.current-date[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-color);opacity:.7}.theme-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-color);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.theme-toggle[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);color:var(--primary)}.badge[_ngcontent-%COMP%]{color:var(--tertiary);padding:.2rem .6rem;background:var(--smoke-color-1);border-radius:50%}.page-content[_ngcontent-%COMP%]{flex:1;padding:0;overflow-y:auto}.mobile-overlay[_ngcontent-%COMP%]{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:999;opacity:0;visibility:hidden;transition:all .3s cubic-bezier(.25,.8,.25,1);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.mobile-overlay.active[_ngcontent-%COMP%]{opacity:1;visibility:visible}@media (max-width: 768px){.app-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.sidebar[_ngcontent-%COMP%]{transform:translate(-105%);box-shadow:0 8px 30px #0000001f;will-change:transform;width:100%}.sidebar[_ngcontent-%COMP%]:not(.hidden){transform:translate(0)}.mobile-overlay[_ngcontent-%COMP%]{display:block;background:#0006;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.header-actions[_ngcontent-%COMP%]{gap:var(--gutter-sm);align-items:flex-end}.current-time[_ngcontent-%COMP%]{font-size:var(--fs-sm)}.current-date[_ngcontent-%COMP%]{font-size:.8rem}}@media (max-width: 480px){.page-content[_ngcontent-%COMP%]{padding:var(--gutter-md)}.sidebar-footer[_ngcontent-%COMP%]{padding:var(--gutter-sm)}.user-section[_ngcontent-%COMP%], .user-actions[_ngcontent-%COMP%]{gap:var(--gutter-sm)}}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:var(--scrollbar-radius)}.sidebar-nav[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(-100%)}to{transform:translate(0)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.app-container.sidebar-collapsed[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]{width:100%;margin-left:0;max-width:100%;box-sizing:border-box}"]})};m0(Mp,Q(N({},Xv),{providers:[...Xv.providers??[],{provide:En,useClass:sl}]})).catch(n=>console.error(n));
